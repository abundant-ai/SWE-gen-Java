diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheKey.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheKey.kt
index 2e202d5a62d..6bc616af600 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheKey.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheKey.kt
@@ -55,7 +55,7 @@ class ConfigurationCacheKey(
 
         putAll(
             startParameter.includedBuilds.map {
-                relativePathOf(it, startParameter.buildTreeRootDirectory)
+                relativePathOf(it, startParameter.rootDirectory)
             }
         )
 
@@ -108,14 +108,14 @@ class ConfigurationCacheKey(
             if (projectDir != null) {
                 relativePathOf(
                     projectDir,
-                    startParameter.buildTreeRootDirectory
+                    startParameter.rootDirectory
                 ).let { relativeProjectDir ->
                     putString(relativeProjectDir)
                 }
             } else {
                 relativeChildPathOrNull(
                     startParameter.currentDirectory,
-                    startParameter.buildTreeRootDirectory
+                    startParameter.rootDirectory
                 )?.let { relativeSubDir ->
                     putString(relativeSubDir)
                 }
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCache.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCache.kt
index a537169e35f..ca71b014640 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCache.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCache.kt
@@ -851,7 +851,7 @@ class DefaultConfigurationCache internal constructor(
 
     private
     fun loadGradleProperties() {
-        gradlePropertiesController.loadGradlePropertiesFrom(startParameter.buildTreeRootDirectory, true)
+        gradlePropertiesController.loadGradlePropertiesFrom(startParameter.settingsDirectory, true)
     }
 
     private
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultIgnoredConfigurationInputs.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultIgnoredConfigurationInputs.kt
index 86b72e70b2a..009e731d670 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultIgnoredConfigurationInputs.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultIgnoredConfigurationInputs.kt
@@ -30,7 +30,7 @@ import javax.inject.Inject
 class DefaultIgnoredConfigurationInputs(
     ignoredPathsString: String?,
     isCaseSensitive: Boolean,
-    private val buildTreeRootDirectory: File
+    private val rootDirectory: File
 ) : IgnoredConfigurationInputs {
 
     @Inject
@@ -41,7 +41,7 @@ class DefaultIgnoredConfigurationInputs(
     ) : this(
         ignoredPathsString = configurationCacheStartParameter.ignoredFileSystemCheckInputs,
         isCaseSensitive = fileSystem.isCaseSensitive,
-        buildTreeRootDirectory = configurationCacheStartParameter.buildTreeRootDirectory
+        rootDirectory = configurationCacheStartParameter.rootDirectory
     )
 
     private
@@ -75,7 +75,7 @@ class DefaultIgnoredConfigurationInputs(
 
     private
     fun maybeRelativize(file: File): File =
-        if (!file.isAbsolute) file else File(GFileUtils.relativePathOf(file, buildTreeRootDirectory))
+        if (!file.isAbsolute) file else File(GFileUtils.relativePathOf(file, rootDirectory))
 
     private
     fun wildcardsToRegexPatternString(pathWithWildcards: String): String {
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/fingerprint/ConfigurationCacheInputFileChecker.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/fingerprint/ConfigurationCacheInputFileChecker.kt
index 25103cc277a..bbc59a61467 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/fingerprint/ConfigurationCacheInputFileChecker.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/fingerprint/ConfigurationCacheInputFileChecker.kt
@@ -82,7 +82,7 @@ internal class DefaultConfigurationCacheInputFileCheckerHost(
         }
 
     override fun displayNameOf(fileOrDirectory: File): String =
-        GFileUtils.relativePathOf(fileOrDirectory, startParameter.buildTreeRootDirectory)
+        GFileUtils.relativePathOf(fileOrDirectory, startParameter.rootDirectory)
 
     private fun locationSnapshot(file: File): FileSystemLocationSnapshot =
         fileSystemAccess.read(file.absolutePath)
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/initialization/ConfigurationCacheStartParameter.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/initialization/ConfigurationCacheStartParameter.kt
index a0f9782958d..aedb0e3c672 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/initialization/ConfigurationCacheStartParameter.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/initialization/ConfigurationCacheStartParameter.kt
@@ -20,7 +20,7 @@ import org.gradle.StartParameter
 import org.gradle.api.internal.StartParameterInternal
 import org.gradle.api.logging.LogLevel
 import org.gradle.initialization.StartParameterBuildOptions.ConfigurationCacheProblemsOption
-import org.gradle.initialization.layout.BuildTreeLocations
+import org.gradle.initialization.layout.BuildLayout
 import org.gradle.internal.buildoption.InternalOptions
 import org.gradle.internal.buildtree.BuildModelParameters
 import org.gradle.internal.cc.impl.ConfigurationCacheLoggingParameters
@@ -35,7 +35,7 @@ import java.io.File
 
 @ServiceScope(Scope.BuildTree::class)
 class ConfigurationCacheStartParameter internal constructor(
-    private val buildTreeLocations: BuildTreeLocations,
+    private val buildLayout: BuildLayout,
     private val startParameter: StartParameterInternal,
     options: InternalOptions,
     private val modelParameters: BuildModelParameters,
@@ -131,8 +131,11 @@ class ConfigurationCacheStartParameter internal constructor(
     val currentDirectory: File
         get() = startParameter.currentDir
 
-    val buildTreeRootDirectory: File
-        get() = buildTreeLocations.buildTreeRootDirectory
+    val settingsDirectory: File
+        get() = buildLayout.settingsDir
+
+    val rootDirectory: File
+        get() = buildLayout.rootDirectory
 
     val isOffline
         get() = startParameter.isOffline
diff --git a/platforms/core-configuration/configuration-cache/src/test/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheKeyTest.kt b/platforms/core-configuration/configuration-cache/src/test/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheKeyTest.kt
index d7b9c723e8e..60c692247d8 100644
--- a/platforms/core-configuration/configuration-cache/src/test/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheKeyTest.kt
+++ b/platforms/core-configuration/configuration-cache/src/test/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheKeyTest.kt
@@ -19,7 +19,6 @@ package org.gradle.internal.cc.impl
 import org.gradle.api.internal.StartParameterInternal
 import org.gradle.api.logging.LogLevel
 import org.gradle.initialization.layout.BuildLayout
-import org.gradle.initialization.layout.BuildTreeLocations
 import org.gradle.internal.buildoption.DefaultInternalOptions
 import org.gradle.internal.buildoption.Option
 import org.gradle.internal.buildtree.RunTasksRequirements
@@ -28,7 +27,6 @@ import org.gradle.internal.cc.impl.services.DefaultBuildModelParameters
 import org.gradle.internal.encryption.EncryptionConfiguration
 import org.gradle.internal.hash.HashCode
 import org.gradle.internal.hash.Hashing
-import org.gradle.internal.scripts.DefaultScriptFileResolver
 import org.gradle.test.fixtures.file.TestNameTestDirectoryProvider
 import org.gradle.util.internal.EncryptionAlgorithm
 import org.gradle.util.internal.SupportedEncryptionAlgorithm
@@ -138,7 +136,12 @@ class ConfigurationCacheKeyTest {
         val startParameter = StartParameterInternal().apply(configure)
         return ConfigurationCacheKey(
             ConfigurationCacheStartParameter(
-                BuildTreeLocations(BuildLayout(file("root"), null, DefaultScriptFileResolver())),
+                BuildLayout(
+                    file("root"),
+                    file("settings"),
+                    null,
+                    null
+                ),
                 startParameter,
                 DefaultInternalOptions(mapOf()),
                 DefaultBuildModelParameters(
diff --git a/platforms/core-runtime/launcher/src/main/java/org/gradle/tooling/internal/provider/LauncherServices.java b/platforms/core-runtime/launcher/src/main/java/org/gradle/tooling/internal/provider/LauncherServices.java
index 2d892fe4218..de145e5cfbe 100644
--- a/platforms/core-runtime/launcher/src/main/java/org/gradle/tooling/internal/provider/LauncherServices.java
+++ b/platforms/core-runtime/launcher/src/main/java/org/gradle/tooling/internal/provider/LauncherServices.java
@@ -31,7 +31,7 @@
 import org.gradle.initialization.BuildCancellationToken;
 import org.gradle.initialization.BuildEventConsumer;
 import org.gradle.initialization.BuildRequestMetaData;
-import org.gradle.initialization.layout.BuildTreeLocations;
+import org.gradle.initialization.layout.BuildLayout;
 import org.gradle.internal.build.BuildLayoutValidator;
 import org.gradle.internal.build.BuildStateRegistry;
 import org.gradle.internal.build.event.BuildEventListenerFactory;
@@ -216,7 +216,7 @@ BuildTreeActionExecutor createActionExecutor(
             FileHasherStatistics.Collector fileHasherStatisticsCollector,
             DirectorySnapshotterStatistics.Collector directorySnapshotterStatisticsCollector,
             BuildOperationRunner buildOperationRunner,
-            BuildTreeLocations buildTreeLocations,
+            BuildLayout buildLayout,
             ExceptionAnalyser exceptionAnalyser,
             List<ProblemReporter> problemReporters,
             BuildLoggerFactory buildLoggerFactory,
@@ -257,7 +257,7 @@ BuildTreeActionExecutor createActionExecutor(
                                     registry,
                                     new ProblemReportingBuildActionRunner(
                                         exceptionAnalyser,
-                                        buildTreeLocations,
+                                        buildLayout,
                                         problemReporters,
                                         new ChainingBuildActionRunner(buildActionRunners)
                                     )
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/DependencyManagementBuildTreeScopeServices.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/DependencyManagementBuildTreeScopeServices.java
index 0d4544ed907..e965c0ee93f 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/DependencyManagementBuildTreeScopeServices.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/DependencyManagementBuildTreeScopeServices.java
@@ -72,7 +72,7 @@
 import org.gradle.api.internal.filestore.DefaultArtifactIdentifierFileStore;
 import org.gradle.api.internal.filestore.TwoStageArtifactIdentifierFileStore;
 import org.gradle.api.internal.project.HoldsProjectState;
-import org.gradle.initialization.layout.BuildTreeLocations;
+import org.gradle.initialization.layout.BuildLayout;
 import org.gradle.internal.component.external.model.ModuleComponentGraphResolveStateFactory;
 import org.gradle.internal.component.local.model.LocalComponentGraphResolveStateFactory;
 import org.gradle.internal.component.model.ComponentIdGenerator;
@@ -177,8 +177,9 @@ ModuleDescriptorHashModuleSource.CODEC_ID, new ModuleDescriptorHashCodec()
     }
 
     @Provides
-    StartParameterResolutionOverride createStartParameterResolutionOverride(StartParameter startParameter, BuildTreeLocations buildTreeLocations) {
-        File gradleDir = new File(buildTreeLocations.getBuildTreeRootDirectory(), "gradle");
+    StartParameterResolutionOverride createStartParameterResolutionOverride(StartParameter startParameter, BuildLayout buildLayout) {
+        File rootDirectory = buildLayout.getRootDirectory();
+        File gradleDir = new File(rootDirectory, "gradle");
         return new StartParameterResolutionOverride(startParameter, gradleDir);
     }
 
diff --git a/subprojects/core/src/main/java/org/gradle/initialization/layout/BuildLayout.java b/subprojects/core/src/main/java/org/gradle/initialization/layout/BuildLayout.java
index fa50f99e2f3..e2fe638c108 100644
--- a/subprojects/core/src/main/java/org/gradle/initialization/layout/BuildLayout.java
+++ b/subprojects/core/src/main/java/org/gradle/initialization/layout/BuildLayout.java
@@ -25,14 +25,16 @@
 
 import static org.gradle.initialization.DefaultProjectDescriptor.BUILD_SCRIPT_BASENAME;
 
-@ServiceScope(Scope.Build.class)
+@ServiceScope({Scope.BuildSession.class, Scope.Build.class})
 public class BuildLayout extends SettingsLocation {
+    private final File rootDirectory;
     private final ScriptFileResolver scriptFileResolver;
 
     // Note: `null` for `settingsFile` means explicitly no settings
     //       A non null value can be a non existent file, which is semantically equivalent to an empty file
-    public BuildLayout(File rootDirectory, @Nullable File settingsFile, ScriptFileResolver scriptFileResolver) {
-        super(rootDirectory, settingsFile);
+    public BuildLayout(File rootDirectory, File settingsDir, @Nullable File settingsFile, ScriptFileResolver scriptFileResolver) {
+        super(settingsDir, settingsFile);
+        this.rootDirectory = rootDirectory;
         this.scriptFileResolver = scriptFileResolver;
     }
 
@@ -47,6 +49,6 @@ public boolean isBuildDefinitionMissing() {
      * Returns the root directory of the build, is never null.
      */
     public File getRootDirectory() {
-        return getSettingsDir();
+        return rootDirectory;
     }
 }
diff --git a/subprojects/core/src/main/java/org/gradle/initialization/layout/BuildLayoutFactory.java b/subprojects/core/src/main/java/org/gradle/initialization/layout/BuildLayoutFactory.java
index 17f9e8ef6f6..eef831b2382 100644
--- a/subprojects/core/src/main/java/org/gradle/initialization/layout/BuildLayoutFactory.java
+++ b/subprojects/core/src/main/java/org/gradle/initialization/layout/BuildLayoutFactory.java
@@ -47,8 +47,11 @@ public BuildLayoutFactory() {
      */
     public BuildLayout getLayoutFor(File currentDir, boolean shouldSearchUpwards) {
         boolean searchUpwards = shouldSearchUpwards && !isBuildSrc(currentDir);
-        BuildLayout layout = searchUpwards ? findLayoutRecursively(currentDir) : findLayout(currentDir);
-        return layout != null ? layout : getLayoutWithDefaultSettingsFile(currentDir);
+        return getLayoutFor(currentDir, searchUpwards ? null : currentDir.getParentFile());
+    }
+
+    private boolean isBuildSrc(File currentDir) {
+        return currentDir.getName().equals(SettingsInternal.BUILD_SRC);
     }
 
     /**
@@ -56,44 +59,35 @@ public BuildLayout getLayoutFor(File currentDir, boolean shouldSearchUpwards) {
      */
     public BuildLayout getLayoutFor(BuildLayoutConfiguration configuration) {
         if (configuration.isUseEmptySettings()) {
-            return layout(configuration.getCurrentDir(), null);
+            return buildLayoutFrom(configuration, null);
         }
         return getLayoutFor(configuration.getCurrentDir(), configuration.isSearchUpwards());
     }
 
+    private BuildLayout buildLayoutFrom(BuildLayoutConfiguration configuration, File settingsFile) {
+        return new BuildLayout(configuration.getCurrentDir(), configuration.getCurrentDir(), settingsFile, scriptFileResolver);
+    }
+
     @Nullable
     public File findExistingSettingsFileIn(File directory) {
         return scriptFileResolver.resolveScriptFile(directory, DEFAULT_SETTINGS_FILE_BASENAME);
     }
 
-    @Nullable
-    private BuildLayout findLayoutRecursively(File dir) {
-        while (dir != null) {
-            BuildLayout layout = findLayout(dir);
-            if (layout != null) {
-                return layout;
+    BuildLayout getLayoutFor(File currentDir, File stopAt) {
+        File settingsFile = findExistingSettingsFileIn(currentDir);
+        if (settingsFile != null) {
+            return layout(currentDir, settingsFile);
+        }
+        for (File candidate = currentDir.getParentFile(); candidate != null && !candidate.equals(stopAt); candidate = candidate.getParentFile()) {
+            settingsFile = findExistingSettingsFileIn(candidate);
+            if (settingsFile != null) {
+                return layout(candidate, settingsFile);
             }
-            dir = dir.getParentFile();
         }
-        return null;
-    }
-
-    @Nullable
-    private BuildLayout findLayout(File dir) {
-        File settingsFile = findExistingSettingsFileIn(dir);
-        return settingsFile != null ? layout(dir, settingsFile) : null;
-    }
-
-    private BuildLayout getLayoutWithDefaultSettingsFile(File dir) {
-        return layout(dir, new File(dir, Settings.DEFAULT_SETTINGS_FILE));
-    }
-
-    private BuildLayout layout(File rootDir, @Nullable File settingsFile) {
-        File canonicalSettingsFile = settingsFile != null ? FileUtils.canonicalize(settingsFile) : null;
-        return new BuildLayout(rootDir, canonicalSettingsFile, scriptFileResolver);
+        return layout(currentDir, new File(currentDir, Settings.DEFAULT_SETTINGS_FILE));
     }
 
-    private static boolean isBuildSrc(File dir) {
-        return dir.getName().equals(SettingsInternal.BUILD_SRC);
+    private BuildLayout layout(File rootDir, File settingsFile) {
+        return new BuildLayout(rootDir, settingsFile.getParentFile(), FileUtils.canonicalize(settingsFile), scriptFileResolver);
     }
 }
diff --git a/subprojects/core/src/main/java/org/gradle/initialization/layout/BuildTreeLocations.java b/subprojects/core/src/main/java/org/gradle/initialization/layout/BuildTreeLocations.java
deleted file mode 100644
index 845038520f2..00000000000
--- a/subprojects/core/src/main/java/org/gradle/initialization/layout/BuildTreeLocations.java
+++ /dev/null
@@ -1,56 +0,0 @@
-/*
- * Copyright 2025 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.initialization.layout;
-
-import org.gradle.internal.service.scopes.Scope;
-import org.gradle.internal.service.scopes.ServiceScope;
-
-import java.io.File;
-
-/**
- * Locations required to set up and manage a build tree.
- * <p>
- * The locations are fixed even for a build-session scope, because they can't change during a continuous build.
- */
-@ServiceScope(Scope.BuildSession.class)
-public class BuildTreeLocations {
-
-    private final BuildLayout rootBuildLayout;
-
-    public BuildTreeLocations(BuildLayout rootBuildLayout) {
-        this.rootBuildLayout = rootBuildLayout;
-    }
-
-    /**
-     * Root directory of the build tree.
-     * <p>
-     * It always matches the root directory of the root build, which is also the same as the settings directory of the root build.
-     * <p>
-     * Note that this directory can technically differ from the <code>Project.rootDir</code>, because the latter is mutable during settings
-     * via the <code>ProjectDescriptor</code> of the root project.
-     */
-    public File getBuildTreeRootDirectory() {
-        return rootBuildLayout.getRootDirectory();
-    }
-
-    /**
-     * Layout of the root build.
-     */
-    public BuildLayout getRootBuildLayout() {
-        return rootBuildLayout;
-    }
-}
diff --git a/subprojects/core/src/main/java/org/gradle/initialization/layout/package-info.java b/subprojects/core/src/main/java/org/gradle/initialization/layout/package-info.java
deleted file mode 100644
index 97b045c663d..00000000000
--- a/subprojects/core/src/main/java/org/gradle/initialization/layout/package-info.java
+++ /dev/null
@@ -1,18 +0,0 @@
-/*
- * Copyright 2025 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-@org.jspecify.annotations.NullMarked
-package org.gradle.initialization.layout;
diff --git a/subprojects/core/src/main/java/org/gradle/internal/buildtree/ProblemReportingBuildActionRunner.java b/subprojects/core/src/main/java/org/gradle/internal/buildtree/ProblemReportingBuildActionRunner.java
index 083244d3700..f301d1e8a48 100644
--- a/subprojects/core/src/main/java/org/gradle/internal/buildtree/ProblemReportingBuildActionRunner.java
+++ b/subprojects/core/src/main/java/org/gradle/internal/buildtree/ProblemReportingBuildActionRunner.java
@@ -18,7 +18,7 @@
 
 import com.google.common.collect.ImmutableList;
 import org.gradle.api.invocation.Gradle;
-import org.gradle.initialization.layout.BuildTreeLocations;
+import org.gradle.initialization.layout.BuildLayout;
 import org.gradle.internal.InternalBuildAdapter;
 import org.gradle.internal.exception.ExceptionAnalyser;
 import org.gradle.internal.invocation.BuildAction;
@@ -33,18 +33,18 @@
 public class ProblemReportingBuildActionRunner implements BuildActionRunner {
     private final BuildActionRunner delegate;
     private final ExceptionAnalyser exceptionAnalyser;
-    private final BuildTreeLocations buildTreeLocations;
+    private final BuildLayout buildLayout;
     private final List<? extends ProblemReporter> reporters;
 
     public ProblemReportingBuildActionRunner(
         ExceptionAnalyser exceptionAnalyser,
-        BuildTreeLocations buildTreeLocations,
+        BuildLayout buildLayout,
         List<? extends ProblemReporter> reporters,
         BuildActionRunner delegate
     ) {
         this.delegate = delegate;
         this.exceptionAnalyser = exceptionAnalyser;
-        this.buildTreeLocations = buildTreeLocations;
+        this.buildLayout = buildLayout;
         this.reporters = ImmutableList.sortedCopyOf(Comparator.comparing(ProblemReporter::getId), reporters);
     }
 
@@ -80,7 +80,7 @@ private RootProjectBuildDirCollectingListener getRootProjectBuildDirCollectingLi
     }
 
     private File defaultRootBuildDirOf() {
-        return new File(buildTreeLocations.getBuildTreeRootDirectory(), "build");
+        return new File(buildLayout.getRootDirectory(), "build");
     }
 
     private static class RootProjectBuildDirCollectingListener extends InternalBuildAdapter {
diff --git a/subprojects/core/src/main/java/org/gradle/internal/service/scopes/CoreBuildSessionServices.java b/subprojects/core/src/main/java/org/gradle/internal/service/scopes/CoreBuildSessionServices.java
index ebf632fad07..17ec1fb7f5b 100644
--- a/subprojects/core/src/main/java/org/gradle/internal/service/scopes/CoreBuildSessionServices.java
+++ b/subprojects/core/src/main/java/org/gradle/internal/service/scopes/CoreBuildSessionServices.java
@@ -42,7 +42,6 @@
 import org.gradle.initialization.layout.BuildLayout;
 import org.gradle.initialization.layout.BuildLayoutConfiguration;
 import org.gradle.initialization.layout.BuildLayoutFactory;
-import org.gradle.initialization.layout.BuildTreeLocations;
 import org.gradle.initialization.layout.ProjectCacheDir;
 import org.gradle.internal.build.BuildLayoutValidator;
 import org.gradle.internal.buildevents.BuildStartedTime;
@@ -103,25 +102,24 @@ CrossProjectConfigurator createCrossProjectConfigurator(BuildOperationRunner bui
     }
 
     @Provides
-    BuildTreeLocations createBuildTreeLocations(BuildLayoutFactory buildLayoutFactory, StartParameter startParameter) {
-        BuildLayout rootBuildLayout = buildLayoutFactory.getLayoutFor(new BuildLayoutConfiguration(startParameter));
-        return new BuildTreeLocations(rootBuildLayout);
+    BuildLayout createBuildLocations(BuildLayoutFactory buildLayoutFactory, StartParameter startParameter) {
+        return buildLayoutFactory.getLayoutFor(new BuildLayoutConfiguration(startParameter));
     }
 
     @Provides
-    FileResolver createFileResolver(FileLookup fileLookup, BuildTreeLocations buildTreeLocations) {
-        return fileLookup.getFileResolver(buildTreeLocations.getBuildTreeRootDirectory());
+    FileResolver createFileResolver(FileLookup fileLookup, BuildLayout buildLayout) {
+        return fileLookup.getFileResolver(buildLayout.getRootDirectory());
     }
 
     @Provides
     ProjectCacheDir createProjectCacheDir(
         GradleUserHomeDirProvider userHomeDirProvider,
-        BuildTreeLocations buildTreeLocations,
+        BuildLayout buildLayout,
         Deleter deleter,
         BuildOperationRunner buildOperationRunner,
         StartParameter startParameter
     ) {
-        BuildScopeCacheDir cacheDir = new BuildScopeCacheDir(userHomeDirProvider, buildTreeLocations.getRootBuildLayout(), startParameter);
+        BuildScopeCacheDir cacheDir = new BuildScopeCacheDir(userHomeDirProvider, buildLayout, startParameter);
         return new ProjectCacheDir(cacheDir.getDir(), buildOperationRunner, deleter);
     }
 
diff --git a/subprojects/core/src/test/groovy/org/gradle/initialization/DefaultSettingsLoaderTest.groovy b/subprojects/core/src/test/groovy/org/gradle/initialization/DefaultSettingsLoaderTest.groovy
index 147e6a460c2..ad713d09186 100644
--- a/subprojects/core/src/test/groovy/org/gradle/initialization/DefaultSettingsLoaderTest.groovy
+++ b/subprojects/core/src/test/groovy/org/gradle/initialization/DefaultSettingsLoaderTest.groovy
@@ -44,7 +44,7 @@ class DefaultSettingsLoaderTest extends Specification {
         file.deleteOnExit()
         FileUtils.canonicalize(file)
     }
-    private mockBuildLayout = new BuildLayout(projectRootDir, null, Stub(ScriptFileResolver))
+    private mockBuildLayout = new BuildLayout(null, projectRootDir, null, Stub(ScriptFileResolver))
     @SuppressWarnings('GroovyAssignabilityCheck')
     private mockBuildLayoutFactory = Mock(BuildLayoutFactory) {
         getLayoutFor(_) >> mockBuildLayout
diff --git a/subprojects/core/src/test/groovy/org/gradle/initialization/layout/BuildLayoutFactoryTest.groovy b/subprojects/core/src/test/groovy/org/gradle/initialization/layout/BuildLayoutFactoryTest.groovy
index a938a4a39cb..e088f86b2c4 100644
--- a/subprojects/core/src/test/groovy/org/gradle/initialization/layout/BuildLayoutFactoryTest.groovy
+++ b/subprojects/core/src/test/groovy/org/gradle/initialization/layout/BuildLayoutFactoryTest.groovy
@@ -16,11 +16,9 @@
 package org.gradle.initialization.layout
 
 import org.gradle.api.internal.StartParameterInternal
-import org.gradle.internal.FileUtils
 import org.gradle.internal.scripts.ScriptFileUtil
 import org.gradle.test.fixtures.file.TestNameTestDirectoryProvider
 import org.junit.Rule
-import org.junit.rules.TemporaryFolder
 import spock.lang.Specification
 
 class BuildLayoutFactoryTest extends Specification {
@@ -132,25 +130,19 @@ class BuildLayoutFactoryTest extends Specification {
         settingsFilename << TEST_CASES
     }
 
-    def "returns current directory when no settings files in current and all parent directories"() {
+    def "returns current directory when no settings or wrapper properties files"() {
         given:
         def locator = buildLayoutFactoryFor()
-        // A directory that will not have Gradle settings file in any of its parents up to the file system root
-        def tmpDir = new TemporaryFolder()
-        tmpDir.create()
 
         and:
-        def currentDir = tmpDir.newFolder("sub", "current")
+        def currentDir = tmpDir.createDir("sub/current")
 
         expect:
-        def layout = locator.getLayoutFor(currentDir, true)
+        def layout = locator.getLayoutFor(currentDir, tmpDir.testDirectory)
         layout.rootDirectory == currentDir
         layout.settingsDir == currentDir
-        layout.settingsFile == FileUtils.canonicalize(new File(currentDir, "settings.gradle"))
+        layout.settingsFile == new File(currentDir, "settings.gradle") // this is the current behaviour
         layout.buildDefinitionMissing
-
-        cleanup:
-        tmpDir.delete()
     }
 
     def "can override build layout by specifying an empty settings script with existing #settingsFilename"() {
diff --git a/testing/architecture-test/src/changes/archunit-store/internal-api-nullability.txt b/testing/architecture-test/src/changes/archunit-store/internal-api-nullability.txt
index 9b13efc9325..5d1800f5ef9 100644
--- a/testing/architecture-test/src/changes/archunit-store/internal-api-nullability.txt
+++ b/testing/architecture-test/src/changes/archunit-store/internal-api-nullability.txt
@@ -1387,6 +1387,13 @@ Class <org.gradle.initialization.exception.ExceptionCollector> is not annotated
 Class <org.gradle.initialization.exception.InitializationException> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (InitializationException.java:0)
 Class <org.gradle.initialization.exception.MultipleBuildFailuresExceptionAnalyser> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (MultipleBuildFailuresExceptionAnalyser.java:0)
 Class <org.gradle.initialization.exception.StackTraceSanitizingExceptionAnalyser> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (StackTraceSanitizingExceptionAnalyser.java:0)
+Class <org.gradle.initialization.layout.BuildLayout> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (BuildLayout.java:0)
+Class <org.gradle.initialization.layout.BuildLayoutConfiguration> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (BuildLayoutConfiguration.java:0)
+Class <org.gradle.initialization.layout.BuildLayoutFactory> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (BuildLayoutFactory.java:0)
+Class <org.gradle.initialization.layout.GlobalCacheDir> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (GlobalCacheDir.java:0)
+Class <org.gradle.initialization.layout.ProjectCacheDir$1> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (ProjectCacheDir.java:0)
+Class <org.gradle.initialization.layout.ProjectCacheDir> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (ProjectCacheDir.java:0)
+Class <org.gradle.initialization.layout.ResolvedBuildLayout> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (ResolvedBuildLayout.java:0)
 Class <org.gradle.initialization.properties.DefaultProjectPropertiesLoader> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (DefaultProjectPropertiesLoader.java:0)
 Class <org.gradle.initialization.properties.DefaultSystemPropertiesInstaller> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (DefaultSystemPropertiesInstaller.java:0)
 Class <org.gradle.initialization.properties.MutableGradleProperties> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (MutableGradleProperties.java:0)
