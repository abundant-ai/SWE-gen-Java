diff --git a/ktor-server/ktor-server-plugins/ktor-server-di/api/ktor-server-di.api b/ktor-server/ktor-server-plugins/ktor-server-di/api/ktor-server-di.api
index b4c3b7ff1..692fc6b60 100644
--- a/ktor-server/ktor-server-plugins/ktor-server-di/api/ktor-server-di.api
+++ b/ktor-server/ktor-server-plugins/ktor-server-di/api/ktor-server-di.api
@@ -210,11 +210,12 @@ public class io/ktor/server/plugins/di/DependencyReflectionJvm : io/ktor/server/
 	public fun toDependencyKey (Lkotlin/reflect/KParameter;)Lio/ktor/server/plugins/di/DependencyKey;
 }
 
-public final class io/ktor/server/plugins/di/DependencyRegistry : io/ktor/server/plugins/di/DependencyProvider, io/ktor/server/plugins/di/DependencyResolver {
-	public fun <init> (Lio/ktor/server/plugins/di/DependencyProvider;Lio/ktor/server/plugins/di/DependencyMap;Lio/ktor/server/plugins/di/DependencyResolution;Lio/ktor/server/plugins/di/DependencyReflection;)V
+public final class io/ktor/server/plugins/di/DependencyRegistry : io/ktor/server/plugins/di/DependencyProvider, io/ktor/server/plugins/di/DependencyResolver, kotlinx/coroutines/CoroutineScope {
+	public fun <init> (Lio/ktor/server/plugins/di/DependencyProvider;Lio/ktor/server/plugins/di/DependencyMap;Lio/ktor/server/plugins/di/DependencyResolution;Lio/ktor/server/plugins/di/DependencyReflection;Lkotlin/coroutines/CoroutineContext;)V
 	public final fun cleanup (Lio/ktor/server/plugins/di/DependencyKey;Lkotlin/jvm/functions/Function1;)V
 	public fun contains (Lio/ktor/server/plugins/di/DependencyKey;)Z
 	public fun get (Lio/ktor/server/plugins/di/DependencyKey;)Ljava/lang/Object;
+	public fun getCoroutineContext ()Lkotlin/coroutines/CoroutineContext;
 	public fun getDeclarations ()Ljava/util/Map;
 	public fun getOrPut (Lio/ktor/server/plugins/di/DependencyKey;Lkotlin/jvm/functions/Function0;)Ljava/lang/Object;
 	public fun getReflection ()Lio/ktor/server/plugins/di/DependencyReflection;
@@ -292,11 +293,12 @@ public final class io/ktor/server/plugins/di/InvalidDependencyReferenceException
 	public synthetic fun <init> (Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;ILkotlin/jvm/internal/DefaultConstructorMarker;)V
 }
 
-public class io/ktor/server/plugins/di/MapDependencyProvider : io/ktor/server/plugins/di/DependencyProvider {
+public class io/ktor/server/plugins/di/MapDependencyProvider : io/ktor/server/plugins/di/DependencyProvider, kotlinx/coroutines/CoroutineScope {
 	public fun <init> ()V
-	public fun <init> (Lio/ktor/server/plugins/di/DependencyKeyCovariance;Lio/ktor/server/plugins/di/DependencyConflictPolicy;Lkotlin/jvm/functions/Function1;Lorg/slf4j/Logger;)V
-	public synthetic fun <init> (Lio/ktor/server/plugins/di/DependencyKeyCovariance;Lio/ktor/server/plugins/di/DependencyConflictPolicy;Lkotlin/jvm/functions/Function1;Lorg/slf4j/Logger;ILkotlin/jvm/internal/DefaultConstructorMarker;)V
+	public fun <init> (Lio/ktor/server/plugins/di/DependencyKeyCovariance;Lio/ktor/server/plugins/di/DependencyConflictPolicy;Lkotlin/jvm/functions/Function1;Lkotlin/coroutines/CoroutineContext;Lorg/slf4j/Logger;)V
+	public synthetic fun <init> (Lio/ktor/server/plugins/di/DependencyKeyCovariance;Lio/ktor/server/plugins/di/DependencyConflictPolicy;Lkotlin/jvm/functions/Function1;Lkotlin/coroutines/CoroutineContext;Lorg/slf4j/Logger;ILkotlin/jvm/internal/DefaultConstructorMarker;)V
 	public final fun getConflictPolicy ()Lio/ktor/server/plugins/di/DependencyConflictPolicy;
+	public fun getCoroutineContext ()Lkotlin/coroutines/CoroutineContext;
 	public fun getDeclarations ()Ljava/util/Map;
 	public final fun getKeyMapping ()Lio/ktor/server/plugins/di/DependencyKeyCovariance;
 	public final fun getOnConflict ()Lkotlin/jvm/functions/Function1;
diff --git a/ktor-server/ktor-server-plugins/ktor-server-di/api/ktor-server-di.klib.api b/ktor-server/ktor-server-plugins/ktor-server-di/api/ktor-server-di.klib.api
index fcb0f9981..202154fdb 100644
--- a/ktor-server/ktor-server-plugins/ktor-server-di/api/ktor-server-di.klib.api
+++ b/ktor-server/ktor-server-plugins/ktor-server-di/api/ktor-server-di.klib.api
@@ -223,9 +223,11 @@ final class io.ktor.server.plugins.di/DependencyMapImpl : io.ktor.server.plugins
     final fun contains(io.ktor.server.plugins.di/DependencyKey): kotlin/Boolean // io.ktor.server.plugins.di/DependencyMapImpl.contains|contains(io.ktor.server.plugins.di.DependencyKey){}[0]
 }
 
-final class io.ktor.server.plugins.di/DependencyRegistry : io.ktor.server.plugins.di/DependencyProvider, io.ktor.server.plugins.di/DependencyResolver { // io.ktor.server.plugins.di/DependencyRegistry|null[0]
-    constructor <init>(io.ktor.server.plugins.di/DependencyProvider, io.ktor.server.plugins.di/DependencyMap, io.ktor.server.plugins.di/DependencyResolution, io.ktor.server.plugins.di/DependencyReflection) // io.ktor.server.plugins.di/DependencyRegistry.<init>|<init>(io.ktor.server.plugins.di.DependencyProvider;io.ktor.server.plugins.di.DependencyMap;io.ktor.server.plugins.di.DependencyResolution;io.ktor.server.plugins.di.DependencyReflection){}[0]
+final class io.ktor.server.plugins.di/DependencyRegistry : io.ktor.server.plugins.di/DependencyProvider, io.ktor.server.plugins.di/DependencyResolver, kotlinx.coroutines/CoroutineScope { // io.ktor.server.plugins.di/DependencyRegistry|null[0]
+    constructor <init>(io.ktor.server.plugins.di/DependencyProvider, io.ktor.server.plugins.di/DependencyMap, io.ktor.server.plugins.di/DependencyResolution, io.ktor.server.plugins.di/DependencyReflection, kotlin.coroutines/CoroutineContext) // io.ktor.server.plugins.di/DependencyRegistry.<init>|<init>(io.ktor.server.plugins.di.DependencyProvider;io.ktor.server.plugins.di.DependencyMap;io.ktor.server.plugins.di.DependencyResolution;io.ktor.server.plugins.di.DependencyReflection;kotlin.coroutines.CoroutineContext){}[0]
 
+    final val coroutineContext // io.ktor.server.plugins.di/DependencyRegistry.coroutineContext|{}coroutineContext[0]
+        final fun <get-coroutineContext>(): kotlin.coroutines/CoroutineContext // io.ktor.server.plugins.di/DependencyRegistry.coroutineContext.<get-coroutineContext>|<get-coroutineContext>(){}[0]
     final val declarations // io.ktor.server.plugins.di/DependencyRegistry.declarations|{}declarations[0]
         final fun <get-declarations>(): kotlin.collections/Map<io.ktor.server.plugins.di/DependencyKey, io.ktor.server.plugins.di/DependencyCreateFunction> // io.ktor.server.plugins.di/DependencyRegistry.declarations.<get-declarations>|<get-declarations>(){}[0]
     final val reflection // io.ktor.server.plugins.di/DependencyRegistry.reflection|{}reflection[0]
@@ -237,10 +239,11 @@ final class io.ktor.server.plugins.di/DependencyRegistry : io.ktor.server.plugin
     final fun cleanup(io.ktor.server.plugins.di/DependencyKey, kotlin/Function1<kotlin/Any?, kotlin/Unit>) // io.ktor.server.plugins.di/DependencyRegistry.cleanup|cleanup(io.ktor.server.plugins.di.DependencyKey;kotlin.Function1<kotlin.Any?,kotlin.Unit>){}[0]
     final fun contains(io.ktor.server.plugins.di/DependencyKey): kotlin/Boolean // io.ktor.server.plugins.di/DependencyRegistry.contains|contains(io.ktor.server.plugins.di.DependencyKey){}[0]
     final fun require(io.ktor.server.plugins.di/DependencyKey) // io.ktor.server.plugins.di/DependencyRegistry.require|require(io.ktor.server.plugins.di.DependencyKey){}[0]
-    final inline fun <#A1: reified kotlin/Any> (io.ktor.server.plugins.di/DependencyProvider).provide(kotlin.reflect/KClass<out #A1>) // io.ktor.server.plugins.di/DependencyRegistry.provide|provide@io.ktor.server.plugins.di.DependencyProvider(kotlin.reflect.KClass<out|0:0>){0§<kotlin.Any>}[0]
+    final inline fun <#A1: reified kotlin/Any> provide(kotlin.reflect/KClass<out #A1>): io.ktor.server.plugins.di/DependencyRegistry.KeyContext<#A1> // io.ktor.server.plugins.di/DependencyRegistry.provide|provide(kotlin.reflect.KClass<out|0:0>){0§<kotlin.Any>}[0]
     final inline fun <#A1: reified kotlin/Any?> cleanup(kotlin/String? = ..., noinline kotlin/Function1<#A1, kotlin/Unit>): io.ktor.server.plugins.di/DependencyRegistry.KeyContext<#A1> // io.ktor.server.plugins.di/DependencyRegistry.cleanup|cleanup(kotlin.String?;kotlin.Function1<0:0,kotlin.Unit>){0§<kotlin.Any?>}[0]
     final inline fun <#A1: reified kotlin/Any?> key(kotlin/String? = ..., noinline kotlin/Function1<io.ktor.server.plugins.di/DependencyRegistry.KeyContext<#A1>, kotlin/Unit>): io.ktor.server.plugins.di/DependencyRegistry.KeyContext<#A1> // io.ktor.server.plugins.di/DependencyRegistry.key|key(kotlin.String?;kotlin.Function1<io.ktor.server.plugins.di.DependencyRegistry.KeyContext<0:0>,kotlin.Unit>){0§<kotlin.Any?>}[0]
     final inline fun <#A1: reified kotlin/Any?> provide(kotlin/String? = ..., noinline kotlin/Function1<io.ktor.server.plugins.di/DependencyResolver, #A1?>): io.ktor.server.plugins.di/DependencyRegistry.KeyContext<#A1> // io.ktor.server.plugins.di/DependencyRegistry.provide|provide(kotlin.String?;kotlin.Function1<io.ktor.server.plugins.di.DependencyResolver,0:0?>){0§<kotlin.Any?>}[0]
+    final inline fun <#A1: reified kotlin/Any?> provideAsync(kotlin/String? = ..., noinline kotlin.coroutines/SuspendFunction1<io.ktor.server.plugins.di/DependencyResolver, #A1?>): io.ktor.server.plugins.di/DependencyRegistry.KeyContext<kotlinx.coroutines/Deferred<#A1>> // io.ktor.server.plugins.di/DependencyRegistry.provideAsync|provideAsync(kotlin.String?;kotlin.coroutines.SuspendFunction1<io.ktor.server.plugins.di.DependencyResolver,0:0?>){0§<kotlin.Any?>}[0]
     final inline fun <#A1: reified kotlin/Any?> provideDelegate(kotlin/Any?, kotlin.reflect/KProperty<*>): kotlin.properties/ReadOnlyProperty<kotlin/Any?, #A1> // io.ktor.server.plugins.di/DependencyRegistry.provideDelegate|provideDelegate(kotlin.Any?;kotlin.reflect.KProperty<*>){0§<kotlin.Any?>}[0]
     final inline fun <#A1: reified kotlin/Any?> resolve(kotlin/String? = ...): #A1 // io.ktor.server.plugins.di/DependencyRegistry.resolve|resolve(kotlin.String?){0§<kotlin.Any?>}[0]
 
@@ -328,8 +331,8 @@ open class io.ktor.server.plugins.di/DependencyInjectionException : kotlin/Runti
     constructor <init>(kotlin/String? = ..., kotlin/Throwable? = ...) // io.ktor.server.plugins.di/DependencyInjectionException.<init>|<init>(kotlin.String?;kotlin.Throwable?){}[0]
 }
 
-open class io.ktor.server.plugins.di/MapDependencyProvider : io.ktor.server.plugins.di/DependencyProvider { // io.ktor.server.plugins.di/MapDependencyProvider|null[0]
-    constructor <init>(io.ktor.server.plugins.di/DependencyKeyCovariance = ..., io.ktor.server.plugins.di/DependencyConflictPolicy = ..., kotlin/Function1<io.ktor.server.plugins.di/DependencyKey, kotlin/Unit> = ..., io.ktor.util.logging/Logger = ...) // io.ktor.server.plugins.di/MapDependencyProvider.<init>|<init>(io.ktor.server.plugins.di.DependencyKeyCovariance;io.ktor.server.plugins.di.DependencyConflictPolicy;kotlin.Function1<io.ktor.server.plugins.di.DependencyKey,kotlin.Unit>;io.ktor.util.logging.Logger){}[0]
+open class io.ktor.server.plugins.di/MapDependencyProvider : io.ktor.server.plugins.di/DependencyProvider, kotlinx.coroutines/CoroutineScope { // io.ktor.server.plugins.di/MapDependencyProvider|null[0]
+    constructor <init>(io.ktor.server.plugins.di/DependencyKeyCovariance = ..., io.ktor.server.plugins.di/DependencyConflictPolicy = ..., kotlin/Function1<io.ktor.server.plugins.di/DependencyKey, kotlin/Unit> = ..., kotlin.coroutines/CoroutineContext = ..., io.ktor.util.logging/Logger = ...) // io.ktor.server.plugins.di/MapDependencyProvider.<init>|<init>(io.ktor.server.plugins.di.DependencyKeyCovariance;io.ktor.server.plugins.di.DependencyConflictPolicy;kotlin.Function1<io.ktor.server.plugins.di.DependencyKey,kotlin.Unit>;kotlin.coroutines.CoroutineContext;io.ktor.util.logging.Logger){}[0]
 
     final val conflictPolicy // io.ktor.server.plugins.di/MapDependencyProvider.conflictPolicy|{}conflictPolicy[0]
         final fun <get-conflictPolicy>(): io.ktor.server.plugins.di/DependencyConflictPolicy // io.ktor.server.plugins.di/MapDependencyProvider.conflictPolicy.<get-conflictPolicy>|<get-conflictPolicy>(){}[0]
@@ -337,6 +340,8 @@ open class io.ktor.server.plugins.di/MapDependencyProvider : io.ktor.server.plug
         final fun <get-keyMapping>(): io.ktor.server.plugins.di/DependencyKeyCovariance // io.ktor.server.plugins.di/MapDependencyProvider.keyMapping.<get-keyMapping>|<get-keyMapping>(){}[0]
     final val onConflict // io.ktor.server.plugins.di/MapDependencyProvider.onConflict|{}onConflict[0]
         final fun <get-onConflict>(): kotlin/Function1<io.ktor.server.plugins.di/DependencyKey, kotlin/Unit> // io.ktor.server.plugins.di/MapDependencyProvider.onConflict.<get-onConflict>|<get-onConflict>(){}[0]
+    open val coroutineContext // io.ktor.server.plugins.di/MapDependencyProvider.coroutineContext|{}coroutineContext[0]
+        open fun <get-coroutineContext>(): kotlin.coroutines/CoroutineContext // io.ktor.server.plugins.di/MapDependencyProvider.coroutineContext.<get-coroutineContext>|<get-coroutineContext>(){}[0]
     open val declarations // io.ktor.server.plugins.di/MapDependencyProvider.declarations|{}declarations[0]
         open fun <get-declarations>(): kotlin.collections/Map<io.ktor.server.plugins.di/DependencyKey, io.ktor.server.plugins.di/DependencyCreateFunction> // io.ktor.server.plugins.di/MapDependencyProvider.declarations.<get-declarations>|<get-declarations>(){}[0]
 
@@ -394,3 +399,4 @@ final inline fun <#A: reified kotlin/Any> (io.ktor.server.plugins.di/DependencyR
 final inline fun <#A: reified kotlin/Any?> (io.ktor.server.plugins.di/DependencyMap).io.ktor.server.plugins.di/resolve(kotlin/String? = ...): #A // io.ktor.server.plugins.di/resolve|resolve@io.ktor.server.plugins.di.DependencyMap(kotlin.String?){0§<kotlin.Any?>}[0]
 final inline fun <#A: reified kotlin/Any?> (io.ktor.server.plugins.di/DependencyProvider).io.ktor.server.plugins.di/provide(kotlin/String? = ..., noinline kotlin/Function1<io.ktor.server.plugins.di/DependencyResolver, #A?>) // io.ktor.server.plugins.di/provide|provide@io.ktor.server.plugins.di.DependencyProvider(kotlin.String?;kotlin.Function1<io.ktor.server.plugins.di.DependencyResolver,0:0?>){0§<kotlin.Any?>}[0]
 final inline fun <#A: reified kotlin/Any?> io.ktor.server.plugins.di/DependencyKey(kotlin/String? = ..., kotlin/Any? = ...): io.ktor.server.plugins.di/DependencyKey // io.ktor.server.plugins.di/DependencyKey|DependencyKey(kotlin.String?;kotlin.Any?){0§<kotlin.Any?>}[0]
+final suspend inline fun <#A: reified kotlin/Any?> (io.ktor.server.plugins.di/DependencyMap).io.ktor.server.plugins.di/resolveAwait(kotlin/String? = ...): #A // io.ktor.server.plugins.di/resolveAwait|resolveAwait@io.ktor.server.plugins.di.DependencyMap(kotlin.String?){0§<kotlin.Any?>}[0]
diff --git a/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyInjection.kt b/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyInjection.kt
index 6e903edbb..c96b16b6f 100644
--- a/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyInjection.kt
+++ b/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyInjection.kt
@@ -8,6 +8,8 @@ import io.ktor.server.application.*
 import io.ktor.server.plugins.di.utils.*
 import io.ktor.util.*
 import io.ktor.util.reflect.*
+import kotlinx.coroutines.Dispatchers
+import kotlinx.coroutines.cancel
 import kotlin.reflect.KClass
 
 /**
@@ -74,6 +76,7 @@ public val DI: ApplicationPlugin<DependencyInjectionConfig> =
             dependenciesMap,
             pluginConfig.resolution,
             pluginConfig.reflection,
+            application.coroutineContext + Dispatchers.Default.limitedParallelism(1),
         )
 
         with(application) {
@@ -84,7 +87,7 @@ public val DI: ApplicationPlugin<DependencyInjectionConfig> =
                 val exceptions = mutableListOf<Pair<DependencyKey, Throwable>>()
                 for ((key, source) in registry.requirements) {
                     try {
-                        registry.get<Any>(key)
+                        registry.get<Any?>(key)
                     } catch (e: Throwable) {
                         environment.log.error("Cannot resolve $key\n${source.externalTrace()}")
                         exceptions += key to e
@@ -117,6 +120,7 @@ public val DI: ApplicationPlugin<DependencyInjectionConfig> =
                         environment.log.error("Exception during cleanup for $key; continuing", e)
                     }
                 }
+                registry.cancel()
             }
 
             attributes.put(DependencyRegistryKey, registry)
diff --git a/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyProvider.kt b/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyProvider.kt
index 408173ba7..c9a781e77 100644
--- a/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyProvider.kt
+++ b/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyProvider.kt
@@ -4,15 +4,11 @@
 
 package io.ktor.server.plugins.di
 
-import io.ktor.server.plugins.di.DependencyConflictResult.Ambiguous
-import io.ktor.server.plugins.di.DependencyConflictResult.Conflict
-import io.ktor.server.plugins.di.DependencyConflictResult.KeepNew
-import io.ktor.server.plugins.di.DependencyConflictResult.KeepPrevious
-import io.ktor.server.plugins.di.DependencyConflictResult.Replace
-import io.ktor.util.logging.KtorSimpleLogger
-import io.ktor.util.logging.Logger
-import io.ktor.util.logging.debug
-import io.ktor.util.logging.trace
+import io.ktor.server.plugins.di.DependencyConflictResult.*
+import io.ktor.util.logging.*
+import kotlinx.coroutines.CoroutineScope
+import kotlinx.coroutines.Dispatchers
+import kotlin.coroutines.CoroutineContext
 
 /**
  * Represents a provider for managing dependencies in a dependency injection mechanism.
@@ -189,14 +185,23 @@ public fun <T> DependencyCreateFunction.ifImplicit(block: (ImplicitCreateFunctio
  *                       for the same dependency key.
  * @param onConflict A callback that is invoked when a conflict is encountered during registration.
  *                   By default, this throws a `DuplicateDependencyException`.
+ * @param coroutineContext The coroutine context used for asynchronous dependency resolution.
+ *                         By default, this uses a single-threaded dispatcher to avoid concurrency problems.
+ * @param log A logger used for logging dependency resolution events.
+ *            By default, this uses a `KtorSimpleLogger` with the name "io.ktor.server.plugins.di.MapDependencyProvider".
+ *
+ * @see DependencyKeyCovariance
+ * @see DependencyConflictPolicy
+ * @see DependencyResolver
  */
 @Suppress("UNCHECKED_CAST")
 public open class MapDependencyProvider(
     public val keyMapping: DependencyKeyCovariance = DefaultKeyCovariance,
     public val conflictPolicy: DependencyConflictPolicy = DefaultConflictPolicy,
     public val onConflict: (DependencyKey) -> Unit = { throw DuplicateDependencyException(it) },
+    public override val coroutineContext: CoroutineContext = Dispatchers.Default.limitedParallelism(1),
     private val log: Logger = KtorSimpleLogger("io.ktor.server.plugins.di.MapDependencyProvider"),
-) : DependencyProvider {
+) : DependencyProvider, CoroutineScope {
     private companion object {
         private const val COVARIANT_LOG_LIMIT = 8
     }
diff --git a/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyRegistry.kt b/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyRegistry.kt
index 547664c36..bc51892a5 100644
--- a/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyRegistry.kt
+++ b/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyRegistry.kt
@@ -7,6 +7,10 @@ package io.ktor.server.plugins.di
 import io.ktor.server.application.*
 import io.ktor.server.plugins.di.MutableDependencyMap.Companion.asResolver
 import io.ktor.utils.io.*
+import kotlinx.coroutines.CoroutineScope
+import kotlinx.coroutines.Deferred
+import kotlinx.coroutines.async
+import kotlin.coroutines.CoroutineContext
 import kotlin.properties.ReadOnlyProperty
 import kotlin.reflect.KClass
 import kotlin.reflect.KProperty
@@ -30,7 +34,8 @@ public class DependencyRegistry(
     private val external: DependencyMap,
     private val resolution: DependencyResolution,
     public override val reflection: DependencyReflection,
-) : DependencyProvider by provider, DependencyResolver {
+    public override val coroutineContext: CoroutineContext,
+) : DependencyProvider by provider, DependencyResolver, CoroutineScope {
 
     internal val requirements = mutableMapOf<DependencyKey, DependencyReference>()
     internal val shutdownHooks = mutableMapOf<DependencyKey, (Any?) -> Unit>()
@@ -104,13 +109,39 @@ public class DependencyRegistry(
      * @param T The type of the dependency to be provided.
      * @param kClass The `KClass` representing the type of the dependency to be created or resolved.
      */
-    public inline fun <reified T : Any> DependencyProvider.provide(kClass: KClass<out T>) {
+    public inline fun <reified T : Any> provide(kClass: KClass<out T>): KeyContext<T> =
         provide<T> { create(kClass) }
-    }
 
+    /**
+     * Creates a new `KeyContext` for the specified type [T] and an optional name.
+     * The given [handler] is invoked on the created `KeyContext`, allowing configuration
+     * such as defining a provider or cleanup logic for the dependency.
+     *
+     * @param T The type of the dependency being handled.
+     * @param name An optional name associated with the dependency. Defaults to `null` if not provided.
+     * @param handler A lambda that defines the actions to be performed on the created `KeyContext`.
+     * @return A `KeyContext` instance representing the defined key and its associated actions.
+     */
     public inline fun <reified T> key(name: String? = null, noinline handler: KeyContext<T>.() -> Unit): KeyContext<T> =
         KeyContext<T>(DependencyKey<T>(name)).also(handler)
 
+    /**
+     * Provide a deferred dependency for the given type using the provided suspend function.
+     *
+     * Shorthand for `provide<Deferred<T>> { async { suspendFunction() } }`
+     */
+    public inline fun <reified T> provideAsync(
+        name: String? = null,
+        noinline provide: suspend DependencyResolver.() -> T?
+    ): KeyContext<Deferred<T>> =
+        provide<Deferred<T>>(name) {
+            async {
+                provide() ?: throw DependencyInjectionException(
+                    "Null result for async declaration: ${DependencyKey<T>(name)}"
+                )
+            }
+        }
+
     /**
      * Basic call for providing a dependency, like `provide<Service> { ServiceImpl() }`.
      */
@@ -258,6 +289,6 @@ internal class DependencyReference : Throwable() {
      */
     fun externalTrace(): String =
         stackTraceToString()
-            .substringAfterLast("io.ktor.server.plugins.di")
+            .substringAfterLast("io.ktor")
             .substringAfter('\n')
 }
diff --git a/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyResolution.kt b/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyResolution.kt
index cee4a81a4..c79c9c63b 100644
--- a/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyResolution.kt
+++ b/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyResolution.kt
@@ -6,6 +6,7 @@ package io.ktor.server.plugins.di
 
 import io.ktor.server.config.ApplicationConfig
 import io.ktor.server.config.SerializableConfigValue
+import kotlinx.coroutines.Deferred
 import kotlin.reflect.KProperty
 
 /**
@@ -174,6 +175,12 @@ public operator fun DependencyMap.plus(right: DependencyMap): DependencyMap =
 public inline fun <reified T> DependencyMap.resolve(key: String? = null): T =
     get(DependencyKey<T>(key))
 
+/**
+ * Resolve a `Deferred<T>` dependency and await its result.
+ */
+public suspend inline fun <reified T> DependencyMap.resolveAwait(key: String? = null): T =
+    resolve<Deferred<T>>(key).await()
+
 internal class MergedDependencyMap(
     private val left: DependencyMap,
     private val right: DependencyMap,
diff --git a/ktor-server/ktor-server-plugins/ktor-server-di/jvm/src/io/ktor/server/plugins/di/utils/Types.jvm.kt b/ktor-server/ktor-server-plugins/ktor-server-di/jvm/src/io/ktor/server/plugins/di/utils/Types.jvm.kt
index 719cd7902..f0966623f 100644
--- a/ktor-server/ktor-server-plugins/ktor-server-di/jvm/src/io/ktor/server/plugins/di/utils/Types.jvm.kt
+++ b/ktor-server/ktor-server-plugins/ktor-server-di/jvm/src/io/ktor/server/plugins/di/utils/Types.jvm.kt
@@ -6,6 +6,8 @@ package io.ktor.server.plugins.di.utils
 
 import io.ktor.util.reflect.*
 import io.ktor.utils.io.*
+import kotlinx.coroutines.Job
+import kotlin.coroutines.CoroutineContext
 import kotlin.reflect.KClass
 import kotlin.reflect.KType
 import kotlin.reflect.KTypeParameter
@@ -147,6 +149,9 @@ private val ignoredSupertypes = setOf(
     java.lang.Comparable::class,
     Enum::class,
     java.lang.Enum::class,
+    Job::class,
+    CoroutineContext::class,
+    CoroutineContext.Element::class,
     Object::class,
     // Add more general types here as needed
 )
