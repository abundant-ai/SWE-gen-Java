diff --git a/android-test/build.gradle.kts b/android-test/build.gradle.kts
index c2aec16a1..906c22e0f 100644
--- a/android-test/build.gradle.kts
+++ b/android-test/build.gradle.kts
@@ -20,8 +20,7 @@ android {
     testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
     testInstrumentationRunnerArguments += mapOf(
       "runnerBuilder" to "de.mannodermaus.junit5.AndroidJUnit5Builder",
-      "notPackage" to "org.bouncycastle",
-      "configurationParameters" to "junit.jupiter.extensions.autodetection.enabled=true"
+      "notPackage" to "org.bouncycastle"
     )
   }
 
diff --git a/mockwebserver-junit5/README.md b/mockwebserver-junit5/README.md
index 8dce14890..fa5f8a838 100644
--- a/mockwebserver-junit5/README.md
+++ b/mockwebserver-junit5/README.md
@@ -51,21 +51,6 @@ class MyTest(
 }
 ```
 
-Multiple instances can be obtained by naming additional ones:
-
-```
-class MyTest(
-  private val server: MockWebServer,
-  @MockWebServerInstance("server2") private val server2: MockWebServer,
-  @MockWebServerInstance("server3") private val server3: MockWebServer
-) {
-  @Test
-  fun test() {
-    ...
-  }
-}
-```
-
 Requirements
 ------------
 
diff --git a/mockwebserver-junit5/src/main/kotlin/mockwebserver3/junit5/internal/MockWebServerExtension.kt b/mockwebserver-junit5/src/main/kotlin/mockwebserver3/junit5/internal/MockWebServerExtension.kt
index b9ece7ec8..1c9a79caf 100644
--- a/mockwebserver-junit5/src/main/kotlin/mockwebserver3/junit5/internal/MockWebServerExtension.kt
+++ b/mockwebserver-junit5/src/main/kotlin/mockwebserver3/junit5/internal/MockWebServerExtension.kt
@@ -16,10 +16,8 @@
 package mockwebserver3.junit5.internal
 
 import java.io.IOException
-import java.lang.reflect.Method
 import java.util.logging.Level
 import java.util.logging.Logger
-import kotlin.jvm.optionals.getOrNull
 import mockwebserver3.MockWebServer
 import org.codehaus.mojo.animal_sniffer.IgnoreJRERequirement
 import org.junit.jupiter.api.extension.AfterEachCallback
@@ -43,25 +41,10 @@ import org.junit.jupiter.api.extension.ParameterResolver
 class MockWebServerExtension :
   BeforeEachCallback, AfterEachCallback, ParameterResolver {
   private val ExtensionContext.resource: ServersForTest
-    get() {
-      // For Methods (before/after/test) grab the class store
-      val store =
-        if (this.element.getOrNull() is Method) {
-          val parent = parent.get()
-          parent.getStore(namespace)
-        } else {
-          getStore(namespace)
-        }
-
-      return store.serversForTest
-    }
-
-  private val ExtensionContext.Store.serversForTest: ServersForTest
-    get() {
-      return getOrComputeIfAbsent(storeKey) {
+    get() =
+      getStore(namespace).getOrComputeIfAbsent(this.uniqueId) {
         ServersForTest()
       } as ServersForTest
-    }
 
   private class ServersForTest {
     private val servers = mutableMapOf<String, MockWebServer>()
@@ -84,11 +67,10 @@ class MockWebServerExtension :
 
     fun shutdownAll() {
       try {
-        val toClear = servers.values.toList()
-        servers.clear()
-        for (server in toClear) {
+        for (server in servers.values) {
           server.shutdown()
         }
+        servers.clear()
       } catch (e: IOException) {
         logger.log(Level.WARNING, "MockWebServer shutdown failed", e)
       }
@@ -101,7 +83,9 @@ class MockWebServerExtension :
     parameterContext: ParameterContext,
     extensionContext: ExtensionContext,
   ): Boolean {
-    return parameterContext.parameter.type === MockWebServer::class.java
+    // Not supported on constructors, or static contexts
+    return parameterContext.parameter.type === MockWebServer::class.java &&
+      extensionContext.testMethod.isPresent
   }
 
   @Suppress("NewApi")
@@ -128,10 +112,9 @@ class MockWebServerExtension :
     context.resource.shutdownAll()
   }
 
-  private companion object {
+  companion object {
     private val logger = Logger.getLogger(MockWebServerExtension::class.java.name)
     private val namespace = ExtensionContext.Namespace.create(MockWebServerExtension::class.java)
     private val defaultName = MockWebServerExtension::class.java.simpleName
-    private val storeKey = "ServersForTest"
   }
 }
diff --git a/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt b/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt
index ef8b28599..11457cab4 100644
--- a/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt
+++ b/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt
@@ -808,6 +808,7 @@ class MockWebServer : Closeable {
         extensions = WebSocketExtensions.parse(webSocketResponse.headers),
         // Compress all messages if compression is enabled.
         minimumDeflateSize = 0L,
+        closeTimeoutMillis = RealWebSocket.CANCEL_AFTER_CLOSE_MILLIS,
       )
     val name = "MockWebServer WebSocket ${request.path!!}"
     webSocket.initReaderAndWriter(name, streams)
diff --git a/okhttp/api/okhttp.api b/okhttp/api/okhttp.api
index 8b7d85d03..da967c1ab 100644
--- a/okhttp/api/okhttp.api
+++ b/okhttp/api/okhttp.api
@@ -918,6 +918,7 @@ public class okhttp3/OkHttpClient : okhttp3/Call$Factory, okhttp3/WebSocket$Fact
 	public final fun callTimeoutMillis ()I
 	public final fun certificateChainCleaner ()Lokhttp3/internal/tls/CertificateChainCleaner;
 	public final fun certificatePinner ()Lokhttp3/CertificatePinner;
+	public final fun closeTimeoutMillis ()I
 	public final fun connectTimeoutMillis ()I
 	public final fun connectionPool ()Lokhttp3/ConnectionPool;
 	public final fun connectionSpecs ()Ljava/util/List;
@@ -961,6 +962,9 @@ public final class okhttp3/OkHttpClient$Builder {
 	public final fun callTimeout (Ljava/time/Duration;)Lokhttp3/OkHttpClient$Builder;
 	public final fun callTimeout-LRDsOJo (J)Lokhttp3/OkHttpClient$Builder;
 	public final fun certificatePinner (Lokhttp3/CertificatePinner;)Lokhttp3/OkHttpClient$Builder;
+	public final fun closeTimeout (JLjava/util/concurrent/TimeUnit;)Lokhttp3/OkHttpClient$Builder;
+	public final fun closeTimeout (Ljava/time/Duration;)Lokhttp3/OkHttpClient$Builder;
+	public final fun closeTimeout-LRDsOJo (J)Lokhttp3/OkHttpClient$Builder;
 	public final fun connectTimeout (JLjava/util/concurrent/TimeUnit;)Lokhttp3/OkHttpClient$Builder;
 	public final fun connectTimeout (Ljava/time/Duration;)Lokhttp3/OkHttpClient$Builder;
 	public final fun connectTimeout-LRDsOJo (J)Lokhttp3/OkHttpClient$Builder;
diff --git a/okhttp/src/main/kotlin/okhttp3/OkHttpClient.kt b/okhttp/src/main/kotlin/okhttp3/OkHttpClient.kt
index bd06f28c3..ebee6bd33 100644
--- a/okhttp/src/main/kotlin/okhttp3/OkHttpClient.kt
+++ b/okhttp/src/main/kotlin/okhttp3/OkHttpClient.kt
@@ -252,6 +252,10 @@ open class OkHttpClient internal constructor(
   @get:JvmName("pingIntervalMillis")
   val pingIntervalMillis: Int = builder.pingInterval
 
+  /** Web socket close timeout (in milliseconds). */
+  @get:JvmName("closeTimeoutMillis")
+  val closeTimeoutMillis: Int = builder.closeTimeout
+
   /**
    * Minimum outbound web socket message size (in bytes) that will be compressed.
    * The default is 1024 bytes.
@@ -327,6 +331,7 @@ open class OkHttpClient internal constructor(
         // extensions is always null for clients:
         extensions = null,
         minimumDeflateSize = minWebSocketMessageToCompress,
+        closeTimeoutMillis = closeTimeoutMillis.toLong(),
       )
     webSocket.connect(this)
     return webSocket
@@ -572,6 +577,7 @@ open class OkHttpClient internal constructor(
     internal var readTimeout = 10_000
     internal var writeTimeout = 10_000
     internal var pingInterval = 0
+    internal var closeTimeout = RealWebSocket.CANCEL_AFTER_CLOSE_MILLIS.toInt()
     internal var minWebSocketMessageToCompress = RealWebSocket.DEFAULT_MINIMUM_DEFLATE_SIZE
     internal var routeDatabase: RouteDatabase? = null
     internal var taskRunner: TaskRunner? = null
@@ -606,6 +612,7 @@ open class OkHttpClient internal constructor(
       this.readTimeout = okHttpClient.readTimeoutMillis
       this.writeTimeout = okHttpClient.writeTimeoutMillis
       this.pingInterval = okHttpClient.pingIntervalMillis
+      this.closeTimeout = okHttpClient.closeTimeoutMillis
       this.minWebSocketMessageToCompress = okHttpClient.minWebSocketMessageToCompress
       this.routeDatabase = okHttpClient.routeDatabase
       this.taskRunner = okHttpClient.taskRunner
@@ -1276,6 +1283,49 @@ open class OkHttpClient internal constructor(
         pingInterval = checkDuration("duration", duration)
       }
 
+    /**
+     * Sets the close timeout for web socket connections. A value of 0 means no timeout, otherwise
+     * values must be between 1 and [Integer.MAX_VALUE] when converted to milliseconds.
+     *
+     * The close timeout is the maximum amount of time after the client calls [close] to wait
+     * for a graceful shutdown. If the server doesn't respond the web socket will be canceled.
+     * The default value is 60 seconds.
+     */
+    fun closeTimeout(
+      timeout: Long,
+      unit: TimeUnit,
+    ) = apply {
+      closeTimeout = checkDuration("timeout", timeout, unit)
+    }
+
+    /**
+     * Sets the close timeout for web socket connections. A value of 0 means no timeout, otherwise
+     * values must be between 1 and [Integer.MAX_VALUE] when converted to milliseconds.
+     *
+     * The close timeout is the maximum amount of time after the client calls [close] to wait
+     * for a graceful shutdown. If the server doesn't respond the web socket will be canceled.
+     * The default value is 60 seconds.
+     */
+    @SuppressLint("NewApi")
+    @IgnoreJRERequirement
+    fun closeTimeout(duration: Duration) =
+      apply {
+        closeTimeout(duration.toMillis(), MILLISECONDS)
+      }
+
+    /**
+     * Sets the close timeout for web socket connections. A value of 0 means no timeout, otherwise
+     * values must be between 1 and [Integer.MAX_VALUE] when converted to milliseconds.
+     *
+     * The close timeout is the maximum amount of time after the client calls [close] to wait
+     * for a graceful shutdown. If the server doesn't respond the web socket will be canceled.
+     * The default value is 60 seconds.
+     */
+    fun closeTimeout(duration: KotlinDuration) =
+      apply {
+        closeTimeout = checkDuration("duration", duration)
+      }
+
     /**
      * Sets minimum outbound web socket message size (in bytes) that will be compressed.
      *
diff --git a/okhttp/src/main/kotlin/okhttp3/internal/ws/RealWebSocket.kt b/okhttp/src/main/kotlin/okhttp3/internal/ws/RealWebSocket.kt
index a8dee727a..c499dea20 100644
--- a/okhttp/src/main/kotlin/okhttp3/internal/ws/RealWebSocket.kt
+++ b/okhttp/src/main/kotlin/okhttp3/internal/ws/RealWebSocket.kt
@@ -64,6 +64,7 @@ class RealWebSocket(
   private var extensions: WebSocketExtensions?,
   /** If compression is negotiated, outbound messages of this size and larger will be compressed. */
   private var minimumDeflateSize: Long,
+  private val closeTimeoutMillis: Long,
 ) : WebSocket, WebSocketReader.FrameCallback {
   private val key: String
 
@@ -469,7 +470,7 @@ class RealWebSocket(
     code: Int,
     reason: String?,
   ): Boolean {
-    return close(code, reason, CANCEL_AFTER_CLOSE_MILLIS)
+    return close(code, reason, closeTimeoutMillis)
   }
 
   @Synchronized fun close(
@@ -712,7 +713,7 @@ class RealWebSocket(
      * The maximum amount of time after the client calls [close] to wait for a graceful shutdown. If
      * the server doesn't respond the web socket will be canceled.
      */
-    private const val CANCEL_AFTER_CLOSE_MILLIS = 60L * 1000
+    const val CANCEL_AFTER_CLOSE_MILLIS = 60L * 1000
 
     /**
      * The smallest message that will be compressed. We use 1024 because smaller messages already
