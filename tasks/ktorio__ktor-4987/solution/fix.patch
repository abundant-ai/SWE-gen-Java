diff --git a/ktor-server/ktor-server-core/common/src/io/ktor/server/config/MapConfigDecoder.kt b/ktor-server/ktor-server-core/common/src/io/ktor/server/config/MapConfigDecoder.kt
index b5bc43c73..39ba7d024 100644
--- a/ktor-server/ktor-server-core/common/src/io/ktor/server/config/MapConfigDecoder.kt
+++ b/ktor-server/ktor-server-core/common/src/io/ktor/server/config/MapConfigDecoder.kt
@@ -59,6 +59,8 @@ internal class MapConfigDecoder(
         return if (map.containsPrefix(fullPath)) {
             currentPath = fullPath
             newIndex
+        } else if (descriptor.isElementOptional(newIndex)) {
+            decodeElementIndex(descriptor)
         } else {
             CompositeDecoder.DECODE_DONE
         }
diff --git a/ktor-server/ktor-server-core/jvm/src/io/ktor/server/config/HoconDecoder.kt b/ktor-server/ktor-server-core/jvm/src/io/ktor/server/config/HoconDecoder.kt
index 0f37d5f59..c4bb11cfb 100644
--- a/ktor-server/ktor-server-core/jvm/src/io/ktor/server/config/HoconDecoder.kt
+++ b/ktor-server/ktor-server-core/jvm/src/io/ktor/server/config/HoconDecoder.kt
@@ -30,6 +30,8 @@ internal open class HoconDecoder(
         return if (config.hasPath(fullPath)) {
             currentPath = fullPath
             newIndex
+        } else if (descriptor.isElementOptional(newIndex)) {
+            decodeElementIndex(descriptor)
         } else {
             CompositeDecoder.DECODE_DONE
         }
