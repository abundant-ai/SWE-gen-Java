diff --git a/okhttp/api/okhttp.api b/okhttp/api/okhttp.api
index 8af317f3d..3a18a38a3 100644
--- a/okhttp/api/okhttp.api
+++ b/okhttp/api/okhttp.api
@@ -1010,6 +1010,7 @@ public final class okhttp3/Request {
 	public final fun newBuilder ()Lokhttp3/Request$Builder;
 	public final fun tag ()Ljava/lang/Object;
 	public final fun tag (Ljava/lang/Class;)Ljava/lang/Object;
+	public final fun tag (Lkotlin/reflect/KClass;)Ljava/lang/Object;
 	public fun toString ()Ljava/lang/String;
 	public final fun url ()Lokhttp3/HttpUrl;
 }
@@ -1033,6 +1034,7 @@ public class okhttp3/Request$Builder {
 	public fun removeHeader (Ljava/lang/String;)Lokhttp3/Request$Builder;
 	public fun tag (Ljava/lang/Class;Ljava/lang/Object;)Lokhttp3/Request$Builder;
 	public fun tag (Ljava/lang/Object;)Lokhttp3/Request$Builder;
+	public final fun tag (Lkotlin/reflect/KClass;Ljava/lang/Object;)Lokhttp3/Request$Builder;
 	public fun url (Ljava/lang/String;)Lokhttp3/Request$Builder;
 	public fun url (Ljava/net/URL;)Lokhttp3/Request$Builder;
 	public fun url (Lokhttp3/HttpUrl;)Lokhttp3/Request$Builder;
diff --git a/okhttp/src/commonMain/kotlin/okhttp3/Request.kt b/okhttp/src/commonMain/kotlin/okhttp3/Request.kt
index be491f333..88522a13d 100644
--- a/okhttp/src/commonMain/kotlin/okhttp3/Request.kt
+++ b/okhttp/src/commonMain/kotlin/okhttp3/Request.kt
@@ -15,6 +15,7 @@
  */
 package okhttp3
 
+import kotlin.reflect.KClass
 import okhttp3.internal.HttpUrlRepresentation
 import okhttp3.internal.commonEmptyRequestBody
 
@@ -27,6 +28,7 @@ expect class Request private constructor(builder: Builder) {
   val method: String
   val headers: Headers
   val body: RequestBody?
+  internal val tags: Map<KClass<*>, Any>
 
   internal var lazyCacheControl: CacheControl?
 
@@ -36,21 +38,11 @@ expect class Request private constructor(builder: Builder) {
 
   fun headers(name: String): List<String>
 
-  // /**
-  //  * Returns the tag attached with `Object.class` as a key, or null if no tag is attached with
-  //  * that key.
-  //  *
-  //  * Prior to OkHttp 3.11, this method never returned null if no tag was attached. Instead it
-  //  * returned either this request, or the request upon which this request was derived with
-  //  * [newBuilder].
-  //  */
-  // fun tag(): Any? = tag(Any::class.java)
-  //
-  // /**
-  //  * Returns the tag attached with [type] as a key, or null if no tag is attached with that
-  //  * key.
-  //  */
-  // fun <T> tag(type: Class<out T>): T? = type.cast(tags[type])
+  /** Returns the tag attached with [T] as a key, or null if no tag is attached with that key. */
+  inline fun <reified T : Any> tag(): T?
+
+  /** Returns the tag attached with [type] as a key, or null if no tag is attached with that key. */
+  fun <T : Any> tag(type: KClass<T>): T?
 
   fun newBuilder(): Builder
 
@@ -66,6 +58,9 @@ expect class Request private constructor(builder: Builder) {
     internal var headers: Headers.Builder
     internal var body: RequestBody?
 
+    /** A mutable map of tags, or an immutable empty map if we don't have any. */
+    internal var tags: Map<KClass<*>, Any>
+
     constructor()
 
     internal constructor(request: Request)
@@ -126,26 +121,23 @@ expect class Request private constructor(builder: Builder) {
 
     open fun method(method: String, body: RequestBody?): Builder
 
-    // /** Attaches [tag] to the request using `Object.class` as a key. */
-    // open fun tag(tag: Any?): Builder = tag(Any::class.java, tag)
-    //
-    // /**
-    //  * Attaches [tag] to the request using [type] as a key. Tags can be read from a
-    //  * request using [Request.tag]. Use null to remove any existing tag assigned for [type].
-    //  *
-    //  * Use this API to attach timing, debugging, or other application data to a request so that
-    //  * you may read it in interceptors, event listeners, or callbacks.
-    //  */
-    // open fun <T> tag(type: Class<in T>, tag: T?) = apply {
-    //   if (tag == null) {
-    //     tags.remove(type)
-    //   } else {
-    //     if (tags.isEmpty()) {
-    //       tags = mutableMapOf()
-    //     }
-    //     tags[type] = type.cast(tag)!! // Force-unwrap due to lack of contracts on Class#cast()
-    //   }
-    // }
+    /**
+     * Attaches [tag] to the request using [T] as a key. Tags can be read from a request using
+     * [Request.tag]. Use null to remove any existing tag assigned for [T].
+     *
+     * Use this API to attach timing, debugging, or other application data to a request so that
+     * you may read it in interceptors, event listeners, or callbacks.
+     */
+    inline fun <reified T : Any> tag(tag: T?): Builder
+
+    /**
+     * Attaches [tag] to the request using [type] as a key. Tags can be read from a request using
+     * [Request.tag]. Use null to remove any existing tag assigned for [type].
+     *
+     * Use this API to attach timing, debugging, or other application data to a request so that
+     * you may read it in interceptors, event listeners, or callbacks.
+     */
+    fun <T : Any> tag(type: KClass<T>, tag: T?): Builder
 
     open fun build(): Request
   }
diff --git a/okhttp/src/commonMain/kotlin/okhttp3/internal/-RequestCommon.kt b/okhttp/src/commonMain/kotlin/okhttp3/internal/-RequestCommon.kt
index 958440005..044b7d6fc 100644
--- a/okhttp/src/commonMain/kotlin/okhttp3/internal/-RequestCommon.kt
+++ b/okhttp/src/commonMain/kotlin/okhttp3/internal/-RequestCommon.kt
@@ -16,6 +16,7 @@
 
 package okhttp3.internal
 
+import kotlin.reflect.KClass
 import okhttp3.CacheControl
 import okhttp3.Headers
 import okhttp3.Request
@@ -103,3 +104,17 @@ fun Request.Builder.commonMethod(method: String, body: RequestBody?): Request.Bu
   this.method = method
   this.body = body
 }
+
+fun <T : Any> Request.Builder.commonTag(type: KClass<T>, tag: T?) = apply {
+  if (tag == null) {
+    if (tags.isNotEmpty()) {
+      (tags as MutableMap).remove(type)
+    }
+  } else {
+    val mutableTags: MutableMap<KClass<*>, Any> = when {
+      tags.isEmpty() -> mutableMapOf<KClass<*>, Any>().also { tags = it }
+      else -> tags as MutableMap<KClass<*>, Any>
+    }
+    mutableTags[type] = tag
+  }
+}
diff --git a/okhttp/src/jvmMain/kotlin/okhttp3/Request.kt b/okhttp/src/jvmMain/kotlin/okhttp3/Request.kt
index 15303d1d5..632eb514c 100644
--- a/okhttp/src/jvmMain/kotlin/okhttp3/Request.kt
+++ b/okhttp/src/jvmMain/kotlin/okhttp3/Request.kt
@@ -16,6 +16,7 @@
 package okhttp3
 
 import java.net.URL
+import kotlin.reflect.KClass
 import okhttp3.HttpUrl.Companion.toHttpUrl
 import okhttp3.internal.canonicalUrl
 import okhttp3.internal.commonAddHeader
@@ -30,7 +31,7 @@ import okhttp3.internal.commonPatch
 import okhttp3.internal.commonPost
 import okhttp3.internal.commonPut
 import okhttp3.internal.commonRemoveHeader
-import okhttp3.internal.toImmutableMap
+import okhttp3.internal.commonTag
 
 actual class Request internal actual constructor(builder: Builder) {
   @get:JvmName("url")
@@ -45,7 +46,7 @@ actual class Request internal actual constructor(builder: Builder) {
   @get:JvmName("body")
   actual val body: RequestBody? = builder.body
 
-  internal val tags: Map<Class<*>, Any> = builder.tags.toImmutableMap()
+  internal actual val tags: Map<KClass<*>, Any> = builder.tags.toMap()
 
   internal actual var lazyCacheControl: CacheControl? = null
 
@@ -82,6 +83,11 @@ actual class Request internal actual constructor(builder: Builder) {
 
   actual fun headers(name: String): List<String> = commonHeaders(name)
 
+  @JvmName("reifiedTag")
+  actual inline fun <reified T : Any> tag(): T? = tag(T::class)
+
+  actual fun <T : Any> tag(type: KClass<T>): T? = type.java.cast(tags[type])
+
   /**
    * Returns the tag attached with `Object.class` as a key, or null if no tag is attached with
    * that key.
@@ -90,13 +96,13 @@ actual class Request internal actual constructor(builder: Builder) {
    * returned either this request, or the request upon which this request was derived with
    * [newBuilder].
    */
-  fun tag(): Any? = tag(Any::class.java)
+  fun tag(): Any? = tag<Any>()
 
   /**
    * Returns the tag attached with [type] as a key, or null if no tag is attached with that
    * key.
    */
-  fun <T> tag(type: Class<out T>): T? = type.cast(tags[type])
+  fun <T> tag(type: Class<out T>): T? = tag(type.kotlin)
 
   actual fun newBuilder(): Builder = Builder(this)
 
@@ -174,9 +180,7 @@ actual class Request internal actual constructor(builder: Builder) {
     internal actual var method: String
     internal actual var headers: Headers.Builder
     internal actual var body: RequestBody? = null
-
-    /** A mutable map of tags, or an immutable empty map if we don't have any. */
-    internal var tags: MutableMap<Class<*>, Any> = mutableMapOf()
+    internal actual var tags = mapOf<KClass<*>, Any>()
 
     actual constructor() {
       this.method = "GET"
@@ -187,10 +191,9 @@ actual class Request internal actual constructor(builder: Builder) {
       this.url = request.url
       this.method = request.method
       this.body = request.body
-      this.tags = if (request.tags.isEmpty()) {
-        mutableMapOf()
-      } else {
-        request.tags.toMutableMap()
+      this.tags = when {
+        request.tags.isEmpty() -> mapOf()
+        else -> request.tags.toMutableMap()
       }
       this.headers = request.headers.newBuilder()
     }
@@ -235,8 +238,13 @@ actual class Request internal actual constructor(builder: Builder) {
 
     actual open fun method(method: String, body: RequestBody?): Builder = commonMethod(method, body)
 
+    @JvmName("reifiedTag")
+    actual inline fun <reified T : Any> tag(tag: T?): Builder = tag(T::class, tag)
+
+    actual fun <T : Any> tag(type: KClass<T>, tag: T?): Builder = commonTag(type, tag)
+
     /** Attaches [tag] to the request using `Object.class` as a key. */
-    open fun tag(tag: Any?): Builder = tag(Any::class.java, tag)
+    open fun tag(tag: Any?): Builder = commonTag(Any::class, tag)
 
     /**
      * Attaches [tag] to the request using [type] as a key. Tags can be read from a
@@ -245,16 +253,7 @@ actual class Request internal actual constructor(builder: Builder) {
      * Use this API to attach timing, debugging, or other application data to a request so that
      * you may read it in interceptors, event listeners, or callbacks.
      */
-    open fun <T> tag(type: Class<in T>, tag: T?) = apply {
-      if (tag == null) {
-        tags.remove(type)
-      } else {
-        if (tags.isEmpty()) {
-          tags = mutableMapOf()
-        }
-        tags[type] = type.cast(tag)!! // Force-unwrap due to lack of contracts on Class#cast()
-      }
-    }
+    open fun <T> tag(type: Class<in T>, tag: T?) = commonTag(type.kotlin, tag)
 
     actual open fun build() = Request(this)
   }
diff --git a/okhttp/src/jvmMain/kotlin/okhttp3/internal/-UtilJvm.kt b/okhttp/src/jvmMain/kotlin/okhttp3/internal/-UtilJvm.kt
index 441440cf1..5362de662 100644
--- a/okhttp/src/jvmMain/kotlin/okhttp3/internal/-UtilJvm.kt
+++ b/okhttp/src/jvmMain/kotlin/okhttp3/internal/-UtilJvm.kt
@@ -223,15 +223,6 @@ fun <T> immutableListOf(vararg elements: T): List<T> {
   return Collections.unmodifiableList(listOf(*elements.clone()))
 }
 
-/** Returns an immutable copy of this. */
-internal fun <K, V> Map<K, V>.toImmutableMap(): Map<K, V> {
-  return if (isEmpty()) {
-    emptyMap()
-  } else {
-    Collections.unmodifiableMap(LinkedHashMap(this))
-  }
-}
-
 /** Closes this, ignoring any checked exceptions. */
 internal fun Socket.closeQuietly() {
   try {
diff --git a/okhttp/src/nonJvmMain/kotlin/okhttp3/Request.kt b/okhttp/src/nonJvmMain/kotlin/okhttp3/Request.kt
index 77a117f1c..2258488d3 100644
--- a/okhttp/src/nonJvmMain/kotlin/okhttp3/Request.kt
+++ b/okhttp/src/nonJvmMain/kotlin/okhttp3/Request.kt
@@ -15,6 +15,7 @@
  */
 package okhttp3
 
+import kotlin.reflect.KClass
 import okhttp3.internal.canonicalUrl
 import okhttp3.internal.commonAddHeader
 import okhttp3.internal.commonCacheControl
@@ -29,12 +30,14 @@ import okhttp3.internal.commonPatch
 import okhttp3.internal.commonPost
 import okhttp3.internal.commonPut
 import okhttp3.internal.commonRemoveHeader
+import okhttp3.internal.commonTag
 
 actual class Request internal actual constructor(builder: Builder) {
   actual val url: String = checkNotNull(builder.url) { "url == null" }
   actual val method: String = builder.method
   actual val headers: Headers = builder.headers.build()
   actual val body: RequestBody? = builder.body
+  internal actual val tags: Map<KClass<*>, Any> = builder.tags.toMap()
 
   internal actual var lazyCacheControl: CacheControl? = null
 
@@ -76,6 +79,10 @@ actual class Request internal actual constructor(builder: Builder) {
   actual val cacheControl: CacheControl
     get() = commonCacheControl()
 
+  actual inline fun <reified T : Any> tag(): T? = tag(T::class)
+
+  actual fun <T : Any> tag(type: KClass<T>): T? = tags[type] as T?
+
   override fun toString(): String = buildString {
     append("Request{method=")
     append(method)
@@ -105,6 +112,7 @@ actual class Request internal actual constructor(builder: Builder) {
     internal actual var method: String
     internal actual var headers: Headers.Builder
     internal actual var body: RequestBody? = null
+    internal actual var tags = mapOf<KClass<*>, Any>()
 
     // /** A mutable map of tags, or an immutable empty map if we don't have any. */
     // internal var tags: MutableMap<Class<*>, Any> = mutableMapOf()
@@ -118,11 +126,10 @@ actual class Request internal actual constructor(builder: Builder) {
       this.url = request.url
       this.method = request.method
       this.body = request.body
-      // this.tags = if (request.tags.isEmpty()) {
-      //   mutableMapOf()
-      // } else {
-      //   request.tags.toMutableMap()
-      // }
+      this.tags = when {
+        request.tags.isEmpty() -> mapOf()
+        else -> request.tags.toMutableMap()
+      }
       this.headers = request.headers.newBuilder()
     }
 
@@ -158,26 +165,9 @@ actual class Request internal actual constructor(builder: Builder) {
 
     actual open fun method(method: String, body: RequestBody?): Builder = commonMethod(method, body)
 
-    // /** Attaches [tag] to the request using `Object.class` as a key. */
-    // open fun tag(tag: Any?): Builder = tag(Any::class.java, tag)
-
-    // /**
-    //  * Attaches [tag] to the request using [type] as a key. Tags can be read from a
-    //  * request using [Request.tag]. Use null to remove any existing tag assigned for [type].
-    //  *
-    //  * Use this API to attach timing, debugging, or other application data to a request so that
-    //  * you may read it in interceptors, event listeners, or callbacks.
-    //  */
-    // open fun <T> tag(type: Class<in T>, tag: T?) = apply {
-    //   if (tag == null) {
-    //     tags.remove(type)
-    //   } else {
-    //     if (tags.isEmpty()) {
-    //       tags = mutableMapOf()
-    //     }
-    //     tags[type] = type.cast(tag)!! // Force-unwrap due to lack of contracts on Class#cast()
-    //   }
-    // }
+    actual inline fun <reified T : Any> tag(tag: T?): Builder = tag(T::class, tag)
+
+    actual fun <T : Any> tag(type: KClass<T>, tag: T?): Builder = commonTag(type, tag)
 
     actual open fun build() = Request(this)
   }
