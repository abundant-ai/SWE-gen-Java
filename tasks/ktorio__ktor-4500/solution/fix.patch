diff --git a/gradle-settings-conventions/src/main/kotlin/conventions-dependency-resolution-management.settings.gradle.kts b/gradle-settings-conventions/src/main/kotlin/conventions-dependency-resolution-management.settings.gradle.kts
index 363b6addf..27985787d 100644
--- a/gradle-settings-conventions/src/main/kotlin/conventions-dependency-resolution-management.settings.gradle.kts
+++ b/gradle-settings-conventions/src/main/kotlin/conventions-dependency-resolution-management.settings.gradle.kts
@@ -88,7 +88,7 @@ dependencyResolutionManagement {
 }
 
 fun VersionCatalogBuilder.downgradeTestDependencies() {
-    val testJdk = JavaVersion.current().majorVersion.toInt()
+    val testJdk = providers.gradleProperty("test.jdk").orNull?.toInt() ?: return
 
     if (testJdk < 11) version("logback", "1.3.14") // Java 8 support dropped in Logback 1.4.x
 }
diff --git a/gradle/gradle-daemon-jvm.properties b/gradle/gradle-daemon-jvm.properties
new file mode 100644
index 000000000..63e5bbdf4
--- /dev/null
+++ b/gradle/gradle-daemon-jvm.properties
@@ -0,0 +1,2 @@
+#This file is generated by updateDaemonJvm
+toolchainVersion=21
diff --git a/gradle/libs.versions.toml b/gradle/libs.versions.toml
index 5c56517ba..34e75a582 100644
--- a/gradle/libs.versions.toml
+++ b/gradle/libs.versions.toml
@@ -99,7 +99,7 @@ ktor-server-compression = { module = "io.ktor:ktor-server-compression", version.
 ktor-server-conditional-headers = { module = "io.ktor:ktor-server-conditional-headers", version.ref = "ktor" }
 ktor-server-content-negotiation = { module = "io.ktor:ktor-server-content-negotiation", version.ref = "ktor" }
 ktor-server-default-headers = { module = "io.ktor:ktor-server-default-headers", version.ref = "ktor" }
-ktor-server-jetty = { module = "io.ktor:ktor-server-jetty", version.ref = "ktor" }
+ktor-server-jetty = { module = "io.ktor:ktor-server-jetty-jakarta", version.ref = "ktor" }
 ktor-server-netty = { module = "io.ktor:ktor-server-netty", version.ref = "ktor" }
 ktor-server-status-pages = { module = "io.ktor:ktor-server-status-pages", version.ref = "ktor" }
 ktor-server-websockets = { module = "io.ktor:ktor-server-websockets", version.ref = "ktor" }
diff --git a/ktor-client/ktor-client-tests/build.gradle.kts b/ktor-client/ktor-client-tests/build.gradle.kts
index 811f2d63e..cf6c91fdb 100644
--- a/ktor-client/ktor-client-tests/build.gradle.kts
+++ b/ktor-client/ktor-client-tests/build.gradle.kts
@@ -58,7 +58,7 @@ kotlin.sourceSets {
             api(project(":ktor-client:ktor-client-apache5"))
             runtimeOnly(project(":ktor-client:ktor-client-android"))
             runtimeOnly(project(":ktor-client:ktor-client-okhttp"))
-            if (currentJdk >= 11) {
+            if (testJdk >= 11) {
                 runtimeOnly(project(":ktor-client:ktor-client-java"))
             }
             implementation(project(":ktor-client:ktor-client-plugins:ktor-client-logging"))
diff --git a/settings.gradle.kts b/settings.gradle.kts
index b80d5536b..eb60c53a4 100644
--- a/settings.gradle.kts
+++ b/settings.gradle.kts
@@ -24,8 +24,12 @@ include(":ktor-server:ktor-server-test-base")
 include(":ktor-server:ktor-server-test-suites")
 include(":ktor-server:ktor-server-jetty")
 include(":ktor-server:ktor-server-jetty:ktor-server-jetty-test-http2")
+include(":ktor-server:ktor-server-jetty-jakarta")
+include(":ktor-server:ktor-server-jetty-jakarta:ktor-server-jetty-test-http2-jakarta")
 include(":ktor-server:ktor-server-servlet")
+include(":ktor-server:ktor-server-servlet-jakarta")
 include(":ktor-server:ktor-server-tomcat")
+include(":ktor-server:ktor-server-tomcat-jakarta")
 include(":ktor-server:ktor-server-netty")
 include(":ktor-server:ktor-server-cio")
 include(":ktor-client")
@@ -40,15 +44,9 @@ include(":ktor-client:ktor-client-ios")
 include(":ktor-client:ktor-client-darwin")
 include(":ktor-client:ktor-client-darwin-legacy")
 include(":ktor-client:ktor-client-winhttp")
-if (JavaVersion.current() >= JavaVersion.VERSION_11) {
-    include(":ktor-client:ktor-client-java")
-    include(":ktor-client:ktor-client-jetty-jakarta")
-    include(":ktor-server:ktor-server-servlet-jakarta")
-    include(":ktor-server:ktor-server-jetty-jakarta")
-    include(":ktor-server:ktor-server-jetty-jakarta:ktor-server-jetty-test-http2-jakarta")
-    include(":ktor-server:ktor-server-tomcat-jakarta")
-}
+include(":ktor-client:ktor-client-java")
 include(":ktor-client:ktor-client-jetty")
+include(":ktor-client:ktor-client-jetty-jakarta")
 include(":ktor-client:ktor-client-js")
 include(":ktor-client:ktor-client-mock")
 include(":ktor-client:ktor-client-okhttp")
