diff --git a/platforms/core-configuration/base-diagnostics/src/integTest/groovy/org/gradle/api/tasks/diagnostics/TaskGraphIntegrationTest.groovy b/platforms/core-configuration/base-diagnostics/src/integTest/groovy/org/gradle/api/tasks/diagnostics/TaskGraphIntegrationTest.groovy
index 876b8ed2a02..a8f2152e45c 100644
--- a/platforms/core-configuration/base-diagnostics/src/integTest/groovy/org/gradle/api/tasks/diagnostics/TaskGraphIntegrationTest.groovy
+++ b/platforms/core-configuration/base-diagnostics/src/integTest/groovy/org/gradle/api/tasks/diagnostics/TaskGraphIntegrationTest.groovy
@@ -33,7 +33,7 @@ Tasks graph for: root
 \\--- :root (org.gradle.api.DefaultTask)
      +--- :leaf1 (org.gradle.api.DefaultTask)
      \\--- :middle (org.gradle.api.DefaultTask)
-          +--- :leaf1 (org.gradle.api.DefaultTask) (*)
+          +--- :leaf1 (*)
           \\--- :leaf2 (org.gradle.api.DefaultTask)
 
 (*) - details omitted (listed previously)
@@ -66,10 +66,10 @@ Tasks graph for: root r2
 +--- :root (org.gradle.api.DefaultTask)
 |    +--- :leaf1 (org.gradle.api.DefaultTask)
 |    \\--- :middle (org.gradle.api.DefaultTask)
-|         +--- :leaf1 (org.gradle.api.DefaultTask) (*)
+|         +--- :leaf1 (*)
 |         \\--- :leaf2 (org.gradle.api.DefaultTask)
 \\--- :root2 (org.gradle.api.DefaultTask)
-     \\--- :leaf2 (org.gradle.api.DefaultTask) (*)
+     \\--- :leaf2 (*)
 
 (*) - details omitted (listed previously)
 """)
@@ -114,7 +114,7 @@ Tasks graph for: root r2
 +--- :root (org.gradle.api.DefaultTask)
 |    +--- :leaf1 (org.gradle.api.DefaultTask)
 |    \\--- :middle (org.gradle.api.DefaultTask)
-|         +--- :leaf1 (org.gradle.api.DefaultTask) (*)
+|         +--- :leaf1 (*)
 |         \\--- :leaf2 (org.gradle.api.DefaultTask)
 \\--- :root2 (org.gradle.api.DefaultTask)
      \\--- other build task :included:fromIncluded (org.gradle.api.DefaultTask)
@@ -174,7 +174,7 @@ Tasks graph for: :included:fromIncluded
      +--- :included:leaf2 (org.gradle.api.DefaultTask)
      +--- :included:middle (org.gradle.api.DefaultTask)
      |    +--- :included:leaf1 (org.gradle.api.DefaultTask)
-     |    \\--- :included:leaf2 (org.gradle.api.DefaultTask) (*)
+     |    \\--- :included:leaf2 (*)
      \\--- :included:leaf3 (org.gradle.api.DefaultTask, finalizer)
 
 (*) - details omitted (listed previously)
@@ -196,7 +196,7 @@ Tasks graph for: fromIncluded
      +--- :leaf2 (org.gradle.api.DefaultTask)
      +--- :middle (org.gradle.api.DefaultTask)
      |    +--- :leaf1 (org.gradle.api.DefaultTask)
-     |    \\--- :leaf2 (org.gradle.api.DefaultTask) (*)
+     |    \\--- :leaf2 (*)
      \\--- :leaf3 (org.gradle.api.DefaultTask, finalizer)
 
 (*) - details omitted (listed previously)
@@ -218,7 +218,7 @@ Tasks graph for: root
 \\--- :root (org.gradle.api.DefaultTask)
      +--- :leaf1 (org.gradle.api.DefaultTask)
      \\--- :middle (org.gradle.api.DefaultTask)
-          +--- :leaf1 (org.gradle.api.DefaultTask) (*)
+          +--- :leaf1 (*)
           \\--- :leaf2 (org.gradle.api.DefaultTask)
 
 (*) - details omitted (listed previously)
@@ -266,7 +266,7 @@ Tasks graph for: jar
      |    +--- :compileJava (org.gradle.api.tasks.compile.JavaCompile)
      |    |    \\--- :buildSorcerer (org.gradle.api.DefaultTask)
      |    \\--- :processResources (org.gradle.language.jvm.tasks.ProcessResources)
-     \\--- :compileJava (org.gradle.api.tasks.compile.JavaCompile) (*)
+     \\--- :compileJava (*)
 
 (*) - details omitted (listed previously)
 """)
@@ -315,7 +315,7 @@ Tasks graph for: root
 \\--- :root (org.gradle.api.DefaultTask)
      +--- :leaf1 (org.gradle.api.DefaultTask)
      \\--- :middle (org.gradle.api.DefaultTask)
-          +--- :leaf1 (org.gradle.api.DefaultTask) (*)
+          +--- :leaf1 (*)
           \\--- :leaf2 (org.gradle.api.DefaultTask)
 
 (*) - details omitted (listed previously)
@@ -342,16 +342,16 @@ Tasks graph for: jar
      |    |         \\--- :generatePluginAdapters (org.gradle.plugin.devel.internal.precompiled.GeneratePluginAdaptersTask)
      |    |              \\--- :extractPluginRequests (org.gradle.plugin.devel.internal.precompiled.ExtractPluginRequestsTask)
      |    +--- :compileGroovyPlugins (org.gradle.plugin.devel.internal.precompiled.CompileGroovyScriptPluginsTask)
-     |    |    +--- :compileGroovy (org.gradle.api.tasks.compile.GroovyCompile) (*)
-     |    |    \\--- :compileJava (org.gradle.api.tasks.compile.JavaCompile) (*)
-     |    +--- :compileJava (org.gradle.api.tasks.compile.JavaCompile) (*)
-     |    +--- :extractPluginRequests (org.gradle.plugin.devel.internal.precompiled.ExtractPluginRequestsTask) (*)
+     |    |    +--- :compileGroovy (*)
+     |    |    \\--- :compileJava (*)
+     |    +--- :compileJava (*)
+     |    +--- :extractPluginRequests (*)
      |    \\--- :processResources (org.gradle.language.jvm.tasks.ProcessResources)
      |         \\--- :pluginDescriptors (org.gradle.plugin.devel.tasks.GeneratePluginDescriptors)
-     +--- :compileGroovy (org.gradle.api.tasks.compile.GroovyCompile) (*)
-     +--- :compileGroovyPlugins (org.gradle.plugin.devel.internal.precompiled.CompileGroovyScriptPluginsTask) (*)
-     +--- :compileJava (org.gradle.api.tasks.compile.JavaCompile) (*)
-     \\--- :extractPluginRequests (org.gradle.plugin.devel.internal.precompiled.ExtractPluginRequestsTask) (*)
+     +--- :compileGroovy (*)
+     +--- :compileGroovyPlugins (*)
+     +--- :compileJava (*)
+     \\--- :extractPluginRequests (*)
 
 (*) - details omitted (listed previously)
 """)
@@ -396,7 +396,7 @@ Tasks graph for: root
 \\--- :root (org.gradle.api.DefaultTask)
      +--- :leaf1 (org.gradle.api.DefaultTask)
      \\--- :middle (org.gradle.api.DefaultTask, disabled)
-          +--- :leaf1 (org.gradle.api.DefaultTask) (*)
+          +--- :leaf1 (*)
           \\--- :leaf2 (org.gradle.api.DefaultTask)
 
 (*) - details omitted (listed previously)
@@ -436,7 +436,7 @@ Tasks graph for: root root2
 |         +--- :leaf1 (org.gradle.api.DefaultTask)
 |         \\--- :leaf2 (org.gradle.api.DefaultTask)
 \\--- :root2 (org.gradle.api.DefaultTask)
-     \\--- :leaf1 (org.gradle.api.DefaultTask) (*)
+     \\--- :leaf1 (*)
 
 (*) - details omitted (listed previously)
 """)
@@ -474,7 +474,7 @@ Tasks graph for: root root2
 |         +--- :leaf1 (org.gradle.api.DefaultTask)
 |         \\--- :leaf2 (org.gradle.api.DefaultTask)
 \\--- :root2 (org.gradle.api.DefaultTask)
-     +--- :leaf1 (org.gradle.api.DefaultTask) (*)
+     +--- :leaf1 (*)
      \\--- :leaf4 (org.gradle.api.DefaultTask, finalizer)
           \\--- :leaf3 (org.gradle.api.DefaultTask)
 
@@ -501,7 +501,7 @@ Tasks graph for: clean root
 \\--- :root (org.gradle.api.DefaultTask)
      +--- :leaf1 (org.gradle.api.DefaultTask)
      \\--- :middle (org.gradle.api.DefaultTask)
-          +--- :leaf1 (org.gradle.api.DefaultTask) (*)
+          +--- :leaf1 (*)
           \\--- :leaf2 (org.gradle.api.DefaultTask)
 
 (*) - details omitted (listed previously)
@@ -775,7 +775,7 @@ Tasks graph for: root
      |         \\--- :lib:libleaf1 (org.gradle.api.DefaultTask)
      +--- :app:leaf1 (org.gradle.api.DefaultTask)
      \\--- :app:middle (org.gradle.api.DefaultTask)
-          +--- :app:leaf1 (org.gradle.api.DefaultTask) (*)
+          +--- :app:leaf1 (*)
           \\--- :app:leaf2 (org.gradle.api.DefaultTask)
 
 (*) - details omitted (listed previously)
diff --git a/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/accessors/AccessorsClassPath.kt b/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/accessors/AccessorsClassPath.kt
index 9e9cee4d417..adc8699d2b3 100644
--- a/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/accessors/AccessorsClassPath.kt
+++ b/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/accessors/AccessorsClassPath.kt
@@ -73,7 +73,6 @@ import org.jetbrains.org.objectweb.asm.signature.SignatureReader
 import org.jetbrains.org.objectweb.asm.signature.SignatureVisitor
 import java.io.Closeable
 import java.io.File
-import java.util.concurrent.ConcurrentHashMap
 import javax.inject.Inject
 
 
@@ -87,28 +86,19 @@ class ProjectAccessorsClassPathGenerator @Inject internal constructor(
     private val asyncIO: AsyncIOScopeFactory,
 ) {
 
-    private
-    val classPathCache = ConcurrentHashMap<ClassLoaderScope, AccessorsClassPath>()
-
-    fun projectAccessorsClassPath(scriptTarget: ExtensionAware, classPath: ClassPath): AccessorsClassPath {
-        val classLoaderScope = classLoaderScopeOf(scriptTarget)
-        if (classLoaderScope == null) {
-            return AccessorsClassPath.empty
-        }
-        return classPathCache.computeIfAbsent(classLoaderScope) {
-            buildAccessorsClassPathFor(classLoaderScope, scriptTarget, classPath)
+    fun projectAccessorsClassPath(scriptTarget: ExtensionAware, classPath: ClassPath): AccessorsClassPath =
+        scriptTarget.getOrCreateProperty("gradleKotlinDsl.accessorsClassPath") {
+            buildAccessorsClassPathFor(scriptTarget, classPath)
                 ?: AccessorsClassPath.empty
         }
-    }
+
 
     private
-    fun buildAccessorsClassPathFor(
-        classLoaderScope: ClassLoaderScope,
-        scriptTarget: Any,
-        classPath: ClassPath
-    ): AccessorsClassPath? =
-        configuredProjectSchemaOf(scriptTarget, classLoaderScope)
-            ?.let { scriptTargetSchema ->
+    fun buildAccessorsClassPathFor(scriptTarget: Any, classPath: ClassPath): AccessorsClassPath? =
+        classLoaderScopeOf(scriptTarget)
+            ?.let { classLoaderScope ->
+                configuredProjectSchemaOf(scriptTarget, classLoaderScope)
+            }?.let { scriptTargetSchema ->
                 val work = GenerateProjectAccessors(
                     scriptTarget,
                     scriptTargetSchema,
diff --git a/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/accessors/BuildScopeServices.kt b/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/accessors/BuildScopeServices.kt
index 56595d19d3a..c74c6a038c8 100644
--- a/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/accessors/BuildScopeServices.kt
+++ b/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/accessors/BuildScopeServices.kt
@@ -17,7 +17,6 @@
 package org.gradle.kotlin.dsl.accessors
 
 import org.gradle.api.internal.file.FileCollectionFactory
-import org.gradle.internal.build.BuildState
 import org.gradle.internal.execution.ExecutionEngine
 import org.gradle.internal.execution.InputFingerprinter
 import org.gradle.internal.hash.ClassLoaderHierarchyHasher
@@ -36,15 +35,13 @@ object BuildScopeServices : ServiceRegistrationProvider {
         fileCollectionFactory: FileCollectionFactory,
         executionEngine: ExecutionEngine,
         inputFingerprinter: InputFingerprinter,
-        workspaceProvider: KotlinDslWorkspaceProvider,
-        buildState: BuildState
+        workspaceProvider: KotlinDslWorkspaceProvider
     ) = Stage1BlocksAccessorClassPathGenerator(
         classLoaderHierarchyHasher,
         fileCollectionFactory,
         executionEngine,
         inputFingerprinter,
-        workspaceProvider,
-        buildState
+        workspaceProvider
     )
 
     @Provides
diff --git a/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/accessors/SingletonProperties.kt b/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/accessors/SingletonProperties.kt
new file mode 100644
index 00000000000..1debe3202da
--- /dev/null
+++ b/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/accessors/SingletonProperties.kt
@@ -0,0 +1,31 @@
+/*
+ * Copyright 2017 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.gradle.kotlin.dsl.accessors
+
+import org.gradle.api.plugins.ExtensionAware
+
+import org.gradle.kotlin.dsl.extra
+
+
+internal
+inline fun <reified T : Any> ExtensionAware.getOrCreateProperty(
+    property: String,
+    crossinline create: () -> T
+): T = extra.run {
+    if (has(property)) get(property) as T
+    else create().also { set(property, it) }
+}
diff --git a/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/accessors/Stage1BlocksAccessorClassPath.kt b/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/accessors/Stage1BlocksAccessorClassPath.kt
index c8fee51c522..4294565490e 100644
--- a/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/accessors/Stage1BlocksAccessorClassPath.kt
+++ b/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/accessors/Stage1BlocksAccessorClassPath.kt
@@ -21,7 +21,6 @@ import org.gradle.api.internal.catalog.ExternalModuleDependencyFactory
 import org.gradle.api.internal.file.FileCollectionFactory
 import org.gradle.api.internal.initialization.ClassLoaderScope
 import org.gradle.api.internal.project.ProjectInternal
-import org.gradle.internal.build.BuildState
 import org.gradle.internal.classpath.DefaultClassPath
 import org.gradle.internal.execution.ExecutionEngine
 import org.gradle.internal.execution.ImmutableUnitOfWork
@@ -61,26 +60,18 @@ class Stage1BlocksAccessorClassPathGenerator @Inject internal constructor(
     private val fileCollectionFactory: FileCollectionFactory,
     private val executionEngine: ExecutionEngine,
     private val inputFingerprinter: InputFingerprinter,
-    private val workspaceProvider: KotlinDslWorkspaceProvider,
-    private val buildState: BuildState,
+    private val workspaceProvider: KotlinDslWorkspaceProvider
 ) {
-
-    private
-    val stage1BlocksAccessorClassPath by lazy {
-        val rootProject = buildState.projects.rootProject.mutableModel
-        val buildSrcClassLoaderScope = baseClassLoaderScopeOf(rootProject)
-        val classLoaderHash = requireNotNull(classLoaderHierarchyHasher.getClassLoaderHash(buildSrcClassLoaderScope.exportClassLoader))
-        val versionCatalogAccessors = generateVersionCatalogAccessors(rootProject, buildSrcClassLoaderScope, classLoaderHash)
-        val pluginSpecBuildersAccessors = generatePluginSpecBuildersAccessors(rootProject, buildSrcClassLoaderScope, classLoaderHash)
-        versionCatalogAccessors + pluginSpecBuildersAccessors
-    }
-
-    fun stage1BlocksAccessorClassPath(project: ProjectInternal): AccessorsClassPath {
-        require(project.owner.owner === buildState) {
-            "$project belongs to a different build."
+    fun stage1BlocksAccessorClassPath(project: ProjectInternal): AccessorsClassPath =
+        project.owner.owner.projects.rootProject.mutableModel.let { rootProject ->
+            rootProject.getOrCreateProperty("gradleKotlinDsl.stage1AccessorsClassPath") {
+                val buildSrcClassLoaderScope = baseClassLoaderScopeOf(rootProject)
+                val classLoaderHash = requireNotNull(classLoaderHierarchyHasher.getClassLoaderHash(buildSrcClassLoaderScope.exportClassLoader))
+                val versionCatalogAccessors = generateVersionCatalogAccessors(rootProject, buildSrcClassLoaderScope, classLoaderHash)
+                val pluginSpecBuildersAccessors = generatePluginSpecBuildersAccessors(rootProject, buildSrcClassLoaderScope, classLoaderHash)
+                versionCatalogAccessors + pluginSpecBuildersAccessors
+            }
         }
-        return stage1BlocksAccessorClassPath
-    }
 
     private
     fun baseClassLoaderScopeOf(rootProject: Project) =
diff --git a/platforms/documentation/docs/src/docs/release/notes.md b/platforms/documentation/docs/src/docs/release/notes.md
index 6b0c5bb0221..e85ab34ce7f 100644
--- a/platforms/documentation/docs/src/docs/release/notes.md
+++ b/platforms/documentation/docs/src/docs/release/notes.md
@@ -237,7 +237,7 @@ Tasks graph for: root r2
 |         +--- :leaf1 (org.gradle.api.DefaultTask)
 |         \--- :leaf2 (org.gradle.api.DefaultTask, disabled)
 \--- :root2 (org.gradle.api.DefaultTask)
-    +--- :leaf1 (org.gradle.api.DefaultTask) (*)
+    +--- :leaf1 (*)
     |--- other build task :included:fromIncluded (org.gradle.api.DefaultTask)
     \--- :leaf4 (org.gradle.api.DefaultTask, finalizer)
          \--- :leaf3 (org.gradle.api.DefaultTask)
diff --git a/platforms/native/platform-native/src/main/java/org/gradle/nativeplatform/internal/NativeDependentBinariesResolutionStrategy.java b/platforms/native/platform-native/src/main/java/org/gradle/nativeplatform/internal/NativeDependentBinariesResolutionStrategy.java
index 4e7f0a4d42a..d372e419e8c 100644
--- a/platforms/native/platform-native/src/main/java/org/gradle/nativeplatform/internal/NativeDependentBinariesResolutionStrategy.java
+++ b/platforms/native/platform-native/src/main/java/org/gradle/nativeplatform/internal/NativeDependentBinariesResolutionStrategy.java
@@ -231,7 +231,7 @@ private List<DependentBinariesResolvedResult> doBuildResolvedResult(final Native
     private void onCircularDependencies(final State state, final Deque<NativeBinarySpecInternal> stack, NativeBinarySpecInternal target) {
         GraphNodeRenderer<NativeBinarySpecInternal> nodeRenderer = new GraphNodeRenderer<NativeBinarySpecInternal>() {
             @Override
-            public void renderTo(NativeBinarySpecInternal node, StyledTextOutput output) {
+            public void renderTo(NativeBinarySpecInternal node, StyledTextOutput output, boolean alreadySeen) {
                 String name = DependentComponentsUtils.getBuildScopedTerseName(node.getId());
                 output.withStyle(StyledTextOutput.Style.Identifier).text(name);
             }
diff --git a/subprojects/composite-builds/src/main/java/org/gradle/composite/internal/DefaultBuildController.java b/subprojects/composite-builds/src/main/java/org/gradle/composite/internal/DefaultBuildController.java
index e0271a87cf2..fb12ea62229 100644
--- a/subprojects/composite-builds/src/main/java/org/gradle/composite/internal/DefaultBuildController.java
+++ b/subprojects/composite-builds/src/main/java/org/gradle/composite/internal/DefaultBuildController.java
@@ -152,7 +152,7 @@ private static void checkForCyclesFor(TaskInternal task, Set<TaskInternal> visit
             List<Set<TaskInternal>> cycles = graphWalker.findCycles();
             Set<TaskInternal> cycle = cycles.get(0);
 
-            DirectedGraphRenderer<TaskInternal> graphRenderer = new DirectedGraphRenderer<>((node, output) -> output.withStyle(StyledTextOutput.Style.Identifier).text(node.getIdentityPath()), (node, values, connectedNodes) -> visitDependenciesOf(node, dep -> {
+            DirectedGraphRenderer<TaskInternal> graphRenderer = new DirectedGraphRenderer<>((node, output, alreadySeen) -> output.withStyle(StyledTextOutput.Style.Identifier).text(node.getIdentityPath()), (node, values, connectedNodes) -> visitDependenciesOf(node, dep -> {
                 if (cycle.contains(dep)) {
                     connectedNodes.add(dep);
                 }
diff --git a/subprojects/core/src/main/java/org/gradle/execution/plan/DetermineExecutionPlanAction.java b/subprojects/core/src/main/java/org/gradle/execution/plan/DetermineExecutionPlanAction.java
index 410f3f1ce92..1d1390854a6 100644
--- a/subprojects/core/src/main/java/org/gradle/execution/plan/DetermineExecutionPlanAction.java
+++ b/subprojects/core/src/main/java/org/gradle/execution/plan/DetermineExecutionPlanAction.java
@@ -307,7 +307,7 @@ private StringWriter renderOrderingCycle(Set<Node> nodes) {
         List<Node> cycle = sortedListOf(nodes);
 
         DirectedGraphRenderer<Node> graphRenderer = new DirectedGraphRenderer<>(
-            (it, output) -> output.withStyle(StyledTextOutput.Style.Identifier).text(it),
+            (it, output, alreadySeen) -> output.withStyle(StyledTextOutput.Style.Identifier).text(it),
             (it, values, connectedNodes) -> {
                 for (Node dependency : cycle) {
                     Set<Node> successors = Sets.newHashSet(it.getHardSuccessors());
diff --git a/subprojects/core/src/main/java/org/gradle/internal/execution/TaskGraphBuildExecutionAction.java b/subprojects/core/src/main/java/org/gradle/internal/execution/TaskGraphBuildExecutionAction.java
index 856574a03f5..c0bf5b7acc0 100644
--- a/subprojects/core/src/main/java/org/gradle/internal/execution/TaskGraphBuildExecutionAction.java
+++ b/subprojects/core/src/main/java/org/gradle/internal/execution/TaskGraphBuildExecutionAction.java
@@ -83,14 +83,16 @@ public ExecutionResult<Void> execute(GradleInternal gradle, FinalizedExecutionPl
     private static class NodeRenderer implements GraphNodeRenderer<TaskInfo> {
 
         @Override
-        public void renderTo(TaskInfo node, StyledTextOutput output) {
+        public void renderTo(TaskInfo node, StyledTextOutput output, boolean alreadySeen) {
             output
                 .withStyle(StyledTextOutput.Style.Identifier).text(node.getId());
 
-            String description = node.getDescription();
-            if (!description.isEmpty()) {
-                output.text(" ");
-                output.withStyle(StyledTextOutput.Style.Description).text(description);
+            if (!alreadySeen) {
+                String description = node.getDescription();
+                if (!description.isEmpty()) {
+                    output.text(" ");
+                    output.withStyle(StyledTextOutput.Style.Description).text(description);
+                }
             }
         }
     }
diff --git a/subprojects/core/src/main/java/org/gradle/internal/graph/DirectedGraphRenderer.java b/subprojects/core/src/main/java/org/gradle/internal/graph/DirectedGraphRenderer.java
index 54c668d1002..a3343017821 100644
--- a/subprojects/core/src/main/java/org/gradle/internal/graph/DirectedGraphRenderer.java
+++ b/subprojects/core/src/main/java/org/gradle/internal/graph/DirectedGraphRenderer.java
@@ -16,10 +16,14 @@
 package org.gradle.internal.graph;
 
 import org.gradle.api.Action;
-import org.gradle.internal.logging.text.StyledTextOutput;
 import org.gradle.internal.logging.text.StreamingStyledTextOutput;
+import org.gradle.internal.logging.text.StyledTextOutput;
 
-import java.util.*;
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.HashSet;
+import java.util.List;
+import java.util.Set;
 
 import static org.gradle.internal.logging.text.StyledTextOutput.Style.Info;
 
@@ -54,7 +58,7 @@ private void renderTo(final N node, GraphRenderer graphRenderer, Collection<N> r
         graphRenderer.visit(new Action<StyledTextOutput>() {
             @Override
             public void execute(StyledTextOutput output) {
-                nodeRenderer.renderTo(node, output);
+                nodeRenderer.renderTo(node, output, alreadySeen);
                 if (alreadySeen) {
                     output.text(" (*)");
                 }
diff --git a/subprojects/core/src/main/java/org/gradle/internal/graph/GraphNodeRenderer.java b/subprojects/core/src/main/java/org/gradle/internal/graph/GraphNodeRenderer.java
index 652ee095a3d..4df5701e280 100644
--- a/subprojects/core/src/main/java/org/gradle/internal/graph/GraphNodeRenderer.java
+++ b/subprojects/core/src/main/java/org/gradle/internal/graph/GraphNodeRenderer.java
@@ -18,5 +18,5 @@
 import org.gradle.internal.logging.text.StyledTextOutput;
 
 public interface GraphNodeRenderer<N> {
-    void renderTo(N node, StyledTextOutput output);
+    void renderTo(N node, StyledTextOutput output, boolean alreadySeen);
 }
diff --git a/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/IsolatedProjectsGradleceptionSyncTest.groovy b/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/IsolatedProjectsGradleceptionSyncTest.groovy
index 6b54b6be1e7..0a8579f4b7e 100644
--- a/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/IsolatedProjectsGradleceptionSyncTest.groovy
+++ b/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/IsolatedProjectsGradleceptionSyncTest.groovy
@@ -33,9 +33,7 @@ class IsolatedProjectsGradleceptionSyncTest extends AbstractIdeSyncTest {
 
         then:
         fixture.assertHtmlReportHasProblems {
-            // In gradle/gradle total problems count depends on amount of subprojects.
-            // We want to avoid useless test failures
-            ignoreTotalProblemsCount = true
+            totalProblemsCount = 211
             withLocatedProblem("Build file 'testing/architecture-test/build.gradle.kts'", "Project ':architecture-test' cannot access 'Project.tasks' functionality on another project ':'")
             withLocatedProblem("Plugin class 'JetGradlePlugin'", "Project ':' cannot access 'Project.extensions' functionality on subprojects via 'allprojects'")
         }
diff --git a/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/fixtures/HasConfigurationCacheProblemsInReportSpec.groovy b/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/fixtures/HasConfigurationCacheProblemsInReportSpec.groovy
index 2cb18918b88..205ba233b73 100644
--- a/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/fixtures/HasConfigurationCacheProblemsInReportSpec.groovy
+++ b/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/fixtures/HasConfigurationCacheProblemsInReportSpec.groovy
@@ -29,8 +29,6 @@ class HasConfigurationCacheProblemsInReportSpec {
     @Nullable
     Integer totalProblemsCount
 
-    boolean ignoreTotalProblemsCount
-
     void validateSpec() {
         def totalCount = totalProblemsCount ?: locationsWithProblems.size()
         if (totalCount < locationsWithProblems.size()) {
diff --git a/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/fixtures/IsolatedProjectsIdeSyncFixture.groovy b/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/fixtures/IsolatedProjectsIdeSyncFixture.groovy
index e4ffaed425b..30a5c3f2175 100644
--- a/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/fixtures/IsolatedProjectsIdeSyncFixture.groovy
+++ b/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/fixtures/IsolatedProjectsIdeSyncFixture.groovy
@@ -59,9 +59,7 @@ class IsolatedProjectsIdeSyncFixture {
             Pair.of(location, message)
         }.unique()
 
-        if (!spec.ignoreTotalProblemsCount) {
-            assert jsModel.totalProblemCount == spec.totalProblemsCount
-        }
+        assert jsModel.totalProblemCount == spec.totalProblemsCount
         assert actualLocationsWithProblems.size() == spec.locationsWithProblems.size()
         assert actualLocationsWithProblems.every { actualLocation ->
             spec.locationsWithProblems.any { expectedLocation ->
