diff --git a/mockwebserver-deprecated/src/test/java/okhttp3/mockwebserver/MockWebServerTest.java b/mockwebserver-deprecated/src/test/java/okhttp3/mockwebserver/MockWebServerTest.java
index 206a9ea74..9176560b1 100644
--- a/mockwebserver-deprecated/src/test/java/okhttp3/mockwebserver/MockWebServerTest.java
+++ b/mockwebserver-deprecated/src/test/java/okhttp3/mockwebserver/MockWebServerTest.java
@@ -617,7 +617,7 @@ public final class MockWebServerTest {
     try {
       server2.start();
       fail();
-    } catch (IllegalStateException expected) {
+    } catch (IllegalArgumentException iae) {
       // expected
     }
     server2.shutdown();
diff --git a/mockwebserver-junit4/build.gradle b/mockwebserver-junit4/build.gradle
deleted file mode 100644
index 26baefa79..000000000
--- a/mockwebserver-junit4/build.gradle
+++ /dev/null
@@ -1,19 +0,0 @@
-jar {
-  manifest {
-    attributes('Automatic-Module-Name': 'mockwebserver3.junit4')
-  }
-}
-
-dependencies {
-  api project(':mockwebserver')
-  api deps.junit
-
-  testImplementation deps.assertj
-}
-
-afterEvaluate { project ->
-  project.tasks.dokka {
-    outputDirectory = "$rootDir/docs/4.x"
-    outputFormat = 'gfm'
-  }
-}
diff --git a/mockwebserver-junit4/src/main/kotlin/mockwebserver3/junit4/MockWebServerRule.kt b/mockwebserver-junit4/src/main/kotlin/mockwebserver3/junit4/MockWebServerRule.kt
deleted file mode 100644
index f310ea3bd..000000000
--- a/mockwebserver-junit4/src/main/kotlin/mockwebserver3/junit4/MockWebServerRule.kt
+++ /dev/null
@@ -1,62 +0,0 @@
-/*
- * Copyright (C) 2020 Square, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package mockwebserver3.junit4
-
-import mockwebserver3.MockWebServer
-import org.junit.rules.ExternalResource
-import java.io.IOException
-import java.util.logging.Level
-import java.util.logging.Logger
-
-/**
- * Runs MockWebServer for the duration of a single test method.
- *
- * In Java JUnit 4 tests (ie. tests annotated `@org.junit.Test`), use this by defining a field with
- * the `@Rule` annotation:
- *
- * ```
- * @Rule public final MockWebServerRule serverRule = new MockWebServerRule();
- * ```
- *
- * For Kotlin the `@JvmField` annotation is also necessary:
- *
- * ```
- * @JvmField @Rule val serverRule = MockWebServerRule()
- * ```
- */
-class MockWebServerRule : ExternalResource() {
-  val server: MockWebServer = MockWebServer()
-
-  override fun before() {
-    try {
-      server.start()
-    } catch (e: IOException) {
-      throw RuntimeException(e)
-    }
-  }
-
-  override fun after() {
-    try {
-      server.shutdown()
-    } catch (e: IOException) {
-      logger.log(Level.WARNING, "MockWebServer shutdown failed", e)
-    }
-  }
-
-  companion object {
-    private val logger = Logger.getLogger(MockWebServerRule::class.java.name)
-  }
-}
diff --git a/mockwebserver-junit4/src/test/java/mockwebserver3/junit4/MockWebServerRuleTest.kt b/mockwebserver-junit4/src/test/java/mockwebserver3/junit4/MockWebServerRuleTest.kt
deleted file mode 100644
index 40bb5e209..000000000
--- a/mockwebserver-junit4/src/test/java/mockwebserver3/junit4/MockWebServerRuleTest.kt
+++ /dev/null
@@ -1,46 +0,0 @@
-/*
- * Copyright (C) 2020 Square, Inc.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package mockwebserver3.junit4
-
-import java.net.ConnectException
-import java.util.concurrent.atomic.AtomicBoolean
-import org.assertj.core.api.Assertions
-import org.assertj.core.api.Assertions.assertThat
-import org.junit.Assert
-import org.junit.Assert.fail
-import org.junit.Test
-import org.junit.runner.Description
-import org.junit.runners.model.Statement
-
-class MockWebServerRuleTest {
-  @Test fun statementStartsAndStops() {
-    val rule = MockWebServerRule()
-    val called = AtomicBoolean()
-    val statement: Statement = rule.apply(object : Statement() {
-      @Throws(Throwable::class) override fun evaluate() {
-        called.set(true)
-        rule.server.url("/").toUrl().openConnection().connect()
-      }
-    }, Description.EMPTY)
-    statement.evaluate()
-    assertThat(called.get()).isTrue
-    try {
-      rule.server.url("/").toUrl().openConnection().connect()
-      fail()
-    } catch (expected: ConnectException) {
-    }
-  }
-}
diff --git a/mockwebserver/build.gradle b/mockwebserver/build.gradle
index 5f0b3f489..01bac5b3c 100644
--- a/mockwebserver/build.gradle
+++ b/mockwebserver/build.gradle
@@ -6,11 +6,10 @@ jar {
 
 dependencies {
   api project(':okhttp')
+  api deps.junit
 
   testImplementation project(':okhttp-testing-support')
   testImplementation project(':okhttp-tls')
-  testImplementation project(':mockwebserver-junit4')
-  testImplementation deps.junit
   testImplementation deps.assertj
 }
 
diff --git a/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt b/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt
index 8442cb149..24de62e34 100644
--- a/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt
+++ b/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt
@@ -44,23 +44,6 @@ import javax.net.ssl.SSLSocket
 import javax.net.ssl.SSLSocketFactory
 import javax.net.ssl.TrustManager
 import javax.net.ssl.X509TrustManager
-import mockwebserver3.SocketPolicy.CONTINUE_ALWAYS
-import mockwebserver3.SocketPolicy.DISCONNECT_AFTER_REQUEST
-import mockwebserver3.SocketPolicy.DISCONNECT_AT_END
-import mockwebserver3.SocketPolicy.DISCONNECT_AT_START
-import mockwebserver3.SocketPolicy.DISCONNECT_DURING_REQUEST_BODY
-import mockwebserver3.SocketPolicy.DISCONNECT_DURING_RESPONSE_BODY
-import mockwebserver3.SocketPolicy.DO_NOT_READ_REQUEST_BODY
-import mockwebserver3.SocketPolicy.EXPECT_CONTINUE
-import mockwebserver3.SocketPolicy.FAIL_HANDSHAKE
-import mockwebserver3.SocketPolicy.NO_RESPONSE
-import mockwebserver3.SocketPolicy.RESET_STREAM_AT_START
-import mockwebserver3.SocketPolicy.SHUTDOWN_INPUT_AT_END
-import mockwebserver3.SocketPolicy.SHUTDOWN_OUTPUT_AT_END
-import mockwebserver3.SocketPolicy.SHUTDOWN_SERVER_AFTER_RESPONSE
-import mockwebserver3.SocketPolicy.STALL_SOCKET_AT_START
-import mockwebserver3.SocketPolicy.UPGRADE_TO_SSL_AT_END
-import mockwebserver3.internal.duplex.DuplexResponseBody
 import okhttp3.Headers
 import okhttp3.Headers.Companion.headersOf
 import okhttp3.HttpUrl
@@ -83,6 +66,23 @@ import okhttp3.internal.toImmutableList
 import okhttp3.internal.ws.RealWebSocket
 import okhttp3.internal.ws.WebSocketExtensions
 import okhttp3.internal.ws.WebSocketProtocol
+import mockwebserver3.SocketPolicy.CONTINUE_ALWAYS
+import mockwebserver3.SocketPolicy.DISCONNECT_AFTER_REQUEST
+import mockwebserver3.SocketPolicy.DISCONNECT_AT_END
+import mockwebserver3.SocketPolicy.DISCONNECT_AT_START
+import mockwebserver3.SocketPolicy.DISCONNECT_DURING_REQUEST_BODY
+import mockwebserver3.SocketPolicy.DISCONNECT_DURING_RESPONSE_BODY
+import mockwebserver3.SocketPolicy.DO_NOT_READ_REQUEST_BODY
+import mockwebserver3.SocketPolicy.EXPECT_CONTINUE
+import mockwebserver3.SocketPolicy.FAIL_HANDSHAKE
+import mockwebserver3.SocketPolicy.NO_RESPONSE
+import mockwebserver3.SocketPolicy.RESET_STREAM_AT_START
+import mockwebserver3.SocketPolicy.SHUTDOWN_INPUT_AT_END
+import mockwebserver3.SocketPolicy.SHUTDOWN_OUTPUT_AT_END
+import mockwebserver3.SocketPolicy.SHUTDOWN_SERVER_AFTER_RESPONSE
+import mockwebserver3.SocketPolicy.STALL_SOCKET_AT_START
+import mockwebserver3.SocketPolicy.UPGRADE_TO_SSL_AT_END
+import mockwebserver3.internal.duplex.DuplexResponseBody
 import okio.Buffer
 import okio.BufferedSink
 import okio.BufferedSource
@@ -92,12 +92,13 @@ import okio.Timeout
 import okio.buffer
 import okio.sink
 import okio.source
+import org.junit.rules.ExternalResource
 
 /**
  * A scriptable web server. Callers supply canned responses and the server replays them upon request
  * in sequence.
  */
-class MockWebServer : Closeable {
+class MockWebServer : ExternalResource(), Closeable {
   private val taskRunnerBackend = TaskRunner.RealBackend(
       threadFactory("MockWebServer TaskRunner", daemon = false))
   private val taskRunner = TaskRunner(taskRunnerBackend)
@@ -120,13 +121,13 @@ class MockWebServer : Closeable {
   var bodyLimit = Long.MAX_VALUE
 
   var serverSocketFactory: ServerSocketFactory? = null
-    @Synchronized get() {
+    get() {
       if (field == null && started) {
         field = ServerSocketFactory.getDefault() // Build the default value lazily.
       }
       return field
     }
-    @Synchronized set(value) {
+    set(value) {
       check(!started) { "serverSocketFactory must not be set after start()" }
       field = value
     }
@@ -188,10 +189,9 @@ class MockWebServer : Closeable {
     }
 
   private var started: Boolean = false
-  private var shutdown: Boolean = false
 
-  @Synchronized private fun before() {
-    if (started) return // Don't call start() in case we're already shut down.
+  @Synchronized override fun before() {
+    if (started) return
     try {
       start()
     } catch (e: IOException) {
@@ -378,8 +378,7 @@ class MockWebServer : Closeable {
    */
   @Synchronized @Throws(IOException::class)
   private fun start(inetSocketAddress: InetSocketAddress) {
-    check(!shutdown) { "shutdown() already called" }
-    if (started) return
+    require(!started) { "start() already called" }
     started = true
 
     this.inetSocketAddress = inetSocketAddress
@@ -443,14 +442,11 @@ class MockWebServer : Closeable {
   @Synchronized
   @Throws(IOException::class)
   fun shutdown() {
-    if (shutdown) return
-    shutdown = true
-
-    if (!started) return // Nothing to shut down.
-    val serverSocket = this.serverSocket ?: return // If this is null, start() must have failed.
+    if (!started) return
+    require(serverSocket != null) { "shutdown() before start()" }
 
     // Cause acceptConnections() to break out.
-    serverSocket.close()
+    serverSocket!!.close()
 
     // Await shutdown.
     for (queue in taskRunner.activeQueues()) {
@@ -461,6 +457,14 @@ class MockWebServer : Closeable {
     taskRunnerBackend.shutdown()
   }
 
+  @Synchronized override fun after() {
+    try {
+      shutdown()
+    } catch (e: IOException) {
+      logger.log(Level.WARNING, "MockWebServer shutdown failed", e)
+    }
+  }
+
   private fun serveConnection(raw: Socket) {
     taskRunner.newQueue().execute("MockWebServer ${raw.remoteSocketAddress}", cancelable = false) {
       try {
diff --git a/mockwebserver/src/main/kotlin/mockwebserver3/internal/duplex/MockDuplexResponseBody.kt b/mockwebserver/src/main/kotlin/mockwebserver3/internal/duplex/MockDuplexResponseBody.kt
index 8059e3b0a..babff7d58 100644
--- a/mockwebserver/src/main/kotlin/mockwebserver3/internal/duplex/MockDuplexResponseBody.kt
+++ b/mockwebserver/src/main/kotlin/mockwebserver3/internal/duplex/MockDuplexResponseBody.kt
@@ -20,13 +20,16 @@ import java.util.concurrent.CountDownLatch
 import java.util.concurrent.FutureTask
 import java.util.concurrent.LinkedBlockingQueue
 import java.util.concurrent.TimeUnit
-import mockwebserver3.RecordedRequest
 import okhttp3.internal.http2.ErrorCode
 import okhttp3.internal.http2.Http2Stream
+import mockwebserver3.RecordedRequest
 import okio.BufferedSink
 import okio.BufferedSource
 import okio.buffer
 import okio.utf8Size
+import org.junit.Assert.assertEquals
+import org.junit.Assert.assertTrue
+import org.junit.Assert.fail
 
 private typealias Action = (RecordedRequest, BufferedSource, BufferedSink, Http2Stream) -> Unit
 
@@ -40,15 +43,12 @@ class MockDuplexResponseBody : DuplexResponseBody {
 
   fun receiveRequest(expected: String) = apply {
     actions += { _, requestBody, _, _ ->
-      val actual = requestBody.readUtf8(expected.utf8Size())
-      if (actual != expected) throw AssertionError("$actual != $expected")
+      assertEquals(expected, requestBody.readUtf8(expected.utf8Size()))
     }
   }
 
   fun exhaustRequest() = apply {
-    actions += { _, requestBody, _, _ ->
-      if (!requestBody.exhausted()) throw AssertionError("expected exhausted")
-    }
+    actions += { _, requestBody, _, _ -> assertTrue(requestBody.exhausted()) }
   }
 
   fun cancelStream(errorCode: ErrorCode) = apply {
@@ -59,7 +59,7 @@ class MockDuplexResponseBody : DuplexResponseBody {
     actions += { _, requestBody, _, _ ->
       try {
         requestBody.exhausted()
-        throw AssertionError("expected IOException")
+        fail()
       } catch (expected: IOException) {
       }
     }
diff --git a/mockwebserver/src/test/java/mockwebserver3/CustomDispatcherTest.java b/mockwebserver/src/test/java/mockwebserver3/CustomDispatcherTest.java
index 93c32bae2..b670a588a 100644
--- a/mockwebserver/src/test/java/mockwebserver3/CustomDispatcherTest.java
+++ b/mockwebserver/src/test/java/mockwebserver3/CustomDispatcherTest.java
@@ -22,7 +22,6 @@ import java.util.ArrayList;
 import java.util.List;
 import java.util.concurrent.CountDownLatch;
 import java.util.concurrent.atomic.AtomicInteger;
-import mockwebserver3.junit4.MockWebServerRule;
 import org.junit.Rule;
 import org.junit.Test;
 import org.junit.rules.Timeout;
@@ -30,12 +29,10 @@ import org.junit.rules.Timeout;
 import static org.assertj.core.api.Assertions.assertThat;
 
 public class CustomDispatcherTest {
-  @Rule public MockWebServerRule mockWebServerRule = new MockWebServerRule();
+  @Rule public MockWebServer mockWebServer = new MockWebServer();
 
   @Rule public Timeout globalTimeout = Timeout.seconds(30);
 
-  private final MockWebServer mockWebServer = mockWebServerRule.getServer();
-
   @Test public void simpleDispatch() throws Exception {
     final List<RecordedRequest> requestsMade = new ArrayList<>();
     final Dispatcher dispatcher = new Dispatcher() {
diff --git a/mockwebserver/src/test/java/mockwebserver3/MockWebServerTest.java b/mockwebserver/src/test/java/mockwebserver3/MockWebServerTest.java
index a6278e7c0..34d1291fe 100644
--- a/mockwebserver/src/test/java/mockwebserver3/MockWebServerTest.java
+++ b/mockwebserver/src/test/java/mockwebserver3/MockWebServerTest.java
@@ -30,8 +30,8 @@ import java.net.URLConnection;
 import java.util.ArrayList;
 import java.util.List;
 import java.util.concurrent.TimeUnit;
+import java.util.concurrent.atomic.AtomicBoolean;
 import javax.net.ssl.HttpsURLConnection;
-import mockwebserver3.junit4.MockWebServerRule;
 import okhttp3.Handshake;
 import okhttp3.Headers;
 import okhttp3.HttpUrl;
@@ -41,12 +41,13 @@ import okhttp3.TestUtil;
 import okhttp3.testing.PlatformRule;
 import okhttp3.tls.HandshakeCertificates;
 import okhttp3.tls.HeldCertificate;
-import org.junit.After;
 import org.junit.Before;
 import org.junit.Ignore;
 import org.junit.Rule;
 import org.junit.Test;
 import org.junit.rules.Timeout;
+import org.junit.runner.Description;
+import org.junit.runners.model.Statement;
 
 import static java.nio.charset.StandardCharsets.UTF_8;
 import static java.util.Arrays.asList;
@@ -63,20 +64,12 @@ import static org.junit.Assume.assumeFalse;
 public final class MockWebServerTest {
   @Rule public PlatformRule platform = new PlatformRule();
 
-  @Rule public final MockWebServerRule serverRule = new MockWebServerRule();
+  @Rule public final MockWebServer server = new MockWebServer();
 
   @Rule public Timeout globalTimeout = Timeout.seconds(30);
 
-  private final MockWebServer server = serverRule.getServer();
-
-  @Before public void setUp() throws IOException {
+  @Before public void checkPlatforms() {
     platform.assumeNotBouncyCastle();
-    server.start();
-  }
-
-  @After
-  public void tearDown() throws Exception {
-    server.shutdown();
   }
 
   @Test public void defaultMockResponse() {
@@ -418,6 +411,25 @@ public final class MockWebServerTest {
     other.shutdown();
   }
 
+  @Test public void statementStartsAndStops() throws Throwable {
+    final AtomicBoolean called = new AtomicBoolean();
+    Statement statement = server.apply(new Statement() {
+      @Override public void evaluate() throws Throwable {
+        called.set(true);
+        server.url("/").url().openConnection().connect();
+      }
+    }, Description.EMPTY);
+
+    statement.evaluate();
+
+    assertThat(called.get()).isTrue();
+    try {
+      server.url("/").url().openConnection().connect();
+      fail();
+    } catch (ConnectException expected) {
+    }
+  }
+
   @Test public void shutdownWhileBlockedDispatching() throws Exception {
     // Enqueue a request that'll cause MockWebServer to hang on QueueDispatcher.dispatch().
     HttpURLConnection connection = (HttpURLConnection) server.url("/").url().openConnection();
@@ -596,15 +608,6 @@ public final class MockWebServerTest {
     assertThat(handshake.peerCertificates().size()).isEqualTo(1);
   }
 
-  @Test
-  public void startTwice() throws IOException {
-    MockWebServer server2 = new MockWebServer();
-
-    server2.start();
-    server2.start();
-    server2.shutdown();
-  }
-
   @Test
   public void shutdownTwice() throws IOException {
     MockWebServer server2 = new MockWebServer();
@@ -614,7 +617,7 @@ public final class MockWebServerTest {
     try {
       server2.start();
       fail();
-    } catch (IllegalStateException expected) {
+    } catch (IllegalArgumentException iae) {
       // expected
     }
     server2.shutdown();
diff --git a/okhttp/build.gradle b/okhttp/build.gradle
index cb05ee070..4c74b523b 100644
--- a/okhttp/build.gradle
+++ b/okhttp/build.gradle
@@ -74,8 +74,6 @@ dependencies {
   testImplementation project(':okhttp-testing-support')
   testImplementation project(':okhttp-tls')
   testImplementation project(':okhttp-urlconnection')
-  testImplementation project(':mockwebserver')
-  testImplementation project(':mockwebserver-junit4')
   testImplementation project(':mockwebserver-deprecated')
   testImplementation project(':okhttp-logging-interceptor')
   testImplementation project(':okhttp-brotli')
diff --git a/okhttp/src/test/java/okhttp3/CallTest.java b/okhttp/src/test/java/okhttp3/CallTest.java
index 93470a7ba..95af90c50 100644
--- a/okhttp/src/test/java/okhttp3/CallTest.java
+++ b/okhttp/src/test/java/okhttp3/CallTest.java
@@ -54,13 +54,6 @@ import javax.net.ssl.SSLPeerUnverifiedException;
 import javax.net.ssl.SSLProtocolException;
 import javax.net.ssl.SSLSocket;
 import javax.net.ssl.SSLSocketFactory;
-import mockwebserver3.Dispatcher;
-import mockwebserver3.MockResponse;
-import mockwebserver3.MockWebServer;
-import mockwebserver3.QueueDispatcher;
-import mockwebserver3.RecordedRequest;
-import mockwebserver3.SocketPolicy;
-import mockwebserver3.junit4.MockWebServerRule;
 import okhttp3.CallEvent.CallEnd;
 import okhttp3.CallEvent.ConnectStart;
 import okhttp3.CallEvent.ConnectionAcquired;
@@ -71,6 +64,12 @@ import okhttp3.internal.RecordingOkAuthenticator;
 import okhttp3.internal.Util;
 import okhttp3.internal.http.RecordingProxySelector;
 import okhttp3.internal.io.InMemoryFileSystem;
+import mockwebserver3.Dispatcher;
+import mockwebserver3.MockResponse;
+import mockwebserver3.MockWebServer;
+import mockwebserver3.QueueDispatcher;
+import mockwebserver3.RecordedRequest;
+import mockwebserver3.SocketPolicy;
 import okhttp3.testing.Flaky;
 import okhttp3.testing.PlatformRule;
 import okhttp3.tls.HandshakeCertificates;
@@ -106,14 +105,12 @@ import static org.junit.Assume.assumeFalse;
 public final class CallTest {
   @Rule public final PlatformRule platform = new PlatformRule();
   @Rule public final TestRule timeout = new Timeout(30_000, TimeUnit.MILLISECONDS);
-  @Rule public final MockWebServerRule serverRule = new MockWebServerRule();
-  @Rule public final MockWebServerRule serverRule2 = new MockWebServerRule();
+  @Rule public final MockWebServer server = new MockWebServer();
+  @Rule public final MockWebServer server2 = new MockWebServer();
   @Rule public final InMemoryFileSystem fileSystem = new InMemoryFileSystem();
   @Rule public final OkHttpClientTestRule clientTestRule = new OkHttpClientTestRule();
   @Rule public final TestLogHandler testLogHandler = new TestLogHandler(OkHttpClient.class);
 
-  private MockWebServer server = serverRule.getServer();
-  private MockWebServer server2 = serverRule2.getServer();
   private RecordingEventListener listener = new RecordingEventListener();
   private HandshakeCertificates handshakeCertificates = localhost();
   private OkHttpClient client = clientTestRule.newClientBuilder()
diff --git a/okhttp/src/test/java/okhttp3/DuplexTest.java b/okhttp/src/test/java/okhttp3/DuplexTest.java
index 9be58537e..bbafe30af 100644
--- a/okhttp/src/test/java/okhttp3/DuplexTest.java
+++ b/okhttp/src/test/java/okhttp3/DuplexTest.java
@@ -22,15 +22,14 @@ import java.util.concurrent.BlockingQueue;
 import java.util.concurrent.CountDownLatch;
 import java.util.concurrent.LinkedBlockingQueue;
 import java.util.concurrent.TimeUnit;
-import mockwebserver3.MockResponse;
-import mockwebserver3.MockWebServer;
-import mockwebserver3.SocketPolicy;
-import mockwebserver3.internal.duplex.MockDuplexResponseBody;
-import mockwebserver3.junit4.MockWebServerRule;
 import okhttp3.internal.RecordingOkAuthenticator;
 import okhttp3.internal.duplex.AsyncRequestBody;
 import okhttp3.internal.duplex.MwsDuplexAccess;
 import okhttp3.internal.http2.ErrorCode;
+import mockwebserver3.MockResponse;
+import mockwebserver3.MockWebServer;
+import mockwebserver3.SocketPolicy;
+import mockwebserver3.internal.duplex.MockDuplexResponseBody;
 import okhttp3.testing.PlatformRule;
 import okhttp3.tls.HandshakeCertificates;
 import okio.BufferedSink;
@@ -52,10 +51,9 @@ import static org.junit.Assert.fail;
 public final class DuplexTest {
   @Rule public final PlatformRule platform = new PlatformRule();
   @Rule public final TestRule timeout = new Timeout(30_000, TimeUnit.MILLISECONDS);
-  @Rule public final MockWebServerRule serverRule = new MockWebServerRule();
+  @Rule public final MockWebServer server = new MockWebServer();
   @Rule public OkHttpClientTestRule clientTestRule = new OkHttpClientTestRule();
 
-  private MockWebServer server = serverRule.getServer();
   private RecordingEventListener listener = new RecordingEventListener();
   private HandshakeCertificates handshakeCertificates = localhost();
   private OkHttpClient client = clientTestRule.newClientBuilder()
diff --git a/okhttp/src/test/java/okhttp3/internal/http2/HttpOverHttp2Test.java b/okhttp/src/test/java/okhttp3/internal/http2/HttpOverHttp2Test.java
index 38ef4f488..2f8f8bea2 100644
--- a/okhttp/src/test/java/okhttp3/internal/http2/HttpOverHttp2Test.java
+++ b/okhttp/src/test/java/okhttp3/internal/http2/HttpOverHttp2Test.java
@@ -34,14 +34,6 @@ import java.util.concurrent.TimeUnit;
 import java.util.concurrent.atomic.AtomicReference;
 import javax.annotation.Nullable;
 import javax.net.ssl.SSLException;
-import mockwebserver3.Dispatcher;
-import mockwebserver3.MockResponse;
-import mockwebserver3.MockWebServer;
-import mockwebserver3.PushPromise;
-import mockwebserver3.QueueDispatcher;
-import mockwebserver3.RecordedRequest;
-import mockwebserver3.SocketPolicy;
-import mockwebserver3.junit4.MockWebServerRule;
 import okhttp3.Cache;
 import okhttp3.Call;
 import okhttp3.Callback;
@@ -66,6 +58,13 @@ import okhttp3.internal.DoubleInetAddressDns;
 import okhttp3.internal.RecordingOkAuthenticator;
 import okhttp3.internal.Util;
 import okhttp3.internal.connection.RealConnection;
+import mockwebserver3.Dispatcher;
+import mockwebserver3.MockResponse;
+import mockwebserver3.MockWebServer;
+import mockwebserver3.PushPromise;
+import mockwebserver3.QueueDispatcher;
+import mockwebserver3.RecordedRequest;
+import mockwebserver3.SocketPolicy;
 import okhttp3.testing.Flaky;
 import okhttp3.testing.PlatformRule;
 import okhttp3.tls.HandshakeCertificates;
@@ -119,10 +118,9 @@ public final class HttpOverHttp2Test {
       .around(new Timeout(60, SECONDS))
       .around(clientTestRule);
   @Rule public final TemporaryFolder tempDir = new TemporaryFolder();
-  @Rule public final MockWebServerRule serverRule = new MockWebServerRule();
+  @Rule public final MockWebServer server = new MockWebServer();
   @Rule public final TestLogHandler testLogHandler = new TestLogHandler(Http2.class);
 
-  private final MockWebServer server = serverRule.getServer();
   private OkHttpClient client;
   private Cache cache;
   private String scheme;
diff --git a/settings.gradle b/settings.gradle
index 4ed43155d..e226413a2 100644
--- a/settings.gradle
+++ b/settings.gradle
@@ -2,7 +2,6 @@ rootProject.name = 'okhttp-parent'
 
 include ':mockwebserver'
 include ':mockwebserver-deprecated'
-include ':mockwebserver-junit4'
 
 if (properties.containsKey('android.injected.invoked.from.ide') ||
         System.getenv('ANDROID_SDK_ROOT') != null) {
