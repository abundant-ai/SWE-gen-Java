diff --git a/mockwebserver-junit4/build.gradle b/mockwebserver-junit4/build.gradle
new file mode 100644
index 000000000..26baefa79
--- /dev/null
+++ b/mockwebserver-junit4/build.gradle
@@ -0,0 +1,19 @@
+jar {
+  manifest {
+    attributes('Automatic-Module-Name': 'mockwebserver3.junit4')
+  }
+}
+
+dependencies {
+  api project(':mockwebserver')
+  api deps.junit
+
+  testImplementation deps.assertj
+}
+
+afterEvaluate { project ->
+  project.tasks.dokka {
+    outputDirectory = "$rootDir/docs/4.x"
+    outputFormat = 'gfm'
+  }
+}
diff --git a/mockwebserver-junit4/src/main/kotlin/mockwebserver3/junit4/MockWebServerRule.kt b/mockwebserver-junit4/src/main/kotlin/mockwebserver3/junit4/MockWebServerRule.kt
new file mode 100644
index 000000000..f310ea3bd
--- /dev/null
+++ b/mockwebserver-junit4/src/main/kotlin/mockwebserver3/junit4/MockWebServerRule.kt
@@ -0,0 +1,62 @@
+/*
+ * Copyright (C) 2020 Square, Inc.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package mockwebserver3.junit4
+
+import mockwebserver3.MockWebServer
+import org.junit.rules.ExternalResource
+import java.io.IOException
+import java.util.logging.Level
+import java.util.logging.Logger
+
+/**
+ * Runs MockWebServer for the duration of a single test method.
+ *
+ * In Java JUnit 4 tests (ie. tests annotated `@org.junit.Test`), use this by defining a field with
+ * the `@Rule` annotation:
+ *
+ * ```
+ * @Rule public final MockWebServerRule serverRule = new MockWebServerRule();
+ * ```
+ *
+ * For Kotlin the `@JvmField` annotation is also necessary:
+ *
+ * ```
+ * @JvmField @Rule val serverRule = MockWebServerRule()
+ * ```
+ */
+class MockWebServerRule : ExternalResource() {
+  val server: MockWebServer = MockWebServer()
+
+  override fun before() {
+    try {
+      server.start()
+    } catch (e: IOException) {
+      throw RuntimeException(e)
+    }
+  }
+
+  override fun after() {
+    try {
+      server.shutdown()
+    } catch (e: IOException) {
+      logger.log(Level.WARNING, "MockWebServer shutdown failed", e)
+    }
+  }
+
+  companion object {
+    private val logger = Logger.getLogger(MockWebServerRule::class.java.name)
+  }
+}
diff --git a/mockwebserver/build.gradle b/mockwebserver/build.gradle
index 01bac5b3c..5f0b3f489 100644
--- a/mockwebserver/build.gradle
+++ b/mockwebserver/build.gradle
@@ -6,10 +6,11 @@ jar {
 
 dependencies {
   api project(':okhttp')
-  api deps.junit
 
   testImplementation project(':okhttp-testing-support')
   testImplementation project(':okhttp-tls')
+  testImplementation project(':mockwebserver-junit4')
+  testImplementation deps.junit
   testImplementation deps.assertj
 }
 
diff --git a/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt b/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt
index 24de62e34..8442cb149 100644
--- a/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt
+++ b/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt
@@ -44,6 +44,23 @@ import javax.net.ssl.SSLSocket
 import javax.net.ssl.SSLSocketFactory
 import javax.net.ssl.TrustManager
 import javax.net.ssl.X509TrustManager
+import mockwebserver3.SocketPolicy.CONTINUE_ALWAYS
+import mockwebserver3.SocketPolicy.DISCONNECT_AFTER_REQUEST
+import mockwebserver3.SocketPolicy.DISCONNECT_AT_END
+import mockwebserver3.SocketPolicy.DISCONNECT_AT_START
+import mockwebserver3.SocketPolicy.DISCONNECT_DURING_REQUEST_BODY
+import mockwebserver3.SocketPolicy.DISCONNECT_DURING_RESPONSE_BODY
+import mockwebserver3.SocketPolicy.DO_NOT_READ_REQUEST_BODY
+import mockwebserver3.SocketPolicy.EXPECT_CONTINUE
+import mockwebserver3.SocketPolicy.FAIL_HANDSHAKE
+import mockwebserver3.SocketPolicy.NO_RESPONSE
+import mockwebserver3.SocketPolicy.RESET_STREAM_AT_START
+import mockwebserver3.SocketPolicy.SHUTDOWN_INPUT_AT_END
+import mockwebserver3.SocketPolicy.SHUTDOWN_OUTPUT_AT_END
+import mockwebserver3.SocketPolicy.SHUTDOWN_SERVER_AFTER_RESPONSE
+import mockwebserver3.SocketPolicy.STALL_SOCKET_AT_START
+import mockwebserver3.SocketPolicy.UPGRADE_TO_SSL_AT_END
+import mockwebserver3.internal.duplex.DuplexResponseBody
 import okhttp3.Headers
 import okhttp3.Headers.Companion.headersOf
 import okhttp3.HttpUrl
@@ -66,23 +83,6 @@ import okhttp3.internal.toImmutableList
 import okhttp3.internal.ws.RealWebSocket
 import okhttp3.internal.ws.WebSocketExtensions
 import okhttp3.internal.ws.WebSocketProtocol
-import mockwebserver3.SocketPolicy.CONTINUE_ALWAYS
-import mockwebserver3.SocketPolicy.DISCONNECT_AFTER_REQUEST
-import mockwebserver3.SocketPolicy.DISCONNECT_AT_END
-import mockwebserver3.SocketPolicy.DISCONNECT_AT_START
-import mockwebserver3.SocketPolicy.DISCONNECT_DURING_REQUEST_BODY
-import mockwebserver3.SocketPolicy.DISCONNECT_DURING_RESPONSE_BODY
-import mockwebserver3.SocketPolicy.DO_NOT_READ_REQUEST_BODY
-import mockwebserver3.SocketPolicy.EXPECT_CONTINUE
-import mockwebserver3.SocketPolicy.FAIL_HANDSHAKE
-import mockwebserver3.SocketPolicy.NO_RESPONSE
-import mockwebserver3.SocketPolicy.RESET_STREAM_AT_START
-import mockwebserver3.SocketPolicy.SHUTDOWN_INPUT_AT_END
-import mockwebserver3.SocketPolicy.SHUTDOWN_OUTPUT_AT_END
-import mockwebserver3.SocketPolicy.SHUTDOWN_SERVER_AFTER_RESPONSE
-import mockwebserver3.SocketPolicy.STALL_SOCKET_AT_START
-import mockwebserver3.SocketPolicy.UPGRADE_TO_SSL_AT_END
-import mockwebserver3.internal.duplex.DuplexResponseBody
 import okio.Buffer
 import okio.BufferedSink
 import okio.BufferedSource
@@ -92,13 +92,12 @@ import okio.Timeout
 import okio.buffer
 import okio.sink
 import okio.source
-import org.junit.rules.ExternalResource
 
 /**
  * A scriptable web server. Callers supply canned responses and the server replays them upon request
  * in sequence.
  */
-class MockWebServer : ExternalResource(), Closeable {
+class MockWebServer : Closeable {
   private val taskRunnerBackend = TaskRunner.RealBackend(
       threadFactory("MockWebServer TaskRunner", daemon = false))
   private val taskRunner = TaskRunner(taskRunnerBackend)
@@ -121,13 +120,13 @@ class MockWebServer : ExternalResource(), Closeable {
   var bodyLimit = Long.MAX_VALUE
 
   var serverSocketFactory: ServerSocketFactory? = null
-    get() {
+    @Synchronized get() {
       if (field == null && started) {
         field = ServerSocketFactory.getDefault() // Build the default value lazily.
       }
       return field
     }
-    set(value) {
+    @Synchronized set(value) {
       check(!started) { "serverSocketFactory must not be set after start()" }
       field = value
     }
@@ -189,9 +188,10 @@ class MockWebServer : ExternalResource(), Closeable {
     }
 
   private var started: Boolean = false
+  private var shutdown: Boolean = false
 
-  @Synchronized override fun before() {
-    if (started) return
+  @Synchronized private fun before() {
+    if (started) return // Don't call start() in case we're already shut down.
     try {
       start()
     } catch (e: IOException) {
@@ -378,7 +378,8 @@ class MockWebServer : ExternalResource(), Closeable {
    */
   @Synchronized @Throws(IOException::class)
   private fun start(inetSocketAddress: InetSocketAddress) {
-    require(!started) { "start() already called" }
+    check(!shutdown) { "shutdown() already called" }
+    if (started) return
     started = true
 
     this.inetSocketAddress = inetSocketAddress
@@ -442,11 +443,14 @@ class MockWebServer : ExternalResource(), Closeable {
   @Synchronized
   @Throws(IOException::class)
   fun shutdown() {
-    if (!started) return
-    require(serverSocket != null) { "shutdown() before start()" }
+    if (shutdown) return
+    shutdown = true
+
+    if (!started) return // Nothing to shut down.
+    val serverSocket = this.serverSocket ?: return // If this is null, start() must have failed.
 
     // Cause acceptConnections() to break out.
-    serverSocket!!.close()
+    serverSocket.close()
 
     // Await shutdown.
     for (queue in taskRunner.activeQueues()) {
@@ -457,14 +461,6 @@ class MockWebServer : ExternalResource(), Closeable {
     taskRunnerBackend.shutdown()
   }
 
-  @Synchronized override fun after() {
-    try {
-      shutdown()
-    } catch (e: IOException) {
-      logger.log(Level.WARNING, "MockWebServer shutdown failed", e)
-    }
-  }
-
   private fun serveConnection(raw: Socket) {
     taskRunner.newQueue().execute("MockWebServer ${raw.remoteSocketAddress}", cancelable = false) {
       try {
diff --git a/mockwebserver/src/main/kotlin/mockwebserver3/internal/duplex/MockDuplexResponseBody.kt b/mockwebserver/src/main/kotlin/mockwebserver3/internal/duplex/MockDuplexResponseBody.kt
index babff7d58..8059e3b0a 100644
--- a/mockwebserver/src/main/kotlin/mockwebserver3/internal/duplex/MockDuplexResponseBody.kt
+++ b/mockwebserver/src/main/kotlin/mockwebserver3/internal/duplex/MockDuplexResponseBody.kt
@@ -20,16 +20,13 @@ import java.util.concurrent.CountDownLatch
 import java.util.concurrent.FutureTask
 import java.util.concurrent.LinkedBlockingQueue
 import java.util.concurrent.TimeUnit
+import mockwebserver3.RecordedRequest
 import okhttp3.internal.http2.ErrorCode
 import okhttp3.internal.http2.Http2Stream
-import mockwebserver3.RecordedRequest
 import okio.BufferedSink
 import okio.BufferedSource
 import okio.buffer
 import okio.utf8Size
-import org.junit.Assert.assertEquals
-import org.junit.Assert.assertTrue
-import org.junit.Assert.fail
 
 private typealias Action = (RecordedRequest, BufferedSource, BufferedSink, Http2Stream) -> Unit
 
@@ -43,12 +40,15 @@ class MockDuplexResponseBody : DuplexResponseBody {
 
   fun receiveRequest(expected: String) = apply {
     actions += { _, requestBody, _, _ ->
-      assertEquals(expected, requestBody.readUtf8(expected.utf8Size()))
+      val actual = requestBody.readUtf8(expected.utf8Size())
+      if (actual != expected) throw AssertionError("$actual != $expected")
     }
   }
 
   fun exhaustRequest() = apply {
-    actions += { _, requestBody, _, _ -> assertTrue(requestBody.exhausted()) }
+    actions += { _, requestBody, _, _ ->
+      if (!requestBody.exhausted()) throw AssertionError("expected exhausted")
+    }
   }
 
   fun cancelStream(errorCode: ErrorCode) = apply {
@@ -59,7 +59,7 @@ class MockDuplexResponseBody : DuplexResponseBody {
     actions += { _, requestBody, _, _ ->
       try {
         requestBody.exhausted()
-        fail()
+        throw AssertionError("expected IOException")
       } catch (expected: IOException) {
       }
     }
diff --git a/okhttp/build.gradle b/okhttp/build.gradle
index 4c74b523b..cb05ee070 100644
--- a/okhttp/build.gradle
+++ b/okhttp/build.gradle
@@ -74,6 +74,8 @@ dependencies {
   testImplementation project(':okhttp-testing-support')
   testImplementation project(':okhttp-tls')
   testImplementation project(':okhttp-urlconnection')
+  testImplementation project(':mockwebserver')
+  testImplementation project(':mockwebserver-junit4')
   testImplementation project(':mockwebserver-deprecated')
   testImplementation project(':okhttp-logging-interceptor')
   testImplementation project(':okhttp-brotli')
diff --git a/settings.gradle b/settings.gradle
index e226413a2..4ed43155d 100644
--- a/settings.gradle
+++ b/settings.gradle
@@ -2,6 +2,7 @@ rootProject.name = 'okhttp-parent'
 
 include ':mockwebserver'
 include ':mockwebserver-deprecated'
+include ':mockwebserver-junit4'
 
 if (properties.containsKey('android.injected.invoked.from.ide') ||
         System.getenv('ANDROID_SDK_ROOT') != null) {
