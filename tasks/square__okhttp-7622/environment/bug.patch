diff --git a/mockwebserver-deprecated/src/main/kotlin/okhttp3/mockwebserver/bridge.kt b/mockwebserver-deprecated/src/main/kotlin/okhttp3/mockwebserver/bridge.kt
index edc69af61..37aa8b71e 100644
--- a/mockwebserver-deprecated/src/main/kotlin/okhttp3/mockwebserver/bridge.kt
+++ b/mockwebserver-deprecated/src/main/kotlin/okhttp3/mockwebserver/bridge.kt
@@ -79,8 +79,9 @@ internal fun MockResponse.wrap(): mockwebserver3.MockResponse {
       result.inTunnel()
       KeepOpen
     }
-    else -> wrapSocketPolicy()
+    else -> socketPolicy.wrap()
   }
+  result.http2ErrorCode = http2ErrorCode
   result.throttleBody(throttleBytesPerPeriod, getThrottlePeriod(MILLISECONDS), MILLISECONDS)
   result.bodyDelay(getBodyDelay(MILLISECONDS), MILLISECONDS)
   result.headersDelay(getHeadersDelay(MILLISECONDS), MILLISECONDS)
@@ -112,8 +113,8 @@ internal fun mockwebserver3.RecordedRequest.unwrap(): RecordedRequest {
   )
 }
 
-private fun MockResponse.wrapSocketPolicy(): mockwebserver3.SocketPolicy {
-  return when (val socketPolicy = socketPolicy) {
+private fun SocketPolicy.wrap(): mockwebserver3.SocketPolicy {
+  return when (this) {
     SocketPolicy.SHUTDOWN_SERVER_AFTER_RESPONSE -> ShutdownServerAfterResponse
     SocketPolicy.KEEP_OPEN -> KeepOpen
     SocketPolicy.DISCONNECT_AT_END -> DisconnectAtEnd
@@ -121,13 +122,13 @@ private fun MockResponse.wrapSocketPolicy(): mockwebserver3.SocketPolicy {
     SocketPolicy.DISCONNECT_AFTER_REQUEST -> DisconnectAfterRequest
     SocketPolicy.DISCONNECT_DURING_REQUEST_BODY -> DisconnectDuringRequestBody
     SocketPolicy.DISCONNECT_DURING_RESPONSE_BODY -> DisconnectDuringResponseBody
-    SocketPolicy.DO_NOT_READ_REQUEST_BODY -> DoNotReadRequestBody(http2ErrorCode)
+    SocketPolicy.DO_NOT_READ_REQUEST_BODY -> DoNotReadRequestBody
     SocketPolicy.FAIL_HANDSHAKE -> FailHandshake
     SocketPolicy.SHUTDOWN_INPUT_AT_END -> ShutdownInputAtEnd
     SocketPolicy.SHUTDOWN_OUTPUT_AT_END -> ShutdownOutputAtEnd
     SocketPolicy.STALL_SOCKET_AT_START -> StallSocketAtStart
     SocketPolicy.NO_RESPONSE -> NoResponse
-    SocketPolicy.RESET_STREAM_AT_START -> ResetStreamAtStart(http2ErrorCode)
-    else -> error("Unexpected SocketPolicy: $socketPolicy")
+    SocketPolicy.RESET_STREAM_AT_START -> ResetStreamAtStart
+    else -> error("Unexpected SocketPolicy: $this")
   }
 }
diff --git a/mockwebserver/api/mockwebserver3.api b/mockwebserver/api/mockwebserver3.api
index 99a9f9659..ef2f07f75 100644
--- a/mockwebserver/api/mockwebserver3.api
+++ b/mockwebserver/api/mockwebserver3.api
@@ -13,13 +13,15 @@ public final class mockwebserver3/MockResponse {
 	public fun <init> (ILokhttp3/Headers;Ljava/lang/String;)V
 	public fun <init> (ILokhttp3/Headers;Ljava/lang/String;Z)V
 	public fun <init> (ILokhttp3/Headers;Ljava/lang/String;ZLmockwebserver3/SocketPolicy;)V
-	public synthetic fun <init> (ILokhttp3/Headers;Ljava/lang/String;ZLmockwebserver3/SocketPolicy;ILkotlin/jvm/internal/DefaultConstructorMarker;)V
+	public fun <init> (ILokhttp3/Headers;Ljava/lang/String;ZLmockwebserver3/SocketPolicy;I)V
+	public synthetic fun <init> (ILokhttp3/Headers;Ljava/lang/String;ZLmockwebserver3/SocketPolicy;IILkotlin/jvm/internal/DefaultConstructorMarker;)V
 	public synthetic fun <init> (Lmockwebserver3/MockResponse$Builder;Lkotlin/jvm/internal/DefaultConstructorMarker;)V
 	public final fun getBody ()Lmockwebserver3/MockResponseBody;
 	public final fun getBodyDelayNanos ()J
 	public final fun getCode ()I
 	public final fun getHeaders ()Lokhttp3/Headers;
 	public final fun getHeadersDelayNanos ()J
+	public final fun getHttp2ErrorCode ()I
 	public final fun getInTunnel ()Z
 	public final fun getInformationalResponses ()Ljava/util/List;
 	public final fun getMessage ()Ljava/lang/String;
@@ -57,6 +59,7 @@ public final class mockwebserver3/MockResponse$Builder : java/lang/Cloneable {
 	public final fun code (I)Lmockwebserver3/MockResponse$Builder;
 	public final fun getBody ()Lmockwebserver3/MockResponseBody;
 	public final fun getCode ()I
+	public final fun getHttp2ErrorCode ()I
 	public final fun getInTunnel ()Z
 	public final fun getInformationalResponses ()Ljava/util/List;
 	public final fun getPushPromises ()Ljava/util/List;
@@ -68,11 +71,13 @@ public final class mockwebserver3/MockResponse$Builder : java/lang/Cloneable {
 	public final fun getWebSocketListener ()Lokhttp3/WebSocketListener;
 	public final fun headers (Lokhttp3/Headers;)Lmockwebserver3/MockResponse$Builder;
 	public final fun headersDelay (JLjava/util/concurrent/TimeUnit;)Lmockwebserver3/MockResponse$Builder;
+	public final fun http2ErrorCode (I)Lmockwebserver3/MockResponse$Builder;
 	public final fun inTunnel ()Lmockwebserver3/MockResponse$Builder;
 	public final fun removeHeader (Ljava/lang/String;)Lmockwebserver3/MockResponse$Builder;
 	public final fun setBody (Lmockwebserver3/MockResponseBody;)V
 	public final fun setCode (I)V
 	public final fun setHeader (Ljava/lang/String;Ljava/lang/Object;)Lmockwebserver3/MockResponse$Builder;
+	public final fun setHttp2ErrorCode (I)V
 	public final fun setSocketPolicy (Lmockwebserver3/SocketPolicy;)V
 	public final fun setStatus (Ljava/lang/String;)V
 	public final fun setStreamHandler (Lmockwebserver3/StreamHandler;)V
@@ -199,10 +204,7 @@ public final class mockwebserver3/SocketPolicy$DisconnectDuringResponseBody : mo
 }
 
 public final class mockwebserver3/SocketPolicy$DoNotReadRequestBody : mockwebserver3/SocketPolicy {
-	public fun <init> ()V
-	public fun <init> (I)V
-	public synthetic fun <init> (IILkotlin/jvm/internal/DefaultConstructorMarker;)V
-	public final fun getHttp2ErrorCode ()I
+	public static final field INSTANCE Lmockwebserver3/SocketPolicy$DoNotReadRequestBody;
 }
 
 public final class mockwebserver3/SocketPolicy$FailHandshake : mockwebserver3/SocketPolicy {
@@ -222,10 +224,7 @@ public final class mockwebserver3/SocketPolicy$NoResponse : mockwebserver3/Socke
 }
 
 public final class mockwebserver3/SocketPolicy$ResetStreamAtStart : mockwebserver3/SocketPolicy {
-	public fun <init> ()V
-	public fun <init> (I)V
-	public synthetic fun <init> (IILkotlin/jvm/internal/DefaultConstructorMarker;)V
-	public final fun getHttp2ErrorCode ()I
+	public static final field INSTANCE Lmockwebserver3/SocketPolicy$ResetStreamAtStart;
 }
 
 public final class mockwebserver3/SocketPolicy$ShutdownInputAtEnd : mockwebserver3/SocketPolicy {
diff --git a/mockwebserver/src/main/kotlin/mockwebserver3/MockResponse.kt b/mockwebserver/src/main/kotlin/mockwebserver3/MockResponse.kt
index ad33db3c7..826912907 100644
--- a/mockwebserver/src/main/kotlin/mockwebserver3/MockResponse.kt
+++ b/mockwebserver/src/main/kotlin/mockwebserver3/MockResponse.kt
@@ -61,6 +61,13 @@ class MockResponse {
 
   val socketPolicy: SocketPolicy
 
+  /**
+   * Sets the [HTTP/2 error code](https://tools.ietf.org/html/rfc7540#section-7) to be
+   * returned when resetting the stream. This is only valid with
+   * [SocketPolicy.ResetStreamAtStart] and [SocketPolicy.DoNotReadRequestBody].
+   */
+  val http2ErrorCode: Int
+
   val bodyDelayNanos: Long
   val headersDelayNanos: Long
 
@@ -75,6 +82,7 @@ class MockResponse {
     body: String = "",
     inTunnel: Boolean = false,
     socketPolicy: SocketPolicy = KeepOpen,
+    http2ErrorCode: Int = -1,
   ) : this(Builder()
     .apply {
       this.code = code
@@ -82,6 +90,7 @@ class MockResponse {
       if (inTunnel) inTunnel()
       this.body(body)
       this.socketPolicy = socketPolicy
+      this.http2ErrorCode = http2ErrorCode
     }
   )
 
@@ -97,6 +106,7 @@ class MockResponse {
     this.throttleBytesPerPeriod = builder.throttleBytesPerPeriod
     this.throttlePeriodNanos = builder.throttlePeriodNanos
     this.socketPolicy = builder.socketPolicy
+    this.http2ErrorCode = builder.http2ErrorCode
     this.bodyDelayNanos = builder.bodyDelayNanos
     this.headersDelayNanos = builder.headersDelayNanos
     this.pushPromises = builder.pushPromises.toList()
@@ -171,6 +181,8 @@ class MockResponse {
 
     var socketPolicy: SocketPolicy
 
+    var http2ErrorCode: Int
+
     internal var bodyDelayNanos: Long
 
     internal var headersDelayNanos: Long
@@ -193,6 +205,7 @@ class MockResponse {
       this.throttleBytesPerPeriod = Long.MAX_VALUE
       this.throttlePeriodNanos = 0L
       this.socketPolicy = KeepOpen
+      this.http2ErrorCode = -1
       this.bodyDelayNanos = 0L
       this.headersDelayNanos = 0L
       this.pushPromises = mutableListOf()
@@ -211,6 +224,7 @@ class MockResponse {
       this.throttleBytesPerPeriod = mockResponse.throttleBytesPerPeriod
       this.throttlePeriodNanos = mockResponse.throttlePeriodNanos
       this.socketPolicy = mockResponse.socketPolicy
+      this.http2ErrorCode = mockResponse.http2ErrorCode
       this.bodyDelayNanos = mockResponse.bodyDelayNanos
       this.headersDelayNanos = mockResponse.headersDelayNanos
       this.pushPromises = mockResponse.pushPromises.toMutableList()
@@ -327,6 +341,11 @@ class MockResponse {
       this.socketPolicy = socketPolicy
     }
 
+    /** Sets the HTTP/2 error code and returns this. */
+    fun http2ErrorCode(http2ErrorCode: Int) = apply {
+      this.http2ErrorCode = http2ErrorCode
+    }
+
     /**
      * Throttles the request reader and response writer to sleep for the given period after each
      * series of [bytesPerPeriod] bytes are transferred. Use this to simulate network behavior.
diff --git a/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt b/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt
index 331e845fb..a3783e9ef 100644
--- a/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt
+++ b/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt
@@ -587,7 +587,7 @@ class MockWebServer : Closeable {
 
       // See warnings associated with these socket policies in SocketPolicy.
       when (response.socketPolicy) {
-        DisconnectAtEnd, is DoNotReadRequestBody -> {
+        DisconnectAtEnd, DoNotReadRequestBody -> {
           socket.close()
           return false
         }
@@ -682,7 +682,7 @@ class MockWebServer : Closeable {
       ).buffer()
       requestBodySink.use {
         when {
-          policy.socketPolicy is DoNotReadRequestBody -> {
+          policy.socketPolicy == DoNotReadRequestBody -> {
             // Ignore the body completely.
           }
 
@@ -771,7 +771,7 @@ class MockWebServer : Closeable {
       extensions = WebSocketExtensions.parse(webSocketResponse.headers),
       minimumDeflateSize = 0L // Compress all messages if compression is enabled.
     )
-    webSocketResponse.webSocketListener.onOpen(webSocket, fancyResponse)
+    webSocketResponse.webSocketListener!!.onOpen(webSocket, fancyResponse)
     val name = "MockWebServer WebSocket ${request.path!!}"
     webSocket.initReaderAndWriter(name, streams)
     try {
@@ -909,9 +909,9 @@ class MockWebServer : Closeable {
     @Throws(IOException::class)
     override fun onStream(stream: Http2Stream) {
       val peekedResponse = dispatcher.peek()
-      if (peekedResponse.socketPolicy is ResetStreamAtStart) {
+      if (peekedResponse.socketPolicy === ResetStreamAtStart) {
         dispatchBookkeepingRequest(sequenceNumber.getAndIncrement(), socket)
-        stream.close(ErrorCode.fromHttp2(peekedResponse.socketPolicy.http2ErrorCode)!!, null)
+        stream.close(ErrorCode.fromHttp2(peekedResponse.http2ErrorCode)!!, null)
         return
       }
 
@@ -941,8 +941,8 @@ class MockWebServer : Closeable {
         DisconnectAtEnd -> {
           stream.connection.shutdown(ErrorCode.NO_ERROR)
         }
-        is DoNotReadRequestBody -> {
-          stream.close(ErrorCode.fromHttp2(socketPolicy.http2ErrorCode)!!, null)
+        DoNotReadRequestBody -> {
+          stream.close(ErrorCode.fromHttp2(response.http2ErrorCode)!!, null)
         }
         else -> {
         }
@@ -985,7 +985,7 @@ class MockWebServer : Closeable {
       val body = Buffer()
       val requestLine = "$method $path HTTP/1.1"
       var exception: IOException? = null
-      if (readBody && peek.streamHandler == null && peek.socketPolicy !is DoNotReadRequestBody) {
+      if (readBody && peek.streamHandler == null && peek.socketPolicy != DoNotReadRequestBody) {
         try {
           val contentLengthString = headers["content-length"]
           val requestBodySink = body.withThrottlingAndSocketPolicy(
diff --git a/mockwebserver/src/main/kotlin/mockwebserver3/SocketPolicy.kt b/mockwebserver/src/main/kotlin/mockwebserver3/SocketPolicy.kt
index 408be99a2..288dc5927 100644
--- a/mockwebserver/src/main/kotlin/mockwebserver3/SocketPolicy.kt
+++ b/mockwebserver/src/main/kotlin/mockwebserver3/SocketPolicy.kt
@@ -77,12 +77,10 @@ sealed interface SocketPolicy {
 
   /**
    * Process the response without even attempting to reading the request body. For HTTP/2 this will
-   * send [http2ErrorCode] after the response body or trailers. For HTTP/1 this will close the
-   * socket after the response body or trailers.
+   * send [MockResponse.getHttp2ErrorCode] after the response body or trailers. For HTTP/1 this will
+   * close the socket after the response body or trailers.
    */
-  class DoNotReadRequestBody(
-    val http2ErrorCode: Int = 0,
-  ) : SocketPolicy
+  object DoNotReadRequestBody : SocketPolicy
 
   /** Don't trust the client during the SSL handshake. */
   object FailHandshake : SocketPolicy
@@ -114,9 +112,7 @@ sealed interface SocketPolicy {
   object NoResponse : SocketPolicy
 
   /**
-   * Fail HTTP/2 requests without processing them by sending [http2ErrorCode].
+   * Fail HTTP/2 requests without processing them by sending an [MockResponse.http2ErrorCode].
    */
-  class ResetStreamAtStart(
-    val http2ErrorCode: Int = 0,
-  ) : SocketPolicy
+  object ResetStreamAtStart : SocketPolicy
 }
diff --git a/okhttp/src/jvmTest/java/okhttp3/FastFallbackTest.kt b/okhttp/src/jvmTest/java/okhttp3/FastFallbackTest.kt
index a8b5f0f9c..0041d05c1 100644
--- a/okhttp/src/jvmTest/java/okhttp3/FastFallbackTest.kt
+++ b/okhttp/src/jvmTest/java/okhttp3/FastFallbackTest.kt
@@ -27,6 +27,7 @@ import kotlin.test.assertFailsWith
 import kotlin.test.fail
 import mockwebserver3.MockResponse
 import mockwebserver3.MockWebServer
+import mockwebserver3.SocketPolicy
 import mockwebserver3.SocketPolicy.ResetStreamAtStart
 import okhttp3.internal.http2.ErrorCode
 import okhttp3.testing.Flaky
@@ -292,7 +293,10 @@ class FastFallbackTest {
 
     // Set up a same-connection retry.
     serverIpv4.enqueue(
-      MockResponse(socketPolicy = ResetStreamAtStart(ErrorCode.REFUSED_STREAM.httpCode))
+      MockResponse(
+        socketPolicy = ResetStreamAtStart,
+        http2ErrorCode = ErrorCode.REFUSED_STREAM.httpCode,
+      )
     )
     serverIpv4.enqueue(
       MockResponse(body = "this was the 2nd request on IPv4")
diff --git a/okhttp/src/jvmTest/java/okhttp3/RouteFailureTest.kt b/okhttp/src/jvmTest/java/okhttp3/RouteFailureTest.kt
index 07562ae86..e11343196 100644
--- a/okhttp/src/jvmTest/java/okhttp3/RouteFailureTest.kt
+++ b/okhttp/src/jvmTest/java/okhttp3/RouteFailureTest.kt
@@ -20,6 +20,7 @@ import java.net.InetAddress
 import java.net.InetSocketAddress
 import mockwebserver3.MockResponse
 import mockwebserver3.MockWebServer
+import mockwebserver3.SocketPolicy
 import mockwebserver3.SocketPolicy.ResetStreamAtStart
 import mockwebserver3.junit5.internal.MockWebServerInstance
 import okhttp3.internal.http2.ErrorCode
@@ -52,7 +53,8 @@ class RouteFailureTest {
   val ipv6 = InetAddress.getByName("2001:db8:ffff:ffff:ffff:ffff:ffff:1")
 
   val refusedStream = MockResponse(
-    socketPolicy = ResetStreamAtStart(ErrorCode.REFUSED_STREAM.httpCode),
+    socketPolicy = ResetStreamAtStart,
+    http2ErrorCode = ErrorCode.REFUSED_STREAM.httpCode,
   )
   val bodyResponse = MockResponse(body = "body")
 
diff --git a/okhttp/src/jvmTest/java/okhttp3/ServerTruncatesRequestTest.kt b/okhttp/src/jvmTest/java/okhttp3/ServerTruncatesRequestTest.kt
index 63665c0d2..f7066971a 100644
--- a/okhttp/src/jvmTest/java/okhttp3/ServerTruncatesRequestTest.kt
+++ b/okhttp/src/jvmTest/java/okhttp3/ServerTruncatesRequestTest.kt
@@ -18,6 +18,7 @@ package okhttp3
 import javax.net.ssl.SSLSocket
 import mockwebserver3.MockResponse
 import mockwebserver3.MockWebServer
+import mockwebserver3.SocketPolicy
 import mockwebserver3.SocketPolicy.DoNotReadRequestBody
 import okhttp3.Headers.Companion.headersOf
 import okhttp3.internal.duplex.AsyncRequestBody
@@ -76,7 +77,8 @@ class ServerTruncatesRequestTest {
     server.enqueue(
       MockResponse(
         body = "abc",
-        socketPolicy = DoNotReadRequestBody(ErrorCode.NO_ERROR.httpCode),
+        socketPolicy = DoNotReadRequestBody,
+        http2ErrorCode = ErrorCode.NO_ERROR.httpCode,
       )
     )
 
@@ -133,7 +135,8 @@ class ServerTruncatesRequestTest {
     server.enqueue(
       MockResponse(
         body = "abc",
-        socketPolicy = DoNotReadRequestBody(ErrorCode.NO_ERROR.httpCode),
+        socketPolicy = DoNotReadRequestBody,
+        http2ErrorCode = ErrorCode.NO_ERROR.httpCode,
       )
     )
 
@@ -178,8 +181,9 @@ class ServerTruncatesRequestTest {
 
   private fun serverTruncatesRequestButTrailersCanStillBeRead(http2: Boolean) {
     val mockResponse = MockResponse.Builder()
-      .socketPolicy(DoNotReadRequestBody(ErrorCode.NO_ERROR.httpCode))
+      .socketPolicy(DoNotReadRequestBody)
       .trailers(headersOf("caboose", "xyz"))
+      .http2ErrorCode(ErrorCode.NO_ERROR.httpCode)
 
     // Trailers always work for HTTP/2, but only for chunked bodies in HTTP/1.
     if (http2) {
diff --git a/okhttp/src/jvmTest/java/okhttp3/internal/http2/HttpOverHttp2Test.kt b/okhttp/src/jvmTest/java/okhttp3/internal/http2/HttpOverHttp2Test.kt
index 1a2c145c4..1c9735d76 100644
--- a/okhttp/src/jvmTest/java/okhttp3/internal/http2/HttpOverHttp2Test.kt
+++ b/okhttp/src/jvmTest/java/okhttp3/internal/http2/HttpOverHttp2Test.kt
@@ -36,6 +36,7 @@ import mockwebserver3.MockWebServer
 import mockwebserver3.PushPromise
 import mockwebserver3.QueueDispatcher
 import mockwebserver3.RecordedRequest
+import mockwebserver3.SocketPolicy
 import mockwebserver3.SocketPolicy.DisconnectAtEnd
 import mockwebserver3.SocketPolicy.NoResponse
 import mockwebserver3.SocketPolicy.ResetStreamAtStart
@@ -816,7 +817,10 @@ class HttpOverHttp2Test {
   ) {
     setUp(protocol, mockWebServer)
     server.enqueue(
-      MockResponse(socketPolicy = ResetStreamAtStart(ErrorCode.REFUSED_STREAM.httpCode))
+      MockResponse(
+        socketPolicy = ResetStreamAtStart,
+        http2ErrorCode = ErrorCode.REFUSED_STREAM.httpCode,
+      )
     )
     server.enqueue(MockResponse(body = "abc"))
     val call = client.newCall(Request(server.url("/")))
@@ -837,7 +841,10 @@ class HttpOverHttp2Test {
       .dns(DoubleInetAddressDns()) // Two routes!
       .build()
     server.enqueue(
-      MockResponse(socketPolicy = ResetStreamAtStart(ErrorCode.REFUSED_STREAM.httpCode))
+      MockResponse(
+        socketPolicy = ResetStreamAtStart,
+        http2ErrorCode = ErrorCode.REFUSED_STREAM.httpCode,
+      )
     )
     server.enqueue(MockResponse(body = "abc"))
 
@@ -861,13 +868,22 @@ class HttpOverHttp2Test {
       .dns(DoubleInetAddressDns()) // Two routes!
       .build()
     server.enqueue(
-      MockResponse(socketPolicy = ResetStreamAtStart(ErrorCode.REFUSED_STREAM.httpCode))
+      MockResponse(
+        socketPolicy = ResetStreamAtStart,
+        http2ErrorCode = ErrorCode.REFUSED_STREAM.httpCode,
+      )
     )
     server.enqueue(
-      MockResponse(socketPolicy = ResetStreamAtStart(ErrorCode.REFUSED_STREAM.httpCode))
+      MockResponse(
+        socketPolicy = ResetStreamAtStart,
+        http2ErrorCode = ErrorCode.REFUSED_STREAM.httpCode,
+      )
     )
     server.enqueue(
-      MockResponse(socketPolicy = ResetStreamAtStart(ErrorCode.REFUSED_STREAM.httpCode))
+      MockResponse(
+        socketPolicy = ResetStreamAtStart,
+        http2ErrorCode = ErrorCode.REFUSED_STREAM.httpCode,
+      )
     )
 
     val request = Request(server.url("/"))
@@ -888,7 +904,10 @@ class HttpOverHttp2Test {
   ) {
     setUp(protocol, mockWebServer)
     server.enqueue(
-      MockResponse(socketPolicy = ResetStreamAtStart(ErrorCode.REFUSED_STREAM.httpCode))
+      MockResponse(
+        socketPolicy = ResetStreamAtStart,
+        http2ErrorCode = ErrorCode.REFUSED_STREAM.httpCode,
+      )
     )
     server.enqueue(MockResponse(body = "abc"))
     val request = Request(server.url("/"))
@@ -914,10 +933,16 @@ class HttpOverHttp2Test {
   ) {
     setUp(protocol, mockWebServer)
     server.enqueue(
-      MockResponse(socketPolicy = ResetStreamAtStart(ErrorCode.REFUSED_STREAM.httpCode))
+      MockResponse(
+        socketPolicy = ResetStreamAtStart,
+        http2ErrorCode = ErrorCode.REFUSED_STREAM.httpCode,
+      )
     )
     server.enqueue(
-      MockResponse(socketPolicy = ResetStreamAtStart(ErrorCode.REFUSED_STREAM.httpCode))
+      MockResponse(
+        socketPolicy = ResetStreamAtStart,
+        http2ErrorCode = ErrorCode.REFUSED_STREAM.httpCode,
+      )
     )
     server.enqueue(MockResponse(body = "abc"))
     server.enqueue(MockResponse(body = "def"))
@@ -954,10 +979,16 @@ class HttpOverHttp2Test {
   fun noRecoveryFromTwoRefusedStreams(protocol: Protocol, mockWebServer: MockWebServer) {
     setUp(protocol, mockWebServer)
     server.enqueue(
-      MockResponse(socketPolicy = ResetStreamAtStart(ErrorCode.REFUSED_STREAM.httpCode))
+      MockResponse(
+        socketPolicy = ResetStreamAtStart,
+        http2ErrorCode = ErrorCode.REFUSED_STREAM.httpCode,
+      )
     )
     server.enqueue(
-      MockResponse(socketPolicy = ResetStreamAtStart(ErrorCode.REFUSED_STREAM.httpCode))
+      MockResponse(
+        socketPolicy = ResetStreamAtStart,
+        http2ErrorCode = ErrorCode.REFUSED_STREAM.httpCode,
+      )
     )
     server.enqueue(
       MockResponse(body = "abc")
@@ -989,7 +1020,10 @@ class HttpOverHttp2Test {
 
   private fun recoverFromOneHttp2ErrorRequiresNewConnection(errorCode: ErrorCode?) {
     server.enqueue(
-      MockResponse(socketPolicy = ResetStreamAtStart(errorCode!!.httpCode))
+      MockResponse(
+        socketPolicy = ResetStreamAtStart,
+        http2ErrorCode = errorCode!!.httpCode,
+      )
     )
     server.enqueue(MockResponse(body = "abc"))
     client = client.newBuilder()
@@ -1011,10 +1045,16 @@ class HttpOverHttp2Test {
   ) {
     setUp(protocol, mockWebServer)
     server.enqueue(
-      MockResponse(socketPolicy = ResetStreamAtStart(ErrorCode.REFUSED_STREAM.httpCode))
+      MockResponse(
+        socketPolicy = ResetStreamAtStart,
+        http2ErrorCode = ErrorCode.REFUSED_STREAM.httpCode,
+      )
     )
     server.enqueue(
-      MockResponse(socketPolicy = ResetStreamAtStart(ErrorCode.REFUSED_STREAM.httpCode))
+      MockResponse(
+        socketPolicy = ResetStreamAtStart,
+        http2ErrorCode = ErrorCode.REFUSED_STREAM.httpCode,
+      )
     )
     server.enqueue(MockResponse(body = "abc"))
     client = client.newBuilder()
@@ -1181,7 +1221,10 @@ class HttpOverHttp2Test {
 
   private fun noRecoveryFromErrorWithRetryDisabled(errorCode: ErrorCode?) {
     server.enqueue(
-      MockResponse(socketPolicy = ResetStreamAtStart(errorCode!!.httpCode))
+      MockResponse(
+        socketPolicy = ResetStreamAtStart,
+        http2ErrorCode = errorCode!!.httpCode,
+      )
     )
     server.enqueue(MockResponse(body = "abc"))
     client = client.newBuilder()
@@ -1203,7 +1246,10 @@ class HttpOverHttp2Test {
     setUp(protocol, mockWebServer)
     server.enqueue(MockResponse(code = 401))
     server.enqueue(
-      MockResponse(socketPolicy = ResetStreamAtStart(ErrorCode.INTERNAL_ERROR.httpCode))
+      MockResponse(
+        socketPolicy = ResetStreamAtStart,
+        http2ErrorCode = ErrorCode.INTERNAL_ERROR.httpCode,
+      )
     )
     server.enqueue(MockResponse(body = "DEF"))
     server.enqueue(
