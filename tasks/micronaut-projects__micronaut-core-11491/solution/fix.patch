diff --git a/gradle.properties b/gradle.properties
index b8e77cfeaf..a071628fdd 100644
--- a/gradle.properties
+++ b/gradle.properties
@@ -3,7 +3,7 @@ projectGroupId=io.micronaut
 projectDesc=Core components supporting the Micronaut Framework
 title=Micronaut Core
 githubSlug=micronaut-projects/micronaut-core
-docsRepository=micronaut-projects/micronaut-docs 
+docsRepository=micronaut-projects/micronaut-docs
 testsdir=inject-groovy/src/test/groovy/io/micronaut/docs
 testssession=session/src/test/groovy/io/micronaut/session/docs
 testskafka=configurations/kafka/src/test/groovy/io/micronaut/configuration/kafka/docs
diff --git a/inject-kotlin/src/main/kotlin/io/micronaut/kotlin/processing/visitor/AbstractKotlinElement.kt b/inject-kotlin/src/main/kotlin/io/micronaut/kotlin/processing/visitor/AbstractKotlinElement.kt
index 60f28b18df..e31f047522 100644
--- a/inject-kotlin/src/main/kotlin/io/micronaut/kotlin/processing/visitor/AbstractKotlinElement.kt
+++ b/inject-kotlin/src/main/kotlin/io/micronaut/kotlin/processing/visitor/AbstractKotlinElement.kt
@@ -48,7 +48,8 @@ import io.micronaut.inject.ast.annotation.AbstractAnnotationElement
 import io.micronaut.inject.ast.annotation.ElementAnnotationMetadataFactory
 import io.micronaut.kotlin.processing.getBinaryName
 import io.micronaut.kotlin.processing.getClassDeclaration
-import java.util.Optional
+import java.util.*
+import kotlin.collections.HashSet
 
 internal abstract class AbstractKotlinElement<T : KotlinNativeElement>(
     private val nativeType: T,
@@ -134,7 +135,8 @@ internal abstract class AbstractKotlinElement<T : KotlinNativeElement>(
     }
 
     private fun shouldBeOpen(annotationMetadata: AnnotationMetadata): Boolean {
-        if (extraOpenAnnotations != null && annotationMetadata.declaredMetadata.hasDeclaredStereotype(*extraOpenAnnotations)) {
+        val extraOpenAnnotations = visitorContext.extraOpenAnnotations
+        if (extraOpenAnnotations.isNotEmpty() && annotationMetadata.declaredMetadata.hasDeclaredStereotype(*extraOpenAnnotations)) {
             return true
         }
         return annotationMetadata.declaredMetadata.hasDeclaredStereotype(
@@ -611,7 +613,6 @@ internal abstract class AbstractKotlinElement<T : KotlinNativeElement>(
     }
 
     companion object {
-        val extraOpenAnnotations = System.getProperty("kotlin.allopen.annotations")?.split(",")?.toTypedArray()
 
         val primitives = mapOf(
             "kotlin.Boolean" to PrimitiveElement.BOOLEAN,
diff --git a/inject-kotlin/src/main/kotlin/io/micronaut/kotlin/processing/visitor/KotlinVisitorContext.kt b/inject-kotlin/src/main/kotlin/io/micronaut/kotlin/processing/visitor/KotlinVisitorContext.kt
index 29d3d7b7c0..def4b4a241 100644
--- a/inject-kotlin/src/main/kotlin/io/micronaut/kotlin/processing/visitor/KotlinVisitorContext.kt
+++ b/inject-kotlin/src/main/kotlin/io/micronaut/kotlin/processing/visitor/KotlinVisitorContext.kt
@@ -61,6 +61,18 @@ internal class KotlinVisitorContext(
     private val expressionCompilationContextFactory = DefaultExpressionCompilationContextFactory(this)
     val nativeElementsHelper = KotlinNativeElementsHelper(resolver)
     var aggregating: Boolean = false
+
+    val extraOpenAnnotations: Array<String> by lazy {
+        var allOpenAnnotations = environment.options["kotlin.allopen.annotations"]
+        if (allOpenAnnotations.isNullOrEmpty()) {
+            allOpenAnnotations = System.getProperty("kotlin.allopen.annotations")
+        }
+        if (allOpenAnnotations == null) {
+            allOpenAnnotations = ""
+        }
+        allOpenAnnotations.split(",", "|").toTypedArray()
+    }
+
     init {
         try {
             // Workaround for bug in KSP https://github.com/google/ksp/issues/1493
@@ -71,6 +83,7 @@ internal class KotlinVisitorContext(
         } catch (e: Exception) {
             // Ignore
         }
+
     }
 
     fun updateResolver(resolver: Resolver) {
diff --git a/settings.gradle b/settings.gradle
index f3acdf625a..66ea1683a1 100644
--- a/settings.gradle
+++ b/settings.gradle
@@ -76,6 +76,7 @@ include "test-suite-http-server-tck-netty"
 include "test-suite-http2-server-tck-netty"
 include "test-suite-kotlin"
 include "test-suite-kotlin-ksp"
+include "test-suite-kotlin-ksp-all-open"
 include "test-suite-groovy"
 include "test-suite-groovy"
 include "test-suite-logback"
diff --git a/src/main/docs/guide/languageSupport/kotlin/ksp.adoc b/src/main/docs/guide/languageSupport/kotlin/ksp.adoc
index 2a5161f573..cbf51d782d 100644
--- a/src/main/docs/guide/languageSupport/kotlin/ksp.adoc
+++ b/src/main/docs/guide/languageSupport/kotlin/ksp.adoc
@@ -44,52 +44,25 @@ If you don't use the https://micronaut-projects.github.io/micronaut-gradle-plugi
 
 [source, kotlin]
 ----
-plugins {
-    id("org.jetbrains.kotlin.jvm") version "1.9.20"
-    id("com.google.devtools.ksp") version "1.9.20-1.0.13"
-    id("org.jetbrains.kotlin.plugin.allopen") version "1.9.20"
-    application
-}
-version = "0.1"
-group = "dockerisms"
-repositories {
-    mavenCentral()
-
-    maven {
-        url = uri("https://s01.oss.sonatype.org/content/repositories/snapshots/")
-    }
-}
-val micronautVersion by properties
-dependencies {
-    runtimeOnly("ch.qos.logback:logback-classic")
-    runtimeOnly("org.yaml:snakeyaml")
-    implementation("io.micronaut:micronaut-jackson-databind")
-
-
-    implementation(platform("io.micronaut.platform:micronaut-platform:$micronautVersion"))
-    implementation("io.micronaut:micronaut-http-server-netty")
-
-    ksp(platform("io.micronaut.platform:micronaut-platform:$micronautVersion"))
-    ksp("io.micronaut:micronaut-inject-kotlin")
-    kspTest(platform("io.micronaut.platform:micronaut-platform:$micronautVersion"))
-    kspTest("io.micronaut:micronaut-inject-kotlin")
+ksp(platform("io.micronaut.platform:micronaut-platform:$micronautVersion"))
+ksp("io.micronaut:micronaut-inject-kotlin")
+kspTest(platform("io.micronaut.platform:micronaut-platform:$micronautVersion"))
+kspTest("io.micronaut:micronaut-inject-kotlin")
+----
 
-    testImplementation(platform("io.micronaut.platform:micronaut-platform:$micronautVersion"))
-    testImplementation("io.micronaut:micronaut-http-client")
-    testImplementation("io.micronaut.test:micronaut-test-junit5")
-    testRuntimeOnly("org.junit.jupiter:junit-jupiter-engine")
-}
+Unfortunately, KSP doesn't see the changes in the classes made by other compiler plugins, which breaks integration with the `allopen` plugin.
+To make the integration work, we have introduced an experimental KSP property `kotlin.allopen.annotations` for the annotation processor. The property expects a list of annotations that are open, separated by `|`. It's also supported to use the system property of the same name, but that might be unreliable considering build daemons can be cached.
 
-application {
-    mainClass.set("dockerisms.Application")
-}
+.Kotlin All-Open plugin configuration
+[source, groovy]
+----
+include::test-suite-kotlin-ksp-all-open/build.gradle[tags="allopen", indent=0]
+----
 
-tasks {
-    withType<Test> {
-        useJUnitPlatform()
-    }
-}
+.KSP configuration - repeat all the annotations that are included in Kotlin All-Open configuration
+[source, groovy]
+----
+include::test-suite-kotlin-ksp-all-open/build.gradle[tags="ksp", indent=0]
 ----
 
-Unfortunately, KSP doesn't see the changes in the classes made by other compiler plugins, which breaks integration with the `allopen` plugin.
-To make the integration work, we have introduced an experimental system property `kotlin.allopen.annotations` for the annotation processor. The property expects a list of annotations that are open, separated by `,`.
+NOTE: Kotlin All-Open plugin supports only class level annotations - it's not possible to open a class just by a method annotation
diff --git a/test-suite-kotlin-ksp-all-open/build.gradle b/test-suite-kotlin-ksp-all-open/build.gradle
new file mode 100644
index 0000000000..ed3f7166a1
--- /dev/null
+++ b/test-suite-kotlin-ksp-all-open/build.gradle
@@ -0,0 +1,61 @@
+plugins {
+    id "io.micronaut.build.internal.convention-test-library"
+    alias libs.plugins.managed.kotlin.jvm
+    alias libs.plugins.managed.ksp
+    alias libs.plugins.managed.kotlin.allopen
+}
+
+// tag::allopen[]
+allOpen {
+    annotations("io.micronaut.docs.aop.around.OpenSingleton", "io.micronaut.docs.aop.around.AnotherOpenSingleton")
+}
+// end::allopen[]
+
+micronautBuild {
+    core {
+        usesMicronautTestJunit()
+        usesMicronautTestSpock()
+        usesMicronautTestKotest()
+    }
+}
+
+dependencies {
+    api libs.managed.kotlin.stdlib
+    api libs.managed.kotlin.reflect
+    api libs.managed.kotlinx.coroutines.core
+    api libs.managed.kotlinx.coroutines.jdk8
+    api libs.managed.kotlinx.coroutines.rx2
+    api project(':http-server-netty')
+    api project(':http-client')
+    api project(':runtime')
+
+    testImplementation project(":context")
+    testImplementation libs.managed.kotlin.test
+    testImplementation libs.managed.kotlinx.coroutines.core
+    testImplementation libs.managed.kotlinx.coroutines.rx2
+    testImplementation libs.managed.kotlinx.coroutines.slf4j
+    testImplementation libs.managed.kotlinx.coroutines.reactor
+
+    // Adding these for now since micronaut-test isnt resolving correctly ... probably need to upgrade gradle there too
+    testImplementation libs.junit.jupiter.api
+
+    kspTest project(':inject-kotlin')
+}
+
+configurations.testRuntimeClasspath {
+    resolutionStrategy.eachDependency {
+        if (it.requested.group == 'org.jetbrains.kotlin') {
+            it.useVersion(libs.versions.managed.kotlin.asProvider().get())
+        }
+    }
+}
+
+tasks.named("test") {
+    useJUnitPlatform()
+}
+
+// tag::ksp[]
+ksp {
+    arg("kotlin.allopen.annotations", "io.micronaut.docs.aop.around.OpenSingleton|io.micronaut.docs.aop.around.AnotherOpenSingleton")
+}
+// end::ksp[]
diff --git a/test-suite-kotlin-ksp-all-open/gradle.properties b/test-suite-kotlin-ksp-all-open/gradle.properties
new file mode 100644
index 0000000000..1d70cd4a96
--- /dev/null
+++ b/test-suite-kotlin-ksp-all-open/gradle.properties
@@ -0,0 +1,2 @@
+skipDocumentation=true
+ksp.incremental = false
