diff --git a/kotlin/codegen/pom.xml b/kotlin/codegen/pom.xml
index 21da5a3a..736f8ce8 100644
--- a/kotlin/codegen/pom.xml
+++ b/kotlin/codegen/pom.xml
@@ -25,14 +25,7 @@
     <dependency>
       <groupId>com.squareup</groupId>
       <artifactId>kotlinpoet</artifactId>
-      <version>1.2.0</version>
-    </dependency>
-    <dependency>
-      <groupId>net.ltgt.gradle.incap</groupId>
-      <artifactId>incap</artifactId>
-      <version>${incap.version}</version>
-      <scope>provided</scope>
-      <optional>true</optional>
+      <version>1.1.0</version>
     </dependency>
     <dependency>
       <groupId>com.google.auto</groupId>
@@ -41,10 +34,9 @@
     </dependency>
     <dependency>
       <groupId>com.google.auto.service</groupId>
-      <artifactId>auto-service-annotations</artifactId>
-      <version>${autoservice.version}</version>
+      <artifactId>auto-service</artifactId>
+      <version>1.0-rc4</version>
       <scope>provided</scope>
-      <optional>true</optional>
     </dependency>
     <dependency>
       <groupId>junit</groupId>
@@ -64,12 +56,10 @@
     <dependency>
       <groupId>org.jetbrains.kotlin</groupId>
       <artifactId>kotlin-compiler-embeddable</artifactId>
-      <scope>test</scope>
     </dependency>
     <dependency>
       <groupId>org.jetbrains.kotlin</groupId>
       <artifactId>kotlin-annotation-processing-embeddable</artifactId>
-      <scope>test</scope>
     </dependency>
     <dependency>
       <groupId>me.eugeniomarletti.kotlin.metadata</groupId>
@@ -111,12 +101,7 @@
                 <annotationProcessorPath>
                   <groupId>com.google.auto.service</groupId>
                   <artifactId>auto-service</artifactId>
-                  <version>${autoservice.version}</version>
-                </annotationProcessorPath>
-                <annotationProcessorPath>
-                  <groupId>net.ltgt.gradle.incap</groupId>
-                  <artifactId>incap-processor</artifactId>
-                  <version>${incap.version}</version>
+                  <version>1.0-rc4</version>
                 </annotationProcessorPath>
               </annotationProcessorPaths>
             </configuration>
diff --git a/kotlin/codegen/src/main/java/com/squareup/moshi/kotlin/codegen/AdapterGenerator.kt b/kotlin/codegen/src/main/java/com/squareup/moshi/kotlin/codegen/AdapterGenerator.kt
index 0deba31f..a75740dc 100644
--- a/kotlin/codegen/src/main/java/com/squareup/moshi/kotlin/codegen/AdapterGenerator.kt
+++ b/kotlin/codegen/src/main/java/com/squareup/moshi/kotlin/codegen/AdapterGenerator.kt
@@ -52,7 +52,6 @@ internal class AdapterGenerator(
 
   private val nameAllocator = NameAllocator()
   private val adapterName = "${className.simpleNames.joinToString(separator = "_")}JsonAdapter"
-  private val originalElement = target.element
   private val originalTypeName = target.element.asType().asTypeName()
 
   private val moshiParam = ParameterSpec.builder(
@@ -98,7 +97,6 @@ internal class AdapterGenerator(
 
   private fun generateType(generatedOption: TypeElement?): TypeSpec {
     val result = TypeSpec.classBuilder(adapterName)
-        .addOriginatingElement(originalElement)
 
     generatedOption?.let {
       result.addAnnotation(AnnotationSpec.builder(it.asClassName())
diff --git a/kotlin/codegen/src/main/java/com/squareup/moshi/kotlin/codegen/JsonClassCodegenProcessor.kt b/kotlin/codegen/src/main/java/com/squareup/moshi/kotlin/codegen/JsonClassCodegenProcessor.kt
index ce3834e7..4821772c 100644
--- a/kotlin/codegen/src/main/java/com/squareup/moshi/kotlin/codegen/JsonClassCodegenProcessor.kt
+++ b/kotlin/codegen/src/main/java/com/squareup/moshi/kotlin/codegen/JsonClassCodegenProcessor.kt
@@ -16,12 +16,12 @@
 package com.squareup.moshi.kotlin.codegen
 
 import com.google.auto.service.AutoService
+import com.squareup.kotlinpoet.TypeSpec
 import com.squareup.moshi.JsonClass
 import me.eugeniomarletti.kotlin.metadata.KotlinMetadataUtils
 import me.eugeniomarletti.kotlin.metadata.declaresDefaultValue
 import me.eugeniomarletti.kotlin.processing.KotlinAbstractProcessor
-import net.ltgt.gradle.incap.IncrementalAnnotationProcessor
-import net.ltgt.gradle.incap.IncrementalAnnotationProcessorType.ISOLATING
+import java.io.File
 import javax.annotation.processing.ProcessingEnvironment
 import javax.annotation.processing.Processor
 import javax.annotation.processing.RoundEnvironment
@@ -42,7 +42,6 @@ import javax.tools.Diagnostic.Kind.ERROR
  * If you don't want this though, you can use the runtime [JsonClass] factory implementation.
  */
 @AutoService(Processor::class)
-@IncrementalAnnotationProcessor(ISOLATING)
 class JsonClassCodegenProcessor : KotlinAbstractProcessor(), KotlinMetadataUtils {
 
   companion object {
@@ -87,8 +86,7 @@ class JsonClassCodegenProcessor : KotlinAbstractProcessor(), KotlinMetadataUtils
       val jsonClass = type.getAnnotation(annotation)
       if (jsonClass.generateAdapter) {
         val generator = adapterGenerator(type) ?: continue
-        generator.generateFile(generatedType)
-            .writeTo(filer)
+        generator.generateAndWrite(generatedType)
       }
     }
 
@@ -125,4 +123,18 @@ class JsonClassCodegenProcessor : KotlinAbstractProcessor(), KotlinMetadataUtils
 
     return AdapterGenerator(type, sortedProperties)
   }
+
+  private fun AdapterGenerator.generateAndWrite(generatedOption: TypeElement?) {
+    val fileSpec = generateFile(generatedOption)
+    val adapterName = fileSpec.members.filterIsInstance<TypeSpec>().first().name!!
+    val outputDir = generatedDir ?: mavenGeneratedDir(adapterName)
+    fileSpec.writeTo(outputDir)
+  }
+
+  private fun mavenGeneratedDir(adapterName: String): File {
+    // Hack since the maven plugin doesn't supply `kapt.kotlin.generated` option
+    // Bug filed at https://youtrack.jetbrains.com/issue/KT-22783
+    val file = filer.createSourceFile(adapterName).toUri().let(::File)
+    return file.parentFile.also { file.delete() }
+  }
 }
diff --git a/kotlin/tests/pom.xml b/kotlin/tests/pom.xml
index fb1523e6..2b91baf6 100644
--- a/kotlin/tests/pom.xml
+++ b/kotlin/tests/pom.xml
@@ -108,7 +108,7 @@
               <sourceDirs>
                 <sourceDir>src/test/kotlin</sourceDir>
                 <sourceDir>src/test/java</sourceDir>
-                <sourceDir>target/generated-sources/kapt/test</sourceDir>
+                <sourceDir>target/generated-sources/kaptKotlin/test</sourceDir>
               </sourceDirs>
             </configuration>
           </execution>
diff --git a/pom.xml b/pom.xml
index 3ef492f6..10e3daf2 100644
--- a/pom.xml
+++ b/pom.xml
@@ -33,8 +33,6 @@
     <kotlin-metadata.version>1.4.0</kotlin-metadata.version>
     <dokka.version>0.9.17</dokka.version>
     <maven-assembly.version>3.1.0</maven-assembly.version>
-    <incap.version>0.2</incap.version>
-    <autoservice.version>1.0-rc5</autoservice.version>
 
     <!-- Dependencies -->
     <okio.version>1.16.0</okio.version>
