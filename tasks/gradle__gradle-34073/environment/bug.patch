diff --git a/.github/CODEOWNERS b/.github/CODEOWNERS
index fa6ca1a27f8..ed7a9902058 100644
--- a/.github/CODEOWNERS
+++ b/.github/CODEOWNERS
@@ -49,27 +49,27 @@ testing/architecture-test/src/changes/accepted-changes/accepted-public-api-chang
 testing/architecture-test/src/changes/archunit-store/internal-api-nullability.txt           @gradle/bt-unassigned-maintainers
 
 # Core automation platform (core/configuration)
-platforms/core-configuration/               @gradle/bt-configuration
-testing/smoke-ide-test/                     @gradle/bt-configuration
+platforms/core-configuration/               @gradle/bt-cortex
+testing/smoke-ide-test/                     @gradle/bt-cortex
 
 # Core automation platform (Kotlin DSL)
-build-logic/kotlin-dsl/                                     @gradle/bt-kotlin-dsl-maintainers
-build-logic/kotlin-dsl-shared-runtime/                      @gradle/bt-kotlin-dsl-maintainers
-platforms/core-configuration/kotlin-dsl/                    @gradle/bt-kotlin-dsl-maintainers
-platforms/core-configuration/kotlin-dsl-integ-tests/        @gradle/bt-kotlin-dsl-maintainers
-platforms/core-configuration/kotlin-dsl-plugins/            @gradle/bt-kotlin-dsl-maintainers
-platforms/core-configuration/kotlin-dsl-provider-plugins/   @gradle/bt-kotlin-dsl-maintainers
-platforms/core-configuration/kotlin-dsl-tooling-builders/   @gradle/bt-kotlin-dsl-maintainers
-platforms/core-configuration/kotlin-dsl-tooling-models/     @gradle/bt-kotlin-dsl-maintainers
+build-logic/kotlin-dsl/                                     @gradle/bt-tide
+build-logic/kotlin-dsl-shared-runtime/                      @gradle/bt-tide
+platforms/core-configuration/kotlin-dsl/                    @gradle/bt-tide
+platforms/core-configuration/kotlin-dsl-integ-tests/        @gradle/bt-tide
+platforms/core-configuration/kotlin-dsl-plugins/            @gradle/bt-tide
+platforms/core-configuration/kotlin-dsl-provider-plugins/   @gradle/bt-tide
+platforms/core-configuration/kotlin-dsl-tooling-builders/   @gradle/bt-tide
+platforms/core-configuration/kotlin-dsl-tooling-models/     @gradle/bt-tide
 
 # Core automation platform (Declarative DSL)
-platforms/core-configuration/declarative-dsl-api/                   @gradle/bt-declarative-dsl
-platforms/core-configuration/declarative-dsl-core/                  @gradle/bt-declarative-dsl
-platforms/core-configuration/declarative-dsl-evaluator/             @gradle/bt-declarative-dsl
-platforms/core-configuration/declarative-dsl-provider/              @gradle/bt-declarative-dsl
-platforms/core-configuration/declarative-dsl-tooling-builders/      @gradle/bt-declarative-dsl
-platforms/core-configuration/declarative-dsl-tooling-models/        @gradle/bt-declarative-dsl
-platforms/core-configuration/declarative-dsl-internal-utils/        @gradle/bt-declarative-dsl
+platforms/core-configuration/declarative-dsl-api/                   @gradle/bt-declarative-gradle
+platforms/core-configuration/declarative-dsl-core/                  @gradle/bt-declarative-gradle
+platforms/core-configuration/declarative-dsl-evaluator/             @gradle/bt-declarative-gradle
+platforms/core-configuration/declarative-dsl-provider/              @gradle/bt-declarative-gradle
+platforms/core-configuration/declarative-dsl-tooling-builders/      @gradle/bt-declarative-gradle
+platforms/core-configuration/declarative-dsl-tooling-models/        @gradle/bt-declarative-gradle
+platforms/core-configuration/declarative-dsl-internal-utils/        @gradle/bt-declarative-gradle
 
 # Core automation platform (core/runtime)
 platforms/core-runtime/                                     @gradle/bt-core-runtime-maintainers
@@ -114,11 +114,11 @@ platforms/extensibility/        @gradle/bt-extensibility-maintainers
 platforms/native/                   @gradle/bt-native-maintainers
 
 # IDE Experience team
-platforms/ide/                    @gradle/bt-ide-experience
+platforms/ide/                    @gradle/bt-tide
 # Eventually be moved to the core platform.
 # Currently heavily developed by the bt-ide-experience team.
-platforms/ide/problems/           @gradle/bt-ide-experience
-platforms/ide/ide-native/         @gradle/bt-ide-experience @gradle/bt-native-maintainers
+platforms/ide/problems/           @gradle/bt-tide
+platforms/ide/ide-native/         @gradle/bt-tide @gradle/bt-native-maintainers
 
 # Documentation
 platforms/documentation/docs/src/docs/                                                        @gradle/bt-docs-reviewers
@@ -127,9 +127,9 @@ platforms/documentation/docs/src/docs-asciidoctor-extensions-base/
 platforms/documentation/docs/src/docs-asciidoctor-extensions/                                 @gradle/bt-docs-reviewers
 platforms/documentation/samples/                                                       	      @gradle/bt-docs-reviewers
 
-platforms/documentation/docs/src/snippets/kotlinDsl/                                                @gradle/bt-docs-reviewers @gradle/bt-kotlin-dsl-maintainers
-platforms/documentation/docs/src/docs/userguide/api/kotlin_dsl.adoc                                 @gradle/bt-docs-reviewers @gradle/bt-kotlin-dsl-maintainers
-platforms/documentation/docs/src/docs/userguide/migration/migrating_from_groovy_to_kotlin_dsl.adoc  @gradle/bt-docs-reviewers @gradle/bt-kotlin-dsl-maintainers
+platforms/documentation/docs/src/snippets/kotlinDsl/                                                @gradle/bt-docs-reviewers @gradle/bt-tide
+platforms/documentation/docs/src/docs/userguide/api/kotlin_dsl.adoc                                 @gradle/bt-docs-reviewers @gradle/bt-tide
+platforms/documentation/docs/src/docs/userguide/migration/migrating_from_groovy_to_kotlin_dsl.adoc  @gradle/bt-docs-reviewers @gradle/bt-tide
 
 platforms/documentation/docs/src/docs/userguide/core-plugins/base_plugin.adoc                 @gradle/bt-docs-reviewers @gradle/bt-jvm
 platforms/documentation/docs/src/docs/userguide/core-plugins/build_dashboard_plugin.adoc      @gradle/bt-docs-reviewers @gradle/bt-jvm
diff --git a/.idea/misc.xml b/.idea/misc.xml
index 545a73f0820..6889f12c626 100644
--- a/.idea/misc.xml
+++ b/.idea/misc.xml
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <project version="4">
   <component name="EntryPointsManager">
-    <list size="4">
+    <list size="5">
       <item index="0" class="java.lang.String" itemvalue="com.tngtech.archunit.junit.ArchTest" />
       <item index="1" class="java.lang.String" itemvalue="org.gradle.internal.instrumentation.api.annotations.BytecodeUpgrade" />
       <item index="2" class="java.lang.String" itemvalue="org.gradle.internal.instrumentation.api.annotations.InterceptJvmCalls" />
@@ -63,4 +63,4 @@
     </option>
   </component>
   <component name="ProjectRootManager" version="2" languageLevel="JDK_1_8" project-jdk-name="17" project-jdk-type="JavaSDK" />
-</project>
+</project>
\ No newline at end of file
diff --git a/.teamcity/performance-test-durations.json b/.teamcity/performance-test-durations.json
index cfd9a81fc67..6fe1b5597d0 100644
--- a/.teamcity/performance-test-durations.json
+++ b/.teamcity/performance-test-durations.json
@@ -2,188 +2,188 @@
   "scenario" : "org.gradle.performance.experiment.declarativedsl.DeclarativeDslFirstUsePerformanceTest.clean checkout",
   "durations" : [ {
     "testProject" : "largeEmptyMultiProjectDeclarativeDsl",
-    "linux" : 461
+    "linux" : 453
   } ]
 }, {
   "scenario" : "org.gradle.performance.experiment.declarativedsl.DeclarativeDslFirstUsePerformanceTest.cold daemon",
   "durations" : [ {
     "testProject" : "largeEmptyMultiProjectDeclarativeDsl",
-    "linux" : 470
+    "linux" : 462
   } ]
 }, {
   "scenario" : "org.gradle.performance.experiment.declarativedsl.DeclarativeDslFirstUsePerformanceTest.first use",
   "durations" : [ {
     "testProject" : "largeEmptyMultiProjectDeclarativeDsl",
-    "linux" : 1199
+    "linux" : 1196
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.android.AndroidIncrementalExecutionPerformanceTest.abi change",
   "durations" : [ {
     "testProject" : "nowInAndroidBuild",
-    "linux" : 383,
-    "windows" : 444,
-    "macOs" : 268
+    "linux" : 389,
+    "windows" : 455,
+    "macOs" : 272
   }, {
     "testProject" : "santaTrackerAndroidBuild",
-    "linux" : 796,
-    "windows" : 1131,
-    "macOs" : 571
+    "linux" : 810,
+    "windows" : 1140,
+    "macOs" : 577
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.android.AndroidIncrementalExecutionPerformanceTest.abi change with configuration caching",
   "durations" : [ {
     "testProject" : "nowInAndroidBuild",
     "linux" : 401,
-    "windows" : 446,
+    "windows" : 466,
     "macOs" : 354
   }, {
     "testProject" : "santaTrackerAndroidBuild",
-    "linux" : 754,
-    "windows" : 822,
-    "macOs" : 568
+    "linux" : 765,
+    "windows" : 830,
+    "macOs" : 576
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.android.AndroidIncrementalExecutionPerformanceTest.non-abi change",
   "durations" : [ {
     "testProject" : "nowInAndroidBuild",
-    "linux" : 346,
-    "windows" : 442,
-    "macOs" : 265
+    "linux" : 342,
+    "windows" : 455,
+    "macOs" : 274
   }, {
     "testProject" : "santaTrackerAndroidBuild",
-    "linux" : 647,
-    "windows" : 884,
-    "macOs" : 421
+    "linux" : 669,
+    "windows" : 866,
+    "macOs" : 433
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.android.AndroidIncrementalExecutionPerformanceTest.non-abi change with configuration caching",
   "durations" : [ {
     "testProject" : "nowInAndroidBuild",
-    "linux" : 344,
-    "windows" : 457,
+    "linux" : 342,
+    "windows" : 462,
     "macOs" : 266
   }, {
     "testProject" : "santaTrackerAndroidBuild",
     "linux" : 412,
-    "windows" : 788,
-    "macOs" : 374
+    "windows" : 761,
+    "macOs" : 367
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.android.RealLifeAndroidBuildPerformanceTest.calculate task graph with test finalizer",
   "durations" : [ {
     "testProject" : "largeAndroidBuild",
-    "linux" : 520
+    "linux" : 522
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.android.RealLifeAndroidBuildPerformanceTest.clean assembleDebug with clean transforms cache",
   "durations" : [ {
     "testProject" : "largeAndroidBuild",
-    "linux" : 1705
+    "linux" : 1670
   }, {
     "testProject" : "nowInAndroidBuild",
-    "linux" : 4673
+    "linux" : 4886
   }, {
     "testProject" : "santaTrackerAndroidBuild",
-    "linux" : 2290
+    "linux" : 2340
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.android.RealLifeAndroidBuildPerformanceTest.clean phthalic:assembleDebug with clean transforms cache",
   "durations" : [ {
     "testProject" : "largeAndroidBuild",
-    "linux" : 1394
+    "linux" : 1388
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.android.RealLifeAndroidBuildPerformanceTest.run assembleDebug",
   "durations" : [ {
     "testProject" : "largeAndroidBuild",
-    "linux" : 1045
+    "linux" : 1049
   }, {
     "testProject" : "nowInAndroidBuild",
-    "linux" : 850
+    "linux" : 921
   }, {
     "testProject" : "santaTrackerAndroidBuild",
-    "linux" : 527
+    "linux" : 531
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.android.RealLifeAndroidBuildPerformanceTest.run clean phthalic:assembleDebug",
   "durations" : [ {
     "testProject" : "largeAndroidBuild",
-    "linux" : 415
+    "linux" : 418
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.android.RealLifeAndroidBuildPerformanceTest.run help",
   "durations" : [ {
     "testProject" : "largeAndroidBuild",
-    "linux" : 415
+    "linux" : 432
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.android.RealLifeAndroidStudioPerformanceTest.run Android Studio sync",
   "durations" : [ {
     "testProject" : "largeAndroidBuild",
-    "linux" : 950
+    "linux" : 888
   }, {
     "testProject" : "nowInAndroidBuild",
-    "linux" : 1118
+    "linux" : 1172
   }, {
     "testProject" : "santaTrackerAndroidBuild",
-    "linux" : 704
+    "linux" : 731
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.buildcache.TaskOutputCachingJavaPerformanceTest.clean assemble for abi change with local cache",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 1069
+    "linux" : 1112
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.buildcache.TaskOutputCachingJavaPerformanceTest.clean assemble for non-abi change with local cache",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 967
+    "linux" : 1025
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.buildcache.TaskOutputCachingJavaPerformanceTest.clean assemble with empty local cache",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 1135
+    "linux" : 1112
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 1314
+    "linux" : 1319
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.buildcache.TaskOutputCachingJavaPerformanceTest.clean assemble with empty remote http cache",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 1157
+    "linux" : 1167
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 1293
+    "linux" : 1311
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.buildcache.TaskOutputCachingJavaPerformanceTest.clean assemble with local cache",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 982
+    "linux" : 989
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 1499
+    "linux" : 1488
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.buildcache.TaskOutputCachingJavaPerformanceTest.clean assemble with remote http cache",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 763
+    "linux" : 777
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 618
+    "linux" : 626
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.buildcache.TaskOutputCachingJavaPerformanceTest.clean assemble with remote https cache",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 764
+    "linux" : 763
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 639
+    "linux" : 648
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.buildcache.TaskOutputCachingJavaPerformanceTest.clean check on ephemeral ci with remote http cache",
@@ -195,58 +195,58 @@
   "scenario" : "org.gradle.performance.regression.buildcache.TaskOutputCachingNativePerformanceTest.clean assemble with local cache (native project)",
   "durations" : [ {
     "testProject" : "bigCppApp",
-    "linux" : 263
+    "linux" : 266
   }, {
     "testProject" : "bigCppMulti",
-    "linux" : 553
+    "linux" : 550
   }, {
     "testProject" : "bigNative",
-    "linux" : 253
+    "linux" : 259
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.buildcache.TaskOutputCachingSwiftPerformanceTest.clean assemble with local cache (swift)",
   "durations" : [ {
     "testProject" : "bigSwiftApp",
-    "linux" : 409
+    "linux" : 401
   }, {
     "testProject" : "mediumSwiftMulti",
-    "linux" : 667
+    "linux" : 658
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.ArchiveTreePerformanceTest.compressing tar",
   "durations" : [ {
     "testProject" : "archivePerformanceProject",
-    "linux" : 170
+    "linux" : 165
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.ArchiveTreePerformanceTest.compressing zip",
   "durations" : [ {
     "testProject" : "archivePerformanceProject",
-    "linux" : 169
+    "linux" : 167
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.ArchiveTreePerformanceTest.packing tar",
   "durations" : [ {
     "testProject" : "archivePerformanceProject",
-    "linux" : 161
+    "linux" : 163
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.ArchiveTreePerformanceTest.visiting gzip tar trees",
   "durations" : [ {
     "testProject" : "archivePerformanceProject",
-    "linux" : 299
+    "linux" : 312
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.ArchiveTreePerformanceTest.visiting tar trees",
   "durations" : [ {
     "testProject" : "archivePerformanceProject",
-    "linux" : 395
+    "linux" : 426
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.ArchiveTreePerformanceTest.visiting zip trees",
   "durations" : [ {
     "testProject" : "archivePerformanceProject",
-    "linux" : 737
+    "linux" : 762
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.DeprecationCreationPerformanceTest.create many deprecation warnings",
@@ -258,73 +258,73 @@
   "scenario" : "org.gradle.performance.regression.corefeature.ExcludeRuleMergingPerformanceTest.merge exclude rules",
   "durations" : [ {
     "testProject" : "excludeRuleMergingBuild",
-    "linux" : 297
+    "linux" : 287
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.ExcludeRuleMergingPerformanceTest.merge exclude rules (parallel)",
   "durations" : [ {
     "testProject" : "excludeRuleMergingBuild",
-    "linux" : 229
+    "linux" : 230
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.IdeIntegrationPerformanceTest.eclipse",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 527
+    "linux" : 539
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 222
+    "linux" : 228
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.IdeIntegrationPerformanceTest.idea",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 514
+    "linux" : 524
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 220
+    "linux" : 226
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.LargeDependencyGraphPerformanceTest.resolve large dependency graph (parallel = false, locking = false)",
   "durations" : [ {
     "testProject" : "excludeRuleMergingBuild",
-    "linux" : 221
+    "linux" : 223
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.LargeDependencyGraphPerformanceTest.resolve large dependency graph (parallel = false, locking = true)",
   "durations" : [ {
     "testProject" : "excludeRuleMergingBuild",
-    "linux" : 226
+    "linux" : 227
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.LargeDependencyGraphPerformanceTest.resolve large dependency graph (parallel = true, locking = false)",
   "durations" : [ {
     "testProject" : "excludeRuleMergingBuild",
-    "linux" : 229
+    "linux" : 230
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.LargeDependencyGraphPerformanceTest.resolve large dependency graph (parallel = true, locking = true)",
   "durations" : [ {
     "testProject" : "excludeRuleMergingBuild",
-    "linux" : 237
+    "linux" : 242
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.LargeDependencyGraphPerformanceTest.resolve large dependency graph from file repo",
   "durations" : [ {
     "testProject" : "excludeRuleMergingBuild",
-    "linux" : 441
+    "linux" : 443
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.ParallelDownloadsPerformanceTest.resolves dependencies from external repository",
   "durations" : [ {
     "testProject" : "springBootApp",
-    "linux" : 889
+    "linux" : 879
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.ParallelDownloadsPerformanceTest.resolves dependencies from external repository (parallel)",
   "durations" : [ {
     "testProject" : "springBootApp",
-    "linux" : 555
+    "linux" : 556
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.RichConsolePerformanceTest.clean assemble with rich console",
@@ -333,10 +333,10 @@
     "linux" : 162
   }, {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 787
+    "linux" : 813
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 1224
+    "linux" : 1239
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.RichConsolePerformanceTest.cleanTest test with rich console",
@@ -348,7 +348,7 @@
   "scenario" : "org.gradle.performance.regression.corefeature.TaskCreationPerformanceTest.create many tasks",
   "durations" : [ {
     "testProject" : "createLotsOfTasks",
-    "linux" : 208
+    "linux" : 205
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.VerboseTestOutputPerformanceTest.cleanTest test with verbose test output",
@@ -357,315 +357,326 @@
     "linux" : 215
   }, {
     "testProject" : "withVerboseTestNG",
-    "linux" : 198
+    "linux" : 196
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.inception.BuildSrcApiChangePerformanceTest.buildSrc abi change",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 657
+    "linux" : 665
   }, {
     "testProject" : "largeJavaMultiProjectKotlinDsl",
-    "linux" : 953
+    "linux" : 985
   }, {
     "testProject" : "mediumMonolithicJavaProject",
-    "linux" : 266
+    "linux" : 268
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.inception.BuildSrcApiChangePerformanceTest.buildSrc non-abi change",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 657
+    "linux" : 665
   }, {
     "testProject" : "largeJavaMultiProjectKotlinDsl",
-    "linux" : 350
+    "linux" : 358
   }, {
     "testProject" : "mediumMonolithicJavaProject",
-    "linux" : 263
+    "linux" : 265
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaCleanAssemblePerformanceTest.clean assemble",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 558
+    "linux" : 564
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 803
+    "linux" : 813
   }, {
     "testProject" : "mediumJavaCompositeBuild",
-    "linux" : 358
+    "linux" : 361
   }, {
     "testProject" : "mediumJavaPredefinedCompositeBuild",
-    "linux" : 354
+    "linux" : 358
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaConfigurationCachePerformanceTest.assemble loading configuration cache state with cold daemon",
   "durations" : [ {
     "testProject" : "largeJavaMultiProjectNoBuildSrc",
-    "linux" : 685
+    "linux" : 694
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaConfigurationCachePerformanceTest.assemble loading configuration cache state with hot daemon",
   "durations" : [ {
     "testProject" : "largeJavaMultiProjectNoBuildSrc",
-    "linux" : 745
+    "linux" : 769
   }, {
     "testProject" : "smallJavaMultiProject",
-    "linux" : 234
+    "linux" : 239
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaConfigurationCachePerformanceTest.assemble storing configuration cache state with cold daemon",
   "durations" : [ {
     "testProject" : "largeJavaMultiProjectNoBuildSrc",
-    "linux" : 716
+    "linux" : 738
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaConfigurationCachePerformanceTest.assemble storing configuration cache state with hot daemon",
   "durations" : [ {
     "testProject" : "largeJavaMultiProjectNoBuildSrc",
-    "linux" : 692
+    "linux" : 697
   }, {
     "testProject" : "smallJavaMultiProject",
-    "linux" : 236
+    "linux" : 237
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaConfigurationPerformanceTest.configure",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 463
+    "linux" : 473
   }, {
     "testProject" : "largeJavaMultiProjectKotlinDsl",
-    "linux" : 610
+    "linux" : 643
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 217
+    "linux" : 220
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaDependencyReportPerformanceTest.generate dependency report",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 428
+    "linux" : 440
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 225
+    "linux" : 231
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaFirstUsePerformanceTest.clean checkout",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 1690
+    "linux" : 1712
   }, {
     "testProject" : "largeJavaMultiProjectKotlinDsl",
-    "linux" : 1329
+    "linux" : 1353
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 683
+    "linux" : 686
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaFirstUsePerformanceTest.cold daemon",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 1571
+    "linux" : 1617
   }, {
     "testProject" : "largeJavaMultiProjectKotlinDsl",
-    "linux" : 1348
+    "linux" : 1368
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 617
+    "linux" : 650
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaFirstUsePerformanceTest.first use",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 1001
+    "linux" : 1020
   }, {
     "testProject" : "largeJavaMultiProjectKotlinDsl",
-    "linux" : 964
+    "linux" : 1012
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 595
+    "linux" : 612
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaIDEModelPerformanceTest.get IDE model for Eclipse",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 1084
+    "linux" : 1086
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaIDEModelPerformanceTest.get IDE model for IDEA",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 1035
+    "linux" : 1072
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaIDETaskExecutionPerformanceTest.run compileJava via Tooling API",
   "durations" : [ {
     "testProject" : "largeAndroidBuild",
-    "linux" : 999
+    "linux" : 1047
   }, {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 996
+    "linux" : 1001
   }, {
     "testProject" : "largeJavaMultiProjectHierarchy",
-    "linux" : 946
+    "linux" : 1028
   }, {
     "testProject" : "nowInAndroidBuild",
-    "linux" : 334
+    "linux" : 337
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaIncrementalExecutionPerformanceTest.assemble for abi change",
   "durations" : [ {
     "testProject" : "largeGroovyMultiProject",
-    "linux" : 772
+    "linux" : 775
   }, {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 567,
-    "windows" : 979,
-    "macOs" : 261
+    "linux" : 592,
+    "windows" : 981,
+    "macOs" : 258
   }, {
     "testProject" : "largeMonolithicGroovyProject",
-    "linux" : 2292
+    "linux" : 2304
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 1564
+    "linux" : 1487
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaIncrementalExecutionPerformanceTest.assemble for abi change with configuration caching",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 343,
-    "windows" : 813,
-    "macOs" : 227
+    "linux" : 364,
+    "windows" : 800,
+    "macOs" : 237
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaIncrementalExecutionPerformanceTest.assemble for non-abi change",
   "durations" : [ {
     "testProject" : "largeGroovyMultiProject",
-    "linux" : 706
+    "linux" : 697
   }, {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 527,
-    "windows" : 997,
-    "macOs" : 260
+    "linux" : 530,
+    "windows" : 1001,
+    "macOs" : 256
   }, {
     "testProject" : "largeMonolithicGroovyProject",
-    "linux" : 2433
+    "linux" : 2481
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 1437
+    "linux" : 1472
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaIncrementalExecutionPerformanceTest.assemble for non-abi change with configuration caching",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 319,
-    "windows" : 712,
-    "macOs" : 219
+    "linux" : 334,
+    "windows" : 701,
+    "macOs" : 220
+  } ]
+}, {
+  "scenario" : "org.gradle.performance.regression.java.JavaIncrementalExecutionPerformanceTest.assemble for non-abi change with file system sensitive archives",
+  "durations" : [ {
+    "testProject" : "largeJavaMultiProject",
+    "linux" : 505,
+    "windows" : 908,
+    "macOs" : 242
+  }, {
+    "testProject" : "largeMonolithicJavaProject",
+    "linux" : 1238
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaIncrementalExecutionPerformanceTest.assemble for non-abi change with reproducible archives",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 547,
-    "windows" : 943,
+    "linux" : 566,
+    "windows" : 990,
     "macOs" : 237
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 1599
+    "linux" : 1672
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaIncrementalExecutionPerformanceTest.test for non-abi change",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 531
+    "linux" : 542
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 1347
+    "linux" : 1341
   }, {
     "testProject" : "mediumJavaMultiProjectWithTestNG",
-    "linux" : 241
+    "linux" : 257
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaIncrementalExecutionPerformanceTest.up-to-date assemble (parallel false)",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 666
+    "linux" : 658
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 306
+    "linux" : 304
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaIncrementalExecutionPerformanceTest.up-to-date assemble (parallel true)",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 533,
-    "windows" : 976
+    "linux" : 546,
+    "windows" : 961
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaIncrementalExecutionPerformanceTest.up-to-date assemble with local build cache enabled (parallel false)",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 674
+    "linux" : 679
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 306
+    "linux" : 311
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaIncrementalExecutionPerformanceTest.up-to-date assemble with local build cache enabled (parallel true)",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 533
+    "linux" : 557
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaTasksPerformanceTest.tasks",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 458
+    "linux" : 465
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 224
+    "linux" : 230
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.java.JavaTasksPerformanceTest.tasks --all",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 596
+    "linux" : 599
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 214
+    "linux" : 216
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.nativeplatform.NativeBuildDependentsPerformanceTest.run libA0:buildDependentsLibA0",
   "durations" : [ {
     "testProject" : "nativeDependents",
-    "linux" : 792
+    "linux" : 797
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.nativeplatform.NativeBuildDependentsPerformanceTest.run libA0:buildDependentsLibA00",
   "durations" : [ {
     "testProject" : "nativeDependents",
-    "linux" : 880
+    "linux" : 944
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.nativeplatform.NativeBuildDependentsPerformanceTest.run libA0:dependentComponents",
   "durations" : [ {
     "testProject" : "nativeDependents",
-    "linux" : 819
+    "linux" : 838
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.nativeplatform.NativeBuildPerformanceTest.assemble with header file change",
   "durations" : [ {
     "testProject" : "bigCppApp",
-    "linux" : 314
+    "linux" : 315
   }, {
     "testProject" : "bigCppMulti",
-    "linux" : 268
+    "linux" : 269
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.nativeplatform.NativeBuildPerformanceTest.assemble with source file change",
   "durations" : [ {
     "testProject" : "bigCppApp",
-    "linux" : 183
+    "linux" : 182
   }, {
     "testProject" : "bigCppMulti",
     "linux" : 266
@@ -674,7 +685,7 @@
   "scenario" : "org.gradle.performance.regression.nativeplatform.NativeBuildPerformanceTest.up-to-date assemble (native)",
   "durations" : [ {
     "testProject" : "bigCppApp",
-    "linux" : 135
+    "linux" : 136
   }, {
     "testProject" : "bigCppMulti",
     "linux" : 263
@@ -683,154 +694,154 @@
   "scenario" : "org.gradle.performance.regression.nativeplatform.NativeCleanBuildPerformanceTest.clean assemble (native, parallel)",
   "durations" : [ {
     "testProject" : "manyProjectsNative",
-    "linux" : 657
+    "linux" : 663
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.nativeplatform.NativeCleanBuildPerformanceTest.clean assemble (native)",
   "durations" : [ {
     "testProject" : "bigCppApp",
-    "linux" : 505
+    "linux" : 506
   }, {
     "testProject" : "bigCppMulti",
-    "linux" : 1504
+    "linux" : 1476
   }, {
     "testProject" : "bigNative",
-    "linux" : 652
+    "linux" : 665
   }, {
     "testProject" : "mediumCppApp",
-    "linux" : 239
+    "linux" : 251
   }, {
     "testProject" : "mediumCppAppWithMacroIncludes",
-    "linux" : 248
+    "linux" : 258
   }, {
     "testProject" : "mediumCppMulti",
-    "linux" : 503
+    "linux" : 488
   }, {
     "testProject" : "mediumCppMultiWithMacroIncludes",
-    "linux" : 490
+    "linux" : 474
   }, {
     "testProject" : "mediumNative",
-    "linux" : 263
+    "linux" : 265
   }, {
     "testProject" : "multiNative",
-    "linux" : 1699
+    "linux" : 1776
   }, {
     "testProject" : "smallCppApp",
-    "linux" : 334
+    "linux" : 333
   }, {
     "testProject" : "smallCppMulti",
-    "linux" : 340
+    "linux" : 338
   }, {
     "testProject" : "smallNative",
-    "linux" : 329
+    "linux" : 322
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.nativeplatform.RealWorldNativePluginPerformanceTest.build with 0 parallel workers",
   "durations" : [ {
     "testProject" : "nativeMonolithic",
-    "linux" : 1319
+    "linux" : 1323
   }, {
     "testProject" : "nativeMonolithicOverlapping",
-    "linux" : 1286
+    "linux" : 1304
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.nativeplatform.RealWorldNativePluginPerformanceTest.build with 12 parallel workers",
   "durations" : [ {
     "testProject" : "nativeMonolithic",
-    "linux" : 608
+    "linux" : 616
   }, {
     "testProject" : "nativeMonolithicOverlapping",
-    "linux" : 598
+    "linux" : 606
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.nativeplatform.RealWorldNativePluginPerformanceTest.build with build file change",
   "durations" : [ {
     "testProject" : "smallNativeMonolithic",
-    "linux" : 524
+    "linux" : 529
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.nativeplatform.RealWorldNativePluginPerformanceTest.build with header file change",
   "durations" : [ {
     "testProject" : "mediumNativeMonolithic",
-    "linux" : 318
+    "linux" : 315
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.nativeplatform.RealWorldNativePluginPerformanceTest.build with source file change",
   "durations" : [ {
     "testProject" : "mediumNativeMonolithic",
-    "linux" : 316
+    "linux" : 318
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.nativeplatform.SwiftBuildPerformanceTest.incremental compile",
   "durations" : [ {
     "testProject" : "bigSwiftApp",
-    "linux" : 305
+    "linux" : 308
   }, {
     "testProject" : "mediumSwiftMulti",
-    "linux" : 1288
+    "linux" : 1283
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.nativeplatform.SwiftBuildPerformanceTest.up-to-date assemble (swift)",
   "durations" : [ {
     "testProject" : "bigSwiftApp",
-    "linux" : 173
+    "linux" : 175
   }, {
     "testProject" : "mediumSwiftMulti",
-    "linux" : 253
+    "linux" : 249
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.nativeplatform.SwiftCleanBuildPerformanceTest.clean assemble (swift)",
   "durations" : [ {
     "testProject" : "bigSwiftApp",
-    "linux" : 2506
+    "linux" : 2474
   }, {
     "testProject" : "mediumSwiftMulti",
-    "linux" : 3321
+    "linux" : 3260
   } ]
 }, {
   "scenario" : "org.gradle.performance.experiment.buildcache.LocalTaskOutputCacheCrossBuildPerformanceTest.assemble with local cache (build comparison)",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 784
+    "linux" : 806
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 1008
+    "linux" : 1018
   } ]
 }, {
   "scenario" : "org.gradle.performance.experiment.java.ParallelBuildPerformanceTest.clean assemble with 4 parallel workers",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 535
+    "linux" : 546
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 524
+    "linux" : 522
   } ]
 }, {
   "scenario" : "org.gradle.performance.experiment.maven.JavaTestGradleVsMavenPerformanceTest.assemble for non-abi change (Gradle vs Maven)",
   "durations" : [ {
     "testProject" : "mediumJavaMultiProject",
-    "linux" : 91
+    "linux" : 93
   }, {
     "testProject" : "mediumMonolithicJavaProject",
-    "linux" : 95
+    "linux" : 97
   } ]
 }, {
   "scenario" : "org.gradle.performance.experiment.maven.JavaTestGradleVsMavenPerformanceTest.clean assemble (Gradle vs Maven)",
   "durations" : [ {
     "testProject" : "mediumJavaMultiProject",
-    "linux" : 119
+    "linux" : 122
   }, {
     "testProject" : "mediumMonolithicJavaProject",
-    "linux" : 114
+    "linux" : 116
   } ]
 }, {
   "scenario" : "org.gradle.performance.experiment.maven.JavaTestGradleVsMavenPerformanceTest.clean test (Gradle vs Maven)",
   "durations" : [ {
     "testProject" : "mediumJavaMultiProject",
-    "linux" : 309
+    "linux" : 312
   }, {
     "testProject" : "mediumMonolithicJavaProject",
-    "linux" : 253
+    "linux" : 261
   } ]
 }, {
   "scenario" : "org.gradle.performance.experiment.maven.JavaTestGradleVsMavenPerformanceTest.test for non-abi change (Gradle vs Maven)",
@@ -839,42 +850,42 @@
     "linux" : 135
   }, {
     "testProject" : "mediumMonolithicJavaProject",
-    "linux" : 236
+    "linux" : 243
   } ]
 }, {
   "scenario" : "org.gradle.performance.experiment.nativeplatform.NativeParallelPerformanceTest.clean assemble with parallel workers",
   "durations" : [ {
     "testProject" : "bigNative",
-    "linux" : 575
+    "linux" : 580
   }, {
     "testProject" : "mediumNative",
-    "linux" : 201
+    "linux" : 202
   }, {
     "testProject" : "multiNative",
-    "linux" : 1378
+    "linux" : 1409
   }, {
     "testProject" : "smallNative",
-    "linux" : 141
+    "linux" : 143
   } ]
 }, {
   "scenario" : "org.gradle.performance.experiment.nativeplatform.NativePreCompiledHeaderPerformanceTest.clean assemble with precompiled headers",
   "durations" : [ {
     "testProject" : "bigPCHNative",
-    "linux" : 964
+    "linux" : 992
   }, {
     "testProject" : "mediumPCHNative",
-    "linux" : 300
+    "linux" : 303
   }, {
     "testProject" : "smallPCHNative",
-    "linux" : 152
+    "linux" : 153
   } ]
 }, {
   "scenario" : "org.gradle.performance.regression.corefeature.TaskAvoidancePerformanceTest.help with lazy and eager tasks",
   "durations" : [ {
     "testProject" : "largeJavaMultiProject",
-    "linux" : 222
+    "linux" : 225
   }, {
     "testProject" : "largeMonolithicJavaProject",
-    "linux" : 131
+    "linux" : 133
   } ]
 } ]
diff --git a/.teamcity/src/main/kotlin/model/CIBuildModel.kt b/.teamcity/src/main/kotlin/model/CIBuildModel.kt
index 02c00dfcc33..0ddf958e15d 100644
--- a/.teamcity/src/main/kotlin/model/CIBuildModel.kt
+++ b/.teamcity/src/main/kotlin/model/CIBuildModel.kt
@@ -375,7 +375,7 @@ data class CIBuildModel(
             ),
             Stage(
                 StageName.HISTORICAL_PERFORMANCE,
-                trigger = if (VersionedSettingsBranch.fromDslContext().isLegacyRelease) Trigger.NEVER else Trigger.WEEKLY,
+                trigger = if (branch.isLegacyRelease) Trigger.NEVER else Trigger.WEEKLY,
                 runsIndependent = true,
                 performanceTests =
                     listOf(
diff --git a/.teamcity/src/main/kotlin/promotion/BasePublishGradleDistribution.kt b/.teamcity/src/main/kotlin/promotion/BasePublishGradleDistribution.kt
index 5d572d53e9b..64f99f4da2e 100644
--- a/.teamcity/src/main/kotlin/promotion/BasePublishGradleDistribution.kt
+++ b/.teamcity/src/main/kotlin/promotion/BasePublishGradleDistribution.kt
@@ -37,7 +37,7 @@ abstract class BasePublishGradleDistribution(
             """
             **/build/git-checkout/platforms/core-runtime/base-services/build/generated-resources/build-receipt/org/gradle/build-receipt.properties
             **/build/distributions/*.zip => promote-build-distributions
-            **/build/website-checkout/data/releases.xml
+            **/build/releases-data-checkout/data/releases.xml
             **/build/git-checkout/build/reports/integTest/** => distribution-tests
             **/smoke-tests/build/reports/tests/** => post-smoke-tests
             **/build/version-info.properties => version-info.properties
diff --git a/build-logic-commons/basics/src/main/kotlin/gradlebuild/basics/kotlindsl/kotlin-compiler-configuration.kt b/build-logic-commons/basics/src/main/kotlin/gradlebuild/basics/kotlindsl/kotlin-compiler-configuration.kt
index f64f93e0cfd..28bcf8f105e 100644
--- a/build-logic-commons/basics/src/main/kotlin/gradlebuild/basics/kotlindsl/kotlin-compiler-configuration.kt
+++ b/build-logic-commons/basics/src/main/kotlin/gradlebuild/basics/kotlindsl/kotlin-compiler-configuration.kt
@@ -38,7 +38,6 @@ fun KotlinCompile.configureKotlinCompilerForGradleBuild() {
         allWarningsAsErrors = true
         apiVersion = KotlinVersion.KOTLIN_1_8
         languageVersion = KotlinVersion.KOTLIN_1_8
-        jvmTarget = JvmTarget.JVM_1_8
         freeCompilerArgs.addAll(
             "-Xjsr305=strict",
             "-Xjspecify-annotations=strict",
diff --git a/build-logic-commons/module-identity/src/main/kotlin/gradlebuild/identity/extension/ReleasedVersionsDetails.kt b/build-logic-commons/module-identity/src/main/kotlin/gradlebuild/identity/extension/ReleasedVersionsDetails.kt
index 0ddad7d1033..14f55d60b2a 100644
--- a/build-logic-commons/module-identity/src/main/kotlin/gradlebuild/identity/extension/ReleasedVersionsDetails.kt
+++ b/build-logic-commons/module-identity/src/main/kotlin/gradlebuild/identity/extension/ReleasedVersionsDetails.kt
@@ -32,7 +32,7 @@ class ReleasedVersionsDetails(currentBaseVersion: GradleVersion, releasedVersion
 
     val mainTestedVersions: List<GradleVersion>
     val lowestInterestingVersion: GradleVersion = GradleVersion.version("0.8")
-    val lowestTestedVersion: GradleVersion = GradleVersion.version("3.0")
+    val lowestTestedVersion: GradleVersion = GradleVersion.version("4.0")
 
     init {
         val releasedVersions = releasedVersionsFile.asFile.reader().use {
diff --git a/build-logic/build-init-samples/build.gradle.kts b/build-logic/build-init-samples/build.gradle.kts
index 85ce021aace..6b2d1db9039 100644
--- a/build-logic/build-init-samples/build.gradle.kts
+++ b/build-logic/build-init-samples/build.gradle.kts
@@ -5,6 +5,8 @@ plugins {
 description = "Provides a plugin to generate samples using internal build init APIs"
 
 dependencies {
+    implementation(projects.jvm)
+
     implementation("gradlebuild:basics")
     implementation("org.gradle.guides:gradle-guides-plugin")
     implementation("org.asciidoctor:asciidoctor-gradle-jvm") {
diff --git a/build-logic/build-init-samples/src/main/kotlin/gradlebuild/generate-samples.gradle.kts b/build-logic/build-init-samples/src/main/kotlin/gradlebuild/generate-samples.gradle.kts
index 9d551f36eca..212f10ab131 100644
--- a/build-logic/build-init-samples/src/main/kotlin/gradlebuild/generate-samples.gradle.kts
+++ b/build-logic/build-init-samples/src/main/kotlin/gradlebuild/generate-samples.gradle.kts
@@ -29,6 +29,11 @@ import org.gradle.docs.samples.Dsl
 
 plugins {
     id("org.gradle.samples")
+    id("gradlebuild.jvm-compile")
+}
+
+jvmCompile {
+    addCompilationFrom(sourceSets.docsTest)
 }
 
 val singleProjectSampleLanguages = listOf(JAVA, GROOVY, SCALA, KOTLIN, SWIFT, CPP)
diff --git a/build-logic/build-update-utils/src/main/kotlin/gradlebuild/buildutils/tasks/AbstractCheckOrUpdateContributorsInReleaseNotes.kt b/build-logic/build-update-utils/src/main/kotlin/gradlebuild/buildutils/tasks/AbstractCheckOrUpdateContributorsInReleaseNotes.kt
index 67a2965e830..32ed9271e77 100644
--- a/build-logic/build-update-utils/src/main/kotlin/gradlebuild/buildutils/tasks/AbstractCheckOrUpdateContributorsInReleaseNotes.kt
+++ b/build-logic/build-update-utils/src/main/kotlin/gradlebuild/buildutils/tasks/AbstractCheckOrUpdateContributorsInReleaseNotes.kt
@@ -110,6 +110,8 @@ abstract class AbstractCheckOrUpdateContributorsInReleaseNotes : DefaultTask() {
         }
         return prs
             .filter { it.milestone?.title?.startsWith(milestone.get()) == true }
+            // Filter out the ghost user that replaces deleted users
+            .filter { it.user.login != "ghost" }
             .map { it.user.login }
             .toSet()
             .map { getUserInfo(it) }
diff --git a/build-logic/buildquality/build.gradle.kts b/build-logic/buildquality/build.gradle.kts
index 3878fdd2cf4..3e520d2c685 100644
--- a/build-logic/buildquality/build.gradle.kts
+++ b/build-logic/buildquality/build.gradle.kts
@@ -10,6 +10,7 @@ dependencies {
     implementation(projects.cleanup)
     implementation(projects.documentation)
     implementation(projects.integrationTesting)
+    implementation(projects.jvm)
     implementation(projects.performanceTesting)
     implementation(projects.profiling)
     implementation(projects.binaryCompatibility)
diff --git a/build-logic/buildquality/src/main/kotlin/gradlebuild.arch-test.gradle.kts b/build-logic/buildquality/src/main/kotlin/gradlebuild.arch-test.gradle.kts
index 2e598567921..e1af5b220db 100644
--- a/build-logic/buildquality/src/main/kotlin/gradlebuild.arch-test.gradle.kts
+++ b/build-logic/buildquality/src/main/kotlin/gradlebuild.arch-test.gradle.kts
@@ -21,6 +21,7 @@ plugins {
     `jvm-test-suite`
     id("gradlebuild.dependency-modules")
     id("gradlebuild.code-quality")
+    id("gradlebuild.jvm-compile")
 }
 
 val packageCyclesExtension = extensions.create<PackageCyclesExtension>("packageCycles").apply {
@@ -47,6 +48,11 @@ testing {
     suites {
         create("archTest", JvmTestSuite::class) {
             useJUnitJupiter()
+
+            project.jvmCompile {
+                addCompilationFrom(sources)
+            }
+
             dependencies {
                 implementation(project.dependencies.create(project))
                 notForAccessorGeneration {
@@ -54,6 +60,7 @@ testing {
                     implementation(project(":internal-architecture-testing"))
                 }
             }
+
             targets {
                 all {
                     testTask.configure {
diff --git a/build-logic/dependency-modules/src/main/kotlin/gradlebuild/modules/extension/ExternalModulesExtension.kt b/build-logic/dependency-modules/src/main/kotlin/gradlebuild/modules/extension/ExternalModulesExtension.kt
index 45446a30843..f5d9546bb05 100644
--- a/build-logic/dependency-modules/src/main/kotlin/gradlebuild/modules/extension/ExternalModulesExtension.kt
+++ b/build-logic/dependency-modules/src/main/kotlin/gradlebuild/modules/extension/ExternalModulesExtension.kt
@@ -27,7 +27,7 @@ abstract class ExternalModulesExtension(bundleGroovyMajor: Int) {
     }
 
     val configurationCacheReportVersion = "1.26"
-    val gradleIdeStarterVersion = "0.5"
+    val gradleIdeStarterVersion = "0.6"
     val kotlinVersion = "2.1.21"
 
     fun futureKotlin(module: String) = "org.jetbrains.kotlin:kotlin-$module:$kotlinVersion"
diff --git a/build-logic/documentation/src/main/groovy/gradlebuild/docs/GradleUserManualPlugin.java b/build-logic/documentation/src/main/groovy/gradlebuild/docs/GradleUserManualPlugin.java
index aada380b2a0..f24522569a5 100644
--- a/build-logic/documentation/src/main/groovy/gradlebuild/docs/GradleUserManualPlugin.java
+++ b/build-logic/documentation/src/main/groovy/gradlebuild/docs/GradleUserManualPlugin.java
@@ -165,7 +165,7 @@ private void generateUserManual(Project project, TaskContainer tasks, ProjectLay
             // TODO: This is coupled to extension.getJavadocs().getJavaApi()
             attributes.put("javadocReferenceUrl", "https://docs.oracle.com/javase/8/docs/technotes/tools/windows/javadoc.html");
             // TODO: This is coupled to extension.getJavadocs().getJavaApi()
-            attributes.put("minJdkVersion", "8");
+            attributes.put("minJdkVersion", "17");
 
             attributes.put("antManual", "https://ant.apache.org/manual");
             attributes.put("docsUrl", "https://docs.gradle.org");
diff --git a/build-logic/integration-testing/build.gradle.kts b/build-logic/integration-testing/build.gradle.kts
index 7245cb1b943..b2a15cd7973 100644
--- a/build-logic/integration-testing/build.gradle.kts
+++ b/build-logic/integration-testing/build.gradle.kts
@@ -19,6 +19,7 @@ dependencies {
 
     implementation(projects.cleanup)
     implementation(projects.dependencyModules)
+    implementation(projects.jvm)
 
     testImplementation("junit:junit")
 }
diff --git a/build-logic/integration-testing/src/main/kotlin/gradlebuild.cross-version-tests.gradle.kts b/build-logic/integration-testing/src/main/kotlin/gradlebuild.cross-version-tests.gradle.kts
index 11fc1e125fb..7e2ea98ae60 100644
--- a/build-logic/integration-testing/src/main/kotlin/gradlebuild.cross-version-tests.gradle.kts
+++ b/build-logic/integration-testing/src/main/kotlin/gradlebuild.cross-version-tests.gradle.kts
@@ -17,7 +17,6 @@
 import gradlebuild.basics.capitalize
 import gradlebuild.basics.testing.TestType
 import gradlebuild.integrationtests.addDependenciesAndConfigurations
-import gradlebuild.integrationtests.addSourceSet
 import gradlebuild.integrationtests.configureIde
 import gradlebuild.integrationtests.createTestTask
 import gradlebuild.integrationtests.setSystemPropertiesOfTestJVM
@@ -26,9 +25,13 @@ plugins {
     java
     id("gradlebuild.module-identity")
     id("gradlebuild.dependency-modules")
+    id("gradlebuild.jvm-compile")
 }
 
-val sourceSet = addSourceSet(TestType.CROSSVERSION)
+val sourceSet = sourceSets.create("${TestType.CROSSVERSION.prefix}Test")
+jvmCompile {
+    addCompilationFrom(sourceSet)
+}
 addDependenciesAndConfigurations(TestType.CROSSVERSION.prefix)
 createQuickFeedbackTasks()
 createAggregateTasks(sourceSet)
diff --git a/build-logic/integration-testing/src/main/kotlin/gradlebuild.integration-tests.gradle.kts b/build-logic/integration-testing/src/main/kotlin/gradlebuild.integration-tests.gradle.kts
index ee3c536e22e..bf5b24c6f9a 100644
--- a/build-logic/integration-testing/src/main/kotlin/gradlebuild.integration-tests.gradle.kts
+++ b/build-logic/integration-testing/src/main/kotlin/gradlebuild.integration-tests.gradle.kts
@@ -17,24 +17,27 @@
 import gradlebuild.basics.testing.TestType
 import gradlebuild.basics.testing.includeSpockAnnotation
 import gradlebuild.integrationtests.addDependenciesAndConfigurations
-import gradlebuild.integrationtests.addSourceSet
 import gradlebuild.integrationtests.configureIde
 import gradlebuild.integrationtests.createTasks
 import gradlebuild.integrationtests.createTestTask
-import gradlebuild.integrationtests.setSystemPropertiesOfTestJVM
 import gradlebuild.integrationtests.extension.IntegrationTestExtension
+import gradlebuild.integrationtests.setSystemPropertiesOfTestJVM
 
 plugins {
     java
     id("gradlebuild.dependency-modules")
+    id("gradlebuild.jvm-compile")
 }
 
 extensions.create<IntegrationTestExtension>("integTest").apply {
-    usesJavadocCodeSnippets.convention(false)
+    generateDefaultAutoTestedSamplesTest.convention(true)
     testJvmXmx.convention("512m")
 }
 
-val sourceSet = addSourceSet(TestType.INTEGRATION)
+val sourceSet = sourceSets.create("${TestType.INTEGRATION.prefix}Test")
+jvmCompile {
+    addCompilationFrom(sourceSet)
+}
 addDependenciesAndConfigurations(TestType.INTEGRATION.prefix)
 createTasks(sourceSet, TestType.INTEGRATION)
 configureIde(TestType.INTEGRATION)
diff --git a/build-logic/integration-testing/src/main/kotlin/gradlebuild.test-fixtures.gradle.kts b/build-logic/integration-testing/src/main/kotlin/gradlebuild.test-fixtures.gradle.kts
index 5b2d978bc6f..f68431e8246 100644
--- a/build-logic/integration-testing/src/main/kotlin/gradlebuild.test-fixtures.gradle.kts
+++ b/build-logic/integration-testing/src/main/kotlin/gradlebuild.test-fixtures.gradle.kts
@@ -30,6 +30,14 @@ plugins {
     `java-test-fixtures`
     groovy
     id("gradlebuild.dependency-modules")
+    id("gradlebuild.jvm-compile")
+}
+
+jvmCompile {
+    addCompilationFrom(sourceSets.named("testFixtures")) {
+        // By default, test fixtures compile to the same JVM version as the production code.
+        targetJvmVersion = compilations.named("main").flatMap { it.targetJvmVersion }
+    }
 }
 
 // The below mimics what the java-library plugin does, but creating a library of test fixtures instead.
diff --git a/build-logic/integration-testing/src/main/kotlin/gradlebuild/integrationtests/extension/IntegrationTestExtension.kt b/build-logic/integration-testing/src/main/kotlin/gradlebuild/integrationtests/extension/IntegrationTestExtension.kt
index 6451f5625fd..15144716365 100644
--- a/build-logic/integration-testing/src/main/kotlin/gradlebuild/integrationtests/extension/IntegrationTestExtension.kt
+++ b/build-logic/integration-testing/src/main/kotlin/gradlebuild/integrationtests/extension/IntegrationTestExtension.kt
@@ -20,6 +20,11 @@ import org.gradle.api.provider.Property
 
 
 abstract class IntegrationTestExtension {
-    abstract val usesJavadocCodeSnippets: Property<Boolean>
+    /**
+     * If enabled, there will be a `GenerateAutoTestedSamplesTestTask` task
+     * that generates a subclass of `AbstractAutoTestedSamplesTest` to
+     * test all snippets embedded in javadoc with `class='autoTested'`.
+     */
+    abstract val generateDefaultAutoTestedSamplesTest: Property<Boolean>
     abstract val testJvmXmx: Property<String>
 }
diff --git a/build-logic/integration-testing/src/main/kotlin/gradlebuild/integrationtests/shared-configuration.kt b/build-logic/integration-testing/src/main/kotlin/gradlebuild/integrationtests/shared-configuration.kt
index ed64e0c1fd6..7921c94910a 100644
--- a/build-logic/integration-testing/src/main/kotlin/gradlebuild/integrationtests/shared-configuration.kt
+++ b/build-logic/integration-testing/src/main/kotlin/gradlebuild/integrationtests/shared-configuration.kt
@@ -26,6 +26,7 @@ import gradlebuild.basics.testSplitOnlyTestGradleVersion
 import gradlebuild.basics.testing.TestType
 import gradlebuild.integrationtests.extension.IntegrationTestExtension
 import gradlebuild.integrationtests.tasks.DistributionTest
+import gradlebuild.integrationtests.tasks.GenerateAutoTestedSamplesTestTask
 import gradlebuild.integrationtests.tasks.IntegrationTest
 import gradlebuild.modules.extension.ExternalModulesExtension
 import gradlebuild.testing.services.BuildBucketProvider
@@ -36,15 +37,14 @@ import org.gradle.api.attributes.Category
 import org.gradle.api.attributes.LibraryElements
 import org.gradle.api.attributes.Usage
 import org.gradle.api.file.ConfigurableFileCollection
-import org.gradle.api.file.Directory
 import org.gradle.api.tasks.GroovySourceDirectorySet
-import org.gradle.api.tasks.InputDirectory
 import org.gradle.api.tasks.InputFiles
 import org.gradle.api.tasks.PathSensitive
 import org.gradle.api.tasks.PathSensitivity
 import org.gradle.api.tasks.SourceSet
 import org.gradle.api.tasks.SourceSetContainer
 import org.gradle.api.tasks.TaskProvider
+import org.gradle.api.tasks.compile.GroovyCompile
 import org.gradle.kotlin.dsl.*
 import org.gradle.plugins.ide.idea.IdeaPlugin
 import org.gradle.process.CommandLineArgumentProvider
@@ -107,19 +107,34 @@ fun Project.addDependenciesAndConfigurations(prefix: String) {
 
 @Suppress("UnusedPrivateProperty")
 internal
-fun Project.addSourceSet(testType: TestType): SourceSet {
+fun Project.createGenerateAutoTestedSamplesTestTask(sourceSet: SourceSet, testType: TestType) {
     val prefix = testType.prefix
     val sourceSets = the<SourceSetContainer>()
     val main by sourceSets.getting
-    return sourceSets.create("${prefix}Test")
+    val sourceSet = sourceSets.getByName("${prefix}Test")
+
+    val groovySourceDir = sourceSet.extensions.findByType<GroovySourceDirectorySet>()
+    // The task generate test class in Groovy, so it cannot be used if the project doesn't use Groovy for integration tests.
+    // This is the case for kotlin-dsl integration tests.
+    if (testType == TestType.INTEGRATION && groovySourceDir != null) {
+        val autoTestedSamplesTest = tasks.register<GenerateAutoTestedSamplesTestTask>("generateAutoTestedSamplesTest") {
+            mainSources.from(main.java)
+            generateAutoTestedSamplesTest.set(project.the<IntegrationTestExtension>().generateDefaultAutoTestedSamplesTest)
+        }
+
+        tasks.named<GroovyCompile>("compileIntegTestGroovy").configure {
+            source(autoTestedSamplesTest.map { it.outputDir })
+        }
+    }
 }
 
 
 internal
 fun Project.createTasks(sourceSet: SourceSet, testType: TestType) {
+    createGenerateAutoTestedSamplesTestTask(sourceSet, testType)
+
     val prefix = testType.prefix
     val defaultExecuter = "embedded"
-
     // For all the other executers, add an executer specific task
     testType.executers.forEach { executer ->
         val taskName = "$executer${prefix.capitalize()}Test"
@@ -156,12 +171,6 @@ abstract class AgentsClasspathProvider : CommandLineArgumentProvider {
 }
 
 
-internal
-class SamplesBaseDirPropertyProvider(@InputDirectory @PathSensitive(PathSensitivity.RELATIVE) val autoTestedSamplesDir: Directory) : CommandLineArgumentProvider {
-    override fun asArguments() = listOf("-DdeclaredSampleInputs=${autoTestedSamplesDir.asFile.absolutePath}")
-}
-
-
 internal
 fun Project.createTestTask(name: String, executer: String, sourceSet: SourceSet, testType: TestType, extraConfig: Action<IntegrationTest>): TaskProvider<IntegrationTest> =
     tasks.register<IntegrationTest>(name) {
@@ -173,9 +182,8 @@ fun Project.createTestTask(name: String, executer: String, sourceSet: SourceSet,
         testClassesDirs = sourceSet.output.classesDirs
         classpath = sourceSet.runtimeClasspath
         extraConfig.execute(this)
-        if (integTest.usesJavadocCodeSnippets.get()) {
-            val samplesDir = layout.projectDirectory.dir("src/main")
-            jvmArgumentProviders.add(SamplesBaseDirPropertyProvider(samplesDir))
+        if (!integTest.generateDefaultAutoTestedSamplesTest.get()) {
+            inputs.dir(layout.projectDirectory.dir("src/main")).withPathSensitivity(PathSensitivity.RELATIVE)
         }
         setUpAgentIfNeeded(testType, executer)
     }
diff --git a/build-logic/integration-testing/src/main/kotlin/gradlebuild/integrationtests/tasks/GenerateAutoTestedSamplesTestTask.kt b/build-logic/integration-testing/src/main/kotlin/gradlebuild/integrationtests/tasks/GenerateAutoTestedSamplesTestTask.kt
new file mode 100644
index 00000000000..509dd898093
--- /dev/null
+++ b/build-logic/integration-testing/src/main/kotlin/gradlebuild/integrationtests/tasks/GenerateAutoTestedSamplesTestTask.kt
@@ -0,0 +1,108 @@
+/*
+ * Copyright 2025 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package gradlebuild.integrationtests.tasks
+
+import org.gradle.api.DefaultTask
+import org.gradle.api.file.ConfigurableFileCollection
+import org.gradle.api.file.DirectoryProperty
+import org.gradle.api.file.FileTreeElement
+import org.gradle.api.internal.file.FileOperations
+import org.gradle.api.provider.Property
+import org.gradle.api.tasks.CacheableTask
+import org.gradle.api.tasks.Input
+import org.gradle.api.tasks.InputFiles
+import org.gradle.api.tasks.Internal
+import org.gradle.api.tasks.OutputDirectory
+import org.gradle.api.tasks.PathSensitive
+import org.gradle.api.tasks.PathSensitivity
+import org.gradle.api.tasks.TaskAction
+import java.util.regex.Pattern
+import javax.inject.Inject
+
+/**
+ * This task scans the main source set and findd samples in javadoc with `class='autoTested'`,
+ * then generates a subclass of AbstractAutoTestedSamplesTest for each class including samples and adds them to the integTest.
+ *
+ * For example, we have two classes ABC.java and XYZ.groovy that include `class='autoTested'`,
+ * there will be two files generated: `ABCAutoTestedSamplesTest.groovy` and `XYZAutoTestedSamplesTest.groovy`
+ */
+@CacheableTask
+abstract class GenerateAutoTestedSamplesTestTask @Inject constructor(@Internal val fileOperations: FileOperations) : DefaultTask() {
+    private
+    val sampleStart = Pattern.compile("""<pre class=['"]autoTested(.*?)['"].*?>""")
+
+    @get:InputFiles
+    @get:PathSensitive(PathSensitivity.RELATIVE)
+    abstract val mainSources: ConfigurableFileCollection
+
+    @get:Input
+    abstract val generateAutoTestedSamplesTest: Property<Boolean>
+
+    @get:OutputDirectory
+    abstract val outputDir: DirectoryProperty
+
+    init {
+        outputDir.convention(project.layout.buildDirectory.dir("generated/sources/autoTested/groovy"))
+    }
+
+    @TaskAction
+    fun generate() {
+        fileOperations.delete(outputDir.get().asFile)
+
+        if (generateAutoTestedSamplesTest.get()) {
+            mainSources.asFileTree.matching {
+                include("**/*.java")
+                include("**/*.groovy")
+            }.visit {
+                if (!isDirectory) {
+                    generateForFile(this)
+                }
+            }
+        }
+    }
+
+    private fun generateForFile(file: FileTreeElement) {
+        val fileContent = file.file.readText()
+        val relativePath = file.relativePath.toString()
+        require(!fileContent.contains("'''")) {
+            "The class with class='autoTested' can't contains triple quotes: $relativePath"
+        }
+        if (!sampleStart.matcher(fileContent).find()) {
+            return
+        }
+        val className = relativePath.substringAfterLast("/").toString().replace(".groovy", "AutoTestedSamplesTest").replace(".java", "AutoTestedSamplesTest")
+        val targetFilePath = "${relativePath.substringBeforeLast("/")}/${className}.groovy"
+        val targetFile = outputDir.file(targetFilePath).get().asFile
+        targetFile.parentFile.mkdirs()
+        targetFile.writeText(
+            """
+package org.gradle.samples
+import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
+import org.junit.Test
+
+class ${className} extends AbstractAutoTestedSamplesTest {
+    private static final String FILE_CONTENT = '''
+        ${fileContent}
+    '''
+    @Test
+    void runSamples() {
+        runSamplesFromFile(new File('${file.file.absoluteFile}'), FILE_CONTENT)
+    }
+}
+"""
+        )
+    }
+}
diff --git a/build-logic/jvm/src/main/kotlin/gradlebuild.jvm-compile.gradle.kts b/build-logic/jvm/src/main/kotlin/gradlebuild.jvm-compile.gradle.kts
new file mode 100644
index 00000000000..51a1eb2f07c
--- /dev/null
+++ b/build-logic/jvm/src/main/kotlin/gradlebuild.jvm-compile.gradle.kts
@@ -0,0 +1,39 @@
+import gradlebuild.jvm.JvmCompileExtension
+
+/*
+ * Copyright 2018 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+plugins {
+    id("java-base")
+}
+
+// Creates the `jvmCompile` extension, which is a container for JvmCompilation instances.
+// JvmCompilation instances control the way each source set is compiled -- most importantly,
+// it controls the JVM version of the compilation. This allows each source set within a project
+// to compile to different JVM versions.
+
+val jvmCompile = extensions.create<JvmCompileExtension>(JvmCompileExtension.NAME)
+
+jvmCompile.compilations.configureEach {
+    // Assume the compilation does not use any workarounds
+    usesJdkInternals = false
+    usesFutureStdlib = false
+
+    // All compilations must have a target JVM version configured explicitly.
+    targetJvmVersion = provider {
+        throw RuntimeException("Target JVM version for $name has not been configured")
+    }
+}
diff --git a/build-logic/jvm/src/main/kotlin/gradlebuild.unittest-and-compile.gradle.kts b/build-logic/jvm/src/main/kotlin/gradlebuild.unittest-and-compile.gradle.kts
index 713ccfca961..aa8e25e08e1 100644
--- a/build-logic/jvm/src/main/kotlin/gradlebuild.unittest-and-compile.gradle.kts
+++ b/build-logic/jvm/src/main/kotlin/gradlebuild.unittest-and-compile.gradle.kts
@@ -38,12 +38,10 @@ import gradlebuild.basics.testing.includeSpockAnnotation
 import gradlebuild.filterEnvironmentVariables
 import gradlebuild.identity.extension.GradleModuleExtension
 import gradlebuild.identity.extension.ModuleTargetRuntimes
+import gradlebuild.jvm.JvmCompileExtension
 import gradlebuild.jvm.argumentproviders.CiEnvironmentProvider
-import gradlebuild.jvm.extension.UnitTestAndCompileExtension
 import org.gradle.internal.jvm.JpmsConfiguration
 import org.gradle.internal.os.OperatingSystem
-import org.jetbrains.kotlin.gradle.dsl.JvmTarget
-import org.jetbrains.kotlin.gradle.dsl.jvm.JvmTargetValidationMode
 import org.jetbrains.kotlin.gradle.tasks.KotlinCompile
 import java.time.Duration
 import java.util.Optional
@@ -53,29 +51,29 @@ plugins {
     idea // Need to apply the idea plugin, so the extended configuration is taken into account on sync
     id("gradlebuild.module-jar")
     id("gradlebuild.dependency-modules")
+    id("gradlebuild.jvm-compile")
 }
 
-val gradleModule = the<GradleModuleExtension>()
-
-// Create an extension that allows projects to configure the way they are compiled and tested.
-//
-// Projects may describe whether they are using any "workarounds" like:
-// - Using JDK internal classes
-// - Using Java standard library APIs that were introduced after the JVM version they are targeting
-// - Using dependencies that target a higher JVM version than the project's target JVM version
-//
-// All of these workarounds should be generally avoided, but, with this data we can configure the
-// compile tasks to permit some of these requirements.
-val jvmCompile = extensions.create<UnitTestAndCompileExtension>(UnitTestAndCompileExtension.NAME).apply {
-    // And assume it does not use any workarounds
-    usesJdkInternals = false
-    usesFutureStdlib = false
-
-    // By default, use the target runtimes of the module to determine the java version
-    targetJvmVersion = gradleModule.targetRuntimes.computeProductionJvmTargetVersion()
+tasks.withType<JavaCompile>().configureEach {
+    options.release = provider {
+        throw GradleException("This task '${name}' is not associated with a compilation. Associate it with a compilation on the '${JvmCompileExtension.NAME}' extension.")
+    }
 }
 
-enforceCompatibility(jvmCompile)
+val gradleModule = the<GradleModuleExtension>()
+the<JvmCompileExtension>().apply {
+    compilations {
+        configureEach {
+            // Everything compiles to Java 17 by default
+            targetJvmVersion = 17
+        }
+    }
+    addCompilationFrom(sourceSets.main) {
+        // For the production code, we derive the JVM version from the target runtime
+        targetJvmVersion = gradleModule.targetRuntimes.computeProductionJvmTargetVersion()
+    }
+    addCompilationFrom(sourceSets.test)
+}
 
 removeTeamcityTempProperty()
 addDependencies()
@@ -97,32 +95,6 @@ fun configureCompileDefaults() {
     }
 }
 
-/**
- * Given the user-configured values in the extension, configure the compilation tasks
- * to enforce compatibility with the target JVM version.
- *
- * We try to use the toolchain configured in [configureDefaultToolchain] as much as possible,
- * but in some cases, we need to use another toolchain.
- *
- * In some cases, we need to set the source and target compatibility flags instead of using
- * the release flag. This is because the release flag limits us from using internal APIs or
- * APIs defined by a Java version higher than the target version.
- *
- * Finally, Groovy does not support the release flag at all. We manually set a toolchain
- * for Groovy to ensure it compiles against the correct classes.
- */
-private
-fun enforceCompatibility(jvmCompile: UnitTestAndCompileExtension) {
-    // When using the release flag, compiled code cannot access JDK internal classes or standard library
-    // APIs defined in future versions of Java. If either of these cases are true, we do not use the
-    // release flag, but instead set the source and target compatibility flags.
-    val useRelease = jvmCompile.usesJdkInternals.zip(jvmCompile.usesFutureStdlib) { internals, futureApis -> !internals && !futureApis }
-
-    enforceJavaCompatibility(jvmCompile.targetJvmVersion, useRelease)
-    enforceGroovyCompatibility(jvmCompile.targetJvmVersion)
-    enforceKotlinCompatibility(jvmCompile.targetJvmVersion, useRelease)
-}
-
 /**
  * Given the declared target platforms of a given Gradle module, determine
  * the JVM version that the production code should target.
@@ -136,74 +108,16 @@ fun ModuleTargetRuntimes.computeProductionJvmTargetVersion(): Provider<Int> {
     )
 
     return reduceBooleanFlagValues(targetRuntimeJavaVersions, ::minOf).orElse(provider {
-        throw GradleException("No target JVM version configured. Specify a runtime target for $project on ${UnitTestAndCompileExtension::class.java.simpleName} for $project")
+        throw GradleException("No target JVM version configured. Specify at least one runtime target for $project on the '${GradleModuleExtension.NAME}' extension.")
     })
 }
 
-fun enforceJavaCompatibility(targetVersion: Provider<Int>, useRelease: Provider<Boolean>) {
-    tasks.withType<JavaCompile>().configureEach {
-        // Set the release flag is requested.
-        // Otherwise, we set the source and target compatibility in the afterEvaluate below.
-        options.release = useRelease.zip(targetVersion) { doUseRelease, target -> if (doUseRelease) { target } else { null } }
-    }
-
-    // Need to use afterEvaluate since source/target compatibility are not lazy
-    project.afterEvaluate {
-        tasks.withType<JavaCompile>().configureEach {
-            if (!useRelease.get()) {
-                val version = targetVersion.get().toString()
-                sourceCompatibility = version
-                targetCompatibility = version
-            }
-        }
-    }
-}
-
-fun enforceGroovyCompatibility(targetVersion: Provider<Int>) {
-    tasks.withType<GroovyCompile>().configureEach {
-        // Groovy does not support the release flag. We must compile with the same
-        // JDK we are targeting in order to see the correct standard lib classes
-        // during compilation
-        javaLauncher = javaToolchains.launcherFor {
-            languageVersion = targetVersion.map { JavaLanguageVersion.of(it) }
-        }
-    }
-
-    // Need to use afterEvaluate since source/target Compatibility are not lazy
-    project.afterEvaluate {
-        tasks.withType<GroovyCompile>().configureEach {
-            val version = targetVersion.get().toString()
-            sourceCompatibility = version
-            targetCompatibility = version
-        }
-    }
-}
-
-fun enforceKotlinCompatibility(targetVersion: Provider<Int>, useRelease: Provider<Boolean>) {
-    tasks.withType<KotlinCompile>().configureEach {
-        jvmTargetValidationMode.set(JvmTargetValidationMode.ERROR)
-        compilerOptions {
-            jvmTarget = targetVersion.map {
-                JvmTarget.fromTarget(if (it < 9) "1.${it}" else it.toString())
-            }
-
-            // TODO KT-49746: Use the DSL to set the release version
-            freeCompilerArgs.addAll(useRelease.zip(jvmTarget) { doUseRelease, targetVersion ->
-                if (doUseRelease) {
-                    listOf("-Xjdk-release=${targetVersion.target}")
-                } else {
-                    listOf()
-                }
-            })
-        }
-    }
-}
-
 fun configureSourcesVariant() {
     java {
         withSourcesJar()
     }
 
+    // TODO: This should not be necessary anymore now that we have variant reselection.
     @Suppress("UnusedPrivateProperty")
     val transitiveSourcesElements by configurations.creating {
         isCanBeResolved = false
@@ -275,7 +189,7 @@ fun addCompileAllTasks() {
     tasks.register("compileAll") {
         description = "Compile all source code, including main, test, integTest, crossVersionTest, testFixtures, etc."
         val compileTasks = project.tasks.matching {
-            it is JavaCompile || it is GroovyCompile
+            it is JavaCompile || it is GroovyCompile || it is KotlinCompile
         }
         dependsOn(compileTasks)
     }
@@ -284,7 +198,7 @@ fun addCompileAllTasks() {
         description = "Compile all production source code, usually only main and testFixtures."
         val compileTasks = project.tasks.matching {
             // Currently, we compile everything since the Groovy compiler is not deterministic enough.
-            (it is JavaCompile || it is GroovyCompile)
+            (it is JavaCompile || it is GroovyCompile || it is KotlinCompile)
         }
         dependsOn(compileTasks)
     }
diff --git a/build-logic/jvm/src/main/kotlin/gradlebuild/jvm/JvmCompilation.kt b/build-logic/jvm/src/main/kotlin/gradlebuild/jvm/JvmCompilation.kt
new file mode 100644
index 00000000000..f57342865fb
--- /dev/null
+++ b/build-logic/jvm/src/main/kotlin/gradlebuild/jvm/JvmCompilation.kt
@@ -0,0 +1,147 @@
+/*
+ * Copyright 2025 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package gradlebuild.jvm
+
+import org.gradle.api.Project
+import org.gradle.api.plugins.GroovyBasePlugin
+import org.gradle.api.provider.Property
+import org.gradle.api.provider.Provider
+import org.gradle.api.tasks.SourceSet
+import org.gradle.api.tasks.TaskProvider
+import org.gradle.api.tasks.compile.GroovyCompile
+import org.gradle.api.tasks.compile.JavaCompile
+import org.gradle.jvm.toolchain.JavaLanguageVersion
+import org.gradle.jvm.toolchain.JavaToolchainService
+import org.gradle.kotlin.dsl.*
+import org.jetbrains.kotlin.gradle.dsl.JvmTarget
+import org.jetbrains.kotlin.gradle.dsl.jvm.JvmTargetValidationMode
+import org.jetbrains.kotlin.gradle.tasks.KotlinCompile
+
+/**
+ * Encapsulates the configuration for the compilation of a source set, including:
+ * - The target JVM version
+ * - Workarounds which may affect the way the compilation is performed
+ *
+ * The compilation workarounds include:
+ * - Using JDK internal classes
+ * - Using Java standard library APIs that were introduced after the JVM version they are targeting
+ *
+ * All of these workarounds should be generally avoided, but, with this data we can configure the
+ * compile tasks to permit some of these requirements.
+ */
+abstract class JvmCompilation {
+
+    abstract val name: String
+
+    /**
+     * Set this flag to true if the compilation compiles against JDK internal classes.
+     *
+     * This workaround should be used sparingly.
+     */
+    abstract val usesJdkInternals: Property<Boolean>
+
+    /**
+     * Set this flag to true if the compilation compiles against Java standard library APIs
+     * that were introduced after [targetJvmVersion].
+     *
+     * This workaround should be used sparingly.
+     */
+    abstract val usesFutureStdlib: Property<Boolean>
+
+    /**
+     * The JVM version that all JVM code in this compilation will target.
+     */
+    abstract val targetJvmVersion: Property<Int>
+
+    fun Project.from(sourceSet: SourceSet) {
+        associate(tasks.named<JavaCompile>(sourceSet.getCompileTaskName("java")))
+        plugins.withType<GroovyBasePlugin>() {
+            associate(tasks.named<GroovyCompile>(sourceSet.getCompileTaskName("groovy")))
+        }
+        plugins.withId("org.jetbrains.kotlin.jvm") {
+            associate(tasks.named<KotlinCompile>(sourceSet.getCompileTaskName("kotlin")))
+        }
+    }
+
+    @JvmName("associateJava")
+    fun Project.associate(javaCompile: TaskProvider<JavaCompile>) {
+        javaCompile.configure {
+            // Set the release flag if requested.
+            // Otherwise, we set the source and target compatibility in the afterEvaluate below.
+            options.release = useRelease().zip(targetJvmVersion) { doUseRelease, target -> if (doUseRelease) { target } else { null } }
+        }
+
+        // Need to use afterEvaluate since source/target compatibility are not lazy
+        afterEvaluate {
+            tasks.withType<JavaCompile>().configureEach {
+                if (!useRelease().get()) {
+                    val version = targetJvmVersion.get().toString()
+                    sourceCompatibility = version
+                    targetCompatibility = version
+                }
+            }
+        }
+    }
+
+    @JvmName("associateGroovy")
+    fun Project.associate(groovyCompile: TaskProvider<GroovyCompile>) {
+        groovyCompile.configure {
+            val javaToolchains = project.the<JavaToolchainService>()
+            // Groovy does not support the release flag. We must compile with the same
+            // JDK we are targeting in order to see the correct standard lib classes
+            // during compilation
+            javaLauncher = javaToolchains.launcherFor {
+                languageVersion = targetJvmVersion.map { JavaLanguageVersion.of(it) }
+            }
+        }
+
+        // Need to use afterEvaluate since source/target Compatibility are not lazy
+        afterEvaluate {
+            groovyCompile.configure {
+                val version = targetJvmVersion.get().toString()
+                sourceCompatibility = version
+                targetCompatibility = version
+            }
+        }
+    }
+
+    @JvmName("associateKotlin")
+    fun associate(kotlinCompile: TaskProvider<KotlinCompile>) {
+        kotlinCompile.configure {
+            jvmTargetValidationMode.set(JvmTargetValidationMode.ERROR)
+            compilerOptions {
+                jvmTarget = targetJvmVersion.map {
+                    JvmTarget.fromTarget(if (it < 9) "1.${it}" else it.toString())
+                }
+
+                // TODO KT-49746: Use the DSL to set the release version
+                freeCompilerArgs.addAll(useRelease().zip(jvmTarget) { doUseRelease, targetVersion ->
+                    if (doUseRelease) {
+                        listOf("-Xjdk-release=${targetVersion.target}")
+                    } else {
+                        listOf()
+                    }
+                })
+            }
+        }
+    }
+
+    private fun useRelease(): Provider<Boolean> {
+        return usesJdkInternals.zip(usesFutureStdlib) { internals, futureApis -> !internals && !futureApis }
+    }
+
+}
diff --git a/build-logic/jvm/src/main/kotlin/gradlebuild/jvm/JvmCompileExtension.kt b/build-logic/jvm/src/main/kotlin/gradlebuild/jvm/JvmCompileExtension.kt
new file mode 100644
index 00000000000..4f835257e6e
--- /dev/null
+++ b/build-logic/jvm/src/main/kotlin/gradlebuild/jvm/JvmCompileExtension.kt
@@ -0,0 +1,58 @@
+/*
+ * Copyright 2025 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package gradlebuild.jvm
+
+import org.gradle.api.NamedDomainObjectContainer
+import org.gradle.api.NamedDomainObjectProvider
+import org.gradle.api.Project
+import org.gradle.api.tasks.SourceSet
+
+/**
+ * A container of [JvmCompilation]s for a JVM project.
+ *
+ * Utility methods are provided to add compilations based on existing [SourceSet]s.
+ */
+abstract class JvmCompileExtension {
+
+    companion object {
+        const val NAME: String = "jvmCompile"
+    }
+
+    abstract val compilations: NamedDomainObjectContainer<JvmCompilation>
+
+    fun Project.addCompilationFrom(sourceSet: NamedDomainObjectProvider<SourceSet>): JvmCompilation {
+        return addCompilationFrom(sourceSet.get())
+    }
+
+    fun Project.addCompilationFrom(sourceSet: NamedDomainObjectProvider<SourceSet>, configure: JvmCompilation.() -> Unit): JvmCompilation {
+        return addCompilationFrom(sourceSet.get(), configure)
+    }
+
+    fun Project.addCompilationFrom(sourceSet: SourceSet): JvmCompilation {
+        return compilations.create(sourceSet.name) {
+            from(sourceSet)
+        }
+    }
+
+    fun Project.addCompilationFrom(sourceSet: SourceSet, configure: JvmCompilation.() -> Unit): JvmCompilation {
+        return compilations.create(sourceSet.name) {
+            from(sourceSet)
+            configure()
+        }
+    }
+
+}
diff --git a/build-logic/jvm/src/main/kotlin/gradlebuild/jvm/extension/UnitTestAndCompileExtension.kt b/build-logic/jvm/src/main/kotlin/gradlebuild/jvm/extension/UnitTestAndCompileExtension.kt
deleted file mode 100644
index 6fb3cd8c4f2..00000000000
--- a/build-logic/jvm/src/main/kotlin/gradlebuild/jvm/extension/UnitTestAndCompileExtension.kt
+++ /dev/null
@@ -1,51 +0,0 @@
-/*
- * Copyright 2020 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package gradlebuild.jvm.extension
-
-import org.gradle.api.provider.Property
-
-/**
- * An extension intended for configuring the manner in which a project is
- * compiled and tested.
- */
-abstract class UnitTestAndCompileExtension {
-
-    companion object {
-        const val NAME: String = "jvmCompile"
-    }
-
-    /**
-     * Set this flag to true if the project compiles against JDK internal classes.
-     *
-     * This workaround should be used sparingly.
-     */
-    abstract val usesJdkInternals: Property<Boolean>
-
-    /**
-     * Set this flag to true if the project compiles against Java standard library APIs
-     * that were introduced after the target JVM bytecode version of the project.
-     *
-     * This workaround should be used sparingly.
-     */
-    abstract val usesFutureStdlib: Property<Boolean>
-
-    /**
-     * The JVM version that all JVM code in this module will target.
-     */
-    abstract val targetJvmVersion: Property<Int>
-
-}
diff --git a/build-logic/performance-testing/build.gradle.kts b/build-logic/performance-testing/build.gradle.kts
index 0b01a472af7..eb382b52aca 100644
--- a/build-logic/performance-testing/build.gradle.kts
+++ b/build-logic/performance-testing/build.gradle.kts
@@ -9,9 +9,10 @@ dependencies {
     implementation("gradlebuild:basics")
     implementation("gradlebuild:module-identity")
 
-    implementation(projects.integrationTesting)
     implementation(projects.cleanup)
     implementation(projects.buildUpdateUtils)
+    implementation(projects.integrationTesting)
+    implementation(projects.jvm)
 
     implementation("com.google.guava:guava")
     implementation("com.google.code.gson:gson")
diff --git a/build-logic/performance-testing/src/main/kotlin/gradlebuild/performance/PerformanceTestPlugin.kt b/build-logic/performance-testing/src/main/kotlin/gradlebuild/performance/PerformanceTestPlugin.kt
index 598445c1379..7db1fbebef5 100644
--- a/build-logic/performance-testing/src/main/kotlin/gradlebuild/performance/PerformanceTestPlugin.kt
+++ b/build-logic/performance-testing/src/main/kotlin/gradlebuild/performance/PerformanceTestPlugin.kt
@@ -48,6 +48,7 @@ import gradlebuild.performance.tasks.DetermineBaselines
 import gradlebuild.performance.tasks.PerformanceTest
 import gradlebuild.performance.tasks.PerformanceTestReport
 import gradlebuild.integrationtests.ide.DEFAULT_ANDROID_STUDIO_VERSION
+import gradlebuild.jvm.JvmCompileExtension
 import org.gradle.api.Action
 import org.gradle.api.Plugin
 import org.gradle.api.Project
@@ -103,6 +104,10 @@ class PerformanceTestPlugin : Plugin<Project> {
         createAndWireCommitDistributionTask(performanceTestExtension)
         createAdditionalTasks(performanceTestSourceSet)
         configureIdePlugins(performanceTestSourceSet)
+
+        the<JvmCompileExtension>().apply {
+            addCompilationFrom(performanceTestSourceSet)
+        }
     }
 
     private
diff --git a/build-logic/profiling/build.gradle.kts b/build-logic/profiling/build.gradle.kts
index 0444a50e681..1dc18235b4c 100644
--- a/build-logic/profiling/build.gradle.kts
+++ b/build-logic/profiling/build.gradle.kts
@@ -11,6 +11,7 @@ dependencies {
     implementation("gradlebuild:module-identity")
 
     implementation(projects.documentation)
+    implementation(projects.jvm)
 
     implementation("me.champeau.jmh:jmh-gradle-plugin")
 }
diff --git a/build-logic/profiling/src/main/kotlin/gradlebuild.jmh.gradle.kts b/build-logic/profiling/src/main/kotlin/gradlebuild.jmh.gradle.kts
index 3e60140c1ad..0af67e5f5ae 100644
--- a/build-logic/profiling/src/main/kotlin/gradlebuild.jmh.gradle.kts
+++ b/build-logic/profiling/src/main/kotlin/gradlebuild.jmh.gradle.kts
@@ -17,6 +17,13 @@ import gradlebuild.jmh.tasks.JmhHTMLReport
 
 plugins {
     id("me.champeau.jmh")
+    id("gradlebuild.jvm-compile")
+}
+
+jvmCompile {
+    addCompilationFrom(sourceSets.jmh) {
+        associate(tasks.jmhCompileGeneratedClasses)
+    }
 }
 
 configurations {
diff --git a/build-logic/uber-plugins/src/main/kotlin/gradlebuild.internal.java.gradle.kts b/build-logic/uber-plugins/src/main/kotlin/gradlebuild.internal.java.gradle.kts
index 6a037d88290..1f8d926700c 100644
--- a/build-logic/uber-plugins/src/main/kotlin/gradlebuild.internal.java.gradle.kts
+++ b/build-logic/uber-plugins/src/main/kotlin/gradlebuild.internal.java.gradle.kts
@@ -19,5 +19,9 @@ plugins {
 }
 
 jvmCompile {
-    targetJvmVersion = 8
+    compilations {
+        named("main") {
+            targetJvmVersion = 17
+        }
+    }
 }
diff --git a/build-logic/uber-plugins/src/main/kotlin/gradlebuild.internal.kotlin.gradle.kts b/build-logic/uber-plugins/src/main/kotlin/gradlebuild.internal.kotlin.gradle.kts
index 15b04b2bf1b..79c964e314d 100644
--- a/build-logic/uber-plugins/src/main/kotlin/gradlebuild.internal.kotlin.gradle.kts
+++ b/build-logic/uber-plugins/src/main/kotlin/gradlebuild.internal.kotlin.gradle.kts
@@ -19,5 +19,9 @@ plugins {
 }
 
 jvmCompile {
-    targetJvmVersion = 8
+    compilations {
+        named("main") {
+            targetJvmVersion = 17
+        }
+    }
 }
diff --git a/gradle/dependency-management/kotlin-versions.properties b/gradle/dependency-management/kotlin-versions.properties
index bd491b8263f..b3a72ae2120 100644
--- a/gradle/dependency-management/kotlin-versions.properties
+++ b/gradle/dependency-management/kotlin-versions.properties
@@ -1,2 +1,2 @@
 # Generated - Update by running `./gradlew updateKotlinVersions`
-latests=2.0.0,2.0.21,2.1.0,2.1.21,2.2.0-RC2
+latests=2.0.0,2.0.21,2.1.0,2.1.21,2.2.0
diff --git a/platforms/core-configuration/base-diagnostics/build.gradle.kts b/platforms/core-configuration/base-diagnostics/build.gradle.kts
index bc71fe51e96..4e894a9841a 100644
--- a/platforms/core-configuration/base-diagnostics/build.gradle.kts
+++ b/platforms/core-configuration/base-diagnostics/build.gradle.kts
@@ -29,7 +29,6 @@ dependencies {
     implementation(projects.concurrent)
     implementation(projects.functional)
     implementation(projects.loggingApi)
-    implementation(projects.serviceLookup)
 
     implementation(libs.commonsLang)
     implementation(libs.guava)
diff --git a/platforms/core-configuration/base-diagnostics/src/main/java/org/gradle/api/reporting/model/ModelReport.java b/platforms/core-configuration/base-diagnostics/src/main/java/org/gradle/api/reporting/model/ModelReport.java
index 38063ae5e63..e295d69d548 100644
--- a/platforms/core-configuration/base-diagnostics/src/main/java/org/gradle/api/reporting/model/ModelReport.java
+++ b/platforms/core-configuration/base-diagnostics/src/main/java/org/gradle/api/reporting/model/ModelReport.java
@@ -17,9 +17,7 @@
 package org.gradle.api.reporting.model;
 
 import org.gradle.api.DefaultTask;
-import org.gradle.api.internal.ConfigurationCacheDegradationController;
 import org.gradle.api.internal.project.ProjectInternal;
-import org.gradle.api.internal.provider.Providers;
 import org.gradle.api.reporting.model.internal.ModelNodeRenderer;
 import org.gradle.api.reporting.model.internal.TextModelReportRenderer;
 import org.gradle.api.tasks.Console;
@@ -37,6 +35,8 @@
 import javax.inject.Inject;
 import java.util.Locale;
 
+import static org.gradle.api.internal.ConfigurationCacheDegradation.requireDegradation;
+
 /**
  * Displays some details about the configuration model of the project.
  * An instance of this type is used when you execute the {@code model} task from the command-line.
@@ -62,7 +62,7 @@ public enum Format {
 
     @Inject
     public ModelReport() {
-        getServices().get(ConfigurationCacheDegradationController.class).requireConfigurationCacheDegradation(this, Providers.of("Task is not compatible with the Configuration Cache"));
+        requireDegradation(this, "Task is not compatible with the Configuration Cache");
     }
 
     @Option(option = "showHidden", description = "Show hidden model elements.")
diff --git a/platforms/core-configuration/bean-serialization-services/build.gradle.kts b/platforms/core-configuration/bean-serialization-services/build.gradle.kts
index 2276ac1aaa0..2814ee7a6d8 100644
--- a/platforms/core-configuration/bean-serialization-services/build.gradle.kts
+++ b/platforms/core-configuration/bean-serialization-services/build.gradle.kts
@@ -22,7 +22,11 @@ plugins {
 description = "Configuration Cache services supporting bean serialization"
 
 jvmCompile {
-    usesJdkInternals = true
+    compilations {
+        named("main") {
+            usesJdkInternals = true
+        }
+    }
 }
 
 dependencies {
diff --git a/platforms/core-configuration/configuration-cache/readme.md b/platforms/core-configuration/configuration-cache/readme.md
new file mode 100644
index 00000000000..86598d87819
--- /dev/null
+++ b/platforms/core-configuration/configuration-cache/readme.md
@@ -0,0 +1,109 @@
+# Configuration Cache
+
+## Configuration Cache modes
+
+CC can function in two modes:
+
+- normal mode aka fail-on-problems
+- warning mode aka lenient
+
+Normal mode is how CC functions by default when enabled, ensuring safety and reliability.
+Warning mode is an opt-in adoption and troubleshooting aid, meant to be used only temporarily.
+
+## Problems and build failures
+
+This section gives an overview of how CC problems interact with the build lifecycle,
+when CC checks can result in build failures and how those are reported.
+
+Whenever a problem is reported, it can be
+
+1. **deferred** until the end of the build
+2. **interrupting** the current scope of work
+3. **suppressed** in an incompatible task
+4. **suppressed silently** via graceful degradation
+
+The way each problem is assigned severity depends on the CC mode and the context in which the problem appears.
+See [`ProblemSeverity`](../../../platforms/core-configuration/configuration-problems-base/src/main/kotlin/org/gradle/internal/cc/impl/problems/ProblemSeverity.kt) for details.
+
+All problems, regardless of their severity, are included in the CC report.
+Except silently suppressed problems, all other problems can also appear in the CC summary printed in the console output.
+
+### Deferred problems
+
+Some problems are *deferred* to maximize the number of reported problems,
+providing the user with a more comprehensive overview of what needs fixing before CC can function successfully.
+This approach is similar to how compilers show all possible compilation problems, instead of only the first one encountered.
+
+Most deferrable problems happen during task serialization, when CC writes the work graph to disk.
+When some state referenced by a task is not supported by CC, that problem is reported but not acted on immediately.
+Instead, the serialization proceeds to find potentially more problems with the rest of the task state.
+Similarly, even if such problems were detected in one task, CC proceeds to serialize the rest of the work graph to collect all such problems.
+Examples of unsupported state include platform types like `java.lang.Thread` or Gradle types like `Project`.
+See [`UnsupportedTypesCodecs.kt`](../../../platforms/core-configuration/core-serialization-codecs/src/main/kotlin/org/gradle/internal/serialize/codecs/core/UnsupportedTypesCodecs.kt) for more details.
+
+Many problems that appear during configuration time before CC-store are also deferrable.
+For instance, we detect when user code starts an [external process](../../../subprojects/core/src/main/java/org/gradle/api/internal/ExternalProcessStartedListener.java)
+or uses an [unsupported build listener](https://github.com/gradle/gradle/blob/89da055f53cfe9be784f616abf0dfa0f4a3ef065/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheState.kt#L937-L949).
+
+This list is non-exhaustive, follow the calls to [`ProblemsListener.onProblem()`](https://github.com/gradle/gradle/blob/71e0b98ed84a392933c54a14a817e9609acd0d6f/platforms/core-configuration/configuration-problems-base/src/main/kotlin/org/gradle/internal/configuration/problems/ProblemsListener.kt#L24) to discover the rest.
+
+When deferred problems are present, CC can fail the build in two points in time:
+
+1. After the CC store has completed
+2. After the build has finished
+
+At each of these points, if _any_ deferred problems have been reported,
+we fail the build with an _aggregated build failure_ (see `ConfigurationCacheProblemsException`).
+
+Deferred problems appear in the CC console summary and in the CC report.
+
+### Interrupting problems
+
+Sometimes, it is impossible or unsafe to defer a problem and the current work must be immediately *interrupted*.
+
+Interrupting problems can occur during work graph serialization (CC store) or deserialization (CC load).
+One example is when `java.io.Serializable` throws an exception from `writeReplace()` or `readResolve()`.
+Another is when a concurrency problem results in serializing a collection that is being modified as it is being written to disk.
+In such cases, the CC store or load halts, and we fail the build with `ConfigurationCacheError`.
+The build does not proceed to the execution phase.
+
+There can be CC problems during the execution phase as well, even if store and load were successful.
+For instance, a task action can call forbidden APIs, such as `Task.getProject()`, or
+reach for project state via [script](../../../subprojects/core/src/main/java/org/gradle/groovy/scripts/BasicScript.java) object instance
+(see `BrokenScript` in [GroovyCodecs.kt](../../../platforms/core-configuration/core-serialization-codecs/src/main/kotlin/org/gradle/internal/serialize/codecs/core/GroovyCodecs.kt)).
+On a CC hit, only CC load is performed, so the project state would not have been initialized before such access.
+Therefore, we prevent user logic from working with bad state by interrupting the task.
+Failing the task also ensures that its results will not be cached.
+
+Since an interrupting problem needs to fail the build immediately, each such problem results in a separate build failure.
+However, all such problems are still included in the CC report, because they are caused by the CC constraints.
+They also appear in the CC console summary, but with lower priority than deferred problems.
+
+Note that even if an interrupting problem is present, the end-of-build CC checks are still executed,
+and they still can result in an _aggregated build failure_ if there were any deferred problems.
+However, the aggregated build failure will not be triggered by the interrupting problems alone.
+
+### Suppressed problems
+
+Incompatible tasks are still serialized by CC to capture remaining problems that need fixing before the incompatibility can be resolved.
+These problems are classified as _suppressed_ and never result in build failure.
+
+Suppressed problems appear in the CC console summary and in the CC report.
+
+### Silently suppressed problems
+
+Some Gradle features and tasks provided by the core plugins are not yet compatible with CC.
+Since these are impossible for the user to fix, when their usage is detected, CC gracefully degrates to vintage,
+while the usages are recorded as _silently suppressed_ problems.
+
+These problems don't appear in the CC console summary but appear in the CC report.
+
+### Problems and warning mode
+
+The warning mode or lenient mode alters the way problems are handled by CC.
+All interrupting problems are downgraded to deferred problems,
+and the presence of deferred problems does not result in the _aggregated build failure_.
+
+However, when CC runs in the warning mode, it can result in the
+[`TooManyConfigurationCacheProblemsException`](../../../platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheException.kt)
+build failure, when the number of observed problems crosses a configurable threshold.
diff --git a/platforms/core-configuration/configuration-cache/src/integTest/groovy/org/gradle/internal/cc/impl/ConfigurationCacheProblemReportingIntegrationTest.groovy b/platforms/core-configuration/configuration-cache/src/integTest/groovy/org/gradle/internal/cc/impl/ConfigurationCacheProblemReportingIntegrationTest.groovy
index 6b933c45f65..3acc348fa3d 100644
--- a/platforms/core-configuration/configuration-cache/src/integTest/groovy/org/gradle/internal/cc/impl/ConfigurationCacheProblemReportingIntegrationTest.groovy
+++ b/platforms/core-configuration/configuration-cache/src/integTest/groovy/org/gradle/internal/cc/impl/ConfigurationCacheProblemReportingIntegrationTest.groovy
@@ -367,6 +367,10 @@ class ConfigurationCacheProblemReportingIntegrationTest extends AbstractConfigur
             problemsWithStackTraceCount = 1
         }
 
+        // The interrupting problem cause must not be repeated in the aggregated CC build failure
+        // TODO: introduce a structured failure assert instead of checking all error output: https://github.com/gradle/gradle/issues/33985
+        failure.error.count("Configuration cache state could not be cached: field `prop` of task `:broken` of type `BrokenTaskType`: error writing value of type 'BrokenSerializable'") == 1
+
         when:
         configurationCacheFails WARN_PROBLEMS_CLI_OPT, 'problems', 'broken'
 
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/CachedBuildState.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/CachedBuildState.kt
index a20a0181172..d880ebdbb49 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/CachedBuildState.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/CachedBuildState.kt
@@ -17,6 +17,7 @@
 package org.gradle.internal.cc.impl
 
 import org.gradle.execution.plan.ScheduledWork
+import org.gradle.internal.build.BuildState
 import org.gradle.normalization.internal.InputNormalizationHandlerInternal
 import org.gradle.util.Path
 import java.io.File
@@ -51,8 +52,8 @@ class ProjectWithNoWork(
 ) : CachedProjectState(path, projectDir, buildFile)
 
 
-data class BuildToStore(
-    val build: VintageGradleBuild,
+class BuildToStore(
+    val build: BuildState,
     // Does this build have work scheduled?
     val hasWork: Boolean,
     // Does this build have a child build with work scheduled?
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheBuildTreeIO.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheBuildTreeIO.kt
index e55eb398420..38053656bb7 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheBuildTreeIO.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheBuildTreeIO.kt
@@ -17,6 +17,7 @@
 package org.gradle.internal.cc.impl
 
 import org.gradle.cache.internal.streams.BlockAddress
+import org.gradle.internal.build.BuildState
 import org.gradle.internal.build.BuildStateRegistry
 import org.gradle.internal.buildtree.BuildTreeWorkGraph
 import org.gradle.internal.cc.impl.cacheentry.EntryDetails
@@ -55,7 +56,7 @@ interface ConfigurationCacheBuildTreeIO : ConfigurationCacheOperationIO {
     /**
      * See [ConfigurationCacheState.writeRootBuildState].
      */
-    fun writeRootBuildStateTo(stateFile: ConfigurationCacheStateFile)
+    fun writeRootBuildStateTo(rootBuild: BuildState, stateFile: ConfigurationCacheStateFile)
 
     fun readRootBuildStateFrom(
         stateFile: ConfigurationCacheStateFile,
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheHost.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheHost.kt
index 9859cf5a253..13563bb2b7f 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheHost.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheHost.kt
@@ -16,6 +16,7 @@
 
 package org.gradle.internal.cc.impl
 
+import org.gradle.internal.build.BuildState
 import org.gradle.internal.cc.base.serialize.HostServiceProvider
 import org.gradle.internal.service.scopes.Scope.Build
 import org.gradle.internal.service.scopes.ServiceScope
@@ -24,9 +25,9 @@ import java.io.File
 @ServiceScope(Build::class)
 interface ConfigurationCacheHost : HostServiceProvider {
 
-    val currentBuild: VintageGradleBuild
+    val currentBuild: BuildState
 
     fun createBuild(settingsFile: File?): ConfigurationCacheBuild
 
-    fun visitBuilds(visitor: (VintageGradleBuild) -> Unit)
+    fun visitBuilds(visitor: (BuildState) -> Unit)
 }
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheState.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheState.kt
index 3871c52c3ba..4068b5e5d61 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheState.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/ConfigurationCacheState.kt
@@ -182,13 +182,10 @@ class ConfigurationCacheState(
     private val eventEmitter: BuildOperationProgressEventEmitter,
     private val host: ConfigurationCacheHost
 ) {
-    /**
-     * Writes the state for the whole build starting from the given root [build] and returns the set
-     * of stored included build directories.
-     */
-    suspend fun WriteContext.writeRootBuildState(build: VintageGradleBuild) {
+
+    suspend fun WriteContext.writeRootBuildState(rootBuild: BuildState) {
         writeBuildInvocationId()
-        writeRootBuild(build).also {
+        writeRootBuild(rootBuild).also {
             writeInt(0x1ecac8e)
         }
     }
@@ -282,15 +279,15 @@ class ConfigurationCacheState(
         host.service<BuildState>()
 
     private
-    suspend fun WriteContext.writeRootBuild(rootBuild: VintageGradleBuild) {
-        require(rootBuild.gradle.owner is RootBuildState)
-        val gradle = rootBuild.gradle
+    suspend fun WriteContext.writeRootBuild(rootBuild: BuildState) {
+        require(rootBuild.mutableModel.isRootBuild)
+        val gradle = rootBuild.mutableModel
         withDebugFrame({ "Gradle" }) {
             write(gradle.settings.settingsScript.resource.location.file)
             writeBuildTreeScopedState(gradle)
         }
         val buildEventListeners = buildEventListenersOf(gradle)
-        writeBuildsInTree(rootBuild, buildEventListeners)
+        writeBuildsInTree(buildEventListeners)
     }
 
     private
@@ -303,13 +300,14 @@ class ConfigurationCacheState(
     }
 
     private
-    suspend fun WriteContext.writeBuildsInTree(rootBuild: VintageGradleBuild, buildEventListeners: List<RegisteredBuildServiceProvider<*, *>>) {
+    suspend fun WriteContext.writeBuildsInTree(buildEventListeners: List<RegisteredBuildServiceProvider<*, *>>) {
         val requiredBuildServicesPerBuild = buildEventListeners.groupBy { it.buildIdentifier }
         val builds = mutableMapOf<BuildState, BuildToStore>()
-        host.visitBuilds { build ->
-            val state = build.state
-            builds[state] = BuildToStore(build, build.hasScheduledWork, build.isRootBuild)
-            if (build.hasScheduledWork && state is StandAloneNestedBuild) {
+        host.visitBuilds { state ->
+            val gradle = state.mutableModel
+            val hasScheduledWork = gradle.taskGraph.hasScheduledWork()
+            builds[state] = BuildToStore(state, hasScheduledWork, hasChildren = gradle.isRootBuild)
+            if (hasScheduledWork && state is StandAloneNestedBuild) {
                 // Also require the owner of a buildSrc build
                 builds[state.owner] = builds.getValue(state.owner).hasChildren()
             }
@@ -317,8 +315,7 @@ class ConfigurationCacheState(
         writeCollection(builds.values) { build ->
             writeBuildState(
                 build,
-                StoredBuildTreeState(requiredBuildServicesPerBuild),
-                rootBuild
+                StoredBuildTreeState(requiredBuildServicesPerBuild)
             )
         }
     }
@@ -331,17 +328,17 @@ class ConfigurationCacheState(
     }
 
     private
-    suspend fun WriteContext.writeBuildState(build: BuildToStore, buildTreeState: StoredBuildTreeState, rootBuild: VintageGradleBuild) {
-        val state = build.build.state
+    suspend fun WriteContext.writeBuildState(build: BuildToStore, buildTreeState: StoredBuildTreeState) {
+        val state = build.build
         when {
             !build.hasWork && !build.hasChildren -> {
                 writeEnum(BuildType.BuildWithNoWork)
-                writeBuildWithNoWork(state, rootBuild)
+                writeBuildWithNoWork(state)
             }
 
             state is RootBuildState -> {
                 writeEnum(BuildType.RootBuild)
-                writeBuildContent(build.build, buildTreeState)
+                writeBuildContent(state, buildTreeState)
             }
 
             state is IncludedBuildState -> {
@@ -444,13 +441,13 @@ class ConfigurationCacheState(
     }
 
     private
-    suspend fun WriteContext.writeBuildWithNoWork(state: BuildState, rootBuild: VintageGradleBuild) {
-        withGradleIsolate(rootBuild.gradle, userTypesCodec) {
-            writeString(state.identityPath.path)
-            if (state.isProjectsCreated) {
+    suspend fun WriteContext.writeBuildWithNoWork(buildState: BuildState) {
+        withGradleIsolate(buildState.mutableModel, userTypesCodec) {
+            writeString(buildState.identityPath.path)
+            if (buildState.isProjectsCreated) {
                 writeBoolean(true)
-                writeString(state.projects.rootProject.name)
-                writeCollection(state.projects.allProjects) { project ->
+                writeString(buildState.projects.rootProject.name)
+                writeCollection(buildState.projects.allProjects) { project ->
                     write(ProjectWithNoWork(project.projectPath, project.projectDir, project.mutableModel.buildFile))
                 }
             } else {
@@ -474,17 +471,16 @@ class ConfigurationCacheState(
         }
 
     internal
-    suspend fun WriteContext.writeBuildContent(build: VintageGradleBuild, buildTreeState: StoredBuildTreeState) {
-        val gradle = build.gradle
-        val state = build.state
-        if (state.isProjectsCreated) {
+    suspend fun WriteContext.writeBuildContent(buildState: BuildState, buildTreeState: StoredBuildTreeState) {
+        val gradle = buildState.mutableModel
+        if (buildState.isProjectsCreated) {
             writeBoolean(true)
-            val scheduledWork = build.scheduledWork
+            val scheduledWork = gradle.taskGraph.collectScheduledWork()
             withDebugFrame({ "Gradle" }) {
                 writeGradleState(gradle)
-                val projects = collectProjects(state.projects, scheduledWork.scheduledNodes, gradle.serviceOf())
+                val projects = collectProjects(buildState.projects, scheduledWork.scheduledNodes, gradle.serviceOf())
                 writeProjects(gradle, projects)
-                writeRequiredBuildServicesOf(state, buildTreeState)
+                writeRequiredBuildServicesOf(buildState, buildTreeState)
             }
             withDebugFrame({ "Work Graph" }) {
                 writeWorkGraphOf(gradle, scheduledWork)
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/CrossProjectConfigurationReportingTaskExecutionGraph.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/CrossProjectConfigurationReportingTaskExecutionGraph.kt
index 3bd0f5c7437..f167cfff9b5 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/CrossProjectConfigurationReportingTaskExecutionGraph.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/CrossProjectConfigurationReportingTaskExecutionGraph.kt
@@ -25,7 +25,7 @@ import org.gradle.api.execution.TaskExecutionGraphListener
 import org.gradle.api.internal.project.CrossProjectModelAccess
 import org.gradle.api.internal.project.ProjectInternal
 import org.gradle.execution.plan.FinalizedExecutionPlan
-import org.gradle.execution.plan.Node
+import org.gradle.execution.plan.ScheduledWork
 import org.gradle.execution.taskgraph.TaskExecutionGraphInternal
 import org.gradle.internal.build.ExecutionResult
 import org.gradle.internal.configuration.problems.ProblemFactory
@@ -33,7 +33,6 @@ import org.gradle.internal.configuration.problems.ProblemsListener
 import org.gradle.internal.extensions.stdlib.capitalized
 import org.gradle.util.Path
 import java.util.Objects
-import java.util.function.BiConsumer
 
 
 internal
@@ -69,11 +68,11 @@ class CrossProjectConfigurationReportingTaskExecutionGraph(
         delegate.whenReady(action.wrap())
     }
 
-    override fun findTask(path: String?): Task? {
+    override fun findTask(path: String): Task? {
         return delegate.findTask(path).also { task ->
             if (task == null) {
                 // check whether the path refers to a different project
-                val parentPath = path?.let(Path::path)?.parent?.path
+                val parentPath = Path.path(path).parent?.path
                 if (parentPath != referrerProject.path) {
                     // even though the task was not found, the current project is coupled with the other project:
                     // if the configuration of that project changes, the result of this call might be different
@@ -195,15 +194,15 @@ class CrossProjectConfigurationReportingTaskExecutionGraph(
 
     // region overridden by delegation
 
-    override fun populate(plan: FinalizedExecutionPlan?) {
+    override fun populate(plan: FinalizedExecutionPlan) {
         delegate.populate(plan)
     }
 
-    override fun execute(plan: FinalizedExecutionPlan?): ExecutionResult<Void>? =
+    override fun execute(plan: FinalizedExecutionPlan): ExecutionResult<Void> =
         delegate.execute(plan)
 
-    override fun visitScheduledNodes(visitor: BiConsumer<List<Node>, Set<Node>>) =
-        delegate.visitScheduledNodes(visitor)
+    override fun collectScheduledWork(): ScheduledWork =
+        delegate.collectScheduledWork()
 
     override fun size(): Int = delegate.size()
 
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCache.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCache.kt
index 43456ec8db3..ca71b014640 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCache.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCache.kt
@@ -33,6 +33,7 @@ import org.gradle.configurationcache.withModelStoreOperation
 import org.gradle.configurationcache.withWorkGraphLoadOperation
 import org.gradle.configurationcache.withWorkGraphStoreOperation
 import org.gradle.initialization.GradlePropertiesController
+import org.gradle.internal.build.BuildState
 import org.gradle.internal.build.BuildStateRegistry
 import org.gradle.internal.buildtree.BuildActionModelRequirements
 import org.gradle.internal.buildtree.BuildTreeModelSideEffect
@@ -243,7 +244,8 @@ class DefaultConfigurationCache internal constructor(
         } else {
             runWorkThatContributesToCacheEntry {
                 val finalizedGraph = scheduler(graph)
-                degradeGracefullyOr { saveWorkGraph() }
+                val rootBuild = buildStateRegistry.rootBuild
+                degradeGracefullyOr { saveWorkGraph(rootBuild) }
                 crossConfigurationTimeBarrier()
                 BuildTreeConfigurationCache.WorkGraphResult(
                     finalizedGraph,
@@ -627,7 +629,7 @@ class DefaultConfigurationCache internal constructor(
     }
 
     private
-    fun saveWorkGraph() {
+    fun saveWorkGraph(rootBuild: BuildState) {
         cacheEntryRequiresCommit = true
 
         if (startParameter.isIgnoreInputsDuringStore) {
@@ -636,7 +638,7 @@ class DefaultConfigurationCache internal constructor(
 
         buildOperationRunner.withWorkGraphStoreOperation(cacheKey.string) {
             val stateStoreResult = runAndStore(stateType = StateType.Work) { stateFile: ConfigurationCacheStateFile ->
-                writeConfigurationCacheState(stateFile)
+                writeConfigurationCacheState(rootBuild, stateFile)
             }
             WorkGraphStoreResult(stateStoreResult.accessedFiles, stateStoreResult.value)
         }
@@ -721,8 +723,8 @@ class DefaultConfigurationCache internal constructor(
     }
 
     private
-    fun writeConfigurationCacheState(stateFile: ConfigurationCacheStateFile) =
-        cacheIO.writeRootBuildStateTo(stateFile)
+    fun writeConfigurationCacheState(rootBuild: BuildState, stateFile: ConfigurationCacheStateFile) =
+        cacheIO.writeRootBuildStateTo(rootBuild, stateFile)
 
     private
     fun ConfigurationCacheRepository.Layout.writeConfigurationCacheFingerprint(reusedProjects: Set<Path>) {
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCacheHost.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCacheHost.kt
index a8930c0edf0..ecf1a92587f 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCacheHost.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCacheHost.kt
@@ -25,7 +25,6 @@ import org.gradle.api.internal.initialization.ScriptHandlerFactory
 import org.gradle.api.internal.initialization.StandaloneDomainObjectContext
 import org.gradle.api.internal.project.ProjectInternal
 import org.gradle.api.internal.project.ProjectStateRegistry
-import org.gradle.execution.plan.ScheduledWork
 import org.gradle.groovy.scripts.TextResourceScriptSource
 import org.gradle.initialization.ClassLoaderScopeRegistry
 import org.gradle.initialization.DefaultProjectDescriptor
@@ -34,7 +33,6 @@ import org.gradle.initialization.SettingsState
 import org.gradle.initialization.layout.BuildLayout
 import org.gradle.internal.build.BuildState
 import org.gradle.internal.build.BuildStateRegistry
-import org.gradle.internal.build.RootBuildState
 import org.gradle.internal.cc.base.serialize.service
 import org.gradle.internal.file.PathToFileResolver
 import org.gradle.internal.reflect.Instantiator
@@ -52,13 +50,11 @@ class DefaultConfigurationCacheHost internal constructor(
     private val classLoaderScopeRegistry: ClassLoaderScopeRegistry,
 ) : ConfigurationCacheHost {
 
-    override val currentBuild: VintageGradleBuild =
-        DefaultVintageGradleBuild(gradle.owner)
+    override val currentBuild: BuildState
+        get() = gradle.owner
 
-    override fun visitBuilds(visitor: (VintageGradleBuild) -> Unit) {
-        service<BuildStateRegistry>().visitBuilds { build ->
-            visitor(DefaultVintageGradleBuild(build))
-        }
+    override fun visitBuilds(visitor: (BuildState) -> Unit) {
+        service<BuildStateRegistry>().visitBuilds(visitor)
     }
 
     override fun createBuild(settingsFile: File?): ConfigurationCacheBuild =
@@ -67,25 +63,6 @@ class DefaultConfigurationCacheHost internal constructor(
     override fun <T : Any> service(serviceType: Class<T>): T =
         gradle.services.get(serviceType)
 
-    private
-    class DefaultVintageGradleBuild(override val state: BuildState) : VintageGradleBuild {
-        override val isRootBuild: Boolean
-            get() = state is RootBuildState
-
-        override val gradle: GradleInternal
-            get() = state.mutableModel
-
-        override val hasScheduledWork: Boolean
-            get() = gradle.taskGraph.size() > 0
-
-        override val scheduledWork: ScheduledWork
-            get() {
-                lateinit var work: ScheduledWork
-                gradle.taskGraph.visitScheduledNodes { nodes, entryNodes -> work = ScheduledWork(nodes, entryNodes) }
-                return work
-            }
-    }
-
     private
     inner class DefaultConfigurationCacheBuild(
         override val state: BuildState,
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCacheIO.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCacheIO.kt
index b3d5227b343..d696696cc6e 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCacheIO.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCacheIO.kt
@@ -20,6 +20,7 @@ import org.gradle.api.logging.LogLevel
 import org.gradle.cache.internal.streams.BlockAddress
 import org.gradle.cache.internal.streams.BlockAddressSerializer
 import org.gradle.initialization.ClassLoaderScopeRegistry
+import org.gradle.internal.build.BuildState
 import org.gradle.internal.build.BuildStateRegistry
 import org.gradle.internal.buildtree.BuildTreeWorkGraph
 import org.gradle.internal.cc.base.logger
@@ -215,10 +216,10 @@ class DefaultConfigurationCacheIO internal constructor(
     /**
      * See [ConfigurationCacheState.writeRootBuildState].
      */
-    override fun writeRootBuildStateTo(stateFile: ConfigurationCacheStateFile) =
+    override fun writeRootBuildStateTo(rootBuild: BuildState, stateFile: ConfigurationCacheStateFile) =
         writeConfigurationCacheState(stateFile) { cacheState ->
             cacheState.run {
-                writeRootBuildState(host.currentBuild)
+                writeRootBuildState(rootBuild)
             }
         }
 
@@ -294,7 +295,7 @@ class DefaultConfigurationCacheIO internal constructor(
         isUsingObjectSharingStrategy(baseFile).let { deduplicate ->
             if (deduplicate) {
                 val (globalContext, _) = writeContextFor(globalsFile, SpecialEncoders(stringEncoder)) { "global values" }
-                globalContext.push(IsolateOwners.OwnerGradle(host.currentBuild.gradle))
+                globalContext.push(IsolateOwners.OwnerGradle(host.currentBuild.mutableModel))
                 DefaultSharedObjectEncoder(globalContext)
             } else {
                 InlineSharedObjectEncoder
@@ -308,7 +309,7 @@ class DefaultConfigurationCacheIO internal constructor(
                 // Create a context that honors global value duplication
                 // but uses an inline global value decoder
                 val (globalContext, _) = readContextFor(globalsFile, SpecialDecoders(stringDecoder))
-                globalContext.push(IsolateOwners.OwnerGradle(host.currentBuild.gradle))
+                globalContext.push(IsolateOwners.OwnerGradle(host.currentBuild.mutableModel))
                 DefaultSharedObjectDecoder(globalContext)
             } else {
                 InlineSharedObjectDecoder
@@ -365,7 +366,7 @@ class DefaultConfigurationCacheIO internal constructor(
         action: suspend WriteContext.(ConfigurationCacheState) -> T
     ): T {
         val profile = {
-            host.currentBuild.gradle.owner.displayName.displayName + " state"
+            host.currentBuild.displayName.displayName + " state"
         }
         return withWriteContextFor(stateFile, profile, specialEncoders) { codecs ->
             action(ConfigurationCacheState(codecs, stateFile, ChildContextSource(stateFile), eventEmitter, host))
@@ -374,7 +375,7 @@ class DefaultConfigurationCacheIO internal constructor(
 
     override fun writeModelTo(model: Any, stateFile: ConfigurationCacheStateFile) {
         writeConfigurationCacheState(stateFile) {
-            withGradleIsolate(host.currentBuild.gradle, codecs.userTypesCodec()) {
+            withGradleIsolate(host.currentBuild.mutableModel, codecs.userTypesCodec()) {
                 write(model)
             }
         }
@@ -382,7 +383,7 @@ class DefaultConfigurationCacheIO internal constructor(
 
     override fun readModelFrom(stateFile: ConfigurationCacheStateFile): Any {
         return readConfigurationCacheState(stateFile) {
-            withGradleIsolate(host.currentBuild.gradle, codecs.userTypesCodec()) {
+            withGradleIsolate(host.currentBuild.mutableModel, codecs.userTypesCodec()) {
                 readNonNull()
             }
         }
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/VintageGradleBuild.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/VintageGradleBuild.kt
deleted file mode 100644
index 80ec1002090..00000000000
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/VintageGradleBuild.kt
+++ /dev/null
@@ -1,30 +0,0 @@
-/*
- * Copyright 2019 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.internal.cc.impl
-
-import org.gradle.api.internal.GradleInternal
-import org.gradle.execution.plan.ScheduledWork
-import org.gradle.internal.build.BuildState
-
-
-interface VintageGradleBuild {
-    val isRootBuild: Boolean
-    val state: BuildState
-    val gradle: GradleInternal
-    val hasScheduledWork: Boolean
-    val scheduledWork: ScheduledWork
-}
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/problems/ConfigurationCacheProblemsSummary.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/problems/ConfigurationCacheProblemsSummary.kt
index 998455c6805..1225c7da423 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/problems/ConfigurationCacheProblemsSummary.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/problems/ConfigurationCacheProblemsSummary.kt
@@ -119,7 +119,7 @@ class ConfigurationCacheProblemsSummary(
             }
             if (severity != ProblemSeverity.SuppressedSilently) {
                 val isNewCause = recordProblemCause(problem, severity)
-                if (isNewCause) {
+                if (isNewCause && severity != ProblemSeverity.Interrupting) {
                     collectOriginalException(problem)
                 }
             }
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/serialize/ParallelStringDecoder.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/serialize/ParallelStringDecoder.kt
index 8a36726c5b8..ee5f9962300 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/serialize/ParallelStringDecoder.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/serialize/ParallelStringDecoder.kt
@@ -17,6 +17,9 @@
 package org.gradle.internal.cc.impl.serialize
 
 import com.esotericsoftware.kryo.io.Input
+import org.gradle.internal.cc.impl.serialize.ParallelStringEncoder.Companion.EMPTY_STRING_ID
+import org.gradle.internal.cc.impl.serialize.ParallelStringEncoder.Companion.FIRST_STRING_ID
+import org.gradle.internal.cc.impl.serialize.ParallelStringEncoder.Companion.NULL_STRING_ID
 import org.gradle.internal.serialize.Decoder
 import org.gradle.internal.serialize.graph.StringDecoder
 import java.io.InputStream
@@ -61,12 +64,14 @@ class ParallelStringDecoder(stream: InputStream) : StringDecoder, AutoCloseable
     private
     val reader = thread(isDaemon = true) {
         Input(stream).use { input ->
+            var nextId = FIRST_STRING_ID
             while (true) {
-                val id = input.readVarInt(true)
-                if (id == 0) break
-
                 val string = input.readString()
-                strings.compute(id) { _, value ->
+                if (string.isEmpty()) {
+                    // EOF
+                    break
+                }
+                strings.compute(nextId++) { _, value ->
                     when (value) {
                         is FutureString -> value.complete(string)
                         else -> require(value == null)
@@ -79,7 +84,7 @@ class ParallelStringDecoder(stream: InputStream) : StringDecoder, AutoCloseable
 
     override fun readNullableString(decoder: Decoder): String? =
         when (val id = decoder.readSmallInt()) {
-            0 -> null
+            NULL_STRING_ID -> null
             else -> doReadString(id)
         }
 
@@ -87,11 +92,11 @@ class ParallelStringDecoder(stream: InputStream) : StringDecoder, AutoCloseable
         doReadString(decoder.readSmallInt())
 
     private
-    fun doReadString(id: Int): String =
-        when (val it = strings.computeIfAbsent(id) { FutureString() }) {
-            is String -> it
-            is FutureString -> it.get()
-            else -> error("$it is unexpected")
+    fun doReadString(id: Int): String = if (id == EMPTY_STRING_ID) "" else
+        when (val stringOrFutureString = strings.computeIfAbsent(id) { FutureString() }) {
+            is String -> stringOrFutureString
+            is FutureString -> stringOrFutureString.get()
+            else -> error("$stringOrFutureString is unexpected")
         }
 
     override fun close() {
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/serialize/ParallelStringEncoder.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/serialize/ParallelStringEncoder.kt
index 1614d96b221..fe7135df84d 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/serialize/ParallelStringEncoder.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/serialize/ParallelStringEncoder.kt
@@ -17,60 +17,69 @@
 package org.gradle.internal.cc.impl.serialize
 
 import com.esotericsoftware.kryo.io.Output
+import org.gradle.internal.cc.impl.serialize.ParallelStringEncoder.Companion.EMPTY_STRING_ID
+import org.gradle.internal.cc.impl.serialize.ParallelStringEncoder.Companion.NULL_STRING_ID
 import org.gradle.internal.serialize.Encoder
 import org.gradle.internal.serialize.graph.StringEncoder
 import java.io.OutputStream
 import java.util.concurrent.ConcurrentHashMap
-import java.util.concurrent.atomic.AtomicInteger
 
 
 /**
  * Deduplicates and encodes strings to a separate stream in a thread-safe manner.
+ *
+ * The file produced is a sequence of non-empty strings, followed by an empty string that marks the end-of-file.
+ *
+ * Requests to write strings provide a client encoder and a string to write. This string encoder will do one of the following:
+ *
+ * - in case of [null][NULL_STRING_ID] or [empty strings][EMPTY_STRING_ID], simply write the corresponding special id into the client's encoder;
+ * - if the non-empty string has not been seen before, write it to this file and write the new, sequentially assigned, id for it into the client's encoder;
+ * - otherwise, the string has been written before, so just write the previously generated id for that string into the client's encoder.
  */
 internal
 class ParallelStringEncoder(stream: OutputStream) : StringEncoder {
 
+    companion object {
+        const val NULL_STRING_ID = 0
+        const val EMPTY_STRING_ID = 1
+        const val FIRST_STRING_ID = 2
+    }
+
     private
     val strings = ConcurrentHashMap<String, Int>()
 
     private
-    var nextId = AtomicInteger(1)
+    var nextId = FIRST_STRING_ID // 0 => null, 1 => ""
 
     private
     val output = Output(stream)
 
     override fun writeNullableString(encoder: Encoder, string: CharSequence?) {
         if (string == null) {
-            encoder.writeSmallInt(0)
+            encoder.writeSmallInt(NULL_STRING_ID)
         } else {
             writeString(encoder, string)
         }
     }
 
     override fun writeString(encoder: Encoder, string: CharSequence) {
-        val id = strings.computeIfAbsent(string.toString()) { key ->
-            val id = nextId.getAndIncrement()
-            doWriteString(id, key)
-            id
-        }
-        encoder.writeSmallInt(id)
+        encoder.writeSmallInt(
+            if (string.isEmpty()) EMPTY_STRING_ID
+            else strings.computeIfAbsent(string.toString(), ::doWriteString)
+        )
     }
 
     override fun close() {
-        output.writeStringId(0) // EOF
-        output.close()
-    }
-
-    private
-    fun doWriteString(id: Int, key: String) {
         synchronized(output) {
-            output.writeStringId(id)
-            output.writeString(key)
+            output.writeString("") // EOF
+            output.close()
         }
     }
 
     private
-    fun Output.writeStringId(id: Int) {
-        writeVarInt(id, true)
-    }
+    fun doWriteString(string: String): Int =
+        synchronized(output) {
+            output.writeString(string)
+            nextId++
+        }
 }
diff --git a/platforms/core-configuration/configuration-problems-base/build.gradle.kts b/platforms/core-configuration/configuration-problems-base/build.gradle.kts
index 81ab43909f6..bd1d8896968 100644
--- a/platforms/core-configuration/configuration-problems-base/build.gradle.kts
+++ b/platforms/core-configuration/configuration-problems-base/build.gradle.kts
@@ -54,7 +54,6 @@ dependencies {
 
     api(libs.kotlinStdlib)
 
-    implementation(libs.groovyJson)
     implementation(libs.guava)
     implementation(libs.jacksonCore)
 
diff --git a/platforms/core-configuration/configuration-problems-base/src/main/kotlin/org/gradle/internal/configuration/problems/CommonReport.kt b/platforms/core-configuration/configuration-problems-base/src/main/kotlin/org/gradle/internal/configuration/problems/CommonReport.kt
index dce196270b3..1c5522c54c1 100644
--- a/platforms/core-configuration/configuration-problems-base/src/main/kotlin/org/gradle/internal/configuration/problems/CommonReport.kt
+++ b/platforms/core-configuration/configuration-problems-base/src/main/kotlin/org/gradle/internal/configuration/problems/CommonReport.kt
@@ -16,7 +16,6 @@
 
 package org.gradle.internal.configuration.problems
 
-import org.apache.groovy.json.internal.CharBuf
 import org.gradle.api.internal.DocumentationRegistry
 import org.gradle.api.internal.file.temp.TemporaryFileProvider
 import org.gradle.api.logging.Logger
@@ -131,10 +130,6 @@ class CommonReport(
             spoolFileProvider: TemporaryFileProvider,
             private val reportFileName: String,
             val executor: ManagedExecutor,
-            /**
-             * [JsonModelWriter] uses Groovy's [CharBuf] for fast json encoding.
-             */
-            private val groovyJsonClassLoader: ClassLoader,
             private val distinctReports: Boolean
         ) : State() {
 
@@ -149,7 +144,6 @@ class CommonReport(
 
             init {
                 executor.submit {
-                    Thread.currentThread().contextClassLoader = groovyJsonClassLoader
                     writer.beginHtmlReport()
                 }
             }
@@ -265,7 +259,6 @@ class CommonReport(
             temporaryFileProvider,
             reportFileName,
             executorFactory.create("${reportContext.capitalized()} writer", 1),
-            CharBuf::class.java.classLoader,
             distinctReports
         ).onDiagnostic(problem)
     }
diff --git a/platforms/core-configuration/core-serialization-codecs/build.gradle.kts b/platforms/core-configuration/core-serialization-codecs/build.gradle.kts
index 3c69a372eb8..ba166e773a9 100644
--- a/platforms/core-configuration/core-serialization-codecs/build.gradle.kts
+++ b/platforms/core-configuration/core-serialization-codecs/build.gradle.kts
@@ -21,7 +21,11 @@ plugins {
 description = "Configuration Cache serialization codecs for :core (and family) types"
 
 jvmCompile {
-    usesFutureStdlib = true
+    compilations {
+        named("main") {
+            usesFutureStdlib = true
+        }
+    }
 }
 
 dependencies {
diff --git a/platforms/core-configuration/kotlin-dsl/build.gradle.kts b/platforms/core-configuration/kotlin-dsl/build.gradle.kts
index 10d97c493c3..60f315c69f6 100644
--- a/platforms/core-configuration/kotlin-dsl/build.gradle.kts
+++ b/platforms/core-configuration/kotlin-dsl/build.gradle.kts
@@ -63,7 +63,6 @@ dependencies {
     implementation("org.gradle:kotlin-dsl-shared-runtime")
 
     implementation(libs.asm)
-    implementation(libs.groovyJson)
     implementation(libs.jspecify)
     implementation(libs.kotlinReflect)
 
diff --git a/platforms/core-configuration/kotlin-dsl/src/integTest/kotlin/org/gradle/kotlin/dsl/support/EmbeddedKotlinProviderTest.kt b/platforms/core-configuration/kotlin-dsl/src/integTest/kotlin/org/gradle/kotlin/dsl/support/EmbeddedKotlinProviderTest.kt
index a76525a4549..e3f5be36c2b 100644
--- a/platforms/core-configuration/kotlin-dsl/src/integTest/kotlin/org/gradle/kotlin/dsl/support/EmbeddedKotlinProviderTest.kt
+++ b/platforms/core-configuration/kotlin-dsl/src/integTest/kotlin/org/gradle/kotlin/dsl/support/EmbeddedKotlinProviderTest.kt
@@ -2,10 +2,12 @@ package org.gradle.kotlin.dsl.support
 
 import org.gradle.kotlin.dsl.*
 import org.gradle.kotlin.dsl.fixtures.AbstractKotlinIntegrationTest
+import org.gradle.test.fixtures.Flaky
 import org.hamcrest.CoreMatchers.containsString
 import org.hamcrest.CoreMatchers.not
 import org.hamcrest.MatcherAssert.assertThat
 import org.junit.Test
+import org.junit.experimental.categories.Category
 
 
 class EmbeddedKotlinProviderTest : AbstractKotlinIntegrationTest() {
@@ -41,33 +43,26 @@ class EmbeddedKotlinProviderTest : AbstractKotlinIntegrationTest() {
     }
 
     @Test
+    @Category(Flaky::class) // https://github.com/gradle/gradle-private/issues/4723
     fun `stdlib and reflect are pinned to the embedded kotlin version for requested plugins`() {
         withBuildScript(
             """
             buildscript {
                 $repositoriesBlock
                 dependencies {
-                    classpath("org.jetbrains.kotlin:kotlin-stdlib:1.9.21")
-                    classpath("org.jetbrains.kotlin:kotlin-reflect:1.9.21")
+                    classpath("org.jetbrains.kotlin:kotlin-stdlib:2.0.0")
+                    classpath("org.jetbrains.kotlin:kotlin-reflect:2.0.0")
                 }
             }
             plugins {
-                kotlin("jvm") version "1.9.21"
+                kotlin("jvm") version "2.0.0"
             }
             """
         )
 
-        executer.expectDocumentedDeprecationWarning(
-            "The StartParameter.isConfigurationCacheRequested property has been deprecated. " +
-                "This is scheduled to be removed in Gradle 10. " +
-                "Please use 'configurationCache.requested' property on 'BuildFeatures' service instead. " +
-                "Consult the upgrading guide for further information: " +
-                "https://docs.gradle.org/current/userguide/upgrading_version_8.html#deprecated_startparameter_is_configuration_cache_requested",
-        )
-
         val result = build("buildEnvironment")
         listOf("stdlib", "reflect").forEach { module ->
-            assertThat(result.output, containsString("org.jetbrains.kotlin:kotlin-$module:1.9.21 -> $embeddedKotlinVersion"))
+            assertThat(result.output, containsString("org.jetbrains.kotlin:kotlin-$module:2.0.0 -> $embeddedKotlinVersion"))
         }
     }
 
diff --git a/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/execution/Lexer.kt b/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/execution/Lexer.kt
index 4f0047bd3e7..07c72e1c677 100644
--- a/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/execution/Lexer.kt
+++ b/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/execution/Lexer.kt
@@ -39,7 +39,7 @@ class UnexpectedDuplicateBlock(val identifier: TopLevelBlockId, override val loc
 
 internal
 class UnexpectedBlockOrder(val identifier: TopLevelBlockId, override val location: IntRange, expectedFirstIdentifier: TopLevelBlockId) :
-    UnexpectedBlock("Unexpected `$identifier` block found. `$identifier` can not appear before `$expectedFirstIdentifier`.")
+    UnexpectedBlock("Unexpected `$identifier` block found. `$identifier` cannot appear before `$expectedFirstIdentifier`.")
 
 
 data class Packaged<T>(
diff --git a/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/provider/ClassLoaderHierarchy.kt b/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/provider/ClassLoaderHierarchy.kt
deleted file mode 100644
index 0fac31aefbe..00000000000
--- a/platforms/core-configuration/kotlin-dsl/src/main/kotlin/org/gradle/kotlin/dsl/provider/ClassLoaderHierarchy.kt
+++ /dev/null
@@ -1,145 +0,0 @@
-/*
- * Copyright 2016 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.kotlin.dsl.provider
-
-import groovy.json.JsonOutput.toJson
-import org.gradle.api.internal.initialization.AbstractClassLoaderScope
-import org.gradle.api.internal.initialization.ClassLoaderScope
-import org.gradle.internal.classloader.ClassLoaderVisitor
-import org.gradle.kotlin.dsl.support.foldHierarchy
-import java.net.URL
-import java.util.ArrayDeque
-import java.util.IdentityHashMap
-
-
-/**
- * A formatter for strings that might contain file system paths.
- */
-internal
-typealias PathStringFormatter = (String) -> String
-
-
-internal
-fun classLoaderHierarchyJsonFor(
-    klass: Class<*>,
-    targetScope: ClassLoaderScope,
-    pathFormatter: PathStringFormatter = { it }
-) =
-
-    classLoaderHierarchyJsonFor(
-        hierarchyOf(klass.classLoader),
-        hierarchyOf(targetScope),
-        pathFormatter
-    )
-
-
-private
-typealias ClassLoaderId = String
-
-
-private
-class ClassLoaderNode(
-    val id: ClassLoaderId,
-    val label: String,
-    val classPath: MutableSet<URL> = LinkedHashSet(),
-    val parents: MutableSet<ClassLoaderId> = LinkedHashSet()
-)
-
-
-private
-fun classLoaderHierarchyJsonFor(
-    classLoaders: List<ClassLoaderNode>,
-    scopes: List<ClassLoaderScope>,
-    pathFormatter: PathStringFormatter
-): String {
-
-    fun labelFor(scope: ClassLoaderScope) =
-        pathFormatter(if (scope is AbstractClassLoaderScope) scope.path else scope.toString())
-
-    return toJson(
-        mapOf(
-            "classLoaders" to classLoaders.map {
-                mapOf(
-                    "id" to it.id,
-                    "label" to it.label,
-                    "classPath" to it.classPath.map { pathFormatter(it.toString()) },
-                    "parents" to it.parents
-                )
-            },
-            "scopes" to scopes.map {
-                mapOf(
-                    "label" to labelFor(it),
-                    "localClassLoader" to idOf(it.localClassLoader),
-                    "exportClassLoader" to idOf(it.exportClassLoader),
-                    "isLocked" to it.isLocked
-                )
-            }
-        )
-    )
-}
-
-
-private
-fun hierarchyOf(initialScope: ClassLoaderScope): List<ClassLoaderScope> =
-    initialScope.foldHierarchy(arrayListOf<ClassLoaderScope>()) { result, scope ->
-        result.apply { add(scope) }
-    }
-
-
-private
-fun hierarchyOf(classLoader: ClassLoader): ArrayList<ClassLoaderNode> {
-
-    val classLoaders = arrayListOf<ClassLoaderNode>()
-    val visitedClassLoaders = IdentityHashMap<ClassLoader, Boolean>()
-    val stack = ArrayDeque<ClassLoaderNode>()
-    val visitor = object : ClassLoaderVisitor() {
-        override fun visit(classLoader: ClassLoader) {
-            if (classLoader in visitedClassLoaders) {
-                return
-            }
-            visitedClassLoaders.put(classLoader, true)
-
-            val record = ClassLoaderNode(idOf(classLoader), classLoader.toString())
-            classLoaders.add(record)
-
-            stack.push(record)
-            super.visit(classLoader)
-            stack.pop()
-        }
-
-        override fun visitParent(classLoader: ClassLoader) {
-            current.parents.add(idOf(classLoader))
-            super.visitParent(classLoader)
-        }
-
-        override fun visitClassPath(classPath: Array<out URL>) {
-            current.classPath.addAll(classPath)
-        }
-
-        private
-        val current: ClassLoaderNode
-            get() = stack.peek()!!
-    }
-
-    visitor.visit(classLoader)
-    return classLoaders
-}
-
-
-private
-fun idOf(classLoader: ClassLoader): String =
-    "${classLoader::class.qualifiedName}@${System.identityHashCode(classLoader)}"
diff --git a/platforms/core-configuration/kotlin-dsl/src/test/kotlin/org/gradle/kotlin/dsl/execution/TopLevelBlockExtractionTest.kt b/platforms/core-configuration/kotlin-dsl/src/test/kotlin/org/gradle/kotlin/dsl/execution/TopLevelBlockExtractionTest.kt
index ad604d0e23c..fab98ee920f 100644
--- a/platforms/core-configuration/kotlin-dsl/src/test/kotlin/org/gradle/kotlin/dsl/execution/TopLevelBlockExtractionTest.kt
+++ b/platforms/core-configuration/kotlin-dsl/src/test/kotlin/org/gradle/kotlin/dsl/execution/TopLevelBlockExtractionTest.kt
@@ -124,7 +124,7 @@ class TopLevelBlockExtractionTest {
         } catch (unexpectedBlock: UnexpectedBlockOrder) {
             assertThat(unexpectedBlock.identifier, equalTo(plugins))
             assertThat(unexpectedBlock.location, equalTo(0..9))
-            assertThat(unexpectedBlock.message, equalTo("Unexpected `plugins` block found. `plugins` can not appear before `pluginManagement`."))
+            assertThat(unexpectedBlock.message, equalTo("Unexpected `plugins` block found. `plugins` cannot appear before `pluginManagement`."))
         }
     }
 
diff --git a/platforms/core-configuration/kotlin-dsl/src/test/kotlin/org/gradle/kotlin/dsl/provider/ClassLoaderHierarchyTest.kt b/platforms/core-configuration/kotlin-dsl/src/test/kotlin/org/gradle/kotlin/dsl/provider/ClassLoaderHierarchyTest.kt
deleted file mode 100644
index 74e72e4563a..00000000000
--- a/platforms/core-configuration/kotlin-dsl/src/test/kotlin/org/gradle/kotlin/dsl/provider/ClassLoaderHierarchyTest.kt
+++ /dev/null
@@ -1,85 +0,0 @@
-package org.gradle.kotlin.dsl.provider
-
-import com.fasterxml.jackson.module.kotlin.jacksonObjectMapper
-import com.fasterxml.jackson.module.kotlin.readValue
-
-import org.gradle.api.internal.initialization.AbstractClassLoaderScope
-
-import org.gradle.internal.classpath.ClassPath
-import org.gradle.internal.classpath.DefaultClassPath
-
-import org.gradle.kotlin.dsl.fixtures.DeepThought
-import org.gradle.kotlin.dsl.fixtures.TestWithTempFiles
-import org.gradle.kotlin.dsl.fixtures.classEntriesFor
-
-import org.gradle.kotlin.dsl.support.zipTo
-
-import org.hamcrest.CoreMatchers.equalTo
-import org.hamcrest.CoreMatchers.hasItem
-import org.hamcrest.MatcherAssert.assertThat
-
-import org.junit.Test
-import org.mockito.kotlin.doReturn
-import org.mockito.kotlin.mock
-
-import java.lang.ClassLoader.getSystemClassLoader
-
-
-class ClassLoaderHierarchyTest : TestWithTempFiles() {
-
-    @Test
-    fun `can dump complete ClassLoader hierarchy to json`() {
-
-        ChildFirstClassLoader(getSystemClassLoader(), classPathWith(DeepThought::class.java)).use { loader ->
-
-            @Suppress("VariableNaming")
-            val `class` = loader.loadClass(DeepThought::class.qualifiedName)
-
-            val targetScope = mock<AbstractClassLoaderScope> {
-                on { localClassLoader } doReturn loader
-                on { exportClassLoader } doReturn loader.parent
-                on { parent }.then { it.mock }
-                on { path }.then { "the path" }
-            }
-
-            val json = classLoaderHierarchyJsonFor(`class`, targetScope)
-
-            val mapper = jacksonObjectMapper()
-            val hierarchy = mapper.readValue<ClassLoaderHierarchy>(json)
-
-            assertThat(hierarchy.classLoaders.size, equalTo(3))
-            assertThat(hierarchy.scopes.size, equalTo(1))
-            assertThat(hierarchy.classLoaders[0].parents, hasItem(hierarchy.classLoaders[1].id))
-            assertThat(hierarchy.scopes[0].label, equalTo("the path"))
-            assertThat(hierarchy.scopes[0].localClassLoader, equalTo(hierarchy.classLoaders[0].id))
-            assertThat(hierarchy.scopes[0].exportClassLoader, equalTo(hierarchy.classLoaders[1].id))
-        }
-    }
-
-    @Suppress("FunctionParameterNaming")
-    private
-    fun classPathWith(`class`: Class<*>): ClassPath {
-        val jar = file("fixture.jar")
-        zipTo(jar, classEntriesFor(`class`))
-        return DefaultClassPath.of(listOf(jar))
-    }
-
-    data class ClassLoaderHierarchy(
-        val classLoaders: List<ClassLoaderNode>,
-        val scopes: List<ScopeNode>
-    )
-
-    data class ClassLoaderNode(
-        val id: String,
-        val label: String,
-        val parents: Set<String>,
-        val classPath: List<String>
-    )
-
-    data class ScopeNode(
-        val label: String,
-        val localClassLoader: String,
-        val exportClassLoader: String,
-        val isLocked: Boolean
-    )
-}
diff --git a/platforms/core-configuration/model-core/build.gradle.kts b/platforms/core-configuration/model-core/build.gradle.kts
index 84a79d12297..6eb925377db 100644
--- a/platforms/core-configuration/model-core/build.gradle.kts
+++ b/platforms/core-configuration/model-core/build.gradle.kts
@@ -6,7 +6,11 @@ plugins {
 description = "Implementation of configuration model types and annotation metadata handling (Providers, software model, conventions)"
 
 jvmCompile {
-    usesJdkInternals = true
+    compilations {
+        named("main") {
+            usesJdkInternals = true
+        }
+    }
 }
 
 dependencies {
@@ -75,8 +79,6 @@ strictCompile {
     ignoreRawTypes() // raw types used in public API
 }
 
-integTest.usesJavadocCodeSnippets = true
-
 packageCycles {
     excludePatterns.add("org/gradle/model/internal/core/**")
     excludePatterns.add("org/gradle/model/internal/inspect/**")
diff --git a/platforms/core-configuration/model-core/src/integTest/groovy/org/gradle/util/AutoTestedSamplesModelCoreIntegrationTest.groovy b/platforms/core-configuration/model-core/src/integTest/groovy/org/gradle/util/AutoTestedSamplesModelCoreIntegrationTest.groovy
deleted file mode 100644
index d8206b2ff69..00000000000
--- a/platforms/core-configuration/model-core/src/integTest/groovy/org/gradle/util/AutoTestedSamplesModelCoreIntegrationTest.groovy
+++ /dev/null
@@ -1,28 +0,0 @@
-/*
- * Copyright 2021 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.util
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesModelCoreIntegrationTest extends AbstractAutoTestedSamplesTest {
-
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/platforms/core-execution/workers/build.gradle.kts b/platforms/core-execution/workers/build.gradle.kts
index 516e878bc30..2d202aa329e 100644
--- a/platforms/core-execution/workers/build.gradle.kts
+++ b/platforms/core-execution/workers/build.gradle.kts
@@ -60,7 +60,6 @@ dependencies {
     }
 }
 
-integTest.usesJavadocCodeSnippets = true
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/core-execution/workers/src/integTest/groovy/org/gradle/samples/AutoTestedSamplesWorkersIntegrationTest.groovy b/platforms/core-execution/workers/src/integTest/groovy/org/gradle/samples/AutoTestedSamplesWorkersIntegrationTest.groovy
deleted file mode 100644
index 1ffa6d101e1..00000000000
--- a/platforms/core-execution/workers/src/integTest/groovy/org/gradle/samples/AutoTestedSamplesWorkersIntegrationTest.groovy
+++ /dev/null
@@ -1,27 +0,0 @@
-/*
- * Copyright 2024 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.samples
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesWorkersIntegrationTest extends AbstractAutoTestedSamplesTest {
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/platforms/core-runtime/base-services/build.gradle.kts b/platforms/core-runtime/base-services/build.gradle.kts
index 8ed884acf0e..bb16a876b7b 100644
--- a/platforms/core-runtime/base-services/build.gradle.kts
+++ b/platforms/core-runtime/base-services/build.gradle.kts
@@ -15,7 +15,11 @@ gradleModule {
 }
 
 jvmCompile {
-    usesFutureStdlib = true
+    compilations {
+        named("main") {
+            usesFutureStdlib = true
+        }
+    }
 }
 
 dependencies {
diff --git a/platforms/core-runtime/build-operations/build.gradle.kts b/platforms/core-runtime/build-operations/build.gradle.kts
index 57c239e3960..df696ab8b2e 100644
--- a/platforms/core-runtime/build-operations/build.gradle.kts
+++ b/platforms/core-runtime/build-operations/build.gradle.kts
@@ -18,6 +18,7 @@ dependencies {
     api(libs.jspecify)
 
     implementation(libs.slf4jApi)
+    implementation(libs.guava)
 
     testFixturesImplementation(libs.guava)
 
diff --git a/platforms/core-runtime/build-operations/src/main/java/org/gradle/internal/operations/DefaultBuildOperationListenerManager.java b/platforms/core-runtime/build-operations/src/main/java/org/gradle/internal/operations/DefaultBuildOperationListenerManager.java
index 1ab176d8591..d534ef6cbd1 100644
--- a/platforms/core-runtime/build-operations/src/main/java/org/gradle/internal/operations/DefaultBuildOperationListenerManager.java
+++ b/platforms/core-runtime/build-operations/src/main/java/org/gradle/internal/operations/DefaultBuildOperationListenerManager.java
@@ -16,28 +16,22 @@
 
 package org.gradle.internal.operations;
 
-import java.util.ArrayList;
-import java.util.Collections;
+import com.google.common.collect.ImmutableList;
+
 import java.util.List;
-import java.util.ListIterator;
 import java.util.Map;
 import java.util.concurrent.ConcurrentHashMap;
-import java.util.concurrent.locks.Lock;
-import java.util.concurrent.locks.ReentrantLock;
+import java.util.concurrent.atomic.AtomicReference;
 
 public class DefaultBuildOperationListenerManager implements BuildOperationListenerManager {
 
-    // This cannot be CopyOnWriteArrayList because we need to iterate it in reverse,
-    // which requires atomically getting an iterator and the size.
-    // Moreover, we iterate this list far more often that we mutate,
-    // making a (albeit home grown) copy-on-write strategy more appealing.
-    private List<ProgressShieldingBuildOperationListener> listeners = Collections.emptyList();
-    private final Lock listenersLock = new ReentrantLock();
+    // Imitation of CopyOnWriteArrayList, which supports safe iteration in reverse
+    private final AtomicReference<ImmutableList<ProgressShieldingBuildOperationListener>> listeners = new AtomicReference<>(ImmutableList.of());
 
     private final BuildOperationListener broadcaster = new BuildOperationListener() {
         @Override
         public void started(BuildOperationDescriptor buildOperation, OperationStartEvent startEvent) {
-            List<? extends BuildOperationListener> listeners = DefaultBuildOperationListenerManager.this.listeners;
+            List<? extends BuildOperationListener> listeners = DefaultBuildOperationListenerManager.this.listeners.get();
             //noinspection ForLoopReplaceableByForEach
             for (int i = 0; i < listeners.size(); ++i) {
                 listeners.get(i).started(buildOperation, startEvent);
@@ -46,7 +40,7 @@ public void started(BuildOperationDescriptor buildOperation, OperationStartEvent
 
         @Override
         public void progress(OperationIdentifier operationIdentifier, OperationProgressEvent progressEvent) {
-            List<? extends BuildOperationListener> listeners = DefaultBuildOperationListenerManager.this.listeners;
+            List<? extends BuildOperationListener> listeners = DefaultBuildOperationListenerManager.this.listeners.get();
             //noinspection ForLoopReplaceableByForEach
             for (int i = 0; i < listeners.size(); ++i) {
                 listeners.get(i).progress(operationIdentifier, progressEvent);
@@ -55,7 +49,7 @@ public void progress(OperationIdentifier operationIdentifier, OperationProgressE
 
         @Override
         public void finished(BuildOperationDescriptor buildOperation, OperationFinishEvent finishEvent) {
-            List<? extends BuildOperationListener> listeners = DefaultBuildOperationListenerManager.this.listeners;
+            List<? extends BuildOperationListener> listeners = DefaultBuildOperationListenerManager.this.listeners.get();
             for (int i = listeners.size() - 1; i >= 0; --i) {
                 listeners.get(i).finished(buildOperation, finishEvent);
             }
@@ -64,31 +58,19 @@ public void finished(BuildOperationDescriptor buildOperation, OperationFinishEve
 
     @Override
     public void addListener(BuildOperationListener listener) {
-        listenersLock.lock();
-        try {
-            List<ProgressShieldingBuildOperationListener> listeners = new ArrayList<ProgressShieldingBuildOperationListener>(this.listeners);
-            listeners.add(new ProgressShieldingBuildOperationListener(listener));
-            this.listeners = listeners;
-        } finally {
-            listenersLock.unlock();
-        }
+        listeners.updateAndGet(current ->
+            ImmutableList.<ProgressShieldingBuildOperationListener>builderWithExpectedSize(current.size() + 1)
+                .addAll(current)
+                .add(new ProgressShieldingBuildOperationListener(listener))
+                .build());
     }
 
     @Override
     public void removeListener(BuildOperationListener listener) {
-        listenersLock.lock();
-        try {
-            List<ProgressShieldingBuildOperationListener> listeners = new ArrayList<ProgressShieldingBuildOperationListener>(this.listeners);
-            ListIterator<ProgressShieldingBuildOperationListener> listIterator = listeners.listIterator();
-            while (listIterator.hasNext()) {
-                if (listIterator.next().delegate.equals(listener)) {
-                    listIterator.remove();
-                }
-            }
-            this.listeners = listeners;
-        } finally {
-            listenersLock.unlock();
-        }
+        listeners.updateAndGet(current ->
+            current.stream()
+                .filter(l -> !l.delegate.equals(listener))
+                .collect(ImmutableList.toImmutableList()));
     }
 
     @Override
diff --git a/platforms/core-runtime/classloaders/build.gradle.kts b/platforms/core-runtime/classloaders/build.gradle.kts
index ab177c96204..bb41c25354d 100644
--- a/platforms/core-runtime/classloaders/build.gradle.kts
+++ b/platforms/core-runtime/classloaders/build.gradle.kts
@@ -29,7 +29,11 @@ gradleModule {
 }
 
 jvmCompile {
-    usesFutureStdlib = true
+    compilations {
+        named("main") {
+            usesFutureStdlib = true
+        }
+    }
 }
 
 dependencies {
diff --git a/platforms/core-runtime/files/src/main/java/org/gradle/internal/file/FilePathUtil.java b/platforms/core-runtime/files/src/main/java/org/gradle/internal/file/FilePathUtil.java
index eca8e4d5a34..292c9aadb26 100644
--- a/platforms/core-runtime/files/src/main/java/org/gradle/internal/file/FilePathUtil.java
+++ b/platforms/core-runtime/files/src/main/java/org/gradle/internal/file/FilePathUtil.java
@@ -18,6 +18,7 @@
 
 import java.io.File;
 import java.util.ArrayList;
+import java.util.Arrays;
 import java.util.List;
 import java.util.StringTokenizer;
 
@@ -73,4 +74,28 @@ public static int sizeOfCommonPrefix(String path1, String path2, int offset, cha
         }
         return lastSeparator;
     }
+
+    /**
+     * Removes the trailing segments from the given path if it ends with the specified path to remove.
+     */
+    public static String maybeRemoveTrailingSegments(String path, String pathToRemove) {
+        String[] removalSegments = getPathSegments(pathToRemove);
+        String[] pathSegments = getPathSegments(path);
+        int potentialRemovalIndex = pathSegments.length - removalSegments.length;
+        // Check if the path ends with the removal path.
+        if (potentialRemovalIndex > 0) {
+            String[] lastSegments = Arrays.stream(pathSegments)
+                .skip(potentialRemovalIndex)
+                .toArray(String[]::new);
+
+            if (Arrays.equals(lastSegments, removalSegments)) {
+                // If it does, we remove the segments from the path
+                // i.e: <rootPath>/<removalPath> becomes just <rootPath>
+                String maybeLeadingSeparator = FILE_PATH_SEPARATORS.contains(path.substring(0, 1)) ? "/" : "";
+                return maybeLeadingSeparator + String.join("/", Arrays.copyOf(pathSegments, potentialRemovalIndex));
+            }
+        }
+        // Otherwise, we return the original path.
+        return path;
+    }
 }
diff --git a/platforms/core-runtime/files/src/test/groovy/org/gradle/internal/file/FilePathUtilTest.groovy b/platforms/core-runtime/files/src/test/groovy/org/gradle/internal/file/FilePathUtilTest.groovy
index 556e2cb7018..47b03cc88d4 100644
--- a/platforms/core-runtime/files/src/test/groovy/org/gradle/internal/file/FilePathUtilTest.groovy
+++ b/platforms/core-runtime/files/src/test/groovy/org/gradle/internal/file/FilePathUtilTest.groovy
@@ -36,4 +36,32 @@ class FilePathUtilTest extends Specification {
         ""          | "oner"            | "one"
         "some/path" | "with/one/ending" | "without/two/different"
     }
+
+    def 'can remove trailing path segments from path'() {
+        expect:
+        FilePathUtil.maybeRemoveTrailingSegments(path, removalPath) == expectedPath
+
+        where:
+        path                            | removalPath                      | expectedPath
+        // should not change the path
+        'some/path/to'                  | 'foo/bar'                        | 'some/path/to'
+        'some/path/to/'                 | 'foo/bar'                        | 'some/path/to/'
+        '/some/path/to'                 | 'foo/bar'                        | '/some/path/to'
+        '//some//path//to'              | 'foo/bar'                        | '//some//path//to'
+        'some/path/to/foo.bar'          | 'foo/bar'                        | 'some/path/to/foo.bar'
+        'some/path/to/foo'              | 'foo/bar'                        | 'some/path/to/foo'
+        'some/path/to/bar'              | 'foo/bar'                        | 'some/path/to/bar'
+        'some/path/to/foo/baz/bar'      | 'foo/bar'                        | 'some/path/to/foo/baz/bar'
+        'some/path/to/../other'         | 'foo/bar'                        | 'some/path/to/../other'
+        // should strip the trailing removalPath from the path
+        'some/path/to/foo'              | 'foo'                            | 'some/path/to'
+        'some/path/to/foo/'             | 'foo'                            | 'some/path/to'
+        '/some/path/to/foo/'            | 'foo'                            | '/some/path/to'
+        '//some//path//to//foo/'        | 'foo'                            | '/some/path/to'
+        'some/path/to/../foo'           | 'foo'                            | 'some/path/to/..'
+        'some/path/to/foo/bar'          | 'foo/bar'                        | 'some/path/to'
+        'some/path/to/../foo/bar'       | 'foo/bar'                        | 'some/path/to/..'
+        'some/path/to/foo//bar'         | 'foo/bar'                        | 'some/path/to'
+        'some/path/to/foo/bar/baz/fizz' | 'foo/bar/baz/fizz'               | 'some/path/to'
+    }
 }
diff --git a/platforms/core-runtime/logging-api/build.gradle.kts b/platforms/core-runtime/logging-api/build.gradle.kts
index eab7130a5bf..7738288cd28 100644
--- a/platforms/core-runtime/logging-api/build.gradle.kts
+++ b/platforms/core-runtime/logging-api/build.gradle.kts
@@ -27,8 +27,9 @@ gradleModule {
 }
 
 dependencies {
+    api(projects.stdlibJavaExtensions)
+
     api(libs.slf4jApi)
 
-    implementation(projects.stdlibJavaExtensions)
     implementation(projects.internalInstrumentationApi)
 }
diff --git a/platforms/core-runtime/logging-api/src/main/java/org/gradle/api/logging/configuration/ConsoleOutput.java b/platforms/core-runtime/logging-api/src/main/java/org/gradle/api/logging/configuration/ConsoleOutput.java
index 6660a67930f..1a65f5f4a5b 100644
--- a/platforms/core-runtime/logging-api/src/main/java/org/gradle/api/logging/configuration/ConsoleOutput.java
+++ b/platforms/core-runtime/logging-api/src/main/java/org/gradle/api/logging/configuration/ConsoleOutput.java
@@ -16,6 +16,8 @@
 
 package org.gradle.api.logging.configuration;
 
+import org.gradle.api.Incubating;
+
 /**
  * Specifies how to treat color and dynamic console output.
  */
@@ -24,15 +26,26 @@ public enum ConsoleOutput {
      * Disable all color and rich output. Generate plain text only.
      */
     Plain,
+
+    /**
+     * Enable color output while omitting rich features such as progress bars.
+     *
+     * @since 9.1.0
+     */
+    @Incubating
+    Colored,
+
     /**
      * Enable color and rich output when the current process is attached to a console, disable when not attached to a console.
      */
     Auto,
+
     /**
      * Enable color and rich output, regardless of whether the current process is attached to a console or not.
      * When not attached to a console, the color and rich output is encoded using ANSI control characters.
      */
     Rich,
+
     /**
      * Enable color and rich output like Rich, but output more detailed message.
      *
diff --git a/platforms/core-runtime/logging/src/integTest/groovy/org/gradle/internal/logging/console/taskgrouping/AbstractConsoleVerboseBasicFunctionalTest.groovy b/platforms/core-runtime/logging/src/integTest/groovy/org/gradle/internal/logging/console/taskgrouping/AbstractConsoleVerboseBasicFunctionalTest.groovy
index 3e76bf74c4b..11e9790be94 100644
--- a/platforms/core-runtime/logging/src/integTest/groovy/org/gradle/internal/logging/console/taskgrouping/AbstractConsoleVerboseBasicFunctionalTest.groovy
+++ b/platforms/core-runtime/logging/src/integTest/groovy/org/gradle/internal/logging/console/taskgrouping/AbstractConsoleVerboseBasicFunctionalTest.groovy
@@ -20,6 +20,7 @@ import org.gradle.integtests.fixtures.console.AbstractConsoleGroupedTaskFunction
 
 import static org.gradle.api.logging.configuration.ConsoleOutput.Auto
 import static org.gradle.api.logging.configuration.ConsoleOutput.Plain
+import static org.gradle.api.logging.configuration.ConsoleOutput.Colored
 import static org.gradle.api.logging.configuration.ConsoleOutput.Verbose
 
 abstract class AbstractConsoleVerboseBasicFunctionalTest extends AbstractConsoleGroupedTaskFunctionalTest {
@@ -27,7 +28,7 @@ abstract class AbstractConsoleVerboseBasicFunctionalTest extends AbstractConsole
         given:
         def helloWorldMessage= 'Hello world'
         def byeWorldMessage= 'Bye world'
-        def hasSilenceTaskOutput = consoleType in [Verbose, Plain] || consoleType == Auto && !consoleAttachment.stdoutAttached
+        def hasSilenceTaskOutput = consoleType in [Verbose, Plain, Colored] || consoleType == Auto && !consoleAttachment.stdoutAttached
 
         buildFile << """
             task helloWorld {
diff --git a/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/LoggingConfigurationBuildOptions.java b/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/LoggingConfigurationBuildOptions.java
index c8836697cdf..80a1694d958 100644
--- a/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/LoggingConfigurationBuildOptions.java
+++ b/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/LoggingConfigurationBuildOptions.java
@@ -181,12 +181,13 @@ public static class ConsoleOption extends StringBuildOption<LoggingConfiguration
         public static final String GRADLE_PROPERTY = "org.gradle.console";
 
         public ConsoleOption() {
-            super(GRADLE_PROPERTY, CommandLineOptionConfiguration.create(LONG_OPTION, "Specifies which type of console output to generate. Values are 'plain', 'auto' (default), 'rich' or 'verbose'."));
+            super(GRADLE_PROPERTY, CommandLineOptionConfiguration.create(LONG_OPTION, "Specifies which type of console output to generate. Values are 'plain', 'colored', 'auto' (default), 'rich' or 'verbose'."));
         }
 
         @Override
         public void applyTo(String value, LoggingConfiguration settings, Origin origin) {
-            String consoleValue = TextUtil.capitalize(value.toLowerCase(Locale.ROOT));
+            String normalized = value.toLowerCase(Locale.ROOT);
+            String consoleValue = TextUtil.capitalize(normalized);
             try {
                 ConsoleOutput consoleOutput = ConsoleOutput.valueOf(consoleValue);
                 settings.setConsoleOutput(consoleOutput);
diff --git a/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/console/ConsoleFlushRenderer.java b/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/console/ConsoleFlushRenderer.java
new file mode 100644
index 00000000000..2e5e06ce922
--- /dev/null
+++ b/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/console/ConsoleFlushRenderer.java
@@ -0,0 +1,44 @@
+/*
+ * Copyright 2025 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.gradle.internal.logging.console;
+
+import org.gradle.internal.logging.events.EndOutputEvent;
+import org.gradle.internal.logging.events.FlushOutputEvent;
+import org.gradle.internal.logging.events.OutputEvent;
+import org.gradle.internal.logging.events.OutputEventListener;
+import org.gradle.internal.logging.events.UpdateNowEvent;
+
+public class ConsoleFlushRenderer implements OutputEventListener {
+
+    private final OutputEventListener listener;
+
+    private final Console console;
+
+    public ConsoleFlushRenderer(OutputEventListener listener, Console console) {
+        this.listener = listener;
+        this.console = console;
+    }
+
+    @Override
+    public void onOutput(OutputEvent event) {
+        listener.onOutput(event);
+
+        if (event instanceof UpdateNowEvent || event instanceof EndOutputEvent || event instanceof FlushOutputEvent) {
+            console.flush();
+        }
+    }
+}
diff --git a/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/console/ThrottlingOutputEventListener.java b/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/console/ThrottlingOutputEventListener.java
index cd1aaa3c1e3..9298faa54bf 100644
--- a/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/console/ThrottlingOutputEventListener.java
+++ b/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/console/ThrottlingOutputEventListener.java
@@ -60,16 +60,13 @@ public ThrottlingOutputEventListener(OutputEventListener listener, Clock clock)
     }
 
     private void scheduleUpdateNow() {
-        ScheduledFuture<?> ignored = executor.scheduleAtFixedRate(new Runnable() {
-            @Override
-            public void run() {
-                try {
-                    onOutput(new UpdateNowEvent(clock.getCurrentTime()));
-                } catch (Throwable t) {
-                    // this class is used as task in a scheduled executor service, so it must not throw any throwable,
-                    // otherwise the further invocations of this task get automatically and silently cancelled
-                    LOGGER.debug("Exception while displaying output", t);
-                }
+        ScheduledFuture<?> ignored = executor.scheduleAtFixedRate(() -> {
+            try {
+                onOutput(new UpdateNowEvent(clock.getCurrentTime()));
+            } catch (Throwable t) {
+                // this class is used as task in a scheduled executor service, so it must not throw any throwable,
+                // otherwise the further invocations of this task get automatically and silently cancelled
+                LOGGER.debug("Exception while displaying output", t);
             }
         }, throttleMs, throttleMs, TimeUnit.MILLISECONDS);
     }
diff --git a/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/sink/ConsoleConfigureAction.java b/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/sink/ConsoleConfigureAction.java
index bc7849311e4..e10ec9ca700 100644
--- a/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/sink/ConsoleConfigureAction.java
+++ b/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/sink/ConsoleConfigureAction.java
@@ -43,6 +43,8 @@ public static void execute(OutputEventRenderer renderer, ConsoleOutput consoleOu
             configureRichConsole(renderer, consoleMetadata, stdout, stderr, true);
         } else if (consoleOutput == ConsoleOutput.Plain) {
             configurePlainConsole(renderer, consoleMetadata, stdout, stderr);
+        } else if (consoleOutput == ConsoleOutput.Colored) {
+            configureColoredConsole(renderer, consoleMetadata, stdout, stderr);
         }
     }
 
@@ -63,8 +65,8 @@ private static void configureAutoConsole(OutputEventRenderer renderer, ConsoleMe
             renderer.addRichConsoleWithErrorOutputOnStdout(console, consoleMetaData, false);
         } else if (consoleMetaData.isStdOut()) {
             // Write rich content to stdout and plain content to stderr
-            Console console = consoleFor(stdout, consoleMetaData, renderer.getColourMap());
-            renderer.addRichConsole(console, stderr, consoleMetaData, false);
+            Console stdoutConsole = consoleFor(stdout, consoleMetaData, renderer.getColourMap());
+            renderer.addRichConsole(stdoutConsole, stderr, consoleMetaData, false);
         } else if (consoleMetaData.isStdErr()) {
             // Write plain content to stdout and rich content to stderr
             Console stderrConsole = consoleFor(stderr, consoleMetaData, renderer.getColourMap());
@@ -84,10 +86,26 @@ private static void configurePlainConsole(OutputEventRenderer renderer, ConsoleM
         }
     }
 
+    private static void configureColoredConsole(OutputEventRenderer renderer, ConsoleMetaData consoleMetaData, OutputStream stdout, OutputStream stderr) {
+        if (consoleMetaData.isStdOut() && consoleMetaData.isStdErr()) {
+            // Redirect stderr to stdout when both stdout and stderr are attached to a console.
+            // Assume that they are attached to the same console.
+            // This avoids interleaving problems when stdout and stderr end up at the same location.
+            Console console = consoleFor(stdout, consoleMetaData, renderer.getColourMap());
+            renderer.addColoredConsoleWithErrorOutputOnStdout(console);
+        } else {
+            // Write colored content to both stdout and stderr
+            Console stdoutConsole = consoleFor(stdout, consoleMetaData, renderer.getColourMap());
+            Console stderrConsole = consoleFor(stderr, consoleMetaData, renderer.getColourMap());
+            renderer.addColoredConsole(stdoutConsole, stderrConsole);
+        }
+    }
+
     private static void configureRichConsole(OutputEventRenderer renderer, ConsoleMetaData consoleMetaData, OutputStream stdout, OutputStream stderr, boolean verbose) {
         if (consoleMetaData.isStdOut() && consoleMetaData.isStdErr()) {
-            // Redirect stderr to stdout when both stdout and stderr are attached to a console. Assume that they are attached to the same console
-            // This avoids interleaving problems when stdout and stderr end up at the same location
+            // Redirect stderr to stdout when both stdout and stderr are attached to a console.
+            // Assume that they are attached to the same console.
+            // This avoids interleaving problems when stdout and stderr end up at the same location.
             Console console = consoleFor(stdout, consoleMetaData, renderer.getColourMap());
             renderer.addRichConsoleWithErrorOutputOnStdout(console, consoleMetaData, verbose);
         } else {
diff --git a/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/sink/OutputEventRenderer.java b/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/sink/OutputEventRenderer.java
index bf4b409ee1e..9da1e40002e 100644
--- a/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/sink/OutputEventRenderer.java
+++ b/platforms/core-runtime/logging/src/main/java/org/gradle/internal/logging/sink/OutputEventRenderer.java
@@ -26,6 +26,7 @@
 import org.gradle.internal.logging.console.BuildStatusRenderer;
 import org.gradle.internal.logging.console.ColorMap;
 import org.gradle.internal.logging.console.Console;
+import org.gradle.internal.logging.console.ConsoleFlushRenderer;
 import org.gradle.internal.logging.console.ConsoleLayoutCalculator;
 import org.gradle.internal.logging.console.DefaultColorMap;
 import org.gradle.internal.logging.console.DefaultWorkInProgressFormatter;
@@ -239,7 +240,9 @@ public void removeOutputEventListener(OutputEventListener listener) {
 
     public void addRichConsoleWithErrorOutputOnStdout(Console stdout, ConsoleMetaData consoleMetaData, boolean verbose) {
         OutputEventListener consoleListener = new StyledTextOutputBackedRenderer(stdout.getBuildOutputArea());
-        OutputEventListener consoleChain = getConsoleChainWithDynamicStdout(stdout, consoleMetaData, verbose, consoleListener);
+        OutputEventListener consoleChain = throttled(
+            getUserInputConsoleRenderer(stdout, consoleMetaData, verbose, consoleListener)
+        );
         addConsoleChain(consoleChain);
     }
 
@@ -247,7 +250,9 @@ public void addRichConsole(Console stdout, Console stderr, ConsoleMetaData conso
         OutputEventListener stdoutChain = new StyledTextOutputBackedRenderer(stdout.getBuildOutputArea());
         OutputEventListener stderrChain = new FlushConsoleListener(stderr, new StyledTextOutputBackedRenderer(stderr.getBuildOutputArea()));
         OutputEventListener consoleListener = new ErrorOutputDispatchingListener(stderrChain, stdoutChain);
-        OutputEventListener consoleChain = getConsoleChainWithDynamicStdout(stdout, consoleMetaData, verbose, consoleListener);
+        OutputEventListener consoleChain = throttled(
+            getUserInputConsoleRenderer(stdout, consoleMetaData, verbose, consoleListener)
+        );
         addConsoleChain(consoleChain);
     }
 
@@ -255,7 +260,9 @@ public void addRichConsole(Console stdout, OutputStream stderr, ConsoleMetaData
         OutputEventListener stdoutChain = new StyledTextOutputBackedRenderer(stdout.getBuildOutputArea());
         OutputEventListener stderrChain = new StyledTextOutputBackedRenderer(new StreamingStyledTextOutput(new StreamBackedStandardOutputListener(stderr)));
         OutputEventListener consoleListener = new ErrorOutputDispatchingListener(stderrChain, stdoutChain);
-        OutputEventListener consoleChain = getConsoleChainWithDynamicStdout(stdout, consoleMetaData, verbose, consoleListener);
+        OutputEventListener consoleChain = throttled(
+            getUserInputConsoleRenderer(stdout, consoleMetaData, verbose, consoleListener)
+        );
         addConsoleChain(consoleChain);
     }
 
@@ -263,56 +270,86 @@ public void addRichConsole(OutputStream stdout, Console stderr, boolean verbose)
         OutputEventListener stdoutChain = new StyledTextOutputBackedRenderer(new StreamingStyledTextOutput(new StreamBackedStandardOutputListener(stdout)));
         OutputEventListener stderrChain = new FlushConsoleListener(stderr, new StyledTextOutputBackedRenderer(stderr.getBuildOutputArea()));
         OutputEventListener consoleListener = new ErrorOutputDispatchingListener(stderrChain, stdoutChain);
-        OutputEventListener consoleChain = getConsoleChainWithoutDynamicStdout(consoleListener, verbose);
+        OutputEventListener consoleChain = throttled(
+            getInputStandardOutputRenderer(consoleListener, verbose)
+        );
         addConsoleChain(consoleChain);
     }
 
     public void addPlainConsoleWithErrorOutputOnStdout(OutputStream stdout) {
-        OutputEventListener stdoutChain = new StyledTextOutputBackedRenderer(new StreamingStyledTextOutput(new StreamBackedStandardOutputListener(stdout)));
-        addConsoleChain(getConsoleChainWithoutDynamicStdout(stdoutChain, true));
+        OutputEventListener stdoutListener = new StyledTextOutputBackedRenderer(new StreamingStyledTextOutput(new StreamBackedStandardOutputListener(stdout)));
+        addConsoleChain(throttled(
+            getInputStandardOutputRenderer(stdoutListener, true)));
     }
 
     public void addPlainConsole(OutputStream stdout, OutputStream stderr) {
         OutputEventListener stdoutChain = new StyledTextOutputBackedRenderer(new StreamingStyledTextOutput(new StreamBackedStandardOutputListener(stdout)));
         OutputEventListener stderrChain = new StyledTextOutputBackedRenderer(new StreamingStyledTextOutput(new StreamBackedStandardOutputListener(stderr)));
         OutputEventListener outputListener = new ErrorOutputDispatchingListener(stderrChain, stdoutChain);
-        addConsoleChain(getConsoleChainWithoutDynamicStdout(outputListener, true));
-    }
-
-    private OutputEventListener getConsoleChainWithDynamicStdout(Console console, ConsoleMetaData consoleMetaData, boolean verbose, OutputEventListener consoleListener) {
-        return throttled(
-            new UserInputConsoleRenderer(
-                new BuildStatusRenderer(
-                    new WorkInProgressRenderer(
-                        new BuildLogLevelFilterRenderer(
-                            new GroupingProgressLogEventGenerator(consoleListener, new PrettyPrefixedLogHeaderFormatter(), verbose)
-                        ),
-                        console.getBuildProgressArea(),
-                        new DefaultWorkInProgressFormatter(consoleMetaData),
-                        new ConsoleLayoutCalculator(consoleMetaData)
-                    ),
-                    console.getStatusBar(), console, consoleMetaData),
-                console,
-                userInput)
+        addConsoleChain(throttled(
+            getInputStandardOutputRenderer(outputListener, true)));
+    }
+
+    public void addColoredConsoleWithErrorOutputOnStdout(Console stdout) {
+        OutputEventListener consoleListener = new FlushConsoleListener(stdout, new StyledTextOutputBackedRenderer(stdout.getBuildOutputArea()));
+        OutputEventListener consoleChain = throttled(
+            flushing(
+                getInputStandardOutputRenderer(consoleListener, true),
+                stdout
+            )
+
         );
+        addConsoleChain(consoleChain);
     }
 
-    private OutputEventListener getConsoleChainWithoutDynamicStdout(OutputEventListener outputListener, boolean verbose) {
-        return throttled(
-            new UserInputStandardOutputRenderer(
-                new BuildLogLevelFilterRenderer(
-                    new GroupingProgressLogEventGenerator(
-                        outputListener,
-                        new PrettyPrefixedLogHeaderFormatter(),
-                        verbose
-                    )
+    public void addColoredConsole(Console stdout, Console stderr) {
+        OutputEventListener stdoutChain = new StyledTextOutputBackedRenderer(stdout.getBuildOutputArea());
+        OutputEventListener stderrChain = new FlushConsoleListener(stderr, new StyledTextOutputBackedRenderer(stderr.getBuildOutputArea()));
+        OutputEventListener consoleListener = new ErrorOutputDispatchingListener(stderrChain, stdoutChain);
+        OutputEventListener consoleChain = throttled(
+            flushing(
+                getInputStandardOutputRenderer(consoleListener, true),
+                stdout
+            )
+        );
+        addConsoleChain(consoleChain);
+    }
+
+    private UserInputConsoleRenderer getUserInputConsoleRenderer(Console console, ConsoleMetaData consoleMetaData, boolean verbose, OutputEventListener consoleListener) {
+        return new UserInputConsoleRenderer(
+            new BuildStatusRenderer(
+                new WorkInProgressRenderer(
+                    new BuildLogLevelFilterRenderer(
+                        new GroupingProgressLogEventGenerator(consoleListener, new PrettyPrefixedLogHeaderFormatter(), verbose)
+                    ),
+                    console.getBuildProgressArea(),
+                    new DefaultWorkInProgressFormatter(consoleMetaData),
+                    new ConsoleLayoutCalculator(consoleMetaData)
                 ),
-                userInput
-            ));
+                console.getStatusBar(), console, consoleMetaData),
+            console,
+            userInput);
+    }
+
+    private UserInputStandardOutputRenderer getInputStandardOutputRenderer(OutputEventListener outputListener, boolean verbose) {
+        return new UserInputStandardOutputRenderer(
+            new BuildLogLevelFilterRenderer(
+                new GroupingProgressLogEventGenerator(
+                    outputListener,
+                    new PrettyPrefixedLogHeaderFormatter(),
+                    verbose
+                )
+            ),
+            userInput
+        );
+    }
+
+    private OutputEventListener throttled(OutputEventListener listener) {
+        return new ThrottlingOutputEventListener(listener, clock);
     }
 
-    private OutputEventListener throttled(OutputEventListener consoleChain) {
-        return new ThrottlingOutputEventListener(consoleChain, clock);
+    private OutputEventListener flushing(OutputEventListener listener, Console console) {
+        return new ConsoleFlushRenderer(listener, console);
     }
 
     private OutputEventRenderer addConsoleChain(OutputEventListener consoleChain) {
diff --git a/platforms/core-runtime/logging/src/test/groovy/org/gradle/internal/logging/LoggingCommandLineConverterTest.groovy b/platforms/core-runtime/logging/src/test/groovy/org/gradle/internal/logging/LoggingCommandLineConverterTest.groovy
index e522ecd264b..fc11495720f 100644
--- a/platforms/core-runtime/logging/src/test/groovy/org/gradle/internal/logging/LoggingCommandLineConverterTest.groovy
+++ b/platforms/core-runtime/logging/src/test/groovy/org/gradle/internal/logging/LoggingCommandLineConverterTest.groovy
@@ -70,11 +70,12 @@ class LoggingCommandLineConverterTest extends Specification {
         checkConversion([arg])
 
         where:
-        arg               | consoleOutput
-        "--console=plain" | ConsoleOutput.Plain
-        "--console=auto"  | ConsoleOutput.Auto
-        "--console=AUTO"  | ConsoleOutput.Auto
-        "--console=rich"  | ConsoleOutput.Rich
+        arg                             | consoleOutput
+        "--console=plain"               | ConsoleOutput.Plain
+        "--console=colored"             | ConsoleOutput.Colored
+        "--console=auto"                | ConsoleOutput.Auto
+        "--console=AUTO"                | ConsoleOutput.Auto
+        "--console=rich"                | ConsoleOutput.Rich
     }
 
     def reportsUnknownConsoleOption() {
diff --git a/platforms/core-runtime/report-rendering/build.gradle.kts b/platforms/core-runtime/report-rendering/build.gradle.kts
index 8cbf77946f1..a91681dcf1b 100644
--- a/platforms/core-runtime/report-rendering/build.gradle.kts
+++ b/platforms/core-runtime/report-rendering/build.gradle.kts
@@ -23,10 +23,11 @@ description = "Provides foundational types needed for building renderable report
 dependencies {
     api(projects.core)
 
+    api(libs.jspecify)
+
     implementation(projects.baseServices)
 
     implementation(libs.commonsLang)
-    implementation(libs.jspecify)
 
     testImplementation(libs.jsoup)
 }
diff --git a/platforms/core-runtime/report-rendering/src/main/java/org/gradle/reporting/CodePanelRenderer.java b/platforms/core-runtime/report-rendering/src/main/java/org/gradle/reporting/CodePanelRenderer.java
index a4b2fefdcfd..6738d04b33b 100644
--- a/platforms/core-runtime/report-rendering/src/main/java/org/gradle/reporting/CodePanelRenderer.java
+++ b/platforms/core-runtime/report-rendering/src/main/java/org/gradle/reporting/CodePanelRenderer.java
@@ -16,15 +16,30 @@
 package org.gradle.reporting;
 
 import org.gradle.internal.html.SimpleHtmlWriter;
+import org.jspecify.annotations.NullMarked;
 
 import java.io.IOException;
 
-public class CodePanelRenderer extends ReportRenderer<String, SimpleHtmlWriter> {
+import static org.gradle.reporting.HtmlWriterTools.addClipboardCopyButton;
+
+public class CodePanelRenderer extends ReportRenderer<CodePanelRenderer.Data, SimpleHtmlWriter> {
+    @NullMarked
+    public static final class Data {
+        private final String text;
+        private final String codePanelId;
+
+        public Data(String text, String codePanelId) {
+            this.text = text;
+            this.codePanelId = codePanelId;
+        }
+    }
+
     @Override
-    public void render(String text, SimpleHtmlWriter htmlWriter) throws IOException {
+    public void render(Data data, SimpleHtmlWriter htmlWriter) throws IOException {
         // Wrap in a <span>, to work around CSS problem in IE
         htmlWriter.startElement("span").attribute("class", "code")
-            .startElement("pre").characters(text).endElement()
-        .endElement();
+            .startElement("pre").attribute("id", data.codePanelId).characters(data.text).endElement();
+        addClipboardCopyButton(htmlWriter, data.codePanelId);
+        htmlWriter.endElement();
     }
 }
diff --git a/platforms/core-runtime/report-rendering/src/main/java/org/gradle/reporting/HtmlWriterTools.java b/platforms/core-runtime/report-rendering/src/main/java/org/gradle/reporting/HtmlWriterTools.java
new file mode 100644
index 00000000000..a9d9f90a49a
--- /dev/null
+++ b/platforms/core-runtime/report-rendering/src/main/java/org/gradle/reporting/HtmlWriterTools.java
@@ -0,0 +1,49 @@
+/*
+ * Copyright 2025 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.gradle.reporting;
+
+import org.gradle.internal.html.SimpleHtmlWriter;
+import org.gradle.internal.xml.SimpleMarkupWriter;
+import org.jspecify.annotations.NullMarked;
+
+import java.io.IOException;
+
+
+/**
+ * More complex HTML generation code that doesn't belong on the {@link SimpleHtmlWriter} itself.
+ */
+@NullMarked
+public class HtmlWriterTools {
+    private HtmlWriterTools() {}
+
+    /**
+     * Adds a clipboard copy button to the given writer.
+     *
+     * @param writer the writer to add the button to
+     * @param copyElementId the id of the element to copy from
+     * @return the writer
+     * @throws IOException if an I/O error occurs
+     */
+    public static SimpleMarkupWriter addClipboardCopyButton(SimpleHtmlWriter writer, String copyElementId) throws IOException {
+        return writer.startElement("button")
+            .attribute("class", "clipboard-copy-btn")
+            .attribute("aria-label", "Copy to clipboard")
+            .attribute("data-copy-element-id", copyElementId)
+            .characters("Copy")
+            .endElement();
+    }
+}
diff --git a/platforms/core-runtime/serialization/build.gradle.kts b/platforms/core-runtime/serialization/build.gradle.kts
index 2c8f7d0e3c2..cd57d81fb06 100644
--- a/platforms/core-runtime/serialization/build.gradle.kts
+++ b/platforms/core-runtime/serialization/build.gradle.kts
@@ -28,7 +28,11 @@ gradleModule {
 }
 
 jvmCompile {
-    usesFutureStdlib = true
+    compilations {
+        named("main") {
+            usesFutureStdlib = true
+        }
+    }
 }
 
 dependencies {
diff --git a/platforms/core-runtime/tooling-api-provider/src/main/java/org/gradle/tooling/internal/provider/DefaultConnection.java b/platforms/core-runtime/tooling-api-provider/src/main/java/org/gradle/tooling/internal/provider/DefaultConnection.java
index 344ab8e8f50..891354c44a2 100644
--- a/platforms/core-runtime/tooling-api-provider/src/main/java/org/gradle/tooling/internal/provider/DefaultConnection.java
+++ b/platforms/core-runtime/tooling-api-provider/src/main/java/org/gradle/tooling/internal/provider/DefaultConnection.java
@@ -29,6 +29,7 @@
 import org.gradle.internal.service.ServiceRegistryBuilder;
 import org.gradle.tooling.UnsupportedVersionException;
 import org.gradle.tooling.internal.adapter.ProtocolToModelAdapter;
+import org.gradle.tooling.internal.consumer.DefaultGradleConnector;
 import org.gradle.tooling.internal.protocol.BuildParameters;
 import org.gradle.tooling.internal.protocol.BuildResult;
 import org.gradle.tooling.internal.protocol.ConfigurableConnection;
@@ -77,7 +78,8 @@ public class DefaultConnection implements ConnectionVersion4,
 
     private static final Logger LOGGER = LoggerFactory.getLogger(DefaultConnection.class);
 
-    private static final GradleVersion MIN_CLIENT_VERSION = GradleVersion.version("3.0");
+    private static final String MIN_CLIENT_VERSION_STR = DefaultGradleConnector.MINIMUM_SUPPORTED_GRADLE_VERSION.getVersion();
+    public static final int GUARANTEED_TAPI_BACKWARDS_COMPATIBILITY = 5;
     private ProtocolToModelAdapter adapter;
     private BuildProcessState buildProcessState;
     private ProviderConnection connection;
@@ -210,10 +212,11 @@ private ProviderOperationParameters validateAndConvert(BuildParameters buildPara
     }
 
     private UnsupportedVersionException unsupportedConnectionException() {
-        return new UnsupportedVersionException(String.format("Support for clients using a tooling API version older than %s was removed in Gradle 5.0. %sYou should upgrade your tooling API client to version %s or later.",
-            MIN_CLIENT_VERSION.getVersion(),
+        return new UnsupportedVersionException(String.format("Support for clients using a tooling API version older than %s was removed in Gradle %d.0. %sYou should upgrade your tooling API client to version %s or later.",
+            MIN_CLIENT_VERSION_STR,
+            DefaultGradleConnector.MINIMAL_CLIENT_MAJOR_VERSION + GUARANTEED_TAPI_BACKWARDS_COMPATIBILITY,
             createCurrentVersionMessage(),
-            MIN_CLIENT_VERSION.getVersion()));
+            MIN_CLIENT_VERSION_STR));
     }
 
     private String createCurrentVersionMessage() {
@@ -226,7 +229,7 @@ private String createCurrentVersionMessage() {
     }
 
     private void checkUnsupportedTapiVersion() {
-        if (consumerVersion == null || consumerVersion.compareTo(MIN_CLIENT_VERSION) < 0) {
+        if (consumerVersion == null || consumerVersion.compareTo(DefaultGradleConnector.MINIMUM_SUPPORTED_GRADLE_VERSION) < 0) {
             throw unsupportedConnectionException();
         }
     }
diff --git a/platforms/documentation/docs/src/docs/dsl/org.gradle.api.tasks.testing.Test.xml b/platforms/documentation/docs/src/docs/dsl/org.gradle.api.tasks.testing.Test.xml
index db823422ac0..794d3809414 100644
--- a/platforms/documentation/docs/src/docs/dsl/org.gradle.api.tasks.testing.Test.xml
+++ b/platforms/documentation/docs/src/docs/dsl/org.gradle.api.tasks.testing.Test.xml
@@ -10,11 +10,11 @@
             </thead>
             <tr>
                 <td>testClassesDirs</td>
-                <td><literal>project.sourceSets.test.output.classesDirs</literal></td>
+                <td/>
             </tr>
             <tr>
                 <td>classpath</td>
-                <td><literal>project.sourceSets.test.runtimeClasspath</literal></td>
+                <td/>
             </tr>
             <tr>
                 <td>workingDir</td>
@@ -34,7 +34,7 @@
             </tr>
             <tr>
                 <td>executable</td>
-                <td><command>java</command> command for the current JVM.</td>
+                <td><command>java</command> launcher provided by <literal>java.toolchain</literal></td>
             </tr>
             <tr>
                 <td>systemProperties</td>
diff --git a/platforms/documentation/docs/src/docs/release/notes-template.md b/platforms/documentation/docs/src/docs/release/notes-template.md
index 44e9b9dee46..efe8016a5d0 100644
--- a/platforms/documentation/docs/src/docs/release/notes-template.md
+++ b/platforms/documentation/docs/src/docs/release/notes-template.md
@@ -33,7 +33,7 @@ Switch your build to use Gradle @version@ by updating the [wrapper](userguide/gr
 ./gradlew wrapper --gradle-version=@version@ && ./gradlew wrapper
 ```
 
-See the [Gradle 8.x upgrade guide](userguide/upgrading_version_8.html#changes_@baseVersion@) to learn about deprecations, breaking changes, and other considerations when upgrading to Gradle @version@.
+See the [Gradle 9.x upgrade guide](userguide/upgrading_version_9.html#changes_@baseVersion@) to learn about deprecations, breaking changes, and other considerations when upgrading to Gradle @version@.
 
 For Java, Groovy, Kotlin, and Android compatibility, see the [full compatibility notes](userguide/compatibility.html).   
 
diff --git a/platforms/documentation/docs/src/docs/release/notes.md b/platforms/documentation/docs/src/docs/release/notes.md
index a403bc6eec4..ad8af916af0 100644
--- a/platforms/documentation/docs/src/docs/release/notes.md
+++ b/platforms/documentation/docs/src/docs/release/notes.md
@@ -14,7 +14,7 @@ We are excited to announce Gradle @version@ (released [@releaseDate@](https://gr
 
 This release features [1](), [2](), ... [n](), and more.
 
-<!-- 
+<!--
 Include only their name, impactful features should be called out separately below.
  [Some person](https://github.com/some-person)
 
@@ -33,9 +33,9 @@ Switch your build to use Gradle @version@ by updating the [wrapper](userguide/gr
 ./gradlew wrapper --gradle-version=@version@ && ./gradlew wrapper
 ```
 
-See the [Gradle 8.x upgrade guide](userguide/upgrading_version_8.html#changes_@baseVersion@) to learn about deprecations, breaking changes, and other considerations when upgrading to Gradle @version@.
+See the [Gradle 9.x upgrade guide](userguide/upgrading_version_9.html#changes_@baseVersion@) to learn about deprecations, breaking changes, and other considerations when upgrading to Gradle @version@.
 
-For Java, Groovy, Kotlin, and Android compatibility, see the [full compatibility notes](userguide/compatibility.html).   
+For Java, Groovy, Kotlin, and Android compatibility, see the [full compatibility notes](userguide/compatibility.html).
 
 ## New features and usability improvements
 
@@ -60,8 +60,8 @@ Example:
 > PROVIDE a screenshot or snippet illustrating the new feature, if applicable
 > LINK to the full documentation for more details
 
-To embed videos, use the macros below. 
-You can extract the URL from YouTube by clicking the "Share" button. 
+To embed videos, use the macros below.
+You can extract the URL from YouTube by clicking the "Share" button.
 For Wistia, contact Gradle's Video Team.
 @youtube(Summary,6aRM8lAYyUA?si=qeXDSX8_8hpVmH01)@
 @wistia(Summary,a5izazvgit)@
@@ -75,6 +75,13 @@ vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv -->
 
 
 <a name="build-authoring"></a>
+### CLI improvement
+
+#### Plain console with colors
+
+This release adds a new value for the `--console` command line option called `colored`, which enables color output for the console while omitting rich features such as progress bars.
+
+
 ### Build authoring improvements
 
 #### Introduce `AttributeContainer#addAllLater`
@@ -107,6 +114,54 @@ assert(bar.getAttribute(color) == "orange") // `color` gets overwritten again
 assert(bar.getAttribute(shape) == "square") // `shape` remains the same
 ```
 
+### Configuration Improvements
+
+#### Simpler target package configuration for Antlr 4
+The AntlrTask class now supports explicitly setting the target package for generated code when using Antlr 4.
+Previously, setting the "-package" argument also required setting the output directory in order to generate classes into the proper package-specific directory structure.
+This release introduces a `packageName` property that allows you to set the target package without needing to also set the output directory properly.
+Setting this property will set the "-package" argument for the Antlr tool, and will also set the generated class directory to match the package.
+
+Explicitly setting the "-package" argument is now deprecated, and will become an error in Gradle 10.
+
+This option is not available for versions before Antlr 4 and will result in an error if this property is set.
+
+```kotlin
+tasks.named("generateGrammarSource").configure {
+    // Set the target package for generated code
+    packageName = "com.example.generated"
+}
+```
+
+#### Antlr generated sources are automatically tracked
+In previous versions of Gradle, the Antlr-generated sources were added to a java source set for compilation, but if the generated sources directory was changed, this change was not reflected in the source set.
+This required manually updating the source set to include the new generated sources directory any time it was changed.
+In this release, the generated sources directory is automatically tracked and updates the source set accordingly.
+A task dependency is also created between the source generation task and the source set, ensuring that tasks that consume the source set as an input will automatically create a task dependency on the source generation task.
+
+#### Specify the Repository in MavenPublication.distributionManagement
+
+For a Maven publication, it is now possible to specify the repository used for distribution in the published POM file.
+
+For example, to specify the GitHub Packages repository in the POM file, use this code: 
+```kotlin
+plugins {
+  id("maven-publish")
+}
+
+publications.withType<MavenPublication>().configureEach {
+  pom {
+    distributionManagement {
+      repository {
+        id = "github"
+        name = "GitHub OWNER Apache Maven Packages"
+        url = "https://maven.pkg.github.com/OWNER/REPOSITORY"
+      }
+    }
+  }
+}
+```
+
 <!-- ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 ADD RELEASE FEATURES ABOVE
 ==========================================================
@@ -120,9 +175,7 @@ See the User Manual section on the "[Feature Lifecycle](userguide/feature_lifecy
 
 The following are the features that have been promoted in this Gradle release.
 
-<!--
-### Example promoted
--->
+* [`getDependencyFactory()`](javadoc/org/gradle/api/Project.html) in `Project`
 
 ## Fixed issues
 
diff --git a/platforms/documentation/docs/src/docs/userguide/authoring-builds/gradle-properties/service_injection.adoc b/platforms/documentation/docs/src/docs/userguide/authoring-builds/gradle-properties/service_injection.adoc
index 4e1edc29727..895c04246d4 100644
--- a/platforms/documentation/docs/src/docs/userguide/authoring-builds/gradle-properties/service_injection.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/authoring-builds/gradle-properties/service_injection.adoc
@@ -23,27 +23,40 @@ The services are made available through _service injection_.
 [[services_for_injection]]
 == Available services
 
-The following services are available for injection:
+WARNING: You should avoid injecting types not listed below. Internal services can sometimes technically be injected, but this practice is not supported and may lead to breaking changes in the future.
+Only inject the services explicitly listed below to ensure stability and compatibility.
+
+The following services are available for injection in all Gradle instantiated objects:
 
 1. <<objectfactory,`ObjectFactory`>> - Allows model objects to be created.
-2. <<sec:projectlayout,`ProjectLayout`>> - Provides access to key project locations.
-3. <<buildlayout,`BuildLayout`>> - Provides access to important locations for a Gradle build.
-4. <<providerfactory,`ProviderFactory`>> - Creates `Provider` instances.
-5. <<workerexecutor,`WorkerExecutor`>> - Allows a task to run work in parallel.
-6. <<filesystemoperations,`FileSystemOperations`>> - Allows a task to run operations on the filesystem such as deleting files, copying files or syncing directories.
-7. <<archiveoperations,`ArchiveOperations`>> - Allows a task to run operations on archive files such as ZIP or TAR files.
-8. <<execoperations,`ExecOperations`>> - Allows a task to run external processes with dedicated support for running external `java` programs.
-9. <<toolingmodelbuilderregistry,`ToolingModelBuilderRegistry`>> - Allows a plugin to registers a Gradle tooling API model.
-10. <<testeventreporterfactory,`TestEventReporterFactory`>> - Allows a plugin to access Gradle's test events and its corresponding API.
+2. <<providerfactory,`ProviderFactory`>> - Creates `Provider` instances.
+3. <<filesystemoperations,`FileSystemOperations`>> - Allows a task to run operations on the filesystem such as deleting files, copying files or syncing directories.
+4. <<archiveoperations,`ArchiveOperations`>> - Allows a task to run operations on archive files such as ZIP or TAR files.
+5. <<execoperations,`ExecOperations`>> - Allows a task to run external processes with dedicated support for running external `java` programs.
+
+=== Additional services in workers
+
+The following services are available for injection in worker API actions and parameters:
+
+1. <<workerexecutor,`WorkerExecutor`>> - Allows a task to run work in parallel.
+
+=== Additional services in projects
+
+The following services are available for injection in project plugins, extensions and objects created in a project:
 
-Out of the above, `ProjectLayout` and `WorkerExecutor` services are only available for injection in project plugins.
-`BuildLayout` is only available in settings plugins and settings files.
-`ProjectLayout` is unavailable in Worker API actions.
+1. <<sec:projectlayout,`ProjectLayout`>> - Provides access to key project locations.
+2. <<workerexecutor,`WorkerExecutor`>> - Allows a task to run work in parallel.
+3. <<toolingmodelbuilderregistry,`ToolingModelBuilderRegistry`>> - Allows a plugin to registers a Gradle tooling API model.
+4. <<testeventreporterfactory,`TestEventReporterFactory`>> - Allows a plugin to access Gradle's test events and its corresponding API.
+5. <<dependencyfactory,`DependencyFactory`>> - Allows a plugin to create dependencies in a type-safe way.
 
-While other services can technically be injected, this practice is not supported and may lead to breaking changes in the future.
-Only inject the services explicitly listed above to ensure stability and compatibility.
+=== Additional services in settings
 
-WARNING: You should avoid injecting types not listed above.
+The following services are available for injection in settings plugins, extensions and objects created in a project:
+
+1. <<buildlayout,`BuildLayout`>> - Provides access to important locations for a Gradle build.
+2. <<toolingmodelbuilderregistry,`ToolingModelBuilderRegistry`>> - Allows a plugin to registers a Gradle tooling API model.
+3. <<dependencyfactory,`DependencyFactory`>> - Allows a plugin to create dependencies in a type-safe way.
 
 [[objectfactory]]
 == `ObjectFactory`
@@ -290,6 +303,15 @@ link:{javadocPath}/org/gradle/api/tasks/testing/TestEventReporterFactory.html[`T
 
 You can learn more at <<test_reporting_api.adoc#test_reporting_api,Test Reporting API>>.
 
+[[dependencyfactory]]
+== `DependencyFactory`
+
+link:{javadocPath}/org/gradle/api/artifacts/dsl/DependencyFactory.html[`DependencyFactory`] is a service that provides methods for creating dependencies in a type-safe way.
+
+You can learn more in the <<implementing_gradle_plugins_binary.adoc#sec:differences_with_top_level_dependencies,Implementing Binary Plugins guide>>.
+
+[[service_injection_patterns]]
+
 == Constructor injection
 
 There are 2 ways that an object can receive the services that it needs. The first option is to add the service as a parameter of the class constructor.
diff --git a/platforms/documentation/docs/src/docs/userguide/authoring-builds/gradle-properties/working_with_files.adoc b/platforms/documentation/docs/src/docs/userguide/authoring-builds/gradle-properties/working_with_files.adoc
index 9b1461aaf15..285f84a4d08 100644
--- a/platforms/documentation/docs/src/docs/userguide/authoring-builds/gradle-properties/working_with_files.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/authoring-builds/gradle-properties/working_with_files.adoc
@@ -719,7 +719,9 @@ For any `CopySpec` involved in copying files, may it be the `Copy` task itself,
 You can do the same for directories too, independently of files, via the link:{javadocPath}/org/gradle/api/file/CopyProcessingSpec.html#dirPermissions-org.gradle.api.Action-[CopySpec.dirPermissions {}] configurations block.
 
 NOTE: Not setting permissions explicitly will preserve the permissions of the original files or directories.
+The exception are archive tasks, see <<sec:reproducible_archives,Reproducible archives>> for details.
 
+.Setting file permissions for files and directories
 ====
 include::sample[dir="snippets/files/copy/kotlin",files="build.gradle.kts[tags=file-permissions]"]
 include::sample[dir="snippets/files/copy/groovy",files="build.gradle[tags=file-permissions]"]
@@ -732,8 +734,19 @@ Using empty configuration blocks for file or directory permissions still sets th
 Everything inside one of these configuration blocks is relative to the default values.
 Default permissions differ for files and directories:
 
-* *file*: read & write for *owner*, read for *group*, read for *other* (*0644*, *rw-r--r--*)
-* *directory*: read, write & execute for *owner*, read & execute for *group*, read & execute for *other* (*0755*, *rwxr-xr-x*)
+* *file*: read & write for *owner*, read for *group*, read for *other* (`0644`, `rw-r--r--`)
+* *directory*: read, write & execute for *owner*, read & execute for *group*, read & execute for *other* (`0755`, `rwxr-xr-x`)
+
+It's also possible to set permissions for a specific file. See the following example:
+
+.Setting file permissions for a specific file
+====
+include::sample[dir="snippets/files/copy/kotlin",files="build.gradle.kts[tags=file-specific-permissions]"]
+include::sample[dir="snippets/files/copy/groovy",files="build.gradle[tags=file-specific-permissions]"]
+====
+
+NOTE: Setting file permissions explicitly for a file doesn't support `UP-TO-DATE` checks, so a task using this setting will always run.
+
 
 [[sec:moving_files_example]]
 == Moving files and directories
@@ -999,7 +1012,9 @@ include::sample[dir="snippets/files/fileTrees/groovy",files="build.gradle[tags=a
 You can see a practical example of extracting an archive file <<#sec:unpacking_archives_example,in the unpacking archives section>> below.
 
 [[sec:reproducible_archives]]
-=== Using `AbstractArchiveTask` for reproducible builds
+== Reproducible archives
+
+NOTE: Starting with Gradle 9, archives are reproducible by default.
 
 It's desirable to recreate archives exactly the same, byte for byte, on different machines.
 Building an artifact from source code should produce the same result no matter when and where it is built.
@@ -1021,7 +1036,7 @@ or link:{groovyDslPath}/org.gradle.api.tasks.bundling.AbstractArchiveTask.html#o
 while keeping the archives reproducible.
 
 [[sec:revert_reproducible_archives]]
-==== Preserve file system-defined aspects
+=== Preserve file system-defined aspects
 
 If desired, you can revert individual aspects of reproducible archives.
 
@@ -1041,6 +1056,19 @@ In case the file system is already the source of truth for the permissions, e.g.
 org.gradle.archives.use-file-system-permissions=true
 ----
 
+[[sec:permissions_inside_archives]]
+== Permissions for files inside archives
+
+Setting file permissions in Gradle archives is done in the same way as when copying file, see <<#sec:setting_file_permissions,Setting file permissions>> for details.
+The main difference is that archive tasks by default set the permissions of files and directories in the archive to fixed values, which are `0644` for files and `0755` for directories for reproducibility.
+
+We recognize two main cases, where users may want to change the permissions of files and directories in archives:
+
+1. Case where the file system is already the source of truth for the permissions.
+For such configuration see <<#sec:revert_reproducible_archives,Preserve file system-defined aspects>> section.
+2. Case where the permissions of files and directories in the archive should be set to specific values, for example to set the executable bit on a script file.
+For such configuration see <<#sec:setting_file_permissions,Setting file permissions>> section.
+
 [[sec:unpacking_archives_example]]
 == Unpacking archives
 
diff --git a/platforms/documentation/docs/src/docs/userguide/authoring-builds/structuring/multi_project_builds.adoc b/platforms/documentation/docs/src/docs/userguide/authoring-builds/structuring/multi_project_builds.adoc
index dbc4ebe2ae4..ee0e4fba165 100644
--- a/platforms/documentation/docs/src/docs/userguide/authoring-builds/structuring/multi_project_builds.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/authoring-builds/structuring/multi_project_builds.adoc
@@ -14,7 +14,7 @@
 
 [[multi_project_builds]]
 = Multi-Project Builds
-:keywords: multi, build, project
+:keywords: multi, project, subprojects, multi-project
 
 As projects grow, it's common to split them into smaller, focused modules that are built, tested, and released together.
 Gradle supports this through multi-project builds, allowing you to organize related codebases under a single build while keeping each module logically isolated.
diff --git a/platforms/documentation/docs/src/docs/userguide/authoring-builds/tasks/more_about_tasks.adoc b/platforms/documentation/docs/src/docs/userguide/authoring-builds/tasks/more_about_tasks.adoc
index 2a6e08b0ea8..6ad5e74aec0 100644
--- a/platforms/documentation/docs/src/docs/userguide/authoring-builds/tasks/more_about_tasks.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/authoring-builds/tasks/more_about_tasks.adoc
@@ -17,7 +17,11 @@
 
 A task represents some *independent unit of work* that a build performs, such as compiling classes, creating a JAR, generating Javadoc, or publishing archives to a repository.
 
-image::writing-tasks-1.png[]
+++++
+<p style="text-align: center;">
+<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/FB5muea-2Z0?si=XcoZGjrw0KD5FSIJ&rel=0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
+</p>
+++++
 
 Before reading this chapter, it's recommended that you first read the <<gradle_directories.adoc#gradle_directories,Learning The Basics>> and complete the <<part1_gradle_init_project.adoc#part1_gradle_init,Tutorial>>.
 
diff --git a/platforms/documentation/docs/src/docs/userguide/best-practices/best_practices_dependencies.adoc b/platforms/documentation/docs/src/docs/userguide/best-practices/best_practices_dependencies.adoc
index 20067748880..4a364b5c182 100644
--- a/platforms/documentation/docs/src/docs/userguide/best-practices/best_practices_dependencies.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/best-practices/best_practices_dependencies.adoc
@@ -85,34 +85,41 @@ Consistent and descriptive names in your version catalog enhance readability and
 
 === Explanation
 
-Version catalogs provide a centralized way to manage dependencies.
-Adopting clear naming conventions for catalog entries ensures that developers can easily identify and use dependencies throughout the project.
+Version catalogs provide a centralized way to manage dependencies by mapping full dependency coordinates to concise, reusable aliases like `airlift-aircompressor`.
+Adopting clear naming conventions for those aliases ensures that developers can easily identify and use dependencies throughout the project.
+
+Aliases are typically made up of 1 to 3 segments.
+For example `org.apache.commons:commons-lang3` could be represented as `commonsLang3`, `apache-commonsLang3`, or `commons-lang3`.
 
 The following guidelines help in naming catalog entries effectively:
 
-1. **Use dashes to separate segments**: Prefer dashes (`-`) over underscores (`_`) to separate different parts of the entry name.
+1. **Use dashes to separate segments**: Prefer hyphen/dashes (`-`) over underscores (`_`) to separate different parts of the entry name.
++
+Example: For `org.apache.logging.log4j:log4j-api`, use `log4j-api`
+
+2. **Derive the first segment from the project group**: Use a unique identifier from the project's group ID as the first segment. Do not include the top level domain in the segment (`com`, `org`, `net`, `dev`).
 +
-*Example*: For `org.apache.logging.log4j:log4j-api`, use `log4j-api`
+Example: For `com.fasterxml.jackson.core:jackson-databind`, use `jackson-databind` or `jackson-core-databind`
 
-2. **Derive the first segment from the project group**: Use a unique identifier from the project's group ID as the first segment.
+3. **Derive the second segment from the artifact ID**: Use a unique identifier from the artifact ID as the second segment.
 +
-*Example*: For `com.fasterxml.jackson.core:jackson-databind`, use `jackson-databind`
+Example: For `com.linecorp.armeria:armeria-grpc`, use `armeria-grpc`
 
-3. **Omit redundant segments**: If the group and artifact IDs are the same, avoid repeating them.
+4. **Avoid generic terms in the segments**: Exclude terms that are obvious or implied in the context of your project (`core`, `java`, `gradle`, `module`, `sdk`), especially if the term appears by itself.
 +
-*Example*: For `io.ktor:ktor-client-core`, use `ktor-client-core`, not `ktor-ktor-client-core`
+Example: For `com.google.googlejavaformat:google-java-format`, use `google-java-format`, not `google-java` or `java`
 
-4. **Convert internal dashes to camelCase**: If the artifact ID contains dashes, convert them to camelCase for better readability in code.
+5. **Omit redundant segments**: If the group and artifact IDs are the same, avoid repeating them.
 +
-*Example*: `spring-boot-starter-web` becomes `springBootStarterWeb`
+Example: For `io.ktor:ktor-client-core`, use `ktor-client-core`, not `ktor-ktor-client-core`
 
-5. **Avoid implicit terms**: Exclude terms that are obvious or implied in the context of your project.
+6. **Convert internal dashes to camelCase**: If the artifact ID contains dashes, convert them to camelCase for better readability in code.
 +
-*Example*: For `com.amazonaws:aws-java-sdk-core`, use `aws-core`, not `aws-javaSdkCore`
+Example: `spring-boot-starter-web` becomes `springBootStarterWeb`
 
-6. **Suffix plugin libraries with `-plugin`**: When referencing a plugin as a library (not in the `[plugins]` section), append `-plugin` to the name.
+7. **Suffix plugin libraries with `-plugin`**: When referencing a plugin as a library (not in the `[plugins]` section), append `-plugin` to the name.
 +
-*Example*: For `org.owasp:dependency-check-gradle`, use `dependency-check-plugin`
+Example: For `org.owasp:dependency-check-gradle`, use `dependency-check-plugin`
 
 === Example
 
diff --git a/platforms/documentation/docs/src/docs/userguide/best-practices/best_practices_general.adoc b/platforms/documentation/docs/src/docs/userguide/best-practices/best_practices_general.adoc
index d26944159a4..3d0469a8b52 100644
--- a/platforms/documentation/docs/src/docs/userguide/best-practices/best_practices_general.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/best-practices/best_practices_general.adoc
@@ -81,7 +81,7 @@ Subscribe to the Gradle link:https://newsletter.gradle.org/[newsletter] to stay
 
 === References
 
-- <<upgrading_version_8.adoc#upgrading_version_8,Upgrade Guide>>
+- <<upgrading_version_9.adoc#upgrading_version_9,Upgrade Guide>>
 
 === Tags
 
diff --git a/platforms/documentation/docs/src/docs/userguide/best-practices/best_practices_structuring_builds.adoc b/platforms/documentation/docs/src/docs/userguide/best-practices/best_practices_structuring_builds.adoc
index 256eb79c565..ee1ce67b583 100644
--- a/platforms/documentation/docs/src/docs/userguide/best-practices/best_practices_structuring_builds.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/best-practices/best_practices_structuring_builds.adoc
@@ -17,7 +17,6 @@
 
 [[modularize_builds]]
 == Modularize Your Builds
-:keywords: structuring-builds
 
 Modularize your builds by splitting your code into multiple projects.
 
@@ -220,7 +219,6 @@ include::sample[dir="snippets/bestPractices/modularizeYourBuild-do/groovy/util-g
 
 [[no_source_in_root]]
 == Do Not Put Source Files in the Root Project
-:keywords: structuring-builds
 
 Do not put source files in your root project; instead, put them in a separate project.
 
@@ -338,7 +336,6 @@ include::sample[dir="snippets/bestPractices/noSourceInRoot-do/groovy/core",files
 
 [[favor_composite_builds]]
 == Favor `build-logic` Composite Builds for Build Logic
-:keywords: structuring-builds,composite-builds,buildSrc
 
 You should set up a <<composite_builds.adoc#defining_composite_builds,Composite Build>> (often called an "included build") to hold your build logicincluding any custom plugins, convention plugins, and other build-specific customizations.
 
@@ -493,7 +490,6 @@ include::sample[dir="snippets/bestPractices/favorCompositeBuilds-do/groovy/build
 
 [[avoid_empty_projects]]
 == Avoid Unintentionally Creating Empty Projects
-:keywords: structuring-builds
 
 When using a hierarchical directory structure to organize your Gradle projects, make sure to avoid unintentionally creating empty projects in your build.
 
diff --git a/platforms/documentation/docs/src/docs/userguide/dep-man/centralizing-dependencies/version_catalogs.adoc b/platforms/documentation/docs/src/docs/userguide/dep-man/centralizing-dependencies/version_catalogs.adoc
index 48ca7134e8f..422cee8fe80 100644
--- a/platforms/documentation/docs/src/docs/userguide/dep-man/centralizing-dependencies/version_catalogs.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/dep-man/centralizing-dependencies/version_catalogs.adoc
@@ -16,6 +16,12 @@
 = Version Catalogs
 :keywords: toml, libs.versions.toml
 
+++++
+<p style="text-align: center;">
+<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/dZmlSsRdctE?si=2u96T8ieHzOu4_48&rel=0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
+</p>
+++++
+
 A version catalog is a selected list of dependencies that can be referenced in build scripts, simplifying dependency management.
 
 Instead of specifying dependencies directly using string notation, you can pick them from a version catalog:
diff --git a/platforms/documentation/docs/src/docs/userguide/dep-man/controlling-dependency-resolution/artifact_transforms.adoc b/platforms/documentation/docs/src/docs/userguide/dep-man/controlling-dependency-resolution/artifact_transforms.adoc
index 752d42911d5..6772bd2ea52 100644
--- a/platforms/documentation/docs/src/docs/userguide/dep-man/controlling-dependency-resolution/artifact_transforms.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/dep-man/controlling-dependency-resolution/artifact_transforms.adoc
@@ -468,3 +468,79 @@ It's important to remember that Artifact Transforms:
 If there are no artifacts present in an input variant to a transform, that transform will be skipped.
 This can happen in the middle of a chain of actions, resulting in all subsequent transforms being skipped.
 ====
+
+[[sec:debugging-artifact-transforms]]
+== Debugging Artifact Transforms
+
+You can use the `artifactTransforms` task to inspect the artifact transforms registered in your build.
+This task makes it easier to debug unexpected transform behavior, understand which transforms are applied, and see how artifacts flow through your build.
+
+To generate the report, run:
+
+[source, bash]
+----
+$ ./gradlew artifactTransforms
+----
+
+This will produce output listing all registered transforms, including details such as:
+
+* The input and output artifact types for each transform
+* Attributes required for the transform to apply
+* Implementation details of custom transforms
+
+This report is especially helpful if you encounter issues with artifact selection or resolution errors related to transforms.
+
+Its important to note that the `artifactTransforms` task operates on a single project.
+If you run it on a subproject, it will report the transforms registered only in that specific project.
+
+For example, to view the artifact transforms in the `app` subproject, you would run:
+
+[source, text]
+----
+$ ./gradlew :app:artifactTransforms
+
+> Task :app:artifactTransforms
+
+--------------------------------------------------
+CopyTransform
+--------------------------------------------------
+Type: dagger.hilt.android.plugin.transform.CopyTransform
+Cacheable: No
+From Attributes:
+    - artifactType = android-classes
+To Attributes:
+    - artifactType = jar-for-dagger
+
+--------------------------------------------------
+CopyTransform
+--------------------------------------------------
+Type: dagger.hilt.android.plugin.transform.CopyTransform
+Cacheable: No
+From Attributes:
+    - artifactType = directory
+To Attributes:
+    - artifactType = jar-for-dagger
+
+--------------------------------------------------
+AggregatedPackagesTransform
+--------------------------------------------------
+Type: dagger.hilt.android.plugin.transform.AggregatedPackagesTransform
+Cacheable: Yes
+From Attributes:
+    - artifactType = jar-for-dagger
+To Attributes:
+    - artifactType = aggregated-jar-for-hilt
+
+Some artifact transforms are not cacheable.  This can have negative performance impacts.
+----
+
+Because the task only inspects the current project, running it on the root project, where no transforms are registered, will produce empty output:
+
+[source, text]
+----
+$ ./gradlew artifactTransforms
+
+> Task :artifactTransforms
+
+There are no transforms registered in root project 'gradle'.
+----
diff --git a/platforms/documentation/docs/src/docs/userguide/dep-man/controlling-dependency-resolution/resolving_specific_artifacts.adoc b/platforms/documentation/docs/src/docs/userguide/dep-man/controlling-dependency-resolution/resolving_specific_artifacts.adoc
new file mode 100644
index 00000000000..c82e09a2d36
--- /dev/null
+++ b/platforms/documentation/docs/src/docs/userguide/dep-man/controlling-dependency-resolution/resolving_specific_artifacts.adoc
@@ -0,0 +1,58 @@
+// Copyright (C) 2024 Gradle, Inc.
+//
+// Licensed under the Creative Commons Attribution-Noncommercial-ShareAlike 4.0 International License.;
+// you may not use this file except in compliance with the License.
+// You may obtain a copy of the License at
+//
+//      https://creativecommons.org/licenses/by-nc-sa/4.0/
+//
+// Unless required by applicable law or agreed to in writing, software
+// distributed under the License is distributed on an "AS IS" BASIS,
+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+// See the License for the specific language governing permissions and
+// limitations under the License.
+
+[[resolving-specific-artifacts]]
+= Resolving Specific Artifacts
+
+When resolving a module from a Maven or Ivy repository, Gradle looks for metadata (e.g., `.module`, `pom.xml`, `ivy.xml`) and a default artifact file (typically a JAR).
+If neither is found, the resolution fails.
+
+In some cases, you may want to override this behavior and request only a specific artifact from a module:
+
+* The module provides only a non-standard artifact (e.g., a ZIP file) with no metadata.
+* The module publishes multiple artifacts, and you only want one of them.
+* You want to avoid resolving transitive dependencies declared in metadata.
+
+Gradle supports this use case with **artifact-only notation**, where you append an `@<extension>` to the dependency coordinates.
+This instructs Gradle to resolve only the artifact with that file extension and skip metadata-based resolution entirely.
+
+WARNING: The `@<extension>` *only* works for module dependencies.
+
+For example, suppose you're building a web application and want to fetch a JavaScript library directly from a repository rather than checking it into version control.
+The link:https://developers.google.com/speed/libraries/[Google Hosted Libraries] platform distributes many open-source JavaScript libraries this way.
+
+To download the `.js` artifact directly, use the `@js` syntax:
+
+====
+include::sample[dir="snippets/dependencyManagement/declaringDependencies-artifactOnly/groovy",files="build.gradle[tags=artifact-only-dependency-declaration]"]
+include::sample[dir="snippets/dependencyManagement/declaringDependencies-artifactOnly/kotlin",files="build.gradle.kts[tags=artifact-only-dependency-declaration]"]
+====
+
+Some modules publish multiple "flavors" of the same artifactfor example, compiled classes, source code, or Javadocs.
+In JavaScript, a library may publish both an uncompressed and a minified version.
+These variants are often distinguished using a **classifier**, a common concept in Maven and Ivy.
+
+To request an artifact with a specific classifier, include it in the dependency notation.
+The following example resolves the minified version of a JQuery library using the classifier `min`:
+
+====
+include::sample[dir="snippets/dependencyManagement/declaringDependencies-artifactOnlyWithClassifier/groovy",files="build.gradle[tags=artifact-only-dependency-declaration]"]
+include::sample[dir="snippets/dependencyManagement/declaringDependencies-artifactOnlyWithClassifier/kotlin",files="build.gradle.kts[tags=artifact-only-dependency-declaration]"]
+====
+
+Using `@extension` bypasses metadata-based resolution.
+Gradle will not attempt to download or interpret module metadata (e.g., `.module`, `pom.xml`, `ivy.xml`), and will treat the coordinates as a direct request for a single artifact.
+As a result, variant-aware resolution, capabilities, and transitive dependencies are all bypassed.
+If no metadata is available and the requested artifact cannot be found, the build may fail.
+In such cases, you may need to provide module metadata using <<component_metadata_rules.adoc#component-metadata-rules,component metadata rules>>.
diff --git a/platforms/documentation/docs/src/docs/userguide/dep-man/how-to/how_to_resolve_specific_artifacts.adoc b/platforms/documentation/docs/src/docs/userguide/dep-man/how-to/how_to_resolve_specific_artifacts.adoc
index 249a6a34754..afd2219627e 100644
--- a/platforms/documentation/docs/src/docs/userguide/dep-man/how-to/how_to_resolve_specific_artifacts.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/dep-man/how-to/how_to_resolve_specific_artifacts.adoc
@@ -41,6 +41,8 @@ include::sample[dir="snippets/dependencyManagement/declaringDependencies-artifac
 include::sample[dir="snippets/dependencyManagement/declaringDependencies-artifactOnly/groovy",files="build.gradle[tags=artifact-only-dependency-declaration]"]
 ====
 
+WARNING: Declaring dependencies with a custom extension (e.g. `@zip`, `@jar`, or `@custom`) disables metadata resolution. Gradle treats this as a request for a specific artifact, skipping variant-aware resolution and component metadata. You may need to provide metadata with a custom <<component_metadata_rules.adoc#component-metadata-rules,component metadata rule>>.
+
 == Step 2: Resolving an Artifact with a Classifier
 
 Some libraries provide multiple variations or **flavors** of an artifact.
diff --git a/platforms/documentation/docs/src/docs/userguide/dep-man/how-to/how_to_upgrade_transitive_dependencies.adoc b/platforms/documentation/docs/src/docs/userguide/dep-man/how-to/how_to_upgrade_transitive_dependencies.adoc
index 605a7c22cac..f6aaacde64c 100644
--- a/platforms/documentation/docs/src/docs/userguide/dep-man/how-to/how_to_upgrade_transitive_dependencies.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/dep-man/how-to/how_to_upgrade_transitive_dependencies.adoc
@@ -26,7 +26,7 @@ There are many reasons to upgrade a version of a dependency:
 * *Performance improvements* make builds faster and more efficient.
 * *New features* provide additional functionality and better compatibility.
 
-== Step 1: Setting Dependency Constraints on Transitive Dependencies
+== Setting Dependency Constraints on Transitive Dependencies
 
 <<dependency_constraints.adoc#dependency-constraints,Dependency constraints>> allow you to define the **version** or **version range** of both direct dependencies and transitive dependencies.
 
diff --git a/platforms/documentation/docs/src/docs/userguide/optimizing-builds/build-cache/build_cache.adoc b/platforms/documentation/docs/src/docs/userguide/optimizing-builds/build-cache/build_cache.adoc
index 89f8e257b01..de5a04c7534 100644
--- a/platforms/documentation/docs/src/docs/userguide/optimizing-builds/build-cache/build_cache.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/optimizing-builds/build-cache/build_cache.adoc
@@ -14,6 +14,7 @@
 
 [[build_cache]]
 = Build Cache
+:keywords: build cache, build-cache
 
 ++++
 <div class="badge-wrapper">
diff --git a/platforms/documentation/docs/src/docs/userguide/optimizing-builds/configuration-cache/configuration_cache.adoc b/platforms/documentation/docs/src/docs/userguide/optimizing-builds/configuration-cache/configuration_cache.adoc
index e1e82fa5478..c31c4e8e3c8 100644
--- a/platforms/documentation/docs/src/docs/userguide/optimizing-builds/configuration-cache/configuration_cache.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/optimizing-builds/configuration-cache/configuration_cache.adoc
@@ -16,7 +16,7 @@
 
 [[config_cache]]
 = Configuration Cache
-:keywords: configuration-cache, no-configuration-cache, org.gradle.configuration-cache, org.gradle.configuration-cache.problems, org.gradle.configuration-cache.max-problems, org.gradle.configuration-cache.parallel, STABLE_CONFIGURATION_CACHE,
+:keywords: configuration cache, configuration-cache, no-configuration-cache, org.gradle.configuration-cache, org.gradle.configuration-cache.problems, org.gradle.configuration-cache.max-problems, org.gradle.configuration-cache.parallel, STABLE_CONFIGURATION_CACHE,
 
 // Run tests for snippets included in this chapter with:
 // ./gradlew :docs:docsTest --tests="ExemplarExternalSamplesFunctionalTest.snippet-configuration-cache-*"
diff --git a/platforms/documentation/docs/src/docs/userguide/platforms/jvm/java_testing.adoc b/platforms/documentation/docs/src/docs/userguide/platforms/jvm/java_testing.adoc
index 6e459f6d17c..44faa9ba314 100644
--- a/platforms/documentation/docs/src/docs/userguide/platforms/jvm/java_testing.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/platforms/jvm/java_testing.adoc
@@ -97,14 +97,6 @@ You can also enable this behavior by using the `--test-dry-run` command-line opt
 
 See link:{groovyDslPath}/org.gradle.api.tasks.testing.Test.html[Test] for details on all the available configuration options.
 
---
-The test process can exit unexpectedly if configured incorrectly. For instance, if the Java executable does not exist or an invalid JVM argument is provided, the test process will fail to start. Similarly, if a test makes programmatic changes to the test process, this can also cause unexpected failures.
-
-For example, issues may occur if a `{javaApi}/java/lang/SecurityManager.html[SecurityManager]` is modified in a test because
-Gradle's internal messaging depends on reflection and socket communication, which may be disrupted if the permissions on the security manager change. In this particular case, you should restore the original `SecurityManager` after the test so that the
-gradle test worker process can continue to function.
---
-
 [[test_filtering]]
 == Test filtering
 
@@ -559,6 +551,55 @@ Users commonly want to run integration tests after the unit tests, because they
 
 For information on how to determine code coverage for tests in additional source sets, see the <<jacoco_plugin#jacoco_plugin,JaCoCo Plugin>> and the <<jacoco_report_aggregation_plugin#jacoco_report_aggregation_plugin, JaCoCo Report Aggregation Plugin>> chapters.
 
+[[sec:java_testing_troubleshooting]]
+== Troubleshooting common problems
+
+=== Tests are not detected or executed
+
+If no tests are detected, Gradle will skip the `Test` task entirely.
+
+This can occur for several reasons:
+
+ * No test sources exist. This is expected behavior for empty test suites.
+ * Test sources exist but are not compiled. This may happen if:
+ ** The source files are located in the wrong directory.
+ ** The source set is not configured correctly.
+ * No test classes are configured on the `Test` task. By default, only the built-in `Test` task is automatically configured to use the test source set.
+   If you're using a custom `Test` task, you must manually configure both `testClassesDirs` and `classpath`.
+
+Prior to Gradle 9.0.0, all `Test` tasks were <<upgrading_version_8#test_task_default_classpath,implicitly configured>> to use the `test` source set.
+
+=== Test process fails to start or stay running
+
+The test process may fail to start if configured incorrectly.
+For instance, if the Java executable does not exist or an invalid JVM argument is provided, the test process will fail to start.
+
+Similarly, if a test requires changes to the environment that are not compatible with Gradle's test worker process, the test process may fail to start.
+For example, tests that rely on modifying the link:{javaApi}/java/lang/SecurityManager.html[`SecurityManager`] may interfere with Gradle's internal messaging communication between the build and test worker.
+
+=== Test process starts but test dependencies are missing
+
+Once the test process starts, it may fail to find its required dependencies if they are missing from the test runtime classpath.
+
+Test dependencies need to be declared on the appropriate configuration.
+The <<jvm_test_suite_plugin.adoc#jvm_test_suite_plugin,JVM Test Suite>> plugin automatically configures all necessary dependencies, but if you are manually configuring a `Test` task, you need to ensure that all required dependencies are declared on the appropriate configuration.
+
+For JUnit4-based tests, you need to declare a dependency on a single JUnit 4.x library.
+For TestNG-based tests, you need to declare a dependency on a single TestNG library.
+For JUnit Jupiter-based tests, you need to declare dependencies on the JUnit Jupiter and JUnit platform libraries.
+
+Prior to Gradle 9.0.0, Gradle <<upgrading_version_8#test_framework_implementation_dependencies,leaked internal dependencies>> into the test runtime classpath which may have masked missing dependencies.
+
+=== Test process fails with unusual exit code
+
+The test process can exit with an unusual exit code (non-zero).
+
+This can be caused by a variety of issues, such as:
+
+ * A test calls `System.exit()` directly.
+ * Too many processes are running which causes the OS to kill the test process.
+ * The test process runs out of memory.
+
 [[sec:java_testing_modular]]
 == Testing Java Modules
 
diff --git a/platforms/documentation/docs/src/docs/userguide/platforms/jvm/toolchains.adoc b/platforms/documentation/docs/src/docs/userguide/platforms/jvm/toolchains.adoc
index 835832c9d7d..7f4c0443bf7 100644
--- a/platforms/documentation/docs/src/docs/userguide/platforms/jvm/toolchains.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/platforms/jvm/toolchains.adoc
@@ -422,6 +422,7 @@ The following is a list of common package managers, tools, and locations that ar
 JVM auto-detection knows how to work with:
 
 * Operation-system specific locations: Linux, macOS, Windows
+* Conventional Environment Variable: `JAVA_HOME`
 * Package Managers: https://asdf-vm.com/#/[Asdf-vm], https://github.com/shyiko/jabba[Jabba], https://sdkman.io/[SDKMAN!]
 * https://maven.apache.org/guides/mini/guide-using-toolchains.html[Maven Toolchain] specifications
 * https://www.jetbrains.com/help/idea/sdk.html#jdk-from-ide[IntelliJ IDEA] installations
diff --git a/platforms/documentation/docs/src/docs/userguide/platforms/native/native_software.adoc b/platforms/documentation/docs/src/docs/userguide/platforms/native/native_software.adoc
index 1df2b6f4b97..cc54f5b28d7 100644
--- a/platforms/documentation/docs/src/docs/userguide/platforms/native/native_software.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/platforms/native/native_software.adoc
@@ -606,7 +606,7 @@ You are able to construct a resource-only library by providing Windows Resource
 [source.multi-language-sample,groovy]
 .only-dll/build.gradle
 ----
-include::{snippetsPath}/native-binaries/windows-resources/groovy/bonly-dll/build.gradle[tag=resource-only-library]
+include::{snippetsPath}/native-binaries/windows-resources/groovy/only-dll/build.gradle[tag=resource-only-library]
 ----
 
 The example above also demonstrates the mechanism of passing extra command-line arguments to the resource compiler. The `rcCompiler` extension is of type link:{javadocPath}/org/gradle/nativeplatform/PreprocessingTool.html[PreprocessingTool].
diff --git a/platforms/documentation/docs/src/docs/userguide/releases/compatibility.adoc b/platforms/documentation/docs/src/docs/userguide/releases/compatibility.adoc
index 731ca0732dd..990bda4e35e 100644
--- a/platforms/documentation/docs/src/docs/userguide/releases/compatibility.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/releases/compatibility.adoc
@@ -24,9 +24,9 @@ Gradle runs on the Java Virtual Machine (JVM), which is often provided by either
 A JVM version between 17 and 24 is required to execute Gradle.
 JVM 25 and later versions are not yet supported.
 
-The Gradle wrapper, Gradle client, Tooling API client, and TestKit client will remain compatible with JVM 8.
+The Gradle wrapper, Gradle client, Tooling API client, and TestKit client are compatible with JVM 8.
 
-JDK 6 above can be used for <<building_java_projects.adoc#sec:java_cross_compilation,compilation>>.
+JDK 6 and above can be used for <<building_java_projects.adoc#sec:java_cross_compilation,compilation>>.
 JVM 8 and above can be used for executing tests.
 
 Any fully supported version of Java can be used for compilation or testing.
@@ -66,7 +66,7 @@ We encourage users to try it out and let us know.
 [[kotlin]]
 == Kotlin
 
-Gradle is tested with Kotlin 2.0.0 through 2.2.0-RC2.
+Gradle is tested with Kotlin 2.0.0 through 2.2.0.
 Beta and RC versions may or may not work.
 
 .Embedded Kotlin version
diff --git a/platforms/documentation/docs/src/docs/userguide/releases/installation.adoc b/platforms/documentation/docs/src/docs/userguide/releases/installation.adoc
index db814353d68..c03373f5574 100644
--- a/platforms/documentation/docs/src/docs/userguide/releases/installation.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/releases/installation.adoc
@@ -38,7 +38,7 @@ This is identifiable by the presence of the `gradlew` or `gradlew.bat` files in
 If the `gradlew` or `gradlew.bat` files are already present in your project, *you do not need to install Gradle*.
 But you need to make sure your system <<installation#sec:prerequisites,satisfies Gradle's prerequisites>>.
 
-You can follow the steps in the <<upgrading_version_8.adoc#upgrading_version_8,Upgrading Gradle section>> if you want to update the Gradle version for your project.
+You can follow the steps in the <<upgrading_version_9.adoc#upgrading_version_9,Upgrading Gradle section>> if you want to update the Gradle version for your project.
 Please use the <<gradle_wrapper.adoc#sec:upgrading_wrapper,Gradle Wrapper>> to upgrade Gradle.
 
 Android Studio comes with a working installation of Gradle, so you *don't need to install Gradle separately when only working within that IDE*.
@@ -59,12 +59,13 @@ To check, run `java -version`:
 
 ----
  java -version
-openjdk version "11.0.18" 2023-01-17
-OpenJDK Runtime Environment Homebrew (build 11.0.18+0)
-OpenJDK 64-Bit Server VM Homebrew (build 11.0.18+0, mixed mode)
+openjdk version "17.0.6" 2023-01-17
+OpenJDK Runtime Environment Temurin-17.0.6+10 (build 17.0.6+10)
+OpenJDK 64-Bit Server VM Temurin-17.0.6+10 (build 17.0.6+10, mixed mode)
 ----
 
-Gradle uses the JDK it finds in your path, the JDK used by your IDE, or the JDK specified by your project.
+Gradle uses the JDK it finds in your path, the JDK used by your IDE, or the <<gradle_daemon#sec:configuring_daemon_jvm,JDK specified in your project>>.
+
 In this example, the $PATH points to JDK17:
 
 ----
@@ -77,12 +78,12 @@ This is especially useful when multiple JDKs are installed:
 
 ----
  echo %JAVA_HOME%
-C:\Program Files\Java\jdk1.7.0_80
+C:\Program Files\Java\jdk17.0_6
 ----
 
 ----
  echo $JAVA_HOME
-/Library/Java/JavaVirtualMachines/jdk-16.jdk/Contents/Home
+/Library/Java/JavaVirtualMachines/jdk-17.jdk/Contents/Home
 ----
 
 Gradle supports link:https://kotlinlang.org/[Kotlin] and link:https://groovy-lang.org/[Groovy] as the main build languages.
diff --git a/platforms/documentation/docs/src/docs/userguide/releases/troubleshooting.adoc b/platforms/documentation/docs/src/docs/userguide/releases/troubleshooting.adoc
index f43cf76f24c..03dd028ebe3 100644
--- a/platforms/documentation/docs/src/docs/userguide/releases/troubleshooting.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/releases/troubleshooting.adoc
@@ -62,9 +62,9 @@ ERROR: JAVA_HOME is set to an invalid directory
 Set the JAVA_HOME variable in your environment to match the location of your Java installation:
 
 ----
-$ export JAVA_HOME=/Users/user/Library/Java/JavaVirtualMachines/corretto-11.0.22/Contents/Home
+$ export JAVA_HOME=/Users/user/Library/Java/JavaVirtualMachines/corretto-22.0.1/Contents/Home
 $ echo $JAVA_HOME
-/Users/user/Library/Java/JavaVirtualMachines/corretto-11.0.22/Contents/Home
+/Users/user/Library/Java/JavaVirtualMachines/corretto-22.0.1/Contents/Home
 ----
 
 You must ensure that a link:{jdkDownloadUrl}[Java Development Kit] version {minJdkVersion} or higher is link:https://www.java.com/en/download/help/index_installing.html[properly installed], the `JAVA_HOME` environment variable is set, and Java is added to your `PATH`.
diff --git a/platforms/documentation/docs/src/docs/userguide/releases/upgrading/upgrading_version_8.adoc b/platforms/documentation/docs/src/docs/userguide/releases/upgrading/upgrading_version_8.adoc
index 051c20d2ab2..a0d35edec2c 100644
--- a/platforms/documentation/docs/src/docs/userguide/releases/upgrading/upgrading_version_8.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/releases/upgrading/upgrading_version_8.adoc
@@ -168,7 +168,7 @@ Refer to Gradles link:compatibility.html#kotlin[compatibility matrix] for det
 
 NOTE: Plugins written using the Kotlin DSL and published with Gradle 7.x or 8.x remain compatible with Gradle 6.8 and newer.
 
-==== Plugins written with the Groovy DSL require Gradle <= 7.0
+==== Plugins written with the Groovy DSL require Gradle >= 7.0
 
 Plugins authored using the Groovy DSL and built with Gradle 9.x require Gradle 7.0 or newer to run.
 This is because Gradle 7.0 introduced Groovy 3.0 support, and Gradle 9 embeds Groovy 4.0.
@@ -215,6 +215,26 @@ However, these configurations were unresolvable and could lead to errors in the
 
 As of Gradle 9, these configurations are no longer created or used by the Scala plugins.
 
+=== Settings file changes
+
+==== Project directories must exist and be writeable
+
+Gradle will fail if a project is included that does not correspond to an existing directory on the file system, or if the directory exists but is read-only.
+
+For example, you may see an error like:
+
+[source,text]
+----
+
+* What went wrong:
+Configuring project ':subproject1' without an existing directory is not allowed. The configured projectDirectory '.../subproject1' does not exist, can't be written to or is not a directory.
+
+* Try:
+> Make sure the project directory exists and is writable.
+----
+
+See <<deprecated_missing_project_directory>> for more details.
+
 === Task changes
 
 [[validate_plugins_without_java_toolchain_90]]
@@ -295,32 +315,6 @@ The `model` and `component` tasks report on the structure of legacy software mod
 Previously, these tasks were automatically added to the project for every build.
 These tasks are now only added to a project when a rule-based plugin is applied (such as those provided by Gradle's support for building native software).
 
-=== Configuration Cache changes
-
-==== Unsupported build event listeners cause configuration cache problems
-
-The build event listener registration method
-link:{javadocPath}/org/gradle/build/event/BuildEventsListenerRegistry.html#onTaskCompletion(org.gradle.api.provider.Provider)[`BuildEventsListenerRegistry.onTaskCompletion`]
-accepts arbitrary providers of any
-link:{javadocPath}/org/gradle/tooling/events/OperationCompletionListener.html[`OperationCompletionListener`]
-implementations.
-However, only providers returned from
-link:{javadocPath}/org/gradle/api/services/BuildServiceRegistry.html#registerIfAbsent(java.lang.String,java.lang.Class,org.gradle.api.Action)[`BuildServiceRegistry.registerIfAbsent`]
-or
-link:{javadocPath}/org/gradle/api/services/BuildServiceRegistration.html#getService()[`BuildServiceRegistration.getService`]
-are currently supported when the Configuration Cache is enabled.
-
-Previously, unsupported providers were silently discarded and never received events when the configuration cache was used.
-Starting with Gradle 9, registering such providers now causes a configuration cache problem and fails the build.
-
-If your build was previously working with the configuration cache (e.g., the listeners were nonessential),
-you can temporarily revert to the old behavior by setting:
-[source,properties]
-----
-org.gradle.configuration-cache.unsafe.ignore.unsupported-build-events-listeners=true
-----
-This property will be removed in Gradle 10.
-
 === Packaging and Artifact changes
 
 ==== Artifact Signing now matches OpenPGP Key Version
@@ -799,7 +793,7 @@ These types are not used in Gradle's public API and as such are not useful.
 * `org.gradle.api.publish.ivy.IvyDependency`
 * `org.gradle.api.publish.maven.MavenDependency`
 
-=== Packaging and Artifact Behavior Changes
+=== Packaging and Artifact Behavior changes
 
 ==== Artifact Signing now matches OpenPGP Key Version
 
@@ -943,142 +937,6 @@ This behavior previously caused a warning: `Gradle Module Metadata is modified a
 
 It will now fail with an error, suggesting a review of the relevant documentation.
 
-=== Task Changes
-
-[[validate_plugins_without_java_toolchain_90]]
-==== `ValidatePlugins` task now requires Java Toolchains
-
-In Gradle 9.0, using the link:{javadocPath}/org/gradle/plugin/devel/tasks/ValidatePlugins.html[`ValidatePlugins`] task without applying the <<toolchains.adoc#toolchains,Java Toolchains>> plugin will result in an error.
-
-To fix this, explicitly apply the `jvm-toolchains` plugin:
-
-====
-[.multi-language-sample]
-=====
-.build.gradle.kts
-[source,kotlin]
-----
-plugins {
-    id("jvm-toolchains")
-}
-----
-=====
-[.multi-language-sample]
-=====
-.build.gradle
-[source,groovy]
-----
-plugins {
-    id 'jvm-toolchains'
-}
-----
-=====
-====
-
-TIP: The `jvm-toolchains` plugin is automatically applied by the <<java_library_plugin.adoc#java_library_plugin,Java Library Plugin>> and other JVM-related plugins.
-If you are already applying one of those, no further action is needed.
-
-[[reproducible_archives_by_default]]
-==== Archive tasks (Jar, Ear, War, Zip, AbstractArchiveTask) now produce reproducible archives by default
-
-In Gradle 9.0, the default behavior of archive tasks (such as `Jar`, `Ear`, `War`, `Zip`, and `AbstractArchiveTask`) has changed to produce reproducible archives by default.
-That means that:
-
-- File order in the archive is now deterministic.
-- Files have fixed timestamps (timestamps depends on the archive type).
-- All directories have fixed permissions set to `0755`.
-- All files have fixed permissions set to `0644`.
-
-This change improves the reproducibility of builds and ensures that the generated archives are consistent across different environments.
-
-You can restore the previous behaviour for one or more properties for your task with the following configuration:
-
-====
-[.multi-language-sample]
-=====
-.build.gradle.kts
-[source,kotlin]
-----
-tasks.withType<AbstractArchiveTask>().configureEach {
-    // Make file order based on the file system
-    isReproducibleFileOrder = false
-    // Use file timestamps from the file system
-    isPreserveFileTimestamps = true
-    // Use permissions from the file system
-    useFileSystemPermissions()
-}
-----
-=====
-[.multi-language-sample]
-=====
-.build.gradle
-[source,groovy]
-----
-tasks.withType(AbstractArchiveTask).configureEach {
-    // Makes file order non deterministic
-    reproducibleFileOrder = false
-    // Use file timestamps from the file system
-    preserveFileTimestamps = true
-    // Use permissions from the file system
-    useFileSystemPermissions()
-}
-----
-=====
-====
-
-You can also preserve the file system permissions across archives tasks by configuring a property:
-
-[source,properties]
-.gradle.properties
-----
-org.gradle.archives.use-file-system-permissions=true
-----
-
-==== `test` task fails when no tests are discovered
-
-When test sources are present and no filters are applied, the `test` task will now fail with an error if it runs but doesnt discover any tests.
-This is to help prevent misconfigurations where the tests are written for one test framework but the test task is mistakenly configured to use another test framework.
-If filters are applied, the outcome depends on the `failOnNoMatchingTests` property.
-
-This behavior can be disabled by setting the `failOnNoDiscoveredTests` property to `false` in the test task configuration:
-
-====
-[.multi-language-sample]
-=====
-.build.gradle.kts
-[source,kotlin]
-----
-tasks.withType<AbstractTestTask>().configureEach {
-    failOnNoDiscoveredTests = false
-}
-----
-=====
-[.multi-language-sample]
-=====
-.build.gradle
-[source,groovy]
-----
-tasks.withType(AbstractTestTask).configureEach {
-    failOnNoDiscoveredTests = false
-}
-----
-=====
-====
-
-==== Stale outputs outside the build directory are no longer deleted
-
-In previous versions of Gradle, class files located outside the build directory were deleted when considered stale. This was a special case for class files registered as outputs of a source set.
-
-Because this setup is uncommon and forced Gradle to eagerly realize all compile related tasks in every build, the behavior has been removed in Gradle 9.0.
-
-Gradle will continue to clean up stale outputs inside the build directory as needed.
-
-==== `model` and `component` tasks are no longer automatically added
-
-The `model` and `component` tasks report on the structure of legacy software model objects configured for the project.
-Previously, these tasks were automatically added to the project for every build.
-These tasks are now only added to a project when a rule-based plugin is applied (such as those provided by Gradle's support for building native software).
-
 === Configuration Cache changes
 
 ==== Unsupported build event listeners are now configuration cache problems
@@ -2187,7 +2045,7 @@ buildCache {
 }
 ----
 
-Add a file like this in `~/.gradle/init.d`:
+Add a file like this in `~/.gradle/init.d/cache.init.gradle.kts`:
 
 [source,kotlin]
 ----
diff --git a/platforms/documentation/docs/src/docs/userguide/releases/upgrading/upgrading_version_9.adoc b/platforms/documentation/docs/src/docs/userguide/releases/upgrading/upgrading_version_9.adoc
new file mode 100644
index 00000000000..546375d4a22
--- /dev/null
+++ b/platforms/documentation/docs/src/docs/userguide/releases/upgrading/upgrading_version_9.adoc
@@ -0,0 +1,63 @@
+// Copyright (C) 2024 Gradle, Inc.
+//
+// Licensed under the Creative Commons Attribution-Noncommercial-ShareAlike 4.0 International License.;
+// you may not use this file except in compliance with the License.
+// You may obtain a copy of the License at
+//
+//      https://creativecommons.org/licenses/by-nc-sa/4.0/
+//
+// Unless required by applicable law or agreed to in writing, software
+// distributed under the License is distributed on an "AS IS" BASIS,
+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+// See the License for the specific language governing permissions and
+// limitations under the License.
+
+[[upgrading_version_9]]
+
+= Upgrading your build from Gradle 9.x to the latest
+
+This chapter provides the information you need to migrate your Gradle 9.x builds to the latest Gradle release.
+For migrating from Gradle 4.x, 5.x, 6.x, 7.x, or 8.x see the <<upgrading_version_8.adoc#upgrading_version_8, older migration guide>> first.
+
+We recommend the following steps for all users:
+
+. Try running `gradle help --scan` and view the https://gradle.com/enterprise/releases/2018.4/#identify-usages-of-deprecated-gradle-functionality[deprecations view] of the generated Build Scan.
++
+image::deprecations.png[Deprecations View of a Gradle Build Scan]
++
+This lets you see any deprecation warnings that apply to your build.
++
+Alternatively, you can run `gradle help --warning-mode=all` to see the deprecations in the console, though it may not report as much detailed information.
+. Update your plugins.
++
+Some plugins will break with this new version of Gradle because they use internal APIs that have been removed or changed.
+The previous step will help you identify potential problems by issuing deprecation warnings when a plugin tries to use a deprecated part of the API.
++
+. Run `gradle wrapper --gradle-version {gradleVersion}` to update the project to {gradleVersion}.
+. Try to run the project and debug any errors using the <<troubleshooting.adoc#troubleshooting, Troubleshooting Guide>>.
+
+[[changes_9.1]]
+== Upgrading from 9.0 and earlier
+
+=== Deprecations
+
+[[archives-configuration]]
+==== Deprecation of the `archives` configuration
+The `archives` configuration added by the `base` plugin has been deprecated and will be removed in Gradle 10.0.0.
+Adding artifacts to the `archives` configuration will now result in a deprecation warning.
+If you want the artifact built when running the `assemble` task, you should add the artifact (or the task that produces it) as a dependency of the `assemble` task directly.
+
+.build.gradle.kts
+[source,kotlin]
+----
+val specialJar = tasks.register<Jar>("specialJar") {
+    archiveBaseName.set("special")
+    from("build/special")
+}
+
+tasks.named("assemble") {
+    dependsOn(specialJar)
+}
+----
+
+=== Potential breaking changes
diff --git a/platforms/documentation/docs/src/docs/userguide/running-builds/build_environment.adoc b/platforms/documentation/docs/src/docs/userguide/running-builds/build_environment.adoc
index fa2f8597f79..55b695c2090 100644
--- a/platforms/documentation/docs/src/docs/userguide/running-builds/build_environment.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/running-builds/build_environment.adoc
@@ -167,6 +167,10 @@ org.gradle.project.myProperty='Hi, world'
 ----
 myProperty='Hi, world'
 ----
++
+The `gradle.properties` file can be located in a number of places, including `<GRADLE_USER_HOME>/gradle.properties`, `./gradle.properties` (the project root) and `<GRADLE_HOME>/gradle.properties`.
++
+If the same property is defined in multiple locations, the files location determines its <<#priority-table-gradle-properties,precedence>>.
 4. *Environment Variables:* You can set project properties with environment variables. If the environment variable name looks like `ORG_GRADLE_PROJECT___myProperty__='Hi, world'`, then Gradle will set a `myProperty` property on your project object, with the value of `Hi, world`.
 +
 [source,text]
@@ -282,6 +286,7 @@ org.gradle.caching.debug=false
 The final configuration considered by Gradle is a combination of all Gradle properties set on the command line and your `gradle.properties` files.
 If an option is configured in multiple locations, the _first one_ found in any of these locations wins:
 
+[[priority-table-gradle-properties]]
 [%autowidth.stretch]
 |===
 |Priority |Method |Location |Details
@@ -333,7 +338,7 @@ Enables incubating configuration-on-demand, where Gradle will attempt to configu
 +
 _Default is `false`._
 
-`org.gradle.console=(auto,plain,rich,verbose)`::
+`org.gradle.console=(auto,plain,colored,rich,verbose)`::
 Customize <<command_line_interface.adoc#sec:command_line_logging,console output>> coloring or verbosity.
 +
 _Default depends on how Gradle is invoked._
diff --git a/platforms/documentation/docs/src/docs/userguide/running-builds/features/command_line_interface.adoc b/platforms/documentation/docs/src/docs/userguide/running-builds/features/command_line_interface.adoc
index 56fbf548217..07c00af12c5 100644
--- a/platforms/documentation/docs/src/docs/userguide/running-builds/features/command_line_interface.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/running-builds/features/command_line_interface.adoc
@@ -669,14 +669,16 @@ _Lifecycle_ is the default log level.
 
 You can control the use of rich output (colors and font variants) by specifying the console mode in the following ways:
 
-`-Dorg.gradle.console=(auto,plain,rich,verbose)`::
+`-Dorg.gradle.console=(auto,plain,colored,rich,verbose)`::
 A <<build_environment.adoc#sec:gradle_configuration_properties,Gradle property>> that specifies the console mode. Different modes are described immediately below.
 
-`--console=(auto,plain,rich,verbose)`::
+`--console=(auto,plain,colored,rich,verbose)`::
 Specifies which type of console output to generate.
 +
 Set to `plain` to generate plain text only. This option disables all color and other rich output in the console output. This is the default when Gradle is _not_ attached to a terminal.
 +
+Set to `colored` to generate colored output without rich status information such as progress bars.
++
 Set to `auto` (the default) to enable color and other rich output in the console output when the build process is attached to a console or to generate plain text only when not attached to a console. _This is the default when Gradle is attached to a terminal._
 +
 Set to `rich` to enable color and other rich output in the console output, regardless of whether the build process is not attached to a console. When not attached to a console, the build output will use ANSI control characters to generate the rich output.
diff --git a/platforms/documentation/docs/src/docs/userguide/running-builds/features/gradle_daemon.adoc b/platforms/documentation/docs/src/docs/userguide/running-builds/features/gradle_daemon.adoc
index b0d7dcf650f..5da1036115b 100644
--- a/platforms/documentation/docs/src/docs/userguide/running-builds/features/gradle_daemon.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/running-builds/features/gradle_daemon.adoc
@@ -223,6 +223,7 @@ java {
 If your build uses a toolchain, ensure it matches the `JAVA_HOME` value, or at least know they differ intentionally.
 You should also check your IDE settings to make sure they match as well.
 
+[[sec:configuring_daemon_jvm]]
 == Configuring the Daemon JVM
 
 NOTE: Daemon JVM discovery and criteria are <<feature_lifecycle.adoc#sec:incubating_state,incubating>> features and are subject to change in a future release.
diff --git a/platforms/documentation/docs/src/docs/userguide/running-builds/features/gradle_wrapper.adoc b/platforms/documentation/docs/src/docs/userguide/running-builds/features/gradle_wrapper.adoc
index eb12bcc1b86..bc29c659728 100644
--- a/platforms/documentation/docs/src/docs/userguide/running-builds/features/gradle_wrapper.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/running-builds/features/gradle_wrapper.adoc
@@ -382,13 +382,13 @@ As with all such files, you should ensure it's trustworthy before executing it.
 
 Since the Wrapper JAR is usually checked into a project's version control system, there is the potential for a malicious actor to replace the original JAR with a modified one by submitting a pull request that only upgrades the Gradle version.
 
-To verify the integrity of the Wrapper JAR, Gradle has created a link:https://github.com/marketplace/actions/gradle-wrapper-validation[GitHub Action] that automatically checks Wrapper JARs in pull requests against a list of known good checksums.
+To verify the integrity of the Wrapper JAR, Gradle has created a link:https://github.com/marketplace/actions/build-with-gradle#the-wrapper-validation-action[GitHub Action] that automatically checks Wrapper JARs in pull requests against a list of known good checksums.
 
 Gradle also publishes the link:https://gradle.org/release-checksums/[checksums of all releases] (except for version 3.3 to 4.0.2, which did not generate reproducible JARs), so you can manually verify the integrity of the Wrapper JAR.
 
 === Automatically verifying the Gradle Wrapper JAR on GitHub
 
-The link:https://github.com/marketplace/actions/gradle-wrapper-validation[GitHub Action] is released separately from Gradle, so please check its documentation for how to apply it to your project.
+The link:https://github.com/marketplace/actions/build-with-gradle#the-wrapper-validation-action[GitHub Action] is released separately from Gradle, so please check its documentation for how to apply it to your project.
 
 === Manually verifying the Gradle Wrapper JAR
 
diff --git a/platforms/documentation/docs/src/docs/userguide/running-builds/introduction/gradle_basics.adoc b/platforms/documentation/docs/src/docs/userguide/running-builds/introduction/gradle_basics.adoc
index 200993434c0..599d54bbe82 100644
--- a/platforms/documentation/docs/src/docs/userguide/running-builds/introduction/gradle_basics.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/running-builds/introduction/gradle_basics.adoc
@@ -21,6 +21,12 @@ image::gradle-basic-1.png[]
 
 == Core concepts
 
+++++
+<p style="text-align: center;">
+<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/Vw39uWQ08Go?si=Qt7qceGy2EDgkU0a&rel=0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
+</p>
+++++
+
 === Projects:
 
 - A Gradle *project* is a piece of software that can be built, such as an application or a library.
diff --git a/platforms/documentation/docs/src/docs/userguide/userguide_single.adoc b/platforms/documentation/docs/src/docs/userguide/userguide_single.adoc
index 71e9955e29c..e50026b6588 100644
--- a/platforms/documentation/docs/src/docs/userguide/userguide_single.adoc
+++ b/platforms/documentation/docs/src/docs/userguide/userguide_single.adoc
@@ -44,7 +44,7 @@ include::feature_lifecycle.adoc[leveloffset=+2]
 
 == UPGRADING
 
-include::upgrading_version_8.adoc[leveloffset=+2]
+include::upgrading_version_9.adoc[leveloffset=+2]
 
 [[part:running_builds]]
 == **RUNNING GRADLE BUILDS**
diff --git a/platforms/documentation/docs/src/main/resources/header.html b/platforms/documentation/docs/src/main/resources/header.html
index 39f2ef7a2ae..be05aff07b7 100644
--- a/platforms/documentation/docs/src/main/resources/header.html
+++ b/platforms/documentation/docs/src/main/resources/header.html
@@ -144,7 +144,8 @@ <h3 id="what-is-new">Releases</h3>
                 <li><a href="../userguide/installation.html">Installing Gradle</a></li>
                 <li><a class="nav-dropdown" data-toggle="collapse" href="#upgrading-gradle" aria-expanded="false" aria-controls="upgrading-gradle">Upgrading Gradle</a>
                     <ul id="upgrading-gradle">
-                        <li><a href="../userguide/upgrading_version_8.html">version 8.X to latest</a></li>
+                        <li><a href="../userguide/upgrading_version_9.html">version 9.X to latest</a></li>
+                        <li><a href="../userguide/upgrading_version_8.html">version 8.X to 9.0</a></li>
                         <li><a href="../userguide/upgrading_version_7.html">version 7.X to 8.0</a></li>
                         <li><a href="../userguide/upgrading_version_6.html">version 6.X to 7.0</a></li>
                         <li><a href="../userguide/upgrading_version_5.html">version 5.X to 6.0</a></li>
@@ -373,6 +374,7 @@ <h3 id="managing-dependencies">Dependency Management</h3>
                 <li><a class="nav-dropdown" data-toggle="collapse" href="#dependency-resolution" aria-expanded="false" aria-controls="dependency-resolution">Controlling Dependency Resolution</a>
                     <ul id="dependency-resolution">
                         <li><a href="../userguide/dependency_resolution_consistency.html">Consistent Dependency Resolution</a></li>
+                        <li><a href="../userguide/resolving_specific_artifacts.html">Resolving Specific Artifacts</a></li>
                         <li><a href="../userguide/component_capabilities.html">Capabilities</a></li>
                         <li><a href="../userguide/variant_attributes.html">Variants and Attributes</a></li>
                         <li><a href="../userguide/artifact_views.html">Artifact Views</a></li>
diff --git a/platforms/documentation/docs/src/snippets/dependencyManagement/catalogs-toml-buildSrc/kotlin/buildSrc/build.gradle.kts b/platforms/documentation/docs/src/snippets/dependencyManagement/catalogs-toml-buildSrc/kotlin/buildSrc/build.gradle.kts
index fb8f38f7825..0610761db34 100644
--- a/platforms/documentation/docs/src/snippets/dependencyManagement/catalogs-toml-buildSrc/kotlin/buildSrc/build.gradle.kts
+++ b/platforms/documentation/docs/src/snippets/dependencyManagement/catalogs-toml-buildSrc/kotlin/buildSrc/build.gradle.kts
@@ -1,6 +1,6 @@
 plugins {
     `kotlin-dsl`
-    alias(libs.plugins.versions) // Access version catalog in builSrc build file for plugin
+    alias(libs.plugins.versions) // Access version catalog in buildSrc build file for plugin
 }
 
 repositories {
diff --git a/platforms/documentation/docs/src/snippets/files/copy/groovy/build.gradle b/platforms/documentation/docs/src/snippets/files/copy/groovy/build.gradle
index 0d66939c778..6c9f104af92 100644
--- a/platforms/documentation/docs/src/snippets/files/copy/groovy/build.gradle
+++ b/platforms/documentation/docs/src/snippets/files/copy/groovy/build.gradle
@@ -244,6 +244,22 @@ tasks.register('permissions', Copy) {
 }
 // end::file-permissions[]
 
+// tag::file-specific-permissions[]
+tasks.register("specificPermissions", Copy) {
+    from 'src/main/webapp'
+    into layout.buildDirectory.dir('explodedWarWithScript')
+    eachFile {
+        if (name == "script.sh") {
+            permissions {
+                user {
+                    execute = true
+                }
+            }
+        }
+    }
+}
+// end::file-specific-permissions[]
+
 tasks.register('test') {
     dependsOn tasks.withType(Copy)
     dependsOn copyMethod
diff --git a/platforms/documentation/docs/src/snippets/files/copy/kotlin/build.gradle.kts b/platforms/documentation/docs/src/snippets/files/copy/kotlin/build.gradle.kts
index c5ad6071666..87e5750d5f4 100644
--- a/platforms/documentation/docs/src/snippets/files/copy/kotlin/build.gradle.kts
+++ b/platforms/documentation/docs/src/snippets/files/copy/kotlin/build.gradle.kts
@@ -247,6 +247,22 @@ tasks.register<Copy>("permissions") {
 }
 // end::file-permissions[]
 
+// tag::file-specific-permissions[]
+tasks.register<Copy>("specificPermissions") {
+    from("src/main/webapp")
+    into(layout.buildDirectory.dir("explodedWarWithScript"))
+    eachFile {
+        if (name == "script.sh") {
+            permissions {
+                user {
+                    execute = true
+                }
+            }
+        }
+    }
+}
+// end::file-specific-permissions[]
+
 tasks.register("test") {
     dependsOn(tasks.withType<Copy>())
     dependsOn(tasks["copyMethod"])
diff --git a/platforms/documentation/docs/src/snippets/init/generated/groovy/settings.gradle b/platforms/documentation/docs/src/snippets/init/generated/groovy/settings.gradle
index ea5653cf072..06f6a1cb292 100644
--- a/platforms/documentation/docs/src/snippets/init/generated/groovy/settings.gradle
+++ b/platforms/documentation/docs/src/snippets/init/generated/groovy/settings.gradle
@@ -1,6 +1,6 @@
 plugins {
     // Apply the foojay-resolver plugin to allow automatic download of JDKs
-    id 'org.gradle.toolchains.foojay-resolver-convention' version '0.9.0'
+    id 'org.gradle.toolchains.foojay-resolver-convention' version '1.0.0'
 }
 
 rootProject.name = 'tutorial'
diff --git a/platforms/documentation/docs/src/snippets/init/generated/kotlin/settings.gradle.kts b/platforms/documentation/docs/src/snippets/init/generated/kotlin/settings.gradle.kts
index 17e5e41eea0..9d2b55c5d6f 100644
--- a/platforms/documentation/docs/src/snippets/init/generated/kotlin/settings.gradle.kts
+++ b/platforms/documentation/docs/src/snippets/init/generated/kotlin/settings.gradle.kts
@@ -1,6 +1,6 @@
 plugins {
     // Apply the foojay-resolver plugin to allow automatic download of JDKs
-    id("org.gradle.toolchains.foojay-resolver-convention") version "0.9.0"
+    id("org.gradle.toolchains.foojay-resolver-convention") version "1.0.0"
 }
 
 rootProject.name = "tutorial"
diff --git a/platforms/documentation/docs/src/snippets/init/upgraded/groovy/settings.gradle b/platforms/documentation/docs/src/snippets/init/upgraded/groovy/settings.gradle
index ea5653cf072..06f6a1cb292 100644
--- a/platforms/documentation/docs/src/snippets/init/upgraded/groovy/settings.gradle
+++ b/platforms/documentation/docs/src/snippets/init/upgraded/groovy/settings.gradle
@@ -1,6 +1,6 @@
 plugins {
     // Apply the foojay-resolver plugin to allow automatic download of JDKs
-    id 'org.gradle.toolchains.foojay-resolver-convention' version '0.9.0'
+    id 'org.gradle.toolchains.foojay-resolver-convention' version '1.0.0'
 }
 
 rootProject.name = 'tutorial'
diff --git a/platforms/documentation/docs/src/snippets/init/upgraded/kotlin/settings.gradle.kts b/platforms/documentation/docs/src/snippets/init/upgraded/kotlin/settings.gradle.kts
index 17e5e41eea0..9d2b55c5d6f 100644
--- a/platforms/documentation/docs/src/snippets/init/upgraded/kotlin/settings.gradle.kts
+++ b/platforms/documentation/docs/src/snippets/init/upgraded/kotlin/settings.gradle.kts
@@ -1,6 +1,6 @@
 plugins {
     // Apply the foojay-resolver plugin to allow automatic download of JDKs
-    id("org.gradle.toolchains.foojay-resolver-convention") version "0.9.0"
+    id("org.gradle.toolchains.foojay-resolver-convention") version "1.0.0"
 }
 
 rootProject.name = "tutorial"
diff --git a/platforms/documentation/docs/src/snippets/multiproject/buildSrc/groovy/settings.gradle b/platforms/documentation/docs/src/snippets/multiproject/buildSrc/groovy/settings.gradle
index ba123255a85..a40230aa3d8 100644
--- a/platforms/documentation/docs/src/snippets/multiproject/buildSrc/groovy/settings.gradle
+++ b/platforms/documentation/docs/src/snippets/multiproject/buildSrc/groovy/settings.gradle
@@ -1,5 +1,5 @@
 plugins {
-    id 'org.gradle.toolchains.foojay-resolver-convention' version '0.9.0'
+    id 'org.gradle.toolchains.foojay-resolver-convention' version '1.0.0'
 }
 
 rootProject.name = 'multiproject-buildSrc'
diff --git a/platforms/documentation/docs/src/snippets/multiproject/buildSrc/kotlin/settings.gradle.kts b/platforms/documentation/docs/src/snippets/multiproject/buildSrc/kotlin/settings.gradle.kts
index 7768dac9220..0fe5a5dbf0c 100644
--- a/platforms/documentation/docs/src/snippets/multiproject/buildSrc/kotlin/settings.gradle.kts
+++ b/platforms/documentation/docs/src/snippets/multiproject/buildSrc/kotlin/settings.gradle.kts
@@ -1,5 +1,5 @@
 plugins {
-    id("org.gradle.toolchains.foojay-resolver-convention") version "0.9.0"
+    id("org.gradle.toolchains.foojay-resolver-convention") version "1.0.0"
 }
 
 rootProject.name = "multiproject-buildSrc"
diff --git a/platforms/documentation/docs/src/snippets/multiproject/no-buildSrc/groovy/settings.gradle b/platforms/documentation/docs/src/snippets/multiproject/no-buildSrc/groovy/settings.gradle
index ba123255a85..a40230aa3d8 100644
--- a/platforms/documentation/docs/src/snippets/multiproject/no-buildSrc/groovy/settings.gradle
+++ b/platforms/documentation/docs/src/snippets/multiproject/no-buildSrc/groovy/settings.gradle
@@ -1,5 +1,5 @@
 plugins {
-    id 'org.gradle.toolchains.foojay-resolver-convention' version '0.9.0'
+    id 'org.gradle.toolchains.foojay-resolver-convention' version '1.0.0'
 }
 
 rootProject.name = 'multiproject-buildSrc'
diff --git a/platforms/documentation/docs/src/snippets/multiproject/no-buildSrc/kotlin/settings.gradle.kts b/platforms/documentation/docs/src/snippets/multiproject/no-buildSrc/kotlin/settings.gradle.kts
index 7768dac9220..0fe5a5dbf0c 100644
--- a/platforms/documentation/docs/src/snippets/multiproject/no-buildSrc/kotlin/settings.gradle.kts
+++ b/platforms/documentation/docs/src/snippets/multiproject/no-buildSrc/kotlin/settings.gradle.kts
@@ -1,5 +1,5 @@
 plugins {
-    id("org.gradle.toolchains.foojay-resolver-convention") version "0.9.0"
+    id("org.gradle.toolchains.foojay-resolver-convention") version "1.0.0"
 }
 
 rootProject.name = "multiproject-buildSrc"
diff --git a/platforms/extensibility/plugin-development/build.gradle.kts b/platforms/extensibility/plugin-development/build.gradle.kts
index 991f7ef8301..182efa52a98 100644
--- a/platforms/extensibility/plugin-development/build.gradle.kts
+++ b/platforms/extensibility/plugin-development/build.gradle.kts
@@ -90,8 +90,6 @@ dependencies {
     testFixturesImplementation(projects.baseServices)
 }
 
-integTest.usesJavadocCodeSnippets = true
-
 strictCompile {
     ignoreDeprecations()
 }
diff --git a/platforms/extensibility/plugin-development/src/integTest/groovy/org/gradle/plugin/devel/AutoTestedSamplesPluginDevelopmentIntegrationTest.groovy b/platforms/extensibility/plugin-development/src/integTest/groovy/org/gradle/plugin/devel/AutoTestedSamplesPluginDevelopmentIntegrationTest.groovy
deleted file mode 100644
index 1f81acedf62..00000000000
--- a/platforms/extensibility/plugin-development/src/integTest/groovy/org/gradle/plugin/devel/AutoTestedSamplesPluginDevelopmentIntegrationTest.groovy
+++ /dev/null
@@ -1,28 +0,0 @@
-/*
- * Copyright 2019 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.plugin.devel
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesPluginDevelopmentIntegrationTest extends AbstractAutoTestedSamplesTest {
-
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/platforms/extensibility/plugin-development/src/integTest/groovy/org/gradle/plugin/devel/variants/GradlePluginWithVariantsPublicationIntegrationTest.groovy b/platforms/extensibility/plugin-development/src/integTest/groovy/org/gradle/plugin/devel/variants/GradlePluginWithVariantsPublicationIntegrationTest.groovy
index 9a2028bf895..662ae3f140d 100644
--- a/platforms/extensibility/plugin-development/src/integTest/groovy/org/gradle/plugin/devel/variants/GradlePluginWithVariantsPublicationIntegrationTest.groovy
+++ b/platforms/extensibility/plugin-development/src/integTest/groovy/org/gradle/plugin/devel/variants/GradlePluginWithVariantsPublicationIntegrationTest.groovy
@@ -17,6 +17,7 @@
 package org.gradle.plugin.devel.variants
 
 import org.gradle.api.JavaVersion
+import org.gradle.api.artifacts.Dependency
 import org.gradle.api.plugins.UnknownPluginException
 import org.gradle.integtests.fixtures.AbstractIntegrationSpec
 import org.gradle.internal.component.resolution.failure.exception.VariantSelectionByAttributesException
@@ -156,7 +157,7 @@ class GradlePluginWithVariantsPublicationIntegrationTest extends AbstractIntegra
             version = "1.0"
 
             configurations.configureEach {
-                if (canBeConsumed)  {
+                if (canBeConsumed && name != '${Dependency.ARCHIVES_CONFIGURATION}')  {
                     attributes {
                         attribute(GradlePluginApiVersion.GRADLE_PLUGIN_API_VERSION_ATTRIBUTE, objects.named(GradlePluginApiVersion, '1000.0'))
                     }
@@ -333,13 +334,15 @@ class GradlePluginWithVariantsPublicationIntegrationTest extends AbstractIntegra
 
             def color = Attribute.of("color", String)
             configurations.configureEach {
-                if (canBeConsumed && name.startsWith(alternate.name))  {
-                    attributes {
-                        attribute(color, 'green')
-                    }
-                } else if (canBeConsumed && !name.startsWith(alternate.name))  {
-                    attributes {
-                        attribute(color, 'blue')
+                if (name != '${Dependency.ARCHIVES_CONFIGURATION}') {
+                    if (canBeConsumed && name.startsWith(alternate.name))  {
+                        attributes {
+                            attribute(color, 'green')
+                        }
+                    } else if (canBeConsumed && !name.startsWith(alternate.name))  {
+                        attributes {
+                            attribute(color, 'blue')
+                        }
                     }
                 }
             }
diff --git a/platforms/ide/base-ide-plugins/build.gradle.kts b/platforms/ide/base-ide-plugins/build.gradle.kts
index 61549704226..6e03e9aa513 100644
--- a/platforms/ide/base-ide-plugins/build.gradle.kts
+++ b/platforms/ide/base-ide-plugins/build.gradle.kts
@@ -26,11 +26,11 @@ dependencies {
     api(projects.coreApi)
     api(projects.ide)
     api(libs.inject)
+    api(libs.jspecify)
 
     implementation(projects.core)
     implementation(projects.logging)
     implementation(projects.loggingApi)
-    implementation(projects.serviceLookup)
 
     implementation(libs.commonsLang)
     implementation(libs.guava)
diff --git a/platforms/ide/base-ide-plugins/src/main/java/org/gradle/plugins/ide/internal/IdePlugin.java b/platforms/ide/base-ide-plugins/src/main/java/org/gradle/plugins/ide/internal/IdePlugin.java
index c2c06e7a4bb..45d1a776be4 100644
--- a/platforms/ide/base-ide-plugins/src/main/java/org/gradle/plugins/ide/internal/IdePlugin.java
+++ b/platforms/ide/base-ide-plugins/src/main/java/org/gradle/plugins/ide/internal/IdePlugin.java
@@ -22,9 +22,7 @@
 import org.gradle.api.Project;
 import org.gradle.api.Task;
 import org.gradle.api.file.FileSystemLocation;
-import org.gradle.api.internal.ConfigurationCacheDegradationController;
 import org.gradle.api.internal.lambdas.SerializableLambdas;
-import org.gradle.api.internal.project.ProjectInternal;
 import org.gradle.api.invocation.Gradle;
 import org.gradle.api.logging.Logger;
 import org.gradle.api.logging.Logging;
@@ -173,15 +171,6 @@ public void execute(Task task) {
         };
     }
 
-    protected static Action<Task> withGracefulDegradation(Project project) {
-        return task -> ((ProjectInternal) project).getServices()
-            .get(ConfigurationCacheDegradationController.class)
-            .requireConfigurationCacheDegradation(
-                task,
-                project.provider(() -> "Task is not compatible with the configuration cache")
-        );
-    }
-
     protected void onApply(Project target) {
     }
 
diff --git a/platforms/ide/base-ide-plugins/src/main/java/org/gradle/plugins/ide/internal/IdePluginHelper.java b/platforms/ide/base-ide-plugins/src/main/java/org/gradle/plugins/ide/internal/IdePluginHelper.java
new file mode 100644
index 00000000000..75fd782f399
--- /dev/null
+++ b/platforms/ide/base-ide-plugins/src/main/java/org/gradle/plugins/ide/internal/IdePluginHelper.java
@@ -0,0 +1,39 @@
+/*
+ * Copyright 2025 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.gradle.plugins.ide.internal;
+
+import org.gradle.api.Action;
+import org.gradle.api.Task;
+import org.jspecify.annotations.NullMarked;
+
+import static org.gradle.api.internal.ConfigurationCacheDegradation.requireDegradation;
+import static org.gradle.internal.Cast.uncheckedNonnullCast;
+
+/**
+ * This class provides a place for sharing functionality with {@link IdePlugin} subclasses
+ * without inadvertently making them API (as happens to public or protected members in {@link IdePlugin}).
+ */
+@NullMarked
+public class IdePluginHelper {
+    /**
+     * Returns a configuration action that requires unconditional graceful degradation
+     * on the consumed task.
+     */
+    public static Action<Task> withGracefulDegradation() {
+        return task -> requireDegradation(uncheckedNonnullCast(task), "Task is not compatible with the configuration cache");
+    }
+}
diff --git a/platforms/ide/ide-native/build.gradle.kts b/platforms/ide/ide-native/build.gradle.kts
index 5278e5f545b..1e17dde09a8 100644
--- a/platforms/ide/ide-native/build.gradle.kts
+++ b/platforms/ide/ide-native/build.gradle.kts
@@ -65,7 +65,6 @@ dependencies {
     integTestDistributionRuntimeOnly(projects.distributionsNative)
 }
 
-integTest.usesJavadocCodeSnippets = true
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/ide/ide-native/src/integTest/groovy/org/gradle/ide/AutoTestedSamplesIdeNativeIntegrationTest.groovy b/platforms/ide/ide-native/src/integTest/groovy/org/gradle/ide/AutoTestedSamplesIdeNativeIntegrationTest.groovy
deleted file mode 100644
index 753672468ec..00000000000
--- a/platforms/ide/ide-native/src/integTest/groovy/org/gradle/ide/AutoTestedSamplesIdeNativeIntegrationTest.groovy
+++ /dev/null
@@ -1,31 +0,0 @@
-/*
- * Copyright 2014 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.ide
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesIdeNativeIntegrationTest extends AbstractAutoTestedSamplesTest{
-
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-
-}
-
-
diff --git a/platforms/ide/ide-native/src/main/java/org/gradle/ide/visualstudio/VisualStudioSolution.java b/platforms/ide/ide-native/src/main/java/org/gradle/ide/visualstudio/VisualStudioSolution.java
index eed0331ed57..043f99cc667 100644
--- a/platforms/ide/ide-native/src/main/java/org/gradle/ide/visualstudio/VisualStudioSolution.java
+++ b/platforms/ide/ide-native/src/main/java/org/gradle/ide/visualstudio/VisualStudioSolution.java
@@ -41,7 +41,7 @@
  *          solution {
  *              solutionFile.location = "vs/${name}.sln"
  *              solutionFile.withContent { TextProvider content -&gt;
- *                  content.asBuilder().insert(0, "# GENERATED FILE: DO NOT EDIT\n")
+ *                  content.asBuilder().insert(0, "# GENERATED FILE: DO NOT EDIT\\n")
  *                  content.text = content.text.replaceAll("HideSolutionNode = FALSE", "HideSolutionNode = TRUE")
  *              }
  *          }
diff --git a/platforms/ide/ide-plugins/build.gradle.kts b/platforms/ide/ide-plugins/build.gradle.kts
index 5d8fa4262e3..289305955cd 100644
--- a/platforms/ide/ide-plugins/build.gradle.kts
+++ b/platforms/ide/ide-plugins/build.gradle.kts
@@ -95,7 +95,6 @@ packageCycles {
  */
 testFilesCleanup.reportOnly = true
 
-integTest.usesJavadocCodeSnippets = true
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/ide/ide-plugins/src/integTest/groovy/org/gradle/samples/AutoTestedSamplesIdePluginsIntegrationTest.groovy b/platforms/ide/ide-plugins/src/integTest/groovy/org/gradle/samples/AutoTestedSamplesIdePluginsIntegrationTest.groovy
deleted file mode 100644
index 498854a9df2..00000000000
--- a/platforms/ide/ide-plugins/src/integTest/groovy/org/gradle/samples/AutoTestedSamplesIdePluginsIntegrationTest.groovy
+++ /dev/null
@@ -1,27 +0,0 @@
-/*
- * Copyright 2024 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.samples
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesIdePluginsIntegrationTest extends AbstractAutoTestedSamplesTest {
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/platforms/ide/ide-plugins/src/main/java/org/gradle/plugins/ide/eclipse/EclipsePlugin.java b/platforms/ide/ide-plugins/src/main/java/org/gradle/plugins/ide/eclipse/EclipsePlugin.java
index 12d29c12045..dd25aa63b24 100644
--- a/platforms/ide/ide-plugins/src/main/java/org/gradle/plugins/ide/eclipse/EclipsePlugin.java
+++ b/platforms/ide/ide-plugins/src/main/java/org/gradle/plugins/ide/eclipse/EclipsePlugin.java
@@ -64,6 +64,7 @@
 import org.gradle.plugins.ide.eclipse.model.internal.EclipseJavaVersionMapper;
 import org.gradle.plugins.ide.internal.IdeArtifactRegistry;
 import org.gradle.plugins.ide.internal.IdePlugin;
+import org.gradle.plugins.ide.internal.IdePluginHelper;
 import org.gradle.plugins.ide.internal.configurer.UniqueProjectNameProvider;
 import org.gradle.testing.base.TestSuite;
 import org.gradle.testing.base.TestingExtension;
@@ -117,7 +118,7 @@ protected String getLifecycleTaskName() {
     @Override
     protected void onApply(Project project) {
         getLifecycleTask().configure(withDescription("Generates all Eclipse files."));
-        getLifecycleTask().configure(withGracefulDegradation(project));
+        getLifecycleTask().configure(IdePluginHelper.withGracefulDegradation());
         getCleanTask().configure(withDescription("Cleans all Eclipse files."));
 
         EclipseModel model = project.getExtensions().create("eclipse", EclipseModel.class, project);
@@ -241,7 +242,7 @@ public void execute(final GenerateEclipseClasspath task) {
                         task.setOutputFile(project.file(".classpath"));
                     }
                 });
-                task.configure(withGracefulDegradation(project));
+                task.configure(IdePluginHelper.withGracefulDegradation());
                 addWorker(task, ECLIPSE_CP_TASK_NAME);
 
                 XmlTransformer xmlTransformer = new XmlTransformer();
diff --git a/platforms/ide/ide-plugins/src/main/java/org/gradle/plugins/ide/eclipse/EclipseWtpPlugin.java b/platforms/ide/ide-plugins/src/main/java/org/gradle/plugins/ide/eclipse/EclipseWtpPlugin.java
index f0b224365e1..7c710aefe0f 100644
--- a/platforms/ide/ide-plugins/src/main/java/org/gradle/plugins/ide/eclipse/EclipseWtpPlugin.java
+++ b/platforms/ide/ide-plugins/src/main/java/org/gradle/plugins/ide/eclipse/EclipseWtpPlugin.java
@@ -40,6 +40,7 @@
 import org.gradle.plugins.ide.eclipse.model.WbResource;
 import org.gradle.plugins.ide.eclipse.model.internal.WtpClasspathAttributeSupport;
 import org.gradle.plugins.ide.internal.IdePlugin;
+import org.gradle.plugins.ide.internal.IdePluginHelper;
 import org.gradle.util.internal.RelativePathUtil;
 import org.gradle.util.internal.WrapUtil;
 
@@ -140,7 +141,7 @@ public void execute(final GenerateEclipseWtpComponent task) {
                 task.setOutputFile(project.file(".settings/org.eclipse.wst.common.component"));
             }
         });
-        task.configure(withGracefulDegradation(project));
+        task.configure(IdePluginHelper.withGracefulDegradation());
         addWorker(task, ECLIPSE_WTP_COMPONENT_TASK_NAME);
 
         ((IConventionAware) component).getConventionMapping().map("deployName", new Callable<String>() {
diff --git a/platforms/ide/ide-plugins/src/main/java/org/gradle/plugins/ide/idea/IdeaPlugin.java b/platforms/ide/ide-plugins/src/main/java/org/gradle/plugins/ide/idea/IdeaPlugin.java
index f14b26c43ab..8e17adb7cbf 100644
--- a/platforms/ide/ide-plugins/src/main/java/org/gradle/plugins/ide/idea/IdeaPlugin.java
+++ b/platforms/ide/ide-plugins/src/main/java/org/gradle/plugins/ide/idea/IdeaPlugin.java
@@ -66,6 +66,7 @@
 import org.gradle.plugins.ide.idea.model.internal.IdeaDependenciesProvider;
 import org.gradle.plugins.ide.internal.IdeArtifactRegistry;
 import org.gradle.plugins.ide.internal.IdePlugin;
+import org.gradle.plugins.ide.internal.IdePluginHelper;
 import org.gradle.plugins.ide.internal.configurer.UniqueProjectNameProvider;
 import org.gradle.testing.base.TestingExtension;
 
@@ -140,7 +141,7 @@ protected String getLifecycleTaskName() {
     @Override
     protected void onApply(final Project project) {
         getLifecycleTask().configure(withDescription("Generates IDEA project files (IML, IPR, IWS)"));
-        getLifecycleTask().configure(withGracefulDegradation(project));
+        getLifecycleTask().configure(IdePluginHelper.withGracefulDegradation());
         getCleanTask().configure(withDescription("Cleans IDEA project files (IML, IPR)"));
 
         ideaModel = project.getExtensions().create("idea", IdeaModel.class);
@@ -186,7 +187,7 @@ public void execute(GenerateIdeaProject projectTask) {
                     projectTask.setDescription("Generates IDEA project file (IPR)");
                 }
             });
-            projectTask.configure(withGracefulDegradation(project));
+            projectTask.configure(IdePluginHelper.withGracefulDegradation());
             ideaModel.setProject(ideaProject);
 
             ideaProject.setOutputFile(new File(project.getProjectDir(), project.getName() + ".ipr"));
@@ -279,7 +280,7 @@ public void execute(GenerateIdeaModule task) {
                 task.setDescription("Generates IDEA module files (IML)");
             }
         });
-        task.configure(withGracefulDegradation(project));
+        task.configure(IdePluginHelper.withGracefulDegradation());
         ideaModel.setModule(module);
 
         final String defaultModuleName = uniqueProjectNameProvider.getUniqueName(project);
diff --git a/platforms/ide/ide/build.gradle.kts b/platforms/ide/ide/build.gradle.kts
index 6e5993fecc8..a5cc5570c38 100644
--- a/platforms/ide/ide/build.gradle.kts
+++ b/platforms/ide/ide/build.gradle.kts
@@ -83,7 +83,6 @@ packageCycles {
     excludePatterns.add("org/gradle/plugins/ide/idea/model/internal/*")
 }
 
-integTest.usesJavadocCodeSnippets = true
 testFilesCleanup.reportOnly = true
 tasks.isolatedProjectsIntegTest {
     enabled = false
diff --git a/platforms/ide/ide/src/integTest/groovy/org/gradle/plugins/ide/AutoTestedSamplesIdeIntegrationTest.groovy b/platforms/ide/ide/src/integTest/groovy/org/gradle/plugins/ide/AutoTestedSamplesIdeIntegrationTest.groovy
deleted file mode 100644
index 580beaf7b13..00000000000
--- a/platforms/ide/ide/src/integTest/groovy/org/gradle/plugins/ide/AutoTestedSamplesIdeIntegrationTest.groovy
+++ /dev/null
@@ -1,27 +0,0 @@
-/*
- * Copyright 2011 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.plugins.ide
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesIdeIntegrationTest extends AbstractAutoTestedSamplesTest {
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/platforms/ide/problems-api/src/integTest/groovy/org/gradle/api/problems/ProblemsApiBuildOperationIntegrationTest.groovy b/platforms/ide/problems-api/src/integTest/groovy/org/gradle/api/problems/ProblemsApiBuildOperationIntegrationTest.groovy
index 4877729ebb2..cde3191804b 100644
--- a/platforms/ide/problems-api/src/integTest/groovy/org/gradle/api/problems/ProblemsApiBuildOperationIntegrationTest.groovy
+++ b/platforms/ide/problems-api/src/integTest/groovy/org/gradle/api/problems/ProblemsApiBuildOperationIntegrationTest.groovy
@@ -63,7 +63,7 @@ class ProblemsApiBuildOperationIntegrationTest extends AbstractIntegrationSpec {
             contextualLocations.size() == 1
             this.with(contextualLocations[0].fileLocation) {
                 path == this.buildFile.absolutePath
-                line == 13
+                line == ProblemsServiceIntegrationTest.PROBLEM_LOCATION_LINE
                 column == null
                 length == null
             }
@@ -104,7 +104,7 @@ class ProblemsApiBuildOperationIntegrationTest extends AbstractIntegrationSpec {
             this.with(originLocations[0]) {
                 this.with(fileLocation) {
                     path == this.buildFile.absolutePath
-                    line == 13
+                    line == ProblemsServiceIntegrationTest.PROBLEM_LOCATION_LINE
                     column == null
                     length == null
                 }
@@ -251,7 +251,7 @@ class ProblemsApiBuildOperationIntegrationTest extends AbstractIntegrationSpec {
             this.with(contextualLocations[0]) {
                 this.with(fileLocation) {
                     path == test.file('included/sub1/build.gradle').absolutePath
-                    line == 13
+                    line == ProblemsServiceIntegrationTest.PROBLEM_LOCATION_LINE
                     column == null
                     length == null
                 }
diff --git a/platforms/ide/problems-api/src/integTest/groovy/org/gradle/api/problems/ProblemsServiceIntegrationTest.groovy b/platforms/ide/problems-api/src/integTest/groovy/org/gradle/api/problems/ProblemsServiceIntegrationTest.groovy
index ceb9ffa44da..263a0483e4c 100644
--- a/platforms/ide/problems-api/src/integTest/groovy/org/gradle/api/problems/ProblemsServiceIntegrationTest.groovy
+++ b/platforms/ide/problems-api/src/integTest/groovy/org/gradle/api/problems/ProblemsServiceIntegrationTest.groovy
@@ -26,6 +26,8 @@ import static org.gradle.api.problems.fixtures.ReportingScript.getProblemReporti
 
 class ProblemsServiceIntegrationTest extends AbstractIntegrationSpec {
 
+    public static final int PROBLEM_LOCATION_LINE = 23
+
     def setup() {
         enableProblemsApiCheck()
     }
@@ -51,7 +53,7 @@ class ProblemsServiceIntegrationTest extends AbstractIntegrationSpec {
             with(oneLocation(StackTraceLocation).fileLocation) {
                 length == -1
                 column == -1
-                line == 13
+                line == PROBLEM_LOCATION_LINE
                 path == buildFile.absolutePath
             }
             with(oneLocation(TaskLocation)) {
@@ -124,7 +126,7 @@ class ProblemsServiceIntegrationTest extends AbstractIntegrationSpec {
                 with(fileLocation as LineInFileLocation) {
                     length == -1
                     column == -1
-                    line == 13
+                    line == PROBLEM_LOCATION_LINE
                     path == buildFile.absolutePath
                 }
                 stackTrace.find { it.className == 'ProblemReportingTask' && it.methodName == 'run' }
@@ -314,7 +316,7 @@ class ProblemsServiceIntegrationTest extends AbstractIntegrationSpec {
             with(oneLocation(StackTraceLocation).fileLocation as LineInFileLocation) {
                 length == -1
                 column == -1
-                line == 13
+                line == PROBLEM_LOCATION_LINE
                 path == buildFile.absolutePath
             }
         }
diff --git a/platforms/ide/problems-api/src/main/java/org/gradle/api/problems/internal/DefaultProblems.java b/platforms/ide/problems-api/src/main/java/org/gradle/api/problems/internal/DefaultProblems.java
index 2f17d9f9b3e..08c04058fa0 100644
--- a/platforms/ide/problems-api/src/main/java/org/gradle/api/problems/internal/DefaultProblems.java
+++ b/platforms/ide/problems-api/src/main/java/org/gradle/api/problems/internal/DefaultProblems.java
@@ -21,13 +21,10 @@
 import org.gradle.internal.isolation.IsolatableFactory;
 import org.gradle.internal.operations.CurrentBuildOperationRef;
 import org.gradle.internal.reflect.Instantiator;
-import org.gradle.internal.service.scopes.Scope;
-import org.gradle.internal.service.scopes.ServiceScope;
 import org.gradle.problems.buildtree.ProblemStream;
 import org.gradle.tooling.internal.provider.serialization.PayloadSerializer;
 import org.jspecify.annotations.NonNull;
 
-@ServiceScope(Scope.BuildTree.class)
 public class DefaultProblems implements InternalProblems {
 
     private final CurrentBuildOperationRef currentBuildOperationRef;
diff --git a/platforms/ide/problems-api/src/testFixtures/groovy/org/gradle/api/problems/fixtures/ReportingScript.groovy b/platforms/ide/problems-api/src/testFixtures/groovy/org/gradle/api/problems/fixtures/ReportingScript.groovy
index 9762409b358..9e188357e01 100644
--- a/platforms/ide/problems-api/src/testFixtures/groovy/org/gradle/api/problems/fixtures/ReportingScript.groovy
+++ b/platforms/ide/problems-api/src/testFixtures/groovy/org/gradle/api/problems/fixtures/ReportingScript.groovy
@@ -25,8 +25,18 @@ class ReportingScript {
             import org.gradle.api.problems.Severity
 
             abstract class ProblemReportingTask extends DefaultTask {
+
+                private final Problems problems;
+
                 @Inject
-                protected abstract Problems getProblems();
+                public ProblemReportingTask(Problems problems) {
+                    this.problems = problems;
+                }
+
+                @Internal
+                protected Problems getProblems() {
+                    return problems;
+                }
 
                 @TaskAction
                 void run() {
diff --git a/platforms/ide/tooling-api/build.gradle.kts b/platforms/ide/tooling-api/build.gradle.kts
index 81628ac8074..a56310d0e5e 100644
--- a/platforms/ide/tooling-api/build.gradle.kts
+++ b/platforms/ide/tooling-api/build.gradle.kts
@@ -13,8 +13,16 @@ gradleModule {
 }
 
 jvmCompile {
-    // JSpecify annotations on static inner type return types
-    usesJdkInternals = true
+    compilations {
+        named("main") {
+            // JSpecify annotations on static inner type return types
+            usesJdkInternals = true
+        }
+        named("crossVersionTest") {
+            // The TAPI tests must be able to run the TAPI client, which is still JVM 8 compatible
+            targetJvmVersion = 8
+        }
+    }
 }
 
 tasks.named<Jar>("sourcesJar") {
@@ -133,10 +141,12 @@ tasks.named("toolingApiShadedJar") {
     dependsOn(gradle.includedBuild("build-logic").task(":java-api-extractor:assemble"))
 }
 
-integTest.usesJavadocCodeSnippets = true
 testFilesCleanup.reportOnly = true
 
 apply(from = "buildship.gradle")
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
+
+// AutoTestedSamplesToolingApiTest includes customized test logic, so automatic auto testing samples generation is not needed (and would fail) in this project
+integTest.generateDefaultAutoTestedSamplesTest = false
diff --git a/platforms/ide/tooling-api/src/crossVersionTest/groovy/org/gradle/integtests/tooling/r900/TestFailureProgressEventCrossVersionTest.groovy b/platforms/ide/tooling-api/src/crossVersionTest/groovy/org/gradle/integtests/tooling/r900/TestFailureProgressEventCrossVersionTest.groovy
index 26c160e2478..68942413314 100644
--- a/platforms/ide/tooling-api/src/crossVersionTest/groovy/org/gradle/integtests/tooling/r900/TestFailureProgressEventCrossVersionTest.groovy
+++ b/platforms/ide/tooling-api/src/crossVersionTest/groovy/org/gradle/integtests/tooling/r900/TestFailureProgressEventCrossVersionTest.groovy
@@ -51,9 +51,7 @@ class TestFailureProgressEventCrossVersionTest extends TestFailureSpecification
         thrown(BuildException)
         collector.failures.size() == 1
         collector.failures[0] instanceof DefaultTestFrameworkFailure
-
-        DefaultTestFrameworkFailure failure = collector.failures[0] as DefaultTestFrameworkFailure
-        failure.message =~ /Process 'Gradle Test Executor \d+' finished with non-zero exit value 1/
+        collector.failures[0].message =~ /Process 'Gradle Test Executor \d+' finished with non-zero exit value 1/
     }
 
     @TargetGradleVersion(">=9.0.0")
@@ -81,16 +79,9 @@ class TestFailureProgressEventCrossVersionTest extends TestFailureSpecification
 
         then:
         thrown(BuildException)
-        collector.failures.size() == 2
+        collector.failures.size() == 1
         collector.failures[0] instanceof DefaultTestFrameworkFailure
-
-        DefaultTestFrameworkFailure failure1 = collector.failures[0] as DefaultTestFrameworkFailure
-        failure1.className == "org.gradle.api.internal.tasks.testing.TestSuiteExecutionException"
-        failure1.message =~ /Could not start Gradle Test Executor \d+: Failed to load JUnit 4.  Please ensure that JUnit 4 is available on the test runtime classpath./
-
-        DefaultTestFrameworkFailure failure2 = collector.failures[1] as DefaultTestFrameworkFailure
-        failure2.className == "org.gradle.api.internal.tasks.testing.TestFrameworkStartupFailureException"
-        failure2.message =~ /Could not start Gradle Test Executor \d+: Failed to load JUnit 4.  Please ensure that JUnit 4 is available on the test runtime classpath./
-        failure1.causes.size() == 1
+        collector.failures[0].className == "org.gradle.api.internal.tasks.testing.TestSuiteExecutionException"
+        collector.failures[0].message =~ /Could not start Gradle Test Executor \d+: Failed to load JUnit 4.  Please ensure that JUnit 4 is available on the test runtime classpath./
     }
 }
diff --git a/platforms/ide/tooling-api/src/main/java/org/gradle/tooling/GradleConnector.java b/platforms/ide/tooling-api/src/main/java/org/gradle/tooling/GradleConnector.java
index 6075fddd75c..65fc966c484 100644
--- a/platforms/ide/tooling-api/src/main/java/org/gradle/tooling/GradleConnector.java
+++ b/platforms/ide/tooling-api/src/main/java/org/gradle/tooling/GradleConnector.java
@@ -61,7 +61,7 @@
  *
  * <p>The Tooling API is both forwards and backwards compatible with other versions of Gradle. It supports execution of Gradle builds that use older or newer versions of Gradle.  Each release of Gradle contains a new release of the Tooling API as well.</p>
  *
- * <p>The Tooling API supports running builds using Gradle version 3.0 and up.</p>
+ * <p>The Tooling API supports running builds using Gradle version 4.0 and up.</p>
  *
  * <p>You should note that not all features of the Tooling API are available for all versions of Gradle. Refer to the documentation for each class and method for more details.</p>
  *
diff --git a/platforms/ide/tooling-api/src/main/java/org/gradle/tooling/ProjectConnection.java b/platforms/ide/tooling-api/src/main/java/org/gradle/tooling/ProjectConnection.java
index 02cc86f4933..fb76c18ee00 100644
--- a/platforms/ide/tooling-api/src/main/java/org/gradle/tooling/ProjectConnection.java
+++ b/platforms/ide/tooling-api/src/main/java/org/gradle/tooling/ProjectConnection.java
@@ -96,7 +96,7 @@ public interface ProjectConnection extends Closeable {
     /**
      * Creates a test launcher which can be used to execute tests.
      *
-     * <p>Requires Gradle 3.0 or later.</p>
+     * <p>Requires Gradle 4.0 or later.</p>
      *
      * @return The launcher.
      * @since 2.6
diff --git a/platforms/ide/tooling-api/src/main/java/org/gradle/tooling/internal/consumer/DefaultGradleConnector.java b/platforms/ide/tooling-api/src/main/java/org/gradle/tooling/internal/consumer/DefaultGradleConnector.java
index fd9644f5de8..2214e655ac7 100644
--- a/platforms/ide/tooling-api/src/main/java/org/gradle/tooling/internal/consumer/DefaultGradleConnector.java
+++ b/platforms/ide/tooling-api/src/main/java/org/gradle/tooling/internal/consumer/DefaultGradleConnector.java
@@ -31,7 +31,8 @@
 public class DefaultGradleConnector extends GradleConnector implements ProjectConnectionCloseListener {
     private static final Logger LOGGER = LoggerFactory.getLogger(GradleConnector.class);
 
-    public static final GradleVersion MINIMUM_SUPPORTED_GRADLE_VERSION = GradleVersion.version("4.0");
+    public static final int MINIMAL_CLIENT_MAJOR_VERSION = 4;
+    public static final GradleVersion MINIMUM_SUPPORTED_GRADLE_VERSION = GradleVersion.version(MINIMAL_CLIENT_MAJOR_VERSION + ".0");
     private final ConnectionFactory connectionFactory;
     private final DistributionFactory distributionFactory;
     private Distribution distribution;
diff --git a/platforms/jvm/ear/build.gradle.kts b/platforms/jvm/ear/build.gradle.kts
index 4a97956b5da..cf8cb4c85ea 100644
--- a/platforms/jvm/ear/build.gradle.kts
+++ b/platforms/jvm/ear/build.gradle.kts
@@ -29,6 +29,7 @@ dependencies {
     implementation(projects.execution)
     implementation(projects.fileCollections)
     implementation(projects.languageJava)
+    implementation(projects.logging)
     implementation(projects.platformBase)
     implementation(projects.pluginsJava)
     implementation(projects.pluginsJavaBase)
diff --git a/platforms/jvm/ear/src/main/java/org/gradle/plugins/ear/EarPlugin.java b/platforms/jvm/ear/src/main/java/org/gradle/plugins/ear/EarPlugin.java
index 916771d5a09..262937a4045 100644
--- a/platforms/jvm/ear/src/main/java/org/gradle/plugins/ear/EarPlugin.java
+++ b/platforms/jvm/ear/src/main/java/org/gradle/plugins/ear/EarPlugin.java
@@ -34,6 +34,7 @@
 import org.gradle.api.plugins.jvm.internal.JvmFeatureInternal;
 import org.gradle.api.plugins.jvm.internal.JvmPluginServices;
 import org.gradle.api.tasks.TaskProvider;
+import org.gradle.internal.deprecation.DeprecationLogger;
 import org.gradle.jvm.component.internal.JvmSoftwareComponentInternal;
 import org.gradle.plugins.ear.descriptor.DeploymentDescriptor;
 import org.gradle.plugins.ear.descriptor.internal.DefaultDeploymentDescriptor;
@@ -123,7 +124,11 @@ private void setupEarTask(final Project project, PluginContainer plugins) {
             task.setDeploymentDescriptor(deploymentDescriptor);
         });
 
-        project.getConfigurations().getByName(Dependency.ARCHIVES_CONFIGURATION).getArtifacts().add(new LazyPublishArtifact(ear, ((ProjectInternal) project).getFileResolver(), taskDependencyFactory));
+        DeprecationLogger.whileDisabled(() -> {
+            project.getConfigurations().getByName(Dependency.ARCHIVES_CONFIGURATION)
+                .getArtifacts()
+                .add(new LazyPublishArtifact(ear, ((ProjectInternal) project).getFileResolver(), taskDependencyFactory));
+        });
     }
 
     private void wireEarTaskConventions(Project project) {
diff --git a/platforms/jvm/java-compiler-plugin/build.gradle.kts b/platforms/jvm/java-compiler-plugin/build.gradle.kts
index 641581c4af1..efa327c14df 100644
--- a/platforms/jvm/java-compiler-plugin/build.gradle.kts
+++ b/platforms/jvm/java-compiler-plugin/build.gradle.kts
@@ -5,7 +5,11 @@ plugins {
 description = "A Java compiler plugin used by Gradle's incremental compiler"
 
 jvmCompile {
-    usesJdkInternals = true
+    compilations {
+        named("main") {
+            usesJdkInternals = true
+        }
+    }
 }
 
 tasks.withType<Test>().configureEach {
diff --git a/platforms/jvm/language-java/build.gradle.kts b/platforms/jvm/language-java/build.gradle.kts
index ded7cbe42f4..93b6243da98 100644
--- a/platforms/jvm/language-java/build.gradle.kts
+++ b/platforms/jvm/language-java/build.gradle.kts
@@ -5,7 +5,11 @@ plugins {
 description = "Source for JavaCompile, JavaExec and Javadoc tasks, it also contains logic for incremental Java compilation"
 
 jvmCompile {
-    usesJdkInternals = true
+    compilations {
+        named("main") {
+            usesJdkInternals = true
+        }
+    }
 }
 
 errorprone {
@@ -125,8 +129,6 @@ packageCycles {
     excludePatterns.add("org/gradle/external/javadoc/**")
 }
 
-integTest.usesJavadocCodeSnippets = true
-
 tasks.javadoc {
     options {
         this as StandardJavadocDocletOptions
diff --git a/platforms/jvm/language-java/src/integTest/groovy/org/gradle/jvm/toolchain/JavaToolchainDownloadSpiKotlinIntegrationTest.groovy b/platforms/jvm/language-java/src/integTest/groovy/org/gradle/jvm/toolchain/JavaToolchainDownloadSpiKotlinIntegrationTest.groovy
index 5f0ccb5a0ca..5ab58fb0c3a 100644
--- a/platforms/jvm/language-java/src/integTest/groovy/org/gradle/jvm/toolchain/JavaToolchainDownloadSpiKotlinIntegrationTest.groovy
+++ b/platforms/jvm/language-java/src/integTest/groovy/org/gradle/jvm/toolchain/JavaToolchainDownloadSpiKotlinIntegrationTest.groovy
@@ -62,8 +62,8 @@ class JavaToolchainDownloadSpiKotlinIntegrationTest extends AbstractIntegrationS
                .assertHasCause("Failed to calculate the value of task ':compileJava' property 'javaCompiler'.")
                .assertHasCause("Cannot find a Java installation on your machine (${OperatingSystem.current()}) matching: {languageVersion=99, vendor=vendor matching('exotic'), implementation=vendor-specific, nativeImageCapable=false}. " +
                    "Some toolchain resolvers had provisioning failures: custom (Unable to download toolchain matching the requirements " +
-                   "({languageVersion=99, vendor=vendor matching('exotic'), implementation=vendor-specific, nativeImageCapable=false}) from 'https://exoticJavaToolchain.com/java-99', " +
-                   "due to: Could not HEAD 'https://exoticJavaToolchain.com/java-99'.).")
+                   "({languageVersion=99, vendor=vendor matching('exotic'), implementation=vendor-specific, nativeImageCapable=false}) from 'https://exoticJavatoolchain.invalid/java-99', " +
+                   "due to: Could not HEAD 'https://exoticJavatoolchain.invalid/java-99'.).")
     }
 
     private static String applyToolchainRegistryPlugin(String className, String code) {
@@ -94,7 +94,7 @@ class JavaToolchainDownloadSpiKotlinIntegrationTest extends AbstractIntegrationS
         """
             abstract class CustomToolchainResolver: JavaToolchainResolver {
                 override fun resolve(request: JavaToolchainRequest): Optional<JavaToolchainDownload> {
-                    val uri = URI.create("https://exoticJavaToolchain.com/java-" + request.getJavaToolchainSpec().getLanguageVersion().get())
+                    val uri = URI.create("https://exoticJavatoolchain.invalid/java-" + request.getJavaToolchainSpec().getLanguageVersion().get())
                     return Optional.of(JavaToolchainDownload.fromUri(uri))
                 }
             }
diff --git a/platforms/jvm/language-java/src/integTest/groovy/org/gradle/language/java/AutoTestedSamplesLanguageJavaIntegrationTest.groovy b/platforms/jvm/language-java/src/integTest/groovy/org/gradle/language/java/AutoTestedSamplesLanguageJavaIntegrationTest.groovy
deleted file mode 100644
index e7aa996fc94..00000000000
--- a/platforms/jvm/language-java/src/integTest/groovy/org/gradle/language/java/AutoTestedSamplesLanguageJavaIntegrationTest.groovy
+++ /dev/null
@@ -1,28 +0,0 @@
-/*
- * Copyright 2019 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.language.java
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesLanguageJavaIntegrationTest extends AbstractAutoTestedSamplesTest {
-
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/platforms/jvm/language-java/src/test/groovy/org/gradle/api/internal/tasks/compile/incremental/analyzer/DefaultClassDependenciesAnalyzerTest.groovy b/platforms/jvm/language-java/src/test/groovy/org/gradle/api/internal/tasks/compile/incremental/analyzer/DefaultClassDependenciesAnalyzerTest.groovy
index 60d2797e99c..19d9ff9c778 100644
--- a/platforms/jvm/language-java/src/test/groovy/org/gradle/api/internal/tasks/compile/incremental/analyzer/DefaultClassDependenciesAnalyzerTest.groovy
+++ b/platforms/jvm/language-java/src/test/groovy/org/gradle/api/internal/tasks/compile/incremental/analyzer/DefaultClassDependenciesAnalyzerTest.groovy
@@ -70,13 +70,14 @@ class DefaultClassDependenciesAnalyzerTest extends Specification {
 
         then:
         analysis.accessibleClassDependencies == [AccessedFromPackagePrivateField.name] as Set
-        analysis.privateClassDependencies == [AccessedFromPrivateField.name,
-                                              AccessedFromPrivateMethod.name,
-                                              AccessedFromPrivateMethodBody.name,
-                                              // AccessedFromPrivateClass.name, // would be in ClassAnalysis for SomeClass$Foo
-                                              // AccessedFromPrivateClassPublicField.name, // would be in ClassAnalysis for SomeClass$Foo
-                                              SomeClass.name + '$Foo',
-                                              SomeClass.name + '$1'] as Set
+        analysis.privateClassDependencies == [
+            AccessedFromPrivateField.name,
+                AccessedFromPrivateMethod.name,
+                AccessedFromPrivateMethodBody.name,
+                // AccessedFromPrivateClass.name, // would be in ClassAnalysis for SomeClass$Foo
+                // AccessedFromPrivateClassPublicField.name, // would be in ClassAnalysis for SomeClass$Foo
+                SomeClass.name + '$Foo'
+        ] as Set
     }
 
     def "knows basic class dependencies of a groovy class"() {
diff --git a/platforms/jvm/language-jvm/src/integTest/groovy/org/gradle/api/tasks/bundling/JarEncodingIntegrationTest.groovy b/platforms/jvm/language-jvm/src/integTest/groovy/org/gradle/api/tasks/bundling/JarEncodingIntegrationTest.groovy
index 93f4f49ceb1..3fab2947237 100644
--- a/platforms/jvm/language-jvm/src/integTest/groovy/org/gradle/api/tasks/bundling/JarEncodingIntegrationTest.groovy
+++ b/platforms/jvm/language-jvm/src/integTest/groovy/org/gradle/api/tasks/bundling/JarEncodingIntegrationTest.groovy
@@ -17,7 +17,6 @@
 package org.gradle.api.tasks.bundling
 
 import org.gradle.integtests.fixtures.AbstractIntegrationSpec
-import org.gradle.integtests.fixtures.ToBeFixedForConfigurationCache
 import org.gradle.integtests.fixtures.archives.TestFileSystemSensitiveArchives
 import org.gradle.test.fixtures.archive.JarTestFixture
 import org.gradle.test.fixtures.file.DoesNotSupportNonAsciiPaths
@@ -136,8 +135,8 @@ class JarEncodingIntegrationTest extends AbstractIntegrationSpec {
         manifest.contains('moji: bak')
     }
 
-    @ToBeFixedForConfigurationCache
     @Issue('GRADLE-3374')
+    @Issue("https://github.com/gradle/gradle/issues/31838")
     @Requires(value = IntegTestPreconditions.NotEmbeddedExecutor, reason = "requires daemon with explicit default charset")
     def "write manifests using a user defined character set"() {
         given:
diff --git a/platforms/jvm/platform-jvm/build.gradle.kts b/platforms/jvm/platform-jvm/build.gradle.kts
index 55de1c18aee..7f1d84908a3 100644
--- a/platforms/jvm/platform-jvm/build.gradle.kts
+++ b/platforms/jvm/platform-jvm/build.gradle.kts
@@ -58,7 +58,6 @@ strictCompile {
     ignoreDeprecations() // most of this project has been deprecated
 }
 
-integTest.usesJavadocCodeSnippets = true
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/jvm/platform-jvm/src/integTest/groovy/org/gradle/api/AutoTestedSamplesPlatformJvmIntegrationTest.groovy b/platforms/jvm/platform-jvm/src/integTest/groovy/org/gradle/api/AutoTestedSamplesPlatformJvmIntegrationTest.groovy
deleted file mode 100644
index f7326be989b..00000000000
--- a/platforms/jvm/platform-jvm/src/integTest/groovy/org/gradle/api/AutoTestedSamplesPlatformJvmIntegrationTest.groovy
+++ /dev/null
@@ -1,29 +0,0 @@
-/*
- * Copyright 2012 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.api
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesPlatformJvmIntegrationTest extends AbstractAutoTestedSamplesTest {
-
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-
-}
diff --git a/platforms/jvm/platform-jvm/src/integTest/groovy/org/gradle/samples/.gitkeepdir b/platforms/jvm/platform-jvm/src/integTest/groovy/org/gradle/samples/.gitkeepdir
new file mode 100644
index 00000000000..5223fc09389
--- /dev/null
+++ b/platforms/jvm/platform-jvm/src/integTest/groovy/org/gradle/samples/.gitkeepdir
@@ -0,0 +1,2 @@
+// For GenerateAutoTestedSamplesTestTask
+// Without this file, if the sourceSet is empty, no AutoTestedSamplesTest will be generated
diff --git a/platforms/jvm/platform-jvm/src/main/java/org/gradle/jvm/tasks/Jar.java b/platforms/jvm/platform-jvm/src/main/java/org/gradle/jvm/tasks/Jar.java
index bb9d7ffb717..723883d116a 100644
--- a/platforms/jvm/platform-jvm/src/main/java/org/gradle/jvm/tasks/Jar.java
+++ b/platforms/jvm/platform-jvm/src/main/java/org/gradle/jvm/tasks/Jar.java
@@ -23,10 +23,12 @@
 import org.gradle.api.InvalidUserDataException;
 import org.gradle.api.file.CopySpec;
 import org.gradle.api.file.FileCopyDetails;
+import org.gradle.api.internal.ConfigurationCacheDegradation;
 import org.gradle.api.internal.file.FileCollectionFactory;
 import org.gradle.api.internal.file.FileTreeInternal;
 import org.gradle.api.internal.file.copy.CopySpecInternal;
 import org.gradle.api.internal.project.ProjectInternal;
+import org.gradle.api.internal.provider.DefaultProvider;
 import org.gradle.api.java.archives.Manifest;
 import org.gradle.api.java.archives.internal.CustomManifestInternalWrapper;
 import org.gradle.api.java.archives.internal.DefaultManifest;
@@ -64,6 +66,14 @@ public Jar() {
         metaInf = (CopySpecInternal) getRootSpec().addFirst().into("META-INF");
         metaInf.addChild().from(manifestFileTree());
         getMainSpec().appendCachingSafeCopyAction(new ExcludeManifestAction());
+        ConfigurationCacheDegradation.requireDegradation(this, new DefaultProvider<>(this::evaluateDegradationReason));
+    }
+
+    private String evaluateDegradationReason() {
+        if (!manifestContentCharset.equals(DefaultManifest.DEFAULT_CONTENT_CHARSET)) {
+            return String.format("Custom charset '%s' was used. Only '%s' is supported with the configuration cache", manifestContentCharset, DefaultManifest.DEFAULT_CONTENT_CHARSET);
+        }
+        return null;
     }
 
     private FileTreeInternal manifestFileTree() {
diff --git a/platforms/jvm/plugins-application/build.gradle.kts b/platforms/jvm/plugins-application/build.gradle.kts
index b08df8d62a6..4f04f266d5a 100644
--- a/platforms/jvm/plugins-application/build.gradle.kts
+++ b/platforms/jvm/plugins-application/build.gradle.kts
@@ -67,5 +67,4 @@ packageCycles {
     excludePatterns.add("org/gradle/api/plugins/**")
 }
 
-integTest.usesJavadocCodeSnippets = true
 testFilesCleanup.reportOnly = true
diff --git a/platforms/jvm/plugins-application/src/integTest/groovy/org/gradle/integtests/samples/AutoTestedSamplesPluginsIntegrationTest.groovy b/platforms/jvm/plugins-application/src/integTest/groovy/org/gradle/integtests/samples/AutoTestedSamplesPluginsIntegrationTest.groovy
deleted file mode 100644
index b7e0d64c0e6..00000000000
--- a/platforms/jvm/plugins-application/src/integTest/groovy/org/gradle/integtests/samples/AutoTestedSamplesPluginsIntegrationTest.groovy
+++ /dev/null
@@ -1,30 +0,0 @@
-/*
- * Copyright 2011 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.integtests.samples
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesPluginsIntegrationTest extends AbstractAutoTestedSamplesTest {
-
-    @Test
-    void runSamples() {
-        // for debugging purposes you can restrict the tests samples to only a single class
-//        includeOnly '**/Test.java'
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/platforms/jvm/plugins-application/src/main/java/org/gradle/api/internal/plugins/StartScriptTemplateBindingFactory.java b/platforms/jvm/plugins-application/src/main/java/org/gradle/api/internal/plugins/StartScriptTemplateBindingFactory.java
index 10592a4a079..d40b86f0043 100644
--- a/platforms/jvm/plugins-application/src/main/java/org/gradle/api/internal/plugins/StartScriptTemplateBindingFactory.java
+++ b/platforms/jvm/plugins-application/src/main/java/org/gradle/api/internal/plugins/StartScriptTemplateBindingFactory.java
@@ -114,6 +114,9 @@ private static String getModuleEntryPoint(MainModule entryPoint) {
     }
 
     private String createJoinedPath(Iterable<String> path) {
+        if (!windows && !path.iterator().hasNext()) {
+            return "\"\\\\\\\"\\\\\\\"\""; // empty path argument for shell script
+        }
         return Streams.stream(path).map(this::encodePath).collect(Collectors.joining(getMultiPathSeparator()));
     }
 
diff --git a/platforms/jvm/plugins-application/src/main/resources/org/gradle/api/internal/plugins/unixStartScript.txt b/platforms/jvm/plugins-application/src/main/resources/org/gradle/api/internal/plugins/unixStartScript.txt
index 1358dd7b4b2..c71b056fc64 100644
--- a/platforms/jvm/plugins-application/src/main/resources/org/gradle/api/internal/plugins/unixStartScript.txt
+++ b/platforms/jvm/plugins-application/src/main/resources/org/gradle/api/internal/plugins/unixStartScript.txt
@@ -147,9 +147,7 @@ case "\$( uname )" in                #(
   NONSTOP* )        nonstop=true ;;
 esac
 
-<% if ( classpath ) {%>\
 CLASSPATH=$classpath
-<% } %>\
 <% if ( mainClassName.startsWith('--module ') ) { %>
 MODULE_PATH=$modulePath
 <% } %>
@@ -209,9 +207,7 @@ fi
 # For Cygwin or MSYS, switch paths to Windows format before running java
 if "\$cygwin" || "\$msys" ; then
     APP_HOME=\$( cygpath --path --mixed "\$APP_HOME" )
-<% if ( classpath ) {%>\
     CLASSPATH=\$( cygpath --path --mixed "\$CLASSPATH" )
-<% } %>\
 <% if ( mainClassName.startsWith('--module ') ) { %>    MODULE_PATH=\$( cygpath --path --mixed "\$MODULE_PATH" )<% } %>
     JAVACMD=\$( cygpath --unix "\$JAVACMD" )
 
@@ -255,10 +251,7 @@ DEFAULT_JVM_OPTS=${defaultJvmOpts}
 set -- \\
 <% if ( appNameSystemProperty ) {
      %>        "-D${appNameSystemProperty}=\$APP_BASE_NAME" \\
-<% } %>\
-<% if ( classpath ) {%>\
-        -classpath "\$CLASSPATH" \\
-<% } %>\
+<% } %>        -classpath "\$CLASSPATH" \\
 <% if ( mainClassName.startsWith('--module ') ) {
      %>        --module-path "\$MODULE_PATH" \\
 <% } %>        ${mainClassName ?: entryPointArgs} \\
diff --git a/platforms/jvm/plugins-application/src/main/resources/org/gradle/api/internal/plugins/windowsStartScript.txt b/platforms/jvm/plugins-application/src/main/resources/org/gradle/api/internal/plugins/windowsStartScript.txt
index 82e7fa8a452..95b88fe56d3 100644
--- a/platforms/jvm/plugins-application/src/main/resources/org/gradle/api/internal/plugins/windowsStartScript.txt
+++ b/platforms/jvm/plugins-application/src/main/resources/org/gradle/api/internal/plugins/windowsStartScript.txt
@@ -71,13 +71,11 @@ goto fail
 :execute
 @rem Setup the command line
 
-<% if ( classpath ) {%>\
 set CLASSPATH=$classpath
-<% } %>\
 <% if ( mainClassName.startsWith('--module ') ) { %>set MODULE_PATH=$modulePath<% } %>
 
 @rem Execute ${applicationName}
-"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %${optsEnvironmentVar}% <% if ( appNameSystemProperty ) { %>"-D${appNameSystemProperty}=%APP_BASE_NAME%"<% } %><% if ( classpath ) {%> -classpath "%CLASSPATH%"<% } %> <% if ( mainClassName.startsWith('--module ') ) { %>--module-path "%MODULE_PATH%" <% } %>${mainClassName ?: entryPointArgs} %*
+"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %${optsEnvironmentVar}% <% if ( appNameSystemProperty ) { %>"-D${appNameSystemProperty}=%APP_BASE_NAME%"<% } %> -classpath "%CLASSPATH%" <% if ( mainClassName.startsWith('--module ') ) { %>--module-path "%MODULE_PATH%" <% } %>${mainClassName ?: entryPointArgs} %*
 
 :end
 @rem End local scope for the variables with windows NT shell
diff --git a/platforms/jvm/plugins-application/src/test/groovy/org/gradle/api/internal/plugins/UnixStartScriptGeneratorTest.groovy b/platforms/jvm/plugins-application/src/test/groovy/org/gradle/api/internal/plugins/UnixStartScriptGeneratorTest.groovy
index df9c823f872..4b5abca8313 100644
--- a/platforms/jvm/plugins-application/src/test/groovy/org/gradle/api/internal/plugins/UnixStartScriptGeneratorTest.groovy
+++ b/platforms/jvm/plugins-application/src/test/groovy/org/gradle/api/internal/plugins/UnixStartScriptGeneratorTest.groovy
@@ -18,7 +18,7 @@ package org.gradle.api.internal.plugins
 
 import org.gradle.jvm.application.scripts.JavaAppStartScriptGenerationDetails
 import org.gradle.util.internal.TextUtil
-import spock.lang.Issue
+import org.gradle.util.internal.WrapUtil
 import spock.lang.Specification
 
 import java.util.regex.Pattern
@@ -144,33 +144,9 @@ class UnixStartScriptGeneratorTest extends Specification {
         "main module with main class" | new MainModule("com.example", "com.example.Main") | '--module com.example/com.example.Main'
     }
 
-    @Issue("https://github.com/gradle/gradle/issues/33415")
-    def "Do not set classpath if it is empty"() {
-        given:
-        JavaAppStartScriptGenerationDetails details = createScriptGenerationDetails(null, 'bin', new MainClass(""), classpath)
-        Writer destination = new StringWriter()
-
-        when:
-        generator.generateScript(details, destination)
-
-        then:
-        destination.toString().contains(text) == result
-
-        where:
-        classpath             | text                     | result
-        []                    | '-classpath "$CLASSPATH' | false
-        []                    | 'CLASSPATH='             | false
-        ['path\\to\\Jar.jar'] | '-classpath "$CLASSPATH' | true
-        ['path\\to\\Jar.jar'] | 'CLASSPATH='             | true
-    }
-
-    private JavaAppStartScriptGenerationDetails createScriptGenerationDetails(
-        List<String> defaultJvmOpts,
-        String scriptRelPath,
-        AppEntryPoint appEntryPoint = new MainClass(""),
-        List<String> classpath = ['path\\to\\Jar.jar']
-    ) {
+    private JavaAppStartScriptGenerationDetails createScriptGenerationDetails(List<String> defaultJvmOpts, String scriptRelPath, AppEntryPoint appEntryPoint = new MainClass("")) {
         final String applicationName = 'TestApp'
+        final List<String> classpath = WrapUtil.toList('path\\to\\Jar.jar')
         return new DefaultJavaAppStartScriptGenerationDetails(applicationName, null, null, appEntryPoint, defaultJvmOpts, classpath, [], scriptRelPath, null)
     }
 }
diff --git a/platforms/jvm/plugins-application/src/test/groovy/org/gradle/api/internal/plugins/WindowsStartScriptGeneratorTest.groovy b/platforms/jvm/plugins-application/src/test/groovy/org/gradle/api/internal/plugins/WindowsStartScriptGeneratorTest.groovy
index e5e14025a2e..c98545eceb1 100644
--- a/platforms/jvm/plugins-application/src/test/groovy/org/gradle/api/internal/plugins/WindowsStartScriptGeneratorTest.groovy
+++ b/platforms/jvm/plugins-application/src/test/groovy/org/gradle/api/internal/plugins/WindowsStartScriptGeneratorTest.groovy
@@ -18,7 +18,7 @@ package org.gradle.api.internal.plugins
 
 import org.gradle.jvm.application.scripts.JavaAppStartScriptGenerationDetails
 import org.gradle.util.internal.TextUtil
-import spock.lang.Issue
+import org.gradle.util.internal.WrapUtil
 import spock.lang.Specification
 
 class WindowsStartScriptGeneratorTest extends Specification {
@@ -139,33 +139,9 @@ class WindowsStartScriptGeneratorTest extends Specification {
         "main module with main class" | new MainModule("com.example", "com.example.Main") | '--module com.example/com.example.Main'
     }
 
-    @Issue("https://github.com/gradle/gradle/issues/33415")
-    def "Do not set classpath if it is empty"() {
-        given:
-        JavaAppStartScriptGenerationDetails details = createScriptGenerationDetails(null, 'bin', new MainClass(""), classpath)
-        Writer destination = new StringWriter()
-
-        when:
-        generator.generateScript(details, destination)
-
-        then:
-        destination.toString().contains(text) == result
-
-        where:
-        classpath             | text                       | result
-        []                    | 'set CLASSPATH'            | false
-        []                    | '-classpath "%CLASSPATH%"' | false
-        ['path\\to\\Jar.jar'] | 'set CLASSPATH'            | true
-        ['path\\to\\Jar.jar'] | '-classpath "%CLASSPATH%"' | true
-    }
-
-    private JavaAppStartScriptGenerationDetails createScriptGenerationDetails(
-        List<String> defaultJvmOpts,
-        String scriptRelPath,
-        AppEntryPoint appEntryPoint = new MainClass(""),
-        List<String> classpath = ['path/to/Jar.jar']
-    ) {
+    private JavaAppStartScriptGenerationDetails createScriptGenerationDetails(List<String> defaultJvmOpts, String scriptRelPath, AppEntryPoint appEntryPoint = new MainClass("")) {
         final String applicationName = 'TestApp'
+        final List<String> classpath = WrapUtil.toList('path/to/Jar.jar')
         return new DefaultJavaAppStartScriptGenerationDetails(applicationName, null, null, appEntryPoint, defaultJvmOpts, classpath, [], scriptRelPath, null)
     }
 }
diff --git a/platforms/jvm/plugins-groovy/build.gradle.kts b/platforms/jvm/plugins-groovy/build.gradle.kts
index 54fb1fa4f0e..a17cd8c447b 100644
--- a/platforms/jvm/plugins-groovy/build.gradle.kts
+++ b/platforms/jvm/plugins-groovy/build.gradle.kts
@@ -47,7 +47,6 @@ dependencies {
     crossVersionTestDistributionRuntimeOnly(projects.distributionsCore)
 }
 
-integTest.usesJavadocCodeSnippets.set(true)
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/jvm/plugins-groovy/src/integTest/groovy/org/gradle/api/plugins/AutoTestedSamplesGroovyIntegrationTest.groovy b/platforms/jvm/plugins-groovy/src/integTest/groovy/org/gradle/api/plugins/AutoTestedSamplesGroovyIntegrationTest.groovy
deleted file mode 100644
index 53dd809858f..00000000000
--- a/platforms/jvm/plugins-groovy/src/integTest/groovy/org/gradle/api/plugins/AutoTestedSamplesGroovyIntegrationTest.groovy
+++ /dev/null
@@ -1,32 +0,0 @@
-/*
- * Copyright 2023 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.api.plugins
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-/**
- * Runs samples contained in class-level javadoc comments in the `plugins-groovy` project.
- */
-class AutoTestedSamplesGroovyIntegrationTest extends AbstractAutoTestedSamplesTest {
-    @Test
-    void runSamples() {
-        // for debugging purposes you can restrict the tests samples to only a single class
-//        includeOnly '**/Test.java'
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/platforms/jvm/plugins-java-base/build.gradle.kts b/platforms/jvm/plugins-java-base/build.gradle.kts
index 19f533b8e54..4f7da9f6a13 100644
--- a/platforms/jvm/plugins-java-base/build.gradle.kts
+++ b/platforms/jvm/plugins-java-base/build.gradle.kts
@@ -67,5 +67,3 @@ dependencies {
 packageCycles {
     excludePatterns.add("org/gradle/api/plugins/**")
 }
-
-integTest.usesJavadocCodeSnippets.set(true)
diff --git a/platforms/jvm/plugins-java-base/src/integTest/groovy/org/gradle/api/plugins/AutoTestedSamplesJavaBaseIntegrationTest.groovy b/platforms/jvm/plugins-java-base/src/integTest/groovy/org/gradle/api/plugins/AutoTestedSamplesJavaBaseIntegrationTest.groovy
deleted file mode 100644
index fdec239d854..00000000000
--- a/platforms/jvm/plugins-java-base/src/integTest/groovy/org/gradle/api/plugins/AutoTestedSamplesJavaBaseIntegrationTest.groovy
+++ /dev/null
@@ -1,32 +0,0 @@
-/*
- * Copyright 2023 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.api.plugins
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-/**
- * Runs samples contained in class-level javadoc comments in the `plugins-java` project.
- */
-class AutoTestedSamplesJavaBaseIntegrationTest extends AbstractAutoTestedSamplesTest {
-    @Test
-    void runSamples() {
-        // for debugging purposes you can restrict the tests samples to only a single class
-//        includeOnly '**/Test.java'
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/platforms/jvm/plugins-java/build.gradle.kts b/platforms/jvm/plugins-java/build.gradle.kts
index 97c37eeca84..a4a757ffabb 100644
--- a/platforms/jvm/plugins-java/build.gradle.kts
+++ b/platforms/jvm/plugins-java/build.gradle.kts
@@ -16,6 +16,7 @@ dependencies {
     implementation(projects.core)
     implementation(projects.ivy)
     implementation(projects.languageJvm)
+    implementation(projects.logging)
     implementation(projects.maven)
     implementation(projects.modelCore)
     implementation(projects.platformBase)
diff --git a/platforms/jvm/plugins-java/src/integTest/groovy/org/gradle/java/dependencies/JavaFeatureRegressionIntegrationTest.groovy b/platforms/jvm/plugins-java/src/integTest/groovy/org/gradle/java/dependencies/JavaFeatureRegressionIntegrationTest.groovy
new file mode 100644
index 00000000000..2d91b2bf586
--- /dev/null
+++ b/platforms/jvm/plugins-java/src/integTest/groovy/org/gradle/java/dependencies/JavaFeatureRegressionIntegrationTest.groovy
@@ -0,0 +1,55 @@
+/*
+ * Copyright 2025 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.gradle.java.dependencies
+
+import org.gradle.integtests.fixtures.AbstractIntegrationSpec
+import spock.lang.Issue
+
+class JavaFeatureRegressionIntegrationTest extends AbstractIntegrationSpec {
+    def setup() {
+        buildFile << """
+            plugins {
+                id("java-library")
+            }
+            // stand in for Nebula resolution rules plugin
+            configurations.all { conf ->
+                project.afterEvaluate {
+                    println("hello " + conf.name)
+                }
+            }
+        """
+    }
+    @Issue("https://github.com/gradle/gradle/issues/34058")
+    def "afterEvaluate called in configurations.all triggered from a create called from a lazy container works withSourcesJar"() {
+        buildFile << """
+            java.withSourcesJar()
+        """
+        expect:
+        succeeds("help")
+        output.contains("hello sourcesElements")
+    }
+
+    @Issue("https://github.com/gradle/gradle/issues/34058")
+    def "afterEvaluate called in configurations.all triggered from a create called from a lazy container works withJavadocJar"() {
+        buildFile << """
+            java.withJavadocJar()
+        """
+        expect:
+        succeeds("help")
+        output.contains("hello javadocElements")
+    }
+}
diff --git a/platforms/jvm/plugins-java/src/main/java/org/gradle/api/plugins/JavaPlugin.java b/platforms/jvm/plugins-java/src/main/java/org/gradle/api/plugins/JavaPlugin.java
index 1396943d72d..088cc4711af 100644
--- a/platforms/jvm/plugins-java/src/main/java/org/gradle/api/plugins/JavaPlugin.java
+++ b/platforms/jvm/plugins-java/src/main/java/org/gradle/api/plugins/JavaPlugin.java
@@ -47,6 +47,7 @@
 import org.gradle.api.tasks.bundling.Jar;
 import org.gradle.api.tasks.diagnostics.DependencyInsightReportTask;
 import org.gradle.api.tasks.testing.Test;
+import org.gradle.internal.deprecation.DeprecationLogger;
 import org.gradle.jvm.component.internal.DefaultJvmSoftwareComponent;
 import org.gradle.jvm.component.internal.JvmSoftwareComponentInternal;
 import org.gradle.testing.base.TestingExtension;
@@ -266,8 +267,10 @@ public void apply(final Project project) {
         ((SoftwareComponentContainerInternal) project.getComponents()).getMainComponent().convention(javaComponent);
 
         // Build the main jar when running `assemble`.
-        project.getConfigurations().getByName(Dependency.ARCHIVES_CONFIGURATION).getArtifacts()
-            .add(javaComponent.getMainFeature().getRuntimeElementsConfiguration().getArtifacts().iterator().next());
+        DeprecationLogger.whileDisabled(() -> {
+            project.getConfigurations().getByName(Dependency.ARCHIVES_CONFIGURATION).getArtifacts()
+                .add(javaComponent.getMainFeature().getRuntimeElementsConfiguration().getArtifacts().iterator().next());
+        });
 
         configureTestTaskOrdering(project.getTasks());
         configureDiagnostics(project, javaComponent.getMainFeature());
diff --git a/platforms/jvm/plugins-java/src/main/java/org/gradle/jvm/component/internal/DefaultJvmSoftwareComponent.java b/platforms/jvm/plugins-java/src/main/java/org/gradle/jvm/component/internal/DefaultJvmSoftwareComponent.java
index 5af7d653beb..7b475b25bfa 100644
--- a/platforms/jvm/plugins-java/src/main/java/org/gradle/jvm/component/internal/DefaultJvmSoftwareComponent.java
+++ b/platforms/jvm/plugins-java/src/main/java/org/gradle/jvm/component/internal/DefaultJvmSoftwareComponent.java
@@ -60,7 +60,7 @@ public void withJavadocJar() {
         // TODO: This should probably apply to all features and not just the main feature or this
         // should be configurable at the feature level instead of the project level.
         // The original implementation only applied to the main feature.
-        getFeatures().configureEach(feature -> {
+        getFeatures().all(feature -> {
             if (feature.getName().equals(JvmConstants.JAVA_MAIN_FEATURE_NAME)) {
                 feature.withJavadocJar();
 
@@ -77,7 +77,7 @@ public void withSourcesJar() {
         // TODO: This should probably apply to all features and not just the main feature or this
         // should be configurable at the feature level instead of the project level.
         // The original implementation only applied to the main feature.
-        getFeatures().configureEach(feature -> {
+        getFeatures().all(feature -> {
             if (feature.getName().equals(JvmConstants.JAVA_MAIN_FEATURE_NAME)) {
                 feature.withSourcesJar();
 
diff --git a/platforms/jvm/scala/build.gradle.kts b/platforms/jvm/scala/build.gradle.kts
index 1b6ad64ad45..8804d42ee62 100644
--- a/platforms/jvm/scala/build.gradle.kts
+++ b/platforms/jvm/scala/build.gradle.kts
@@ -97,7 +97,6 @@ packageCycles {
     excludePatterns.add("org/gradle/language/scala/tasks/*")
 }
 
-integTest.usesJavadocCodeSnippets = true
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/jvm/scala/src/integTest/groovy/org/gradle/integtests/samples/AutoTestedSamplesScalaIntegrationTest.groovy b/platforms/jvm/scala/src/integTest/groovy/org/gradle/integtests/samples/AutoTestedSamplesScalaIntegrationTest.groovy
deleted file mode 100644
index 0ffec816480..00000000000
--- a/platforms/jvm/scala/src/integTest/groovy/org/gradle/integtests/samples/AutoTestedSamplesScalaIntegrationTest.groovy
+++ /dev/null
@@ -1,28 +0,0 @@
-/*
- * Copyright 2019 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.integtests.samples
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesScalaIntegrationTest extends AbstractAutoTestedSamplesTest {
-
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/platforms/jvm/scala/src/integTest/groovy/org/gradle/scala/ScalaPluginIntegrationTest.groovy b/platforms/jvm/scala/src/integTest/groovy/org/gradle/scala/ScalaPluginIntegrationTest.groovy
index f657723a85e..3f2b83f5d96 100644
--- a/platforms/jvm/scala/src/integTest/groovy/org/gradle/scala/ScalaPluginIntegrationTest.groovy
+++ b/platforms/jvm/scala/src/integTest/groovy/org/gradle/scala/ScalaPluginIntegrationTest.groovy
@@ -184,7 +184,7 @@ class ScalaPluginIntegrationTest extends MultiVersionIntegrationSpec {
             project(":ear") {
                 apply plugin: 'ear'
                 dependencies {
-                    deploy project(path: ':war', configuration: 'archives')
+                    deploy project(path: ':war')
                 }
             }
         """
diff --git a/platforms/jvm/testing-jvm/build.gradle.kts b/platforms/jvm/testing-jvm/build.gradle.kts
index bf95ca0aae8..ccbd539cdbb 100644
--- a/platforms/jvm/testing-jvm/build.gradle.kts
+++ b/platforms/jvm/testing-jvm/build.gradle.kts
@@ -18,7 +18,6 @@ dependencies {
     api(projects.coreApi)
     api(projects.fileOperations)
     api(projects.jvmServices)
-    api(projects.logging)
     api(projects.messaging)
     api(projects.modelCore)
     api(projects.reporting)
@@ -35,6 +34,7 @@ dependencies {
     api(libs.inject)
     api(libs.jspecify)
 
+    implementation(projects.logging)
     implementation(projects.classloaders)
     implementation(projects.concurrent)
     implementation(projects.fileTemp)
@@ -78,7 +78,6 @@ packageCycles {
     excludePatterns.add("org/gradle/api/internal/tasks/testing/**")
 }
 
-integTest.usesJavadocCodeSnippets = true
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/AutoTestedSampleTestingJvmIntegrationTest.groovy b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/AutoTestedSampleTestingJvmIntegrationTest.groovy
deleted file mode 100644
index 61584fdb0cc..00000000000
--- a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/AutoTestedSampleTestingJvmIntegrationTest.groovy
+++ /dev/null
@@ -1,27 +0,0 @@
-/*
- * Copyright 2017 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.testing
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSampleTestingJvmIntegrationTest extends AbstractAutoTestedSamplesTest {
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/TestFrameworkMissingDependenciesIntegrationTest.groovy b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/TestFrameworkMissingDependenciesIntegrationTest.groovy
index 76a23704c20..51013770c64 100644
--- a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/TestFrameworkMissingDependenciesIntegrationTest.groovy
+++ b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/TestFrameworkMissingDependenciesIntegrationTest.groovy
@@ -27,6 +27,61 @@ import org.gradle.testing.fixture.TestNGCoverage
  * runtime dependencies are not included on the test runtime classpath.
  */
 class TestFrameworkMissingDependenciesIntegrationTest extends AbstractIntegrationSpec implements TestFrameworkStartupTestFixture {
+    def "sensible help message when multiple workers fail to start"() {
+        given:
+        buildFile << """
+            plugins {
+                id("java-library")
+            }
+
+            ${mavenCentralRepository()}
+
+            dependencies {
+                testCompileOnly("junit:junit:${JUnitCoverage.LATEST_JUNIT4_VERSION}")
+            }
+
+            test {
+                useJUnit()
+                maxParallelForks = 2
+            }
+
+            ${addLoggingTestListener()}
+        """
+
+        file("src/test/java/MyTest.java") << """
+            public class MyTest {
+                @org.junit.Test
+                public void test() {}
+            }
+        """
+
+        file("src/test/java/MyTest2.java") << """
+            public class MyTest2 {
+                @org.junit.Test
+                public void test() {}
+            }
+        """
+
+        file("src/test/java/MyTest3.java") << """
+            public class MyTest3 {
+                @org.junit.Test
+                public void test() {}
+            }
+        """
+
+        when:
+        fails('test')
+
+        then: "Test framework startup failure is reported"
+        assertTestWorkerStartedAndTestFrameworkFailedToStart(":test", 2)
+
+        and: "Resolutions are provided"
+        assertSuggestsInspectTaskConfiguration()
+
+        and: "No test class results created"
+        new DefaultTestExecutionResult(testDirectory).testClassDoesNotExist("MyTest")
+    }
+
     def "junit 4 fails with sensible error message"() {
         given:
         buildFile << """
diff --git a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/TestProcessingStartupFailureIntegrationTest.groovy b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/TestProcessingStartupFailureIntegrationTest.groovy
index ed490b042d1..65204ceea17 100644
--- a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/TestProcessingStartupFailureIntegrationTest.groovy
+++ b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/TestProcessingStartupFailureIntegrationTest.groovy
@@ -22,6 +22,8 @@ import org.gradle.test.fixtures.file.TestFile
 import org.gradle.testing.fixture.JUnitCoverage
 import org.gradle.testing.fixture.TestFrameworkStartupTestFixture
 
+import static org.gradle.util.Matchers.matchesRegexp
+
 /**
  * Tests behavior of the test task there are problems starting test processing.
  *
@@ -67,6 +69,84 @@ class TestProcessingStartupFailureIntegrationTest extends AbstractIntegrationSpe
         new DefaultTestExecutionResult(testDirectory).testClassDoesNotExist("MyTest")
     }
 
+    def "mix of startup failure and regular failures show startup failures first"() {
+        given:
+        buildFile << """
+            plugins {
+                id("java-library")
+            }
+
+            ${mavenCentralRepository()}
+
+            testing {
+                suites {
+                    test {
+                        useJUnitJupiter()
+                    }
+                }
+            }
+
+            ${addLoggingTestListener()}
+        """
+
+        addMyTestForJunit5()
+        succeeds("compileTestJava")
+        file("build/classes/java/test/MyOtherTest.class").text = "corrupted content"
+
+        when:
+        fails('test', "-x", "compileTestJava")
+
+        then: "Task failure is reported"
+
+        failure.assertHasFailure("Execution failed for task ':test'.") {
+            it.assertHasCause("Could not execute test class 'MyOtherTest'.")
+        }
+        def testResults = new DefaultTestExecutionResult(testDirectory)
+        testResults.testClassDoesNotExist("MyOtherTest")
+        testResults.testClassExists("MyTest")
+    }
+
+
+    def "test process failing in an unusual way is shown"() {
+        given:
+        buildFile << """
+            plugins {
+                id("java-library")
+            }
+
+            ${mavenCentralRepository()}
+
+            testing {
+                suites {
+                    test {
+                        useJUnitJupiter()
+                    }
+                }
+            }
+
+            ${addLoggingTestListener()}
+        """
+
+        addMyTestForJunit5()
+        file("src/test/java/MyOtherTest.java") << """
+            public class MyOtherTest {
+                @org.junit.jupiter.api.Test
+                void test() {
+                    System.exit(-25);
+                }
+            }
+        """
+        when:
+        executer.withStackTraceChecksDisabled()
+        fails('test')
+
+        then: "Task failure is reported"
+
+        failure.assertHasDescription("Execution failed for task ':test'.")
+        failure.assertHasCause("Test process encountered an unexpected problem.")
+        failure.assertThatCause(matchesRegexp(/Process 'Gradle Test Executor \d+' finished with non-zero exit value.*/))
+    }
+
     def "tests not found due to incorrect framework used (junit 4 default)"() {
         given:
         buildFile << """
diff --git a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/AbstractJUnitTestExecutionIntegrationTest.groovy b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/AbstractJUnitTestExecutionIntegrationTest.groovy
index de501183d8d..433e32de82f 100644
--- a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/AbstractJUnitTestExecutionIntegrationTest.groovy
+++ b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/AbstractJUnitTestExecutionIntegrationTest.groovy
@@ -294,27 +294,6 @@ abstract class AbstractJUnitTestExecutionIntegrationTest extends AbstractTesting
             containsString('VM START TIME =')).get(0))))
     }
 
-    def "tries to execute unparseable test classes"() {
-        given:
-        file('build/classes/java/test/com/example/Foo.class').text = "invalid class file"
-        buildFile << """
-            apply plugin: 'java'
-            ${mavenCentralRepository()}
-            dependencies {
-                ${testFrameworkDependencies}
-            }
-            test.${configureTestFramework}
-        """
-
-        when:
-        fails('test', '-x', 'compileTestJava')
-
-        then:
-        failureCauseContains("There were failing tests")
-        DefaultTestExecutionResult testResult = new DefaultTestExecutionResult(testDirectory)
-        assertFailedToExecute(testResult, 'com.example.Foo').assertTestCount(1, 1, 0)
-    }
-
     @Issue("https://issues.gradle.org/browse/GRADLE-1948")
     def "test interrupting its own thread does not kill test execution"() {
         given:
diff --git a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/junit4/JUnit4TestExecutionIntegrationTest.groovy b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/junit4/JUnit4TestExecutionIntegrationTest.groovy
index d543cfbbc20..c05f39e63f4 100644
--- a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/junit4/JUnit4TestExecutionIntegrationTest.groovy
+++ b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/junit4/JUnit4TestExecutionIntegrationTest.groovy
@@ -38,6 +38,28 @@ class JUnit4TestExecutionIntegrationTest extends AbstractJUnitTestExecutionInteg
             .assertTestFailed("initializationError", containsString('ClassFormatError'))
     }
 
+    def "tries to execute unparseable test classes"() {
+        given:
+        file('build/classes/java/test/com/example/Foo.class').text = "invalid class file"
+        buildFile << """
+            apply plugin: 'java'
+            ${mavenCentralRepository()}
+            dependencies {
+                ${testFrameworkDependencies}
+            }
+            test.${configureTestFramework}
+        """
+
+        when:
+        fails('test', '-x', 'compileTestJava')
+
+        then:
+        // TODO: This doesn't look like the other test frameworks
+        failure.assertHasCause("There were failing tests.")
+        DefaultTestExecutionResult testResult = new DefaultTestExecutionResult(testDirectory)
+        assertFailedToExecute(testResult, 'com.example.Foo').assertTestCount(1, 1, 0)
+    }
+
     def "test thread name is reset after test execution"() {
         when:
         buildFile << """
diff --git a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/jupiter/JUnitJupiterTestExecutionIntegrationTest.groovy b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/jupiter/JUnitJupiterTestExecutionIntegrationTest.groovy
index ea0367c3206..4e189b6584e 100644
--- a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/jupiter/JUnitJupiterTestExecutionIntegrationTest.groovy
+++ b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/jupiter/JUnitJupiterTestExecutionIntegrationTest.groovy
@@ -16,6 +16,7 @@
 
 package org.gradle.testing.junit.jupiter
 
+import org.gradle.integtests.fixtures.DefaultTestExecutionResult
 import org.gradle.integtests.fixtures.TargetCoverage
 import org.gradle.integtests.fixtures.TestClassExecutionResult
 import org.gradle.integtests.fixtures.TestExecutionResult
@@ -36,4 +37,26 @@ class JUnitJupiterTestExecutionIntegrationTest extends AbstractJUnitTestExecutio
         return testResult.testClassStartsWith('Gradle Test Executor')
             .assertTestFailed("failed to execute tests", containsString("Could not execute test class '${testClassName}'"))
     }
+
+    def "tries to execute unparseable test classes"() {
+        given:
+        file('build/classes/java/test/com/example/Foo.class').text = "invalid class file"
+        buildFile << """
+            apply plugin: 'java'
+            ${mavenCentralRepository()}
+            dependencies {
+                ${testFrameworkDependencies}
+            }
+            test.${configureTestFramework}
+        """
+
+        when:
+        fails('test', '-x', 'compileTestJava')
+
+        then:
+        failure.assertHasCause("Test process encountered an unexpected problem.")
+        failure.assertHasCause("Could not execute test class 'com.example.Foo'.")
+        DefaultTestExecutionResult testResult = new DefaultTestExecutionResult(testDirectory)
+        assertFailedToExecute(testResult, 'com.example.Foo').assertTestCount(1, 1, 0)
+    }
 }
diff --git a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/platform/JUnitPlatformIntegrationTest.groovy b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/platform/JUnitPlatformIntegrationTest.groovy
index aabaec59bd0..2a1149c2ecc 100644
--- a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/platform/JUnitPlatformIntegrationTest.groovy
+++ b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/platform/JUnitPlatformIntegrationTest.groovy
@@ -369,7 +369,7 @@ public class StaticInnerTest {
 
         expect:
         fails('test', *extraArgs)
-        failureCauseContains('There were failing tests.')
+        failure.assertHasCause('Test process encountered an unexpected problem.')
 
         where:
         scenario       | extraArgs
diff --git a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/vintage/JUnitVintageTestExecutionIntegrationTest.groovy b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/vintage/JUnitVintageTestExecutionIntegrationTest.groovy
index 123d6c825b7..b0906e42495 100644
--- a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/vintage/JUnitVintageTestExecutionIntegrationTest.groovy
+++ b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/junit/vintage/JUnitVintageTestExecutionIntegrationTest.groovy
@@ -16,6 +16,7 @@
 
 package org.gradle.testing.junit.vintage
 
+import org.gradle.integtests.fixtures.DefaultTestExecutionResult
 import org.gradle.integtests.fixtures.TargetCoverage
 import org.gradle.integtests.fixtures.TestClassExecutionResult
 import org.gradle.integtests.fixtures.TestExecutionResult
@@ -44,4 +45,26 @@ class JUnitVintageTestExecutionIntegrationTest extends AbstractJUnitTestExecutio
             testImplementation 'junit:junit:${LATEST_JUNIT4_VERSION}'
         """
     }
+
+    def "tries to execute unparseable test classes"() {
+        given:
+        file('build/classes/java/test/com/example/Foo.class').text = "invalid class file"
+        buildFile << """
+            apply plugin: 'java'
+            ${mavenCentralRepository()}
+            dependencies {
+                ${testFrameworkDependencies}
+            }
+            test.${configureTestFramework}
+        """
+
+        when:
+        fails('test', '-x', 'compileTestJava')
+
+        then:
+        failure.assertHasCause("Test process encountered an unexpected problem.")
+        failure.assertHasCause("Could not execute test class 'com.example.Foo'.")
+        DefaultTestExecutionResult testResult = new DefaultTestExecutionResult(testDirectory)
+        assertFailedToExecute(testResult, 'com.example.Foo').assertTestCount(1, 1, 0)
+    }
 }
diff --git a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/testng/TestNGIntegrationTest.groovy b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/testng/TestNGIntegrationTest.groovy
index b01bffa1def..4277d3d7a5d 100644
--- a/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/testng/TestNGIntegrationTest.groovy
+++ b/platforms/jvm/testing-jvm/src/integTest/groovy/org/gradle/testing/testng/TestNGIntegrationTest.groovy
@@ -302,7 +302,8 @@ class TestNGIntegrationTest extends MultiVersionIntegrationSpec {
         fails('test', '-x', 'compileTestJava')
 
         then:
-        failureCauseContains("There were failing tests")
+        failure.assertHasCause("Test process encountered an unexpected problem.")
+        failure.assertHasCause("Could not execute test class 'com.example.Foo'.")
         DefaultTestExecutionResult result = new DefaultTestExecutionResult(testDirectory)
         result.testClassStartsWith('Gradle Test Executor')
             .assertTestCount(1, 1, 0)
diff --git a/platforms/jvm/testing-jvm/src/main/java/org/gradle/api/internal/tasks/testing/detection/DefaultTestExecuter.java b/platforms/jvm/testing-jvm/src/main/java/org/gradle/api/internal/tasks/testing/detection/DefaultTestExecuter.java
index 2604c66f3e1..4a6f88b7e13 100644
--- a/platforms/jvm/testing-jvm/src/main/java/org/gradle/api/internal/tasks/testing/detection/DefaultTestExecuter.java
+++ b/platforms/jvm/testing-jvm/src/main/java/org/gradle/api/internal/tasks/testing/detection/DefaultTestExecuter.java
@@ -17,7 +17,6 @@
 package org.gradle.api.internal.tasks.testing.detection;
 
 import org.gradle.api.file.FileTree;
-import org.gradle.api.internal.DocumentationRegistry;
 import org.gradle.api.internal.classpath.ModuleRegistry;
 import org.gradle.api.internal.tasks.testing.JvmTestExecutionSpec;
 import org.gradle.api.internal.tasks.testing.TestClassProcessor;
@@ -32,8 +31,8 @@
 import org.gradle.api.internal.tasks.testing.processors.RunPreviousFailedFirstTestClassProcessor;
 import org.gradle.api.internal.tasks.testing.processors.TestMainAction;
 import org.gradle.api.internal.tasks.testing.results.TestRetryShieldingTestResultProcessor;
-import org.gradle.api.internal.tasks.testing.worker.ForkingTestClassProcessor;
 import org.gradle.api.internal.tasks.testing.worker.ForkedTestClasspath;
+import org.gradle.api.internal.tasks.testing.worker.ForkingTestClassProcessor;
 import org.gradle.api.logging.Logger;
 import org.gradle.api.logging.Logging;
 import org.gradle.internal.Factory;
@@ -58,14 +57,13 @@ public class DefaultTestExecuter implements TestExecuter<JvmTestExecutionSpec> {
     private final WorkerLeaseService workerLeaseService;
     private final int maxWorkerCount;
     private final Clock clock;
-    private final DocumentationRegistry documentationRegistry;
     private final DefaultTestFilter testFilter;
     private TestClassProcessor processor;
 
     public DefaultTestExecuter(
         WorkerProcessFactory workerFactory, ActorFactory actorFactory, ModuleRegistry moduleRegistry,
         WorkerLeaseService workerLeaseService, int maxWorkerCount,
-        Clock clock, DocumentationRegistry documentationRegistry, DefaultTestFilter testFilter
+        Clock clock, DefaultTestFilter testFilter
     ) {
         this.workerFactory = workerFactory;
         this.actorFactory = actorFactory;
@@ -73,7 +71,6 @@ public DefaultTestExecuter(
         this.workerLeaseService = workerLeaseService;
         this.maxWorkerCount = maxWorkerCount;
         this.clock = clock;
-        this.documentationRegistry = documentationRegistry;
         this.testFilter = testFilter;
     }
 
@@ -91,7 +88,7 @@ public void execute(final JvmTestExecutionSpec testExecutionSpec, TestResultProc
             @Override
             public TestClassProcessor create() {
                 return new ForkingTestClassProcessor(workerLeaseService, workerFactory, testInstanceFactory, testExecutionSpec.getJavaForkOptions(),
-                    classpath, testFramework.getWorkerConfigurationAction(), documentationRegistry);
+                    classpath, testFramework.getWorkerConfigurationAction());
             }
         };
         final Factory<TestClassProcessor> reforkingProcessorFactory = new Factory<TestClassProcessor>() {
diff --git a/platforms/jvm/testing-jvm/src/main/java/org/gradle/api/tasks/testing/Test.java b/platforms/jvm/testing-jvm/src/main/java/org/gradle/api/tasks/testing/Test.java
index 370e88ea2f6..1c965b84797 100644
--- a/platforms/jvm/testing-jvm/src/main/java/org/gradle/api/tasks/testing/Test.java
+++ b/platforms/jvm/testing-jvm/src/main/java/org/gradle/api/tasks/testing/Test.java
@@ -27,7 +27,6 @@
 import org.gradle.api.file.FileCollection;
 import org.gradle.api.file.FileTree;
 import org.gradle.api.file.FileTreeElement;
-import org.gradle.api.internal.DocumentationRegistry;
 import org.gradle.api.internal.classpath.ModuleRegistry;
 import org.gradle.api.internal.provider.PropertyFactory;
 import org.gradle.api.internal.tasks.testing.JvmTestExecutionSpec;
@@ -714,7 +713,6 @@ protected TestExecuter<JvmTestExecutionSpec> createTestExecuter() {
                 getServices().get(WorkerLeaseService.class),
                 getServices().get(StartParameter.class).getMaxWorkerCount(),
                 getServices().get(Clock.class),
-                getServices().get(DocumentationRegistry.class),
                 (DefaultTestFilter) getFilter());
         } else {
             return testExecuter;
diff --git a/platforms/jvm/testing-jvm/src/testFixtures/groovy/org/gradle/testing/fixture/TestFrameworkStartupTestFixture.groovy b/platforms/jvm/testing-jvm/src/testFixtures/groovy/org/gradle/testing/fixture/TestFrameworkStartupTestFixture.groovy
index a25af7bd29e..b2fbdf62bac 100644
--- a/platforms/jvm/testing-jvm/src/testFixtures/groovy/org/gradle/testing/fixture/TestFrameworkStartupTestFixture.groovy
+++ b/platforms/jvm/testing-jvm/src/testFixtures/groovy/org/gradle/testing/fixture/TestFrameworkStartupTestFixture.groovy
@@ -17,8 +17,9 @@
 package org.gradle.testing.fixture
 
 import groovy.transform.SelfType
-
 import org.gradle.integtests.fixtures.AbstractIntegrationSpec
+import org.gradle.util.GradleVersion
+
 import static org.gradle.util.Matchers.matchesRegexp
 
 /**
@@ -38,8 +39,11 @@ trait TestFrameworkStartupTestFixture {
         assert taskOutput =~ /afterSuite Gradle Test Run $taskName \[.*\] FAILURE/
     }
 
-    void assertTestWorkerStartedAndTestFrameworkFailedToStart(String taskName = ":test") {
-        failure.assertHasDescription("Execution failed for task '$taskName'.")
+    void assertTestWorkerStartedAndTestFrameworkFailedToStart(String taskName = ":test", int expectedWorkerFailures = 1) {
+        failure.assertHasFailure("Execution failed for task '$taskName'.") {
+            it.assertHasCauses(1 + expectedWorkerFailures)
+            it.assertHasCause("Test process encountered an unexpected problem.")
+        }
         failure.assertThatCause(matchesRegexp(/Could not start Gradle Test Executor \d+:.*/))
 
         def taskOutput = result.groupedOutput.task(taskName).output
@@ -48,7 +52,7 @@ trait TestFrameworkStartupTestFixture {
     }
 
     void assertSuggestsInspectTaskConfiguration() {
-        failure.assertHasResolution("Inspect your task configuration for errors.")
+        failure.assertHasResolution("Check common problems https://docs.gradle.org/${GradleVersion.current().version}/userguide/java_testing.html#sec:java_testing_troubleshooting.")
     }
 
     String addLoggingTestListener() {
diff --git a/platforms/jvm/toolchains-jvm-shared/build.gradle.kts b/platforms/jvm/toolchains-jvm-shared/build.gradle.kts
index c880a3956a6..6135a9b7c55 100644
--- a/platforms/jvm/toolchains-jvm-shared/build.gradle.kts
+++ b/platforms/jvm/toolchains-jvm-shared/build.gradle.kts
@@ -59,5 +59,3 @@ packageCycles {
     // which in turn references the interface.
     excludePatterns.add("org/gradle/jvm/toolchain/JavaToolchainDownload**")
 }
-
-integTest.usesJavadocCodeSnippets.set(true)
diff --git a/platforms/jvm/toolchains-jvm/build.gradle.kts b/platforms/jvm/toolchains-jvm/build.gradle.kts
index 5d6189604c1..ff0fc4a3035 100644
--- a/platforms/jvm/toolchains-jvm/build.gradle.kts
+++ b/platforms/jvm/toolchains-jvm/build.gradle.kts
@@ -73,7 +73,6 @@ packageCycles {
     excludePatterns.add("org/gradle/jvm/toolchain/**")
 }
 
-integTest.usesJavadocCodeSnippets.set(true)
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/jvm/toolchains-jvm/src/integTest/groovy/org/gradle/AutoTestedSamplesToolchainsJvmIntegrationTest.groovy b/platforms/jvm/toolchains-jvm/src/integTest/groovy/org/gradle/AutoTestedSamplesToolchainsJvmIntegrationTest.groovy
deleted file mode 100644
index a9a846788e5..00000000000
--- a/platforms/jvm/toolchains-jvm/src/integTest/groovy/org/gradle/AutoTestedSamplesToolchainsJvmIntegrationTest.groovy
+++ /dev/null
@@ -1,33 +0,0 @@
-/*
- * Copyright 2023 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-
-/**
- * Runs samples contained in class-level javadoc comments in the `toolchains-jvm` project.
- */
-class AutoTestedSamplesToolchainsJvmIntegrationTest extends AbstractAutoTestedSamplesTest {
-    @Test
-    void runSamples() {
-        // for debugging purposes you can restrict the tests samples to only a single class
-//        includeOnly '**/Test.java'
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/platforms/jvm/toolchains-jvm/src/integTest/groovy/org/gradle/samples/.gitkeepdir b/platforms/jvm/toolchains-jvm/src/integTest/groovy/org/gradle/samples/.gitkeepdir
new file mode 100644
index 00000000000..dd0e1507902
--- /dev/null
+++ b/platforms/jvm/toolchains-jvm/src/integTest/groovy/org/gradle/samples/.gitkeepdir
@@ -0,0 +1 @@
+// For GenerateAutoTestedSamplesTestTask
diff --git a/platforms/jvm/war/build.gradle.kts b/platforms/jvm/war/build.gradle.kts
index e728bef616e..c179818f45c 100644
--- a/platforms/jvm/war/build.gradle.kts
+++ b/platforms/jvm/war/build.gradle.kts
@@ -34,6 +34,7 @@ dependencies {
     implementation(projects.dependencyManagement)
     implementation(projects.fileCollections)
     implementation(projects.fileOperations)
+    implementation(projects.logging)
     implementation(projects.languageJava)
     implementation(projects.modelCore)
     implementation(projects.platformBase)
diff --git a/platforms/jvm/war/src/main/java/org/gradle/api/plugins/WarPlugin.java b/platforms/jvm/war/src/main/java/org/gradle/api/plugins/WarPlugin.java
index 42b8367701c..aed2dc6e610 100644
--- a/platforms/jvm/war/src/main/java/org/gradle/api/plugins/WarPlugin.java
+++ b/platforms/jvm/war/src/main/java/org/gradle/api/plugins/WarPlugin.java
@@ -35,6 +35,7 @@
 import org.gradle.api.plugins.jvm.internal.JvmFeatureInternal;
 import org.gradle.api.tasks.TaskProvider;
 import org.gradle.api.tasks.bundling.War;
+import org.gradle.internal.deprecation.DeprecationLogger;
 
 import javax.inject.Inject;
 import java.util.concurrent.Callable;
@@ -84,7 +85,9 @@ public void apply(final Project project) {
         });
 
         PublishArtifact warArtifact = new LazyPublishArtifact(war, ((ProjectInternal) project).getFileResolver(), ((ProjectInternal) project).getTaskDependencyFactory());
-        project.getConfigurations().getByName(Dependency.ARCHIVES_CONFIGURATION).getArtifacts().add(warArtifact);
+        DeprecationLogger.whileDisabled(() -> {
+            project.getConfigurations().getByName(Dependency.ARCHIVES_CONFIGURATION).getArtifacts().add(warArtifact);
+        });
         configureConfigurations(((ProjectInternal) project).getConfigurations(), mainFeature);
         configureComponent(project, warArtifact);
     }
diff --git a/platforms/native/language-native/build.gradle.kts b/platforms/native/language-native/build.gradle.kts
index 450674152a4..2eebe60ba0b 100644
--- a/platforms/native/language-native/build.gradle.kts
+++ b/platforms/native/language-native/build.gradle.kts
@@ -88,7 +88,6 @@ packageCycles {
     excludePatterns.add("org/gradle/language/nativeplatform/internal/**")
 }
 
-integTest.usesJavadocCodeSnippets = true
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/native/language-native/src/integTest/groovy/org/gradle/language/AutoTestedSamplesLanguageNativeIntegrationTest.groovy b/platforms/native/language-native/src/integTest/groovy/org/gradle/language/AutoTestedSamplesLanguageNativeIntegrationTest.groovy
deleted file mode 100644
index 3deb4feaf38..00000000000
--- a/platforms/native/language-native/src/integTest/groovy/org/gradle/language/AutoTestedSamplesLanguageNativeIntegrationTest.groovy
+++ /dev/null
@@ -1,33 +0,0 @@
-/*
- * Copyright 2014 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-
-
-package org.gradle.language
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesLanguageNativeIntegrationTest extends AbstractAutoTestedSamplesTest{
-
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-
-}
-
-
diff --git a/platforms/native/platform-native/build.gradle.kts b/platforms/native/platform-native/build.gradle.kts
index 906d9ae748b..143d39f73f9 100644
--- a/platforms/native/platform-native/build.gradle.kts
+++ b/platforms/native/platform-native/build.gradle.kts
@@ -88,7 +88,6 @@ packageCycles {
     excludePatterns.add("org/gradle/nativeplatform/toolchain/internal/**")
 }
 
-integTest.usesJavadocCodeSnippets = true
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/native/platform-native/src/integTest/groovy/org/gradle/nativeplatform/AutoTestedSamplesPlatformNativeIntegrationTest.groovy b/platforms/native/platform-native/src/integTest/groovy/org/gradle/nativeplatform/AutoTestedSamplesPlatformNativeIntegrationTest.groovy
deleted file mode 100644
index 57f0d0c3775..00000000000
--- a/platforms/native/platform-native/src/integTest/groovy/org/gradle/nativeplatform/AutoTestedSamplesPlatformNativeIntegrationTest.groovy
+++ /dev/null
@@ -1,31 +0,0 @@
-/*
- * Copyright 2012 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.nativeplatform
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesPlatformNativeIntegrationTest extends AbstractAutoTestedSamplesTest{
-
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-
-}
-
-
diff --git a/platforms/native/testing-native/src/integTest/groovy/org/gradle/nativeplatform/test/xctest/SwiftXCTestErrorHandlingIntegrationTest.groovy b/platforms/native/testing-native/src/integTest/groovy/org/gradle/nativeplatform/test/xctest/SwiftXCTestErrorHandlingIntegrationTest.groovy
index 34150be54c6..1cf0c16c5c4 100644
--- a/platforms/native/testing-native/src/integTest/groovy/org/gradle/nativeplatform/test/xctest/SwiftXCTestErrorHandlingIntegrationTest.groovy
+++ b/platforms/native/testing-native/src/integTest/groovy/org/gradle/nativeplatform/test/xctest/SwiftXCTestErrorHandlingIntegrationTest.groovy
@@ -55,7 +55,7 @@ class SwiftXCTestErrorHandlingIntegrationTest extends AbstractInstalledToolChain
         fails(':app:test')
 
         and:
-        failure.assertHasCause("There were failing tests.")
+        failure.assertHasCause("Test process encountered an unexpected problem.")
         def testFailure = testExecutionResult.testClass("Gradle Test Run :app:xcTest")
         testFailure.assertTestFailed(EXECUTION_FAILURE, containsText("A problem occurred starting process"))
     }
@@ -80,7 +80,7 @@ class SwiftXCTestErrorHandlingIntegrationTest extends AbstractInstalledToolChain
         fails(':app:test')
 
         and:
-        failure.assertHasCause("There were failing tests.")
+        failure.assertHasCause("Test process encountered an unexpected problem.")
         def testFailure = testExecutionResult.testClass("Gradle Test Run :app:xcTest")
         testFailure.assertTestFailed(EXECUTION_FAILURE, containsText("finished with non-zero exit value"))
         if (OperatingSystem.current().isMacOsX()) {
diff --git a/platforms/software/antlr/build.gradle.kts b/platforms/software/antlr/build.gradle.kts
index 2b822d35a03..5db9ce3f24b 100644
--- a/platforms/software/antlr/build.gradle.kts
+++ b/platforms/software/antlr/build.gradle.kts
@@ -25,6 +25,7 @@ dependencies {
 
     implementation(projects.baseServices)
     implementation(projects.languageJava)
+    implementation(projects.logging)
     implementation(projects.platformJvm)
     implementation(projects.pluginsJava)
     implementation(projects.pluginsJavaBase)
diff --git a/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/AbstractAntlrIntegrationTest.groovy b/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/AbstractAntlrIntegrationTest.groovy
index c14ac6bec75..c599ac91d81 100644
--- a/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/AbstractAntlrIntegrationTest.groovy
+++ b/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/AbstractAntlrIntegrationTest.groovy
@@ -18,7 +18,7 @@ package org.gradle.api.plugins.antlr
 
 import org.gradle.integtests.fixtures.AbstractIntegrationSpec
 
-abstract class AbstractAntlrIntegrationTest extends AbstractIntegrationSpec {
+abstract class AbstractAntlrIntegrationTest extends AbstractIntegrationSpec implements AntlrDeprecationFixture {
 
     def setup() {
         // So we can assert on which version of ANTLR is used at runtime
diff --git a/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/Antlr2PluginIntegrationTest.groovy b/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/Antlr2PluginIntegrationTest.groovy
index 40abd6446ff..041be2c0438 100644
--- a/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/Antlr2PluginIntegrationTest.groovy
+++ b/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/Antlr2PluginIntegrationTest.groovy
@@ -15,6 +15,8 @@
  */
 package org.gradle.api.plugins.antlr
 
+import org.gradle.test.fixtures.file.TestFile
+
 class Antlr2PluginIntegrationTest extends AbstractAntlrIntegrationTest {
 
     String antlrDependency = "antlr:antlr:2.7.7"
@@ -62,6 +64,46 @@ class Antlr2PluginIntegrationTest extends AbstractAntlrIntegrationTest {
         assertGrammarSourceGenerated("UnpackagedGrammar")
     }
 
+    def "exception when package is set using #description"() {
+        goodGrammar()
+
+        buildFile "grammar-builder/build.gradle", """
+            generateGrammarSource {
+                ${expression}
+            }
+        """
+        if (expectDeprecationWarning) {
+            expectPackageArgumentDeprecationWarning(executer)
+        }
+
+        expect:
+        fails("generateGrammarSource")
+        failure.assertHasCause("The -package argument is not supported by ANTLR 2.")
+
+        where:
+        description                     | expression                                    | expectDeprecationWarning
+        "arguments"                     | "arguments = ['-package', 'org.acme.test']"   | true
+        "packageName property"          | "packageName = 'org.acme.test'"               | false
+    }
+
+    def "can change output directory and source set reflects change"() {
+        goodGrammar()
+        goodProgram()
+        buildFile "grammar-builder/build.gradle", """
+            generateGrammarSource {
+                outputDirectory = file("build/generated/antlr/main")
+            }
+        """
+
+        expect:
+        succeeds("generateGrammarSource")
+        assertAntlrVersion(2)
+        assertGrammarSourceGenerated(file("grammar-builder/build/generated/antlr/main"), "org/acme/TestGrammar")
+        assertGrammarSourceGenerated(file("grammar-builder/build/generated/antlr/main"), "org/acme/AnotherGrammar")
+        assertGrammarSourceGenerated(file("grammar-builder/build/generated/antlr/main"), "UnpackagedGrammar")
+        succeeds("build")
+    }
+
     private goodGrammar() {
         file("grammar-builder/src/main/antlr/TestGrammar.g") << """
             header {
@@ -160,9 +202,13 @@ class Antlr2PluginIntegrationTest extends AbstractAntlrIntegrationTest {
     }
 
     private void assertGrammarSourceGenerated(String grammarName) {
-        assert file("grammar-builder/build/generated-src/antlr/main/${grammarName}.java").exists()
-        assert file("grammar-builder/build/generated-src/antlr/main/${grammarName}.smap").exists()
-        assert file("grammar-builder/build/generated-src/antlr/main/${grammarName}TokenTypes.java").exists()
-        assert file("grammar-builder/build/generated-src/antlr/main/${grammarName}TokenTypes.txt").exists()
+        assertGrammarSourceGenerated(file('grammar-builder/build/generated-src/antlr/main'), grammarName)
+    }
+
+    private static void assertGrammarSourceGenerated(TestFile root, String grammarName) {
+        assert root.file("${grammarName}.java").exists()
+        assert root.file("${grammarName}.smap").exists()
+        assert root.file("${grammarName}TokenTypes.java").exists()
+        assert root.file("${grammarName}TokenTypes.txt").exists()
     }
 }
diff --git a/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/Antlr3PluginIntegrationTest.groovy b/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/Antlr3PluginIntegrationTest.groovy
index 83cb8a883f3..2f3f0782d2f 100644
--- a/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/Antlr3PluginIntegrationTest.groovy
+++ b/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/Antlr3PluginIntegrationTest.groovy
@@ -15,6 +15,8 @@
  */
 package org.gradle.api.plugins.antlr
 
+import org.gradle.test.fixtures.file.TestFile
+
 class Antlr3PluginIntegrationTest extends AbstractAntlrIntegrationTest {
 
     String antlrDependency = "org.antlr:antlr:3.5.2"
@@ -58,10 +60,14 @@ class Antlr3PluginIntegrationTest extends AbstractAntlrIntegrationTest {
     }
 
     private void assertGrammarSourceGenerated(String grammarName) {
+        assertGrammarSourceGenerated(file('grammar-builder/build/generated-src/antlr/main'), grammarName)
+    }
+
+    private static void assertGrammarSourceGenerated(TestFile root, String grammarName) {
         def slashIndex = grammarName.lastIndexOf("/")
-        assert file("grammar-builder/build/generated-src/antlr/main/${slashIndex == -1 ? grammarName : grammarName.substring(slashIndex)}.tokens").exists()
-        assert file("grammar-builder/build/generated-src/antlr/main/${grammarName}Lexer.java").exists()
-        assert file("grammar-builder/build/generated-src/antlr/main/${grammarName}Parser.java").exists()
+        assert root.file("${slashIndex == -1 ? grammarName : grammarName.substring(slashIndex)}.tokens").exists()
+        assert root.file("${grammarName}Lexer.java").exists()
+        assert root.file("${grammarName}Parser.java").exists()
     }
 
     def "analyze bad grammar"() {
@@ -73,6 +79,47 @@ class Antlr3PluginIntegrationTest extends AbstractAntlrIntegrationTest {
         assertAntlrVersion(3)
     }
 
+    def "exception when package is set using #description"() {
+        goodGrammar()
+
+        buildFile "grammar-builder/build.gradle", """
+            generateGrammarSource {
+                ${expression}
+            }
+        """
+        if (expectDeprecationWarning) {
+            expectPackageArgumentDeprecationWarning(executer)
+        }
+
+        expect:
+        fails("generateGrammarSource")
+        failure.assertHasCause("The -package argument is not supported by ANTLR 3.")
+
+        where:
+        description                     | expression                                    | expectDeprecationWarning
+        "arguments"                     | "arguments = ['-package', 'org.acme.test']"   | true
+        "packageName property"          | "packageName = 'org.acme.test'"               | false
+    }
+
+    def "can change output directory and source set reflects change"() {
+        goodGrammar()
+        goodProgram()
+        buildFile "grammar-builder/build.gradle", """
+            generateGrammarSource {
+                outputDirectory = file("build/generated/antlr/main")
+            }
+        """
+
+        expect:
+        succeeds("generateGrammarSource")
+
+        assertGrammarSourceGenerated(file("grammar-builder/build/generated/antlr/main"), "AnotherGrammar")
+        assertGrammarSourceGenerated(file("grammar-builder/build/generated/antlr/main"), "org/acme/test/Test")
+        assertAntlrVersion(3)
+
+        succeeds("build")
+    }
+
     private goodGrammar() {
         file("grammar-builder/src/main/antlr/org/acme/test/Test.g") << """grammar Test;
             @header {
diff --git a/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/Antlr4PluginIntegrationTest.groovy b/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/Antlr4PluginIntegrationTest.groovy
index 96d3de72e52..28cb2382dbd 100644
--- a/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/Antlr4PluginIntegrationTest.groovy
+++ b/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/Antlr4PluginIntegrationTest.groovy
@@ -15,6 +15,8 @@
  */
 package org.gradle.api.plugins.antlr
 
+import org.gradle.test.fixtures.file.TestFile
+
 class Antlr4PluginIntegrationTest extends AbstractAntlrIntegrationTest {
 
     String antlrDependency = "org.antlr:antlr4:4.3"
@@ -69,6 +71,72 @@ class Antlr4PluginIntegrationTest extends AbstractAntlrIntegrationTest {
         assertAntlrVersion(4)
     }
 
+    def "can generate grammar source with package using #description and correctly wire source set"() {
+        goodGrammarWithoutPackage()
+
+        when:
+        buildFile "grammar-builder/build.gradle", """
+            generateGrammarSource {
+                outputDirectory = file("build/sources/antlr/main${packageDir}")
+                ${expression}
+            }
+        """
+        if (expectDeprecationWarning) {
+            expectPackageArgumentDeprecationWarning(executer)
+        }
+
+        then:
+        succeeds("generateGrammarSource")
+
+        and:
+        assertGrammarSourceGenerated(file("grammar-builder/build/sources/antlr/main"), "org/acme/Test")
+        assertGrammarSourceGenerated(file("grammar-builder/build/sources/antlr/main"), "org/acme/Another")
+        assertAntlrVersion(4)
+
+        and:
+        succeeds("build")
+
+        where:
+        description                     | expression                               | packageDir  | expectDeprecationWarning
+        "arguments"                     | "arguments += ['-package', 'org.acme']"  | "/org/acme" | true
+        "packageName property"          | "packageName = 'org.acme'"               | ""          | false
+    }
+
+    def "exception when both packageName and arguments are set"() {
+        goodGrammarWithoutPackage()
+
+        when:
+        buildFile "grammar-builder/build.gradle", """
+            generateGrammarSource {
+                packageName = 'org.acme'
+                arguments += ['-package', 'org.acme']
+            }
+        """
+        expectPackageArgumentDeprecationWarning(executer)
+
+        then:
+        fails("generateGrammarSource")
+        failure.assertHasCause("The package has been set both in the arguments (i.e. '-package') and via the 'packageName' property.  Please set the package only using the 'packageName' property.")
+    }
+
+    def "can change output directory and source set reflects change"() {
+        goodGrammar()
+        goodProgram()
+        buildFile "grammar-builder/build.gradle", """
+            generateGrammarSource {
+                outputDirectory = file("build/generated/antlr/main")
+            }
+        """
+
+        when:
+        expect:
+        succeeds("generateGrammarSource")
+        assertGrammarSourceGenerated(file("grammar-builder/build/generated/antlr/main"),"org/acme/Test")
+        assertGrammarSourceGenerated(file("grammar-builder/build/generated/antlr/main"), "Another")
+        assertAntlrVersion(4)
+        succeeds("build")
+    }
+
     void goodProgram() {
         file("grammar-user/src/main/java/Main.java") << """
 
@@ -90,12 +158,16 @@ class Antlr4PluginIntegrationTest extends AbstractAntlrIntegrationTest {
     }
 
     private void assertGrammarSourceGenerated(String grammarName) {
-        assert file("grammar-builder/build/generated-src/antlr/main/${grammarName}.tokens").exists()
-        assert file("grammar-builder/build/generated-src/antlr/main/${grammarName}BaseListener.java").exists()
-        assert file("grammar-builder/build/generated-src/antlr/main/${grammarName}Lexer.java").exists()
-        assert file("grammar-builder/build/generated-src/antlr/main/${grammarName}Lexer.tokens").exists()
-        assert file("grammar-builder/build/generated-src/antlr/main/${grammarName}Listener.java").exists()
-        assert file("grammar-builder/build/generated-src/antlr/main/${grammarName}Parser.java").exists()
+        assertGrammarSourceGenerated(file('grammar-builder/build/generated-src/antlr/main'), grammarName)
+    }
+
+    private static void assertGrammarSourceGenerated(TestFile root, String grammarName) {
+        assert root.file("${grammarName}.tokens").exists()
+        assert root.file("${grammarName}BaseListener.java").exists()
+        assert root.file("${grammarName}Lexer.java").exists()
+        assert root.file("${grammarName}Lexer.tokens").exists()
+        assert root.file("${grammarName}Listener.java").exists()
+        assert root.file("${grammarName}Parser.java").exists()
     }
 
     def "analyze bad grammar"() {
@@ -131,4 +203,17 @@ class Antlr4PluginIntegrationTest extends AbstractAntlrIntegrationTest {
             WS : [ \\t\\r\\n]+ -> skip ;
         """
     }
+
+    private goodGrammarWithoutPackage() {
+        file("grammar-builder/src/main/antlr/Test.g4") << """grammar Test;
+            r  : 'hello' ID ;
+            ID : [a-z]+ ;
+            WS : [ \\t\\r\\n]+ -> skip ;
+        """
+        file("grammar-builder/src/main/antlr/Another.g4") << """grammar Another;
+            r  : 'hello' ID ;
+            ID : [a-z]+ ;
+            WS : [ \\t\\r\\n]+ -> skip ;
+        """
+    }
 }
diff --git a/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/AntlrDeprecationFixture.groovy b/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/AntlrDeprecationFixture.groovy
new file mode 100644
index 00000000000..c6f8a723cf2
--- /dev/null
+++ b/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/AntlrDeprecationFixture.groovy
@@ -0,0 +1,30 @@
+/*
+ * Copyright 2025 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.gradle.api.plugins.antlr
+
+import org.gradle.integtests.fixtures.executer.GradleExecuter
+
+trait AntlrDeprecationFixture {
+    static GradleExecuter expectPackageArgumentDeprecationWarning(GradleExecuter executer) {
+        return executer.expectDocumentedDeprecationWarning(
+            "Setting the '-package' argument directly on AntlrTask has been deprecated." +
+                " This will fail with an error in Gradle 10." +
+                " Use the 'packageName' property of the AntlrTask to specify the package name instead of using the '-package' argument." +
+                " For more information, please refer to https://docs.gradle.org/current/dsl/org.gradle.api.plugins.antlr.AntlrTask.html#org.gradle.api.plugins.antlr.AntlrTask:packageName in the Gradle documentation."
+        )
+    }
+}
diff --git a/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/AntlrFilteringIntegrationTest.groovy b/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/AntlrFilteringIntegrationTest.groovy
new file mode 100644
index 00000000000..76371b71d52
--- /dev/null
+++ b/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/AntlrFilteringIntegrationTest.groovy
@@ -0,0 +1,94 @@
+/*
+ * Copyright 2025 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.gradle.api.plugins.antlr
+
+import org.gradle.integtests.fixtures.AbstractIntegrationSpec
+import spock.lang.Issue
+
+class AntlrFilteringIntegrationTest extends AbstractIntegrationSpec implements AntlrDeprecationFixture{
+
+    @Issue("https://github.com/gradle/gradle/issues/33180")
+    def "can filter antlr sources in a java source set when setting package using #description"() {
+        given:
+        file('src/main/antlr/Hello.g4') << """
+            grammar Hello;
+            r   : 'hello' ID;
+            ID  : [a-z]+ ;
+            WS  : [ \\t\\r\\n]+ -> skip ;
+        """.stripIndent()
+
+        buildFile """
+            plugins {
+                id 'antlr'
+                id 'java'
+            }
+
+            repositories {
+                mavenCentral()
+            }
+
+            dependencies {
+                antlr 'org.antlr:antlr4:4.13.2'
+            }
+
+            tasks.named('generateGrammarSource').configure {
+                arguments = ['-visitor', '-no-listener']
+                ${expression}
+            }
+
+            tasks.register("filteredTask", SourceTask) {
+                source = sourceSets.main.getAllJava()
+                exclude('**/com/company/Hello*')
+                doLast {
+                    println("Filtered task executed with sources:")
+                    source.files.each { file ->
+                        println(" - " + relativePath(file))
+                    }
+                }
+            }
+        """
+
+        when:
+        if (expectDeprecationWarning) {
+            expectPackageArgumentDeprecationWarning(executer)
+        }
+        succeeds(":filteredTask")
+
+        then:
+        file("build/generated-src/antlr/main/com/company/HelloParser.java").exists()
+        result.assertTaskExecuted(':generateGrammarSource')
+        result.assertTaskSkipped(':filteredTask')
+
+        where:
+        description                     | expression                             | expectDeprecationWarning
+        "arguments and outputDirectory" | setPackageWithArguments("com.company") | true
+        "packageName property"          | setPackageWithProperty("com.company")  | false
+    }
+
+    static String setPackageWithArguments(String packageName) {
+        return """
+            outputDirectory = new File(outputDirectory, '${packageName.replace('.', '/')}')
+            arguments += ['-package', '${packageName}']
+        """
+    }
+
+    static String setPackageWithProperty(String packageName) {
+        return """
+            packageName = '${packageName}'
+        """
+    }
+}
diff --git a/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/AntlrPluginIntegrationTest.groovy b/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/AntlrPluginIntegrationTest.groovy
index fce8400afbe..7ecaaf9396b 100644
--- a/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/AntlrPluginIntegrationTest.groovy
+++ b/platforms/software/antlr/src/integTest/groovy/org/gradle/api/plugins/antlr/AntlrPluginIntegrationTest.groovy
@@ -16,6 +16,8 @@
 package org.gradle.api.plugins.antlr
 
 import org.gradle.integtests.fixtures.WellBehavedPluginTest
+import org.gradle.test.fixtures.archive.JarTestFixture
+import spock.lang.Issue
 
 import static org.gradle.test.fixtures.dsl.GradleDsl.GROOVY
 import static org.gradle.test.fixtures.dsl.GradleDsl.KOTLIN
@@ -36,20 +38,7 @@ class AntlrPluginIntegrationTest extends WellBehavedPluginTest {
         """
         and:
 
-        file("src/main/antlr/org/acme/TestGrammar.g") << """ class TestGrammar extends Parser;
-        options {
-            buildAST = true;
-        }
-
-        expr:   mexpr (PLUS^ mexpr)* SEMI!
-        ;
-
-        mexpr
-        :   atom (STAR^ atom)*
-        ;
-
-        atom:   INT
-        ;"""
+        file("src/main/antlr/org/acme/TestGrammar.g") << testGrammarSource
 
         when:
         succeeds("generateGrammarSource")
@@ -103,4 +92,56 @@ class AntlrPluginIntegrationTest extends WellBehavedPluginTest {
         expect:
         succeeds 'help'
     }
+
+    @Issue('https://github.com/gradle/gradle/issues/19555')
+    def "creates proper dependency wiring between generated source set and source generation task"() {
+        given:
+        settingsFile << """
+            rootProject.name = 'antlr'
+        """
+        buildFile << """
+            apply plugin: "java"
+            apply plugin: "antlr"
+
+            ${mavenCentralRepository()}
+
+            java {
+                withSourcesJar()
+            }
+        """
+
+        and:
+        file("src/main/antlr/TestGrammar.g") << testGrammarSource
+
+        when:
+        succeeds('sourcesJar')
+
+        then:
+        executed(':generateGrammarSource')
+
+        and:
+        def jar = new JarTestFixture(file("build/libs/antlr-sources.jar"))
+        jar.assertContainsFile("TestGrammar.java")
+        jar.assertContainsFile("TestGrammar.g")
+        jar.assertContainsFile("TestGrammar.smap")
+        jar.assertContainsFile("TestGrammarTokenTypes.txt")
+        jar.assertContainsFile("TestGrammarTokenTypes.java")
+    }
+
+    private static String getTestGrammarSource() {
+        return """ class TestGrammar extends Parser;
+        options {
+            buildAST = true;
+        }
+
+        expr:   mexpr (PLUS^ mexpr)* SEMI!
+        ;
+
+        mexpr
+        :   atom (STAR^ atom)*
+        ;
+
+        atom:   INT
+        ;"""
+    }
 }
diff --git a/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/AntlrPlugin.java b/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/AntlrPlugin.java
index a6109b93cc5..471f408da34 100644
--- a/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/AntlrPlugin.java
+++ b/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/AntlrPlugin.java
@@ -19,7 +19,6 @@
 import org.gradle.api.Action;
 import org.gradle.api.Plugin;
 import org.gradle.api.Project;
-import org.gradle.api.Task;
 import org.gradle.api.artifacts.Configuration;
 import org.gradle.api.internal.project.ProjectInternal;
 import org.gradle.api.internal.tasks.DefaultSourceSet;
@@ -29,9 +28,14 @@
 import org.gradle.api.plugins.antlr.internal.DefaultAntlrSourceDirectorySet;
 import org.gradle.api.plugins.internal.JavaPluginHelper;
 import org.gradle.api.tasks.SourceSet;
+import org.gradle.api.tasks.TaskProvider;
+import org.gradle.internal.file.FilePathUtil;
 
 import javax.inject.Inject;
 import java.io.File;
+import java.util.List;
+
+import static org.gradle.api.plugins.antlr.internal.AntlrSpec.PACKAGE_ARG;
 
 /**
  * A plugin for adding Antlr support to {@link org.gradle.api.plugins.JavaPlugin java projects}.
@@ -79,32 +83,49 @@ public void execute(final SourceSet sourceSet) {
                     //    naming conventions via call to sourceSet.getTaskName()
                     final String taskName = sourceSet.getTaskName("generate", "GrammarSource");
 
-                    // 3) Set up the Antlr output directory (adding to javac inputs!)
+                    // 3) Set up the Antlr output directory
                     final String outputDirectoryName = project.getBuildDir() + "/generated-src/antlr/" + sourceSet.getName();
                     final File outputDirectory = new File(outputDirectoryName);
-                    sourceSet.getJava().srcDir(outputDirectory);
-
-                    project.getTasks().register(taskName, AntlrTask.class, new Action<AntlrTask>() {
-                        @Override
-                        public void execute(AntlrTask antlrTask) {
-                            antlrTask.setDescription("Processes the " + sourceSet.getName() + " Antlr grammars.");
-                            // 4) set up convention mapping for default sources (allows user to not have to specify)
-                            antlrTask.setSource(antlrSourceSet);
-                            antlrTask.setOutputDirectory(outputDirectory);
-                        }
-                    });
 
-                    // 5) register fact that antlr should be run before compiling
-                    project.getTasks().named(sourceSet.getCompileJavaTaskName(), new Action<Task>() {
-                        @Override
-                        public void execute(Task task) {
-                            task.dependsOn(taskName);
-                        }
+                    // 4) Register a source-generating task, and
+                    TaskProvider<AntlrTask> antlrTask = project.getTasks().register(taskName, AntlrTask.class, task -> {
+                        task.setDescription("Processes the " + sourceSet.getName() + " Antlr grammars.");
+                        // 4.1) set up convention mapping for default sources (allows user to not have to specify)
+                        task.setSource(antlrSourceSet);
+                        task.setOutputDirectory(outputDirectory);
                     });
+
+                    // 5) Add that task's outputs to the Java source set
+                    sourceSet.getJava().srcDir(antlrTask.map(task -> {
+                        String relativeOutputDirectory = project.relativePath(task.getOutputDirectory());
+                        return project.file(deriveGeneratedSourceRootDirectory(relativeOutputDirectory, task.getArguments()));
+                    }));
                 }
             });
     }
 
+    /**
+     * Derives the root source directory from the configuration of the Antlr task.
+     *
+     * If the package name has been added to the arguments, it is likely that the task output directory has also been adjusted to include the package structure.
+     * If so, we can derive the source directory by removing the relative package path from the output directory.  Otherwise, we assume the output directory is
+     * the root of the generated sources.
+     *
+     * This logic can be removed once we make it an error to set the package name via the arguments and require the use of the 'packageName' property instead.
+     */
+    private static String deriveGeneratedSourceRootDirectory(String outputDirectoryPath, List<String> arguments) {
+        // If the package argument is present, remove the package from the path if it has been added.
+        if (arguments.contains(PACKAGE_ARG)) {
+            int packageIndex = arguments.indexOf(PACKAGE_ARG);
+            if (packageIndex + 1 < arguments.size()) {
+                String packageRelativePath = arguments.get(packageIndex + 1).replace('.', '/');
+                return FilePathUtil.maybeRemoveTrailingSegments(outputDirectoryPath, packageRelativePath);
+            }
+        }
+        // Otherwise, we assume the output directory is the root of the generated sources.
+        return outputDirectoryPath;
+    }
+
     private static AntlrSourceDirectorySet createAntlrSourceDirectorySet(String parentDisplayName, ObjectFactory objectFactory) {
         String name = parentDisplayName + ".antlr";
         String displayName = parentDisplayName + " Antlr source";
diff --git a/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/AntlrTask.java b/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/AntlrTask.java
index 9d324189e11..e34723c96ed 100644
--- a/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/AntlrTask.java
+++ b/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/AntlrTask.java
@@ -16,6 +16,7 @@
 
 package org.gradle.api.plugins.antlr;
 
+import org.gradle.api.Incubating;
 import org.gradle.api.file.ConfigurableFileCollection;
 import org.gradle.api.file.FileCollection;
 import org.gradle.api.file.FileTree;
@@ -27,12 +28,14 @@
 import org.gradle.api.plugins.antlr.internal.AntlrSourceGenerationException;
 import org.gradle.api.plugins.antlr.internal.AntlrSpec;
 import org.gradle.api.plugins.antlr.internal.AntlrSpecFactory;
+import org.gradle.api.provider.Property;
 import org.gradle.api.tasks.CacheableTask;
 import org.gradle.api.tasks.Classpath;
 import org.gradle.api.tasks.IgnoreEmptyDirectories;
 import org.gradle.api.tasks.Input;
 import org.gradle.api.tasks.InputFiles;
 import org.gradle.api.tasks.Internal;
+import org.gradle.api.tasks.Optional;
 import org.gradle.api.tasks.OutputDirectory;
 import org.gradle.api.tasks.PathSensitive;
 import org.gradle.api.tasks.PathSensitivity;
@@ -66,7 +69,6 @@
 @NullMarked
 @CacheableTask
 public abstract class AntlrTask extends SourceTask {
-
     private boolean trace;
     private boolean traceLexer;
     private boolean traceParser;
@@ -349,4 +351,18 @@ protected FileCollection getStableSources() {
 
     @Inject
     protected abstract Deleter getDeleter();
+
+    /**
+     * Sets the package to be used when generating the parser source files.  Supported only when using Antlr 4.
+     *
+     * This will add a "-package" argument to the ANTLR command line as well as adjust the target directory to generate sources into a package-specific subdirectory of {@link #getOutputDirectory()}.
+     *
+     * For example, if the package name is set to "com.foo.bar" and the output directory is set to "path/to/output", the sources will be generated into "path/to/output/com/foo/bar".
+     *
+     * @since 9.1.0
+     */
+    @Input
+    @Optional
+    @Incubating
+    abstract public Property<String> getPackageName();
 }
diff --git a/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/internal/AntlrExecuter.java b/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/internal/AntlrExecuter.java
index a9850d24a0f..2ba3a7c389b 100644
--- a/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/internal/AntlrExecuter.java
+++ b/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/internal/AntlrExecuter.java
@@ -37,6 +37,8 @@
 import java.lang.reflect.InvocationTargetException;
 import java.util.List;
 
+import static org.gradle.api.plugins.antlr.internal.AntlrSpec.PACKAGE_ARG;
+
 public class AntlrExecuter implements RequestHandler<AntlrSpec, AntlrResult> {
 
     private static final Logger LOGGER = LoggerFactory.getLogger(AntlrExecuter.class);
@@ -63,9 +65,16 @@ public AntlrResult run(AntlrSpec spec) {
         throw new IllegalStateException("No Antlr implementation available");
     }
 
+    private static void errorIfPackageArgumentSet(List<String> arguments, String antlrVersion) {
+        if (arguments.contains(PACKAGE_ARG)) {
+            throw new IllegalArgumentException("The " + PACKAGE_ARG + " argument is not supported by ANTLR " + antlrVersion + ".");
+        }
+    }
+
     private static class Antlr3Tool extends AntlrTool {
         @Override
         int invoke(List<String> arguments, File inputDirectory) throws ClassNotFoundException {
+            errorIfPackageArgumentSet(arguments, "3");
             final Object backedObject = loadTool("org.antlr.Tool", null);
             String[] argArray = arguments.toArray(new String[0]);
             if (inputDirectory != null) {
@@ -219,6 +228,7 @@ public AntlrResult doProcess(AntlrSpec spec) throws ClassNotFoundException {
          * */
         @Override
         int invoke(List<String> arguments, File inputDirectory) throws ClassNotFoundException {
+            errorIfPackageArgumentSet(arguments, "2");
             final Object backedAntlrTool = loadTool("antlr.Tool", null);
             JavaMethod.of(backedAntlrTool, Integer.class, "doEverything", String[].class).invoke(backedAntlrTool, new Object[]{toArray(arguments)});
             return 0;
diff --git a/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/internal/AntlrSpec.java b/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/internal/AntlrSpec.java
index c471de33718..e16ca89c3cb 100644
--- a/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/internal/AntlrSpec.java
+++ b/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/internal/AntlrSpec.java
@@ -24,6 +24,7 @@
 import java.util.Set;
 
 public class AntlrSpec implements Serializable {
+    public final static String PACKAGE_ARG = "-package";
 
     private List<String> arguments;
     private Set<File> inputDirectories;
diff --git a/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/internal/AntlrSpecFactory.java b/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/internal/AntlrSpecFactory.java
index 722c67e6618..ab8e7e35193 100644
--- a/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/internal/AntlrSpecFactory.java
+++ b/platforms/software/antlr/src/main/java/org/gradle/api/plugins/antlr/internal/AntlrSpecFactory.java
@@ -19,15 +19,19 @@
 import com.google.common.collect.Lists;
 import org.gradle.api.file.FileCollection;
 import org.gradle.api.plugins.antlr.AntlrTask;
+import org.gradle.internal.deprecation.DeprecationLogger;
 
 import java.io.File;
 import java.util.Collections;
 import java.util.List;
 import java.util.Set;
 
+import static org.gradle.api.plugins.antlr.internal.AntlrSpec.PACKAGE_ARG;
+
 public class AntlrSpecFactory {
 
     public AntlrSpec create(AntlrTask antlrTask, Set<File> grammarFiles, FileCollection sourceSetDirectories) {
+        File outputDirectory = antlrTask.getOutputDirectory();
         List<String> arguments = Lists.newLinkedList(antlrTask.getArguments());
 
         if (antlrTask.isTrace() && !arguments.contains("-trace")) {
@@ -42,6 +46,22 @@ public AntlrSpec create(AntlrTask antlrTask, Set<File> grammarFiles, FileCollect
         if (antlrTask.isTraceTreeWalker() && !arguments.contains("-traceTreeWalker")) {
             arguments.add("-traceTreeWalker");
         }
+        if (antlrTask.getArguments().contains(PACKAGE_ARG)) {
+            DeprecationLogger.deprecateAction("Setting the '" + PACKAGE_ARG + "' argument directly on AntlrTask")
+                .withAdvice("Use the 'packageName' property of the AntlrTask to specify the package name instead of using the '" + PACKAGE_ARG + "' argument.")
+                .willBecomeAnErrorInGradle10()
+                .withDslReference(AntlrTask.class, "packageName")
+                .nagUser();
+        }
+        if (antlrTask.getPackageName().isPresent()) {
+            if (!arguments.contains(PACKAGE_ARG)) {
+                arguments.add(PACKAGE_ARG);
+                arguments.add(antlrTask.getPackageName().get());
+                outputDirectory = new File(outputDirectory, antlrTask.getPackageName().get().replace('.', '/'));
+            } else {
+                throw new IllegalStateException("The package has been set both in the arguments (i.e. '" + PACKAGE_ARG + "') and via the 'packageName' property.  Please set the package only using the 'packageName' property.");
+            }
+        }
         Set<File> sourceSetDirectoriesFiles;
         if (sourceSetDirectories == null) {
             sourceSetDirectoriesFiles = Collections.emptySet();
@@ -49,6 +69,6 @@ public AntlrSpec create(AntlrTask antlrTask, Set<File> grammarFiles, FileCollect
             sourceSetDirectoriesFiles = sourceSetDirectories.getFiles();
         }
 
-        return new AntlrSpec(arguments, grammarFiles, sourceSetDirectoriesFiles, antlrTask.getOutputDirectory(), antlrTask.getMaxHeapSize());
+        return new AntlrSpec(arguments, grammarFiles, sourceSetDirectoriesFiles, outputDirectory, antlrTask.getMaxHeapSize());
     }
 }
diff --git a/platforms/software/antlr/src/test/groovy/org/gradle/api/plugins/antlr/AntlrPluginTest.groovy b/platforms/software/antlr/src/test/groovy/org/gradle/api/plugins/antlr/AntlrPluginTest.groovy
index fcd00ae9081..bf919aece43 100644
--- a/platforms/software/antlr/src/test/groovy/org/gradle/api/plugins/antlr/AntlrPluginTest.groovy
+++ b/platforms/software/antlr/src/test/groovy/org/gradle/api/plugins/antlr/AntlrPluginTest.groovy
@@ -18,6 +18,7 @@ package org.gradle.api.plugins.antlr
 
 import org.gradle.api.Action
 import org.gradle.test.fixtures.AbstractProjectBuilderSpec
+import spock.lang.Issue
 
 import static org.gradle.api.reflect.TypeOf.typeOf
 
@@ -93,4 +94,20 @@ class AntlrPluginTest extends AbstractProjectBuilderSpec {
         def main = project.sourceSets.main
         main.extensions.extensionsSchema.find { it.name == 'antlr' }.publicType == typeOf(AntlrSourceDirectorySet)
     }
+
+    @Issue('https://github.com/gradle/gradle/issues/19555')
+    def 'adds task dependency to sourcesJar'() {
+        when:
+        project.pluginManager.apply(AntlrPlugin)
+
+        and:
+        project.java {
+            withSourcesJar()
+        }
+
+        then:
+        def generateGrammarSource = project.tasks.generateGrammarSource
+        def sourcesJar = project.tasks.sourcesJar
+        sourcesJar.taskDependencies.getDependencies(null).contains(generateGrammarSource)
+    }
 }
diff --git a/platforms/software/antlr/src/test/groovy/org/gradle/api/plugins/antlr/internal/AntlrSpecFactoryTest.groovy b/platforms/software/antlr/src/test/groovy/org/gradle/api/plugins/antlr/internal/AntlrSpecFactoryTest.groovy
index 19df7c70e0a..f79015218fb 100644
--- a/platforms/software/antlr/src/test/groovy/org/gradle/api/plugins/antlr/internal/AntlrSpecFactoryTest.groovy
+++ b/platforms/software/antlr/src/test/groovy/org/gradle/api/plugins/antlr/internal/AntlrSpecFactoryTest.groovy
@@ -18,6 +18,7 @@ package org.gradle.api.plugins.antlr.internal
 
 import org.gradle.api.file.FileCollection
 import org.gradle.api.plugins.antlr.AntlrTask
+import org.gradle.util.TestUtil
 import spock.lang.Specification
 
 class AntlrSpecFactoryTest extends Specification {
@@ -36,6 +37,7 @@ class AntlrSpecFactoryTest extends Specification {
         _ * task.isTraceLexer() >> true
         _ * task.isTraceParser() >> true
         _ * task.isTraceTreeWalker() >> true
+        _ * task.getPackageName() >> TestUtil.objectFactory().property(String)
 
         def spec = factory.create(task, [] as Set, sourceSetDirectories)
 
@@ -56,6 +58,7 @@ class AntlrSpecFactoryTest extends Specification {
         _ * task.isTraceLexer() >> true
         _ * task.isTraceParser() >> true
         _ * task.isTraceTreeWalker() >> true
+        _ * task.getPackageName() >> TestUtil.objectFactory().property(String)
 
         def spec = factory.create(task, [] as Set, null)
 
@@ -69,6 +72,7 @@ class AntlrSpecFactoryTest extends Specification {
         AntlrTask task = Mock()
         _ * task.outputDirectory >> destFile()
         _ * task.getArguments() >> ["-trace", "-traceLexer", "-traceParser", "-traceTreeWalker"]
+        _ * task.getPackageName() >> TestUtil.objectFactory().property(String)
 
         def spec = factory.create(task, [] as Set, sourceSetDirectories)
 
@@ -89,6 +93,7 @@ class AntlrSpecFactoryTest extends Specification {
         _ * task.isTraceLexer() >> true
         _ * task.isTraceParser() >> true
         _ * task.isTraceTreeWalker() >> true
+        _ * task.getPackageName() >> TestUtil.objectFactory().property(String)
 
         def spec = factory.create(task, [] as Set, sourceSetDirectories)
 
@@ -99,13 +104,43 @@ class AntlrSpecFactoryTest extends Specification {
         spec.arguments.count { it == "-traceTreeWalker" } == 1
     }
 
+    def "package argument added when packageName is set"() {
+        when:
+        sourceSetDirectoriesAreEmptySet()
+        AntlrTask task = Mock()
+        _ * task.outputDirectory >> new File("/path/to/output")
+        _ * task.getArguments() >> []
+        _ * task.getPackageName() >> TestUtil.objectFactory().property(String).value("com.example")
+
+        def spec = factory.create(task, [] as Set, sourceSetDirectories)
+
+        then:
+        spec.arguments.contains("-package")
+        spec.arguments.contains("com.example")
+        spec.outputDirectory == new File("/path/to/output/com/example")
+    }
+
+    def "cannot add package argument when packageName is set"() {
+        when:
+        AntlrTask task = Mock()
+        _ * task.outputDirectory >> new File("/path/to/output")
+        _ * task.getArguments() >> ["-package", "foo.bar"]
+        _ * task.getPackageName() >> TestUtil.objectFactory().property(String).value("com.example")
+
+        def spec = factory.create(task, [] as Set, sourceSetDirectories)
+
+        then:
+        def e = thrown(IllegalStateException)
+        e.message == "The package has been set both in the arguments (i.e. '-package') and via the 'packageName' property.  Please set the package only using the 'packageName' property."
+    }
+
+
+
     private void sourceSetDirectoriesAreEmptySet() {
         1 * sourceSetDirectories.getFiles() >> []
     }
 
     def destFile() {
-        File dest = Mock()
-        dest.getAbsolutePath() >> "/output"
-        dest
+        new File("/output")
     }
 }
diff --git a/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/ModuleDependencyExcludeResolveIntegrationTest.groovy b/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/ModuleDependencyExcludeResolveIntegrationTest.groovy
index ea789c60242..cf219ee24c7 100644
--- a/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/ModuleDependencyExcludeResolveIntegrationTest.groovy
+++ b/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/ModuleDependencyExcludeResolveIntegrationTest.groovy
@@ -31,10 +31,6 @@ import static org.gradle.integtests.resolve.versions.AbstractVersionRangeResolve
 class ModuleDependencyExcludeResolveIntegrationTest extends AbstractModuleDependencyResolveTest {
     def setup() {
         buildFile << """
-dependencies {
-    conf 'a:a:1.0'
-}
-
 task check(type: Sync) {
     from configurations.conf
     into 'libs'
@@ -74,6 +70,12 @@ task check(type: Sync) {
             'c:c:1.0' { expectResolve() }
         }
 
+        buildFile << """
+            dependencies {
+                conf("a:a:1.0")
+            }
+        """
+
         when:
         succeeds "checkDep"
 
@@ -132,6 +134,12 @@ task check(type: Sync) {
             }
         }
 
+        buildFile << """
+            dependencies {
+                conf("a:a:1.0")
+            }
+        """
+
         when:
         succeedsDependencyResolution()
 
@@ -179,6 +187,12 @@ task check(type: Sync) {
             'b:b:1.0' { expectResolve() }
         }
 
+        buildFile << """
+            dependencies {
+                conf("a:a:1.0")
+            }
+        """
+
         when:
         succeeds "checkDep"
 
@@ -220,6 +234,12 @@ task check(type: Sync) {
             }
         }
 
+        buildFile << """
+            dependencies {
+                conf("a:a:1.0")
+            }
+        """
+
         when:
         succeedsDependencyResolution()
 
@@ -264,6 +284,11 @@ task check(type: Sync) {
             'b:b:1.0' { expectResolve() }
         }
 
+        buildFile << """
+            dependencies {
+                conf("a:a:1.0")
+            }
+        """
 
         when:
         succeeds "checkDep"
@@ -307,6 +332,12 @@ task check(type: Sync) {
             }
         }
 
+        buildFile << """
+            dependencies {
+                conf("a:a:1.0")
+            }
+        """
+
         when:
         succeedsDependencyResolution()
 
@@ -347,6 +378,12 @@ task check(type: Sync) {
             }
         }
 
+        buildFile << """
+            dependencies {
+                conf("a:a:1.0")
+            }
+        """
+
         when:
         succeedsDependencyResolution()
 
@@ -378,6 +415,12 @@ task check(type: Sync) {
             'b:b:1.0' { expectResolve() }
         }
 
+        buildFile << """
+            dependencies {
+                conf("a:a:1.0")
+            }
+        """
+
         and: // Initial request to cache metadata
         succeeds "checkDeps"
 
@@ -426,6 +469,12 @@ task check(type: Sync) {
             'd:d:1.0' { expectResolve() }
         }
 
+        buildFile << """
+            dependencies {
+                conf("a:a:1.0")
+            }
+        """
+
         when:
         succeeds "checkDep"
 
@@ -498,16 +547,13 @@ task check(type: Sync) {
         }
 
         buildFile << """
-            configurations {
-                conf.dependencies.clear()
-            }
-
             dependencies {
                 conf(platform('org.test:platform:1.0'))
                 conf 'org.test:depD:1.0'
                 conf 'org.test:depF:1.0'
             }
-"""
+        """
+
         when:
         succeeds 'checkDeps'
 
@@ -554,26 +600,30 @@ task check(type: Sync) {
      *
      * Exclude is applied to configuration conf
      */
-    def "ensure renamed dependencies are exclude correctly"() {
+    def "ensure renamed dependencies are excluded correctly"() {
         given:
         buildFile << """
-configurations {
-    conf {
-        exclude group: 'b', module: 'b'
-        resolutionStrategy {
-            dependencySubstitution {
-                all {
-                    if (it.requested instanceof ModuleComponentSelector) {
-                        if (it.requested.group == 'c' && it.requested.module == 'c') {
-                            it.useTarget group: 'b', name: 'b', version: '1.0'
+            dependencies {
+                conf("a:a:1.0")
+            }
+
+            configurations {
+                conf {
+                    exclude group: 'b', module: 'b'
+                    resolutionStrategy {
+                        dependencySubstitution {
+                            all {
+                                if (it.requested instanceof ModuleComponentSelector) {
+                                    if (it.requested.group == 'c' && it.requested.module == 'c') {
+                                        it.useTarget group: 'b', name: 'b', version: '1.0'
+                                    }
+                                }
+                            }
                         }
                     }
                 }
             }
-        }
-    }
-}
-"""
+        """
 
         def expectResolved = ['a', 'f', 'g']
         repository {
@@ -608,4 +658,68 @@ configurations {
         def resolvedJars = expectResolved.collect { it + '-1.0.jar' }
         assertResolvedFiles(resolvedJars)
     }
+
+    @Issue("https://github.com/gradle/gradle/issues/33924")
+    def "node reentering the queue with a new incoming edge with fewer exclusions than all previous incoming edges properly propagates new transitive excludes"() {
+        repository {
+            id("org.hamcrest:hamcrest-junit:2.0.0.0")
+            id("org:ut:2.0.0-BETA-4-JAVA7") {
+                dependsOn("org.hamcrest:hamcrest-junit:2.0.0.0")
+            }
+            id("org.slf4j:slf4j-api:1.7.36")
+            id("org:engine:1.4.1") {
+                dependsOn("org.slf4j:slf4j-api:1.7.36")
+                dependsOn("org:ut:2.0.0-BETA-4-JAVA7")
+            }
+            id("data:tools:27.9.67") {
+                dependsOn("org:engine:1.4.1")
+            }
+        }
+
+        repositoryInteractions {
+            id("org.hamcrest:hamcrest-junit:2.0.0.0") {
+                expectResolve()
+            }
+            id("org:ut:2.0.0-BETA-4-JAVA7") {
+                expectResolve()
+            }
+            id("org:engine:1.4.1") {
+                expectResolve()
+            }
+            id("org.slf4j:slf4j-api:1.7.36") {
+                expectResolve()
+            }
+            id("data:tools:27.9.67") {
+                expectResolve()
+            }
+        }
+
+        buildFile << """
+            dependencies {
+                conf("org:engine:1.4.1") {
+                    exclude(group: "org.slf4j", module: "*")
+                    exclude(group: "org.hamcrest", module: "*")
+                }
+                conf("data:tools:27.9.67")
+            }
+        """
+
+        when:
+        succeeds(":checkDeps")
+
+        then:
+        resolve.expectGraph {
+            root(":", ":test:") {
+                module("org:engine:1.4.1") {
+                    module("org.slf4j:slf4j-api:1.7.36")
+                    module("org:ut:2.0.0-BETA-4-JAVA7") {
+                        module("org.hamcrest:hamcrest-junit:2.0.0.0")
+                    }
+                }
+                module("data:tools:27.9.67") {
+                    module("org:engine:1.4.1")
+                }
+            }
+        }
+    }
 }
diff --git a/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/PluginVariantResolveIntegrationTest.groovy b/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/PluginVariantResolveIntegrationTest.groovy
index 5d2645bb183..1c8c7508df7 100644
--- a/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/PluginVariantResolveIntegrationTest.groovy
+++ b/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/PluginVariantResolveIntegrationTest.groovy
@@ -17,6 +17,7 @@
 package org.gradle.integtests.resolve
 
 import org.gradle.api.JavaVersion
+import org.gradle.api.artifacts.Dependency
 import org.gradle.integtests.fixtures.AbstractIntegrationSpec
 import spock.lang.Issue
 
@@ -149,7 +150,7 @@ class PluginVariantResolveIntegrationTest extends AbstractIntegrationSpec {
             }
 
             configurations.all {
-                if (it.canBeConsumed && it.name != 'sourcesElements' ) {
+                if (it.canBeConsumed && it.name != 'sourcesElements' && it.name != '${Dependency.ARCHIVES_CONFIGURATION}') {
                     // let's pretend it was built with a newer Java version
                     attributes {
                         // This test is not Artic Code Vault safe
diff --git a/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/api/ConfigurationRoleUsageIntegrationTest.groovy b/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/api/ConfigurationRoleUsageIntegrationTest.groovy
index 3ddedd6b2a6..09a9538b880 100644
--- a/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/api/ConfigurationRoleUsageIntegrationTest.groovy
+++ b/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/api/ConfigurationRoleUsageIntegrationTest.groovy
@@ -456,6 +456,9 @@ class ConfigurationRoleUsageIntegrationTest extends AbstractIntegrationSpec impl
         """
 
         when: "the build fails"
+        // archives is now deprecated for all usages, so the error contains the word "deprecated", so we disable deprecation checks to avoid
+        // a post-execution error that a deprecation warning may appear in the output
+        executer.noDeprecationChecks()
         fails 'help'
 
         then:
@@ -487,6 +490,9 @@ class ConfigurationRoleUsageIntegrationTest extends AbstractIntegrationSpec impl
         """
 
         when: "the build fails because the configuration is not allowed to change"
+        // archives is now deprecated for all usages, so the error contains the word "deprecated", so we disable deprecation checks to avoid
+        // a post-execution error that a deprecation warning may appear in the output
+        executer.noDeprecationChecks()
         fails 'help'
 
         then:
diff --git a/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/attributes/ComponentAttributesDynamicVersionIntegrationTest.groovy b/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/attributes/ComponentAttributesDynamicVersionIntegrationTest.groovy
index 756e4de8a00..4777349727d 100644
--- a/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/attributes/ComponentAttributesDynamicVersionIntegrationTest.groovy
+++ b/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/attributes/ComponentAttributesDynamicVersionIntegrationTest.groovy
@@ -317,6 +317,63 @@ Versions rejected by attribute matching:
       - Attribute 'shape' didn't match. Requested 'circle', was: 'square'""")
     }
 
+    def "attributes on constraints are used to select the version"() {
+        given:
+        repository {
+            'org:test:1.0' {
+                attribute('quality', 'qa')
+            }
+            'org:test:1.1' {
+                attribute('quality', 'rc')
+            }
+        }
+        buildFile << """
+            def quality = Attribute.of("quality", String)
+
+            dependencies {
+                attributesSchema {
+                    attribute(quality)
+                }
+
+                conf('org:test:[1.0,)')
+
+                constraints {
+                    conf('org:test') {
+                        attributes {
+                            attribute(quality, 'qa')
+                        }
+                    }
+                }
+            }
+        """
+
+        when:
+        repositoryInteractions {
+            'org:test' {
+                expectVersionListing()
+                '1.0' {
+                    expectResolve()
+                }
+                '1.1' {
+                    expectGetMetadata()
+                }
+            }
+        }
+
+        then:
+        run ':checkDeps'
+        resolve.expectGraph {
+            root(":", ":test:") {
+                edge('org:test:[1.0,)', 'org:test:1.0') {
+                    byReason("rejection: version 1.1:   - Attribute 'quality' didn't match. Requested 'qa', was: 'rc'")
+                }
+                constraint("org:test", "org:test:1.0") {
+                    byConstraint()
+                }
+            }
+        }
+    }
+
     static Closure<String> latestNotation() {
         { -> GradleMetadataResolveRunner.useIvy() ? "latest.integration" : "latest.release" }
     }
diff --git a/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/transform/TransformLoggingIntegrationTest.groovy b/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/transform/TransformLoggingIntegrationTest.groovy
index 304d4182a6c..aa66098216d 100644
--- a/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/transform/TransformLoggingIntegrationTest.groovy
+++ b/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/transform/TransformLoggingIntegrationTest.groovy
@@ -26,7 +26,7 @@ import static org.gradle.test.fixtures.ConcurrentTestUtil.poll
 class TransformLoggingIntegrationTest extends AbstractConsoleGroupedTaskFunctionalTest {
     ConsoleOutput consoleType
 
-    private static final List<ConsoleOutput> TESTED_CONSOLE_TYPES = [ConsoleOutput.Plain, ConsoleOutput.Verbose, ConsoleOutput.Rich, ConsoleOutput.Auto]
+    private static final List<ConsoleOutput> TESTED_CONSOLE_TYPES = [ConsoleOutput.Plain, ConsoleOutput.Colored, ConsoleOutput.Verbose, ConsoleOutput.Rich, ConsoleOutput.Auto]
 
     def setup() {
         createDirs("lib", "util", "app")
diff --git a/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/versions/VersionConflictResolutionIntegrationTest.groovy b/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/versions/VersionConflictResolutionIntegrationTest.groovy
index ae9b5252af6..40504caee9c 100644
--- a/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/versions/VersionConflictResolutionIntegrationTest.groovy
+++ b/platforms/software/dependency-management/src/integTest/groovy/org/gradle/integtests/resolve/versions/VersionConflictResolutionIntegrationTest.groovy
@@ -2533,9 +2533,7 @@ parentFirst
         resolve.expectGraph {
             root(":", ":test:") {
                 module("com.netflix.eureka:eureka-client:2.0.1") {
-                    module("com.netflix.netflix-commons:netflix-eventbus:0.3.0") {
-                        module("com.netflix.archaius:archaius-core:0.3.3")
-                    }
+                    module("com.netflix.netflix-commons:netflix-eventbus:0.3.0")
                 }
                 project(":indirect", "test:indirect:1.0") {
                     module("org.springframework.cloud:spring-cloud-netflix-dependencies:4.1.0") {
diff --git a/platforms/software/dependency-management/src/integTest/groovy/org/gradle/plugin/devel/variants/TargetJVMVersionOnPluginTooNewFailureDescriberIntegrationTest.groovy b/platforms/software/dependency-management/src/integTest/groovy/org/gradle/plugin/devel/variants/TargetJVMVersionOnPluginTooNewFailureDescriberIntegrationTest.groovy
index 9fc3b8a8a58..e1b30a73f4f 100644
--- a/platforms/software/dependency-management/src/integTest/groovy/org/gradle/plugin/devel/variants/TargetJVMVersionOnPluginTooNewFailureDescriberIntegrationTest.groovy
+++ b/platforms/software/dependency-management/src/integTest/groovy/org/gradle/plugin/devel/variants/TargetJVMVersionOnPluginTooNewFailureDescriberIntegrationTest.groovy
@@ -17,6 +17,7 @@
 package org.gradle.plugin.devel.variants
 
 import org.gradle.api.JavaVersion
+import org.gradle.api.artifacts.Dependency
 import org.gradle.integtests.fixtures.AbstractIntegrationSpec
 import org.gradle.integtests.fixtures.AvailableJavaHomes
 import org.gradle.integtests.fixtures.jvm.JavaToolchainFixture
@@ -134,7 +135,7 @@ class TargetJVMVersionOnPluginTooNewFailureDescriberIntegrationTest extends Abst
             version = "1.0"
 
             configurations.configureEach {
-                if (canBeConsumed)  {
+                if (canBeConsumed && name != '${Dependency.ARCHIVES_CONFIGURATION}')  {
                     attributes {
                         attribute(TargetJvmVersion.TARGET_JVM_VERSION_ATTRIBUTE, $tooHighJava)
                     }
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/component/ComponentSelectorInternal.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/component/ComponentSelectorInternal.java
new file mode 100644
index 00000000000..b06a52c134f
--- /dev/null
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/component/ComponentSelectorInternal.java
@@ -0,0 +1,34 @@
+/*
+ * Copyright 2025 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.gradle.api.internal.artifacts.component;
+
+import com.google.common.collect.ImmutableSet;
+import org.gradle.api.artifacts.capability.CapabilitySelector;
+import org.gradle.api.artifacts.component.ComponentSelector;
+import org.gradle.api.internal.attributes.ImmutableAttributes;
+
+/**
+ * Internal counterpart to {@link ComponentSelector}
+ */
+public interface ComponentSelectorInternal extends ComponentSelector {
+
+    @Override
+    ImmutableAttributes getAttributes();
+
+    @Override
+    ImmutableSet<CapabilitySelector> getCapabilitySelectors();
+
+}
diff --git a/platforms/software/ivy/src/integTest/groovy/org/gradle/api/AutoTestedSamplesIvyIntegrationTest.groovy b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/component/package-info.java
similarity index 63%
rename from platforms/software/ivy/src/integTest/groovy/org/gradle/api/AutoTestedSamplesIvyIntegrationTest.groovy
rename to platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/component/package-info.java
index 5de0dfc49e3..3b9fc276ef1 100644
--- a/platforms/software/ivy/src/integTest/groovy/org/gradle/api/AutoTestedSamplesIvyIntegrationTest.groovy
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/component/package-info.java
@@ -1,5 +1,5 @@
 /*
- * Copyright 2012 the original author or authors.
+ * Copyright 2025 the original author or authors.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -14,16 +14,8 @@
  * limitations under the License.
  */
 
-package org.gradle.api
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesIvyIntegrationTest extends AbstractAutoTestedSamplesTest {
-
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-
-}
+/**
+ * Internal types related to components.
+ */
+@org.jspecify.annotations.NullMarked
+package org.gradle.api.internal.artifacts.component;
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ResolutionExecutor.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ResolutionExecutor.java
index 9e3dd35b6f6..188774ce48b 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ResolutionExecutor.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ResolutionExecutor.java
@@ -461,16 +461,15 @@ private ComponentResolvers getResolvers(
         }
         resolvers.add(projectDependencyResolver);
 
+        // TODO: We should reuse these resolvers for all resolutions instead of creating
+        // a new one each time we resolve a graph. This means we should not pass any
+        // state to `createResolvers` that is specific to this resolution.
         resolvers.add(externalResolverFactory.createResolvers(
             repositories,
             componentMetadataProcessorFactory,
             legacyParams.getComponentSelectionRules(),
             params.isDependencyVerificationEnabled(),
             params.getCacheExpirationControl(),
-            // We should not need to know _what_ we're resolving in order to construct a resolver for a set of repositories.
-            // The request attributes and schema are used to support filtering components by attributes when using dynamic versions.
-            // We should consider just removing that feature and making dynamic version selection dumber.
-            params.getRootVariant().getAttributes(),
             params.getRootComponent().getMetadata().getAttributesSchema()
         ));
 
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/dependencysubstitution/UnversionedModuleComponentSelector.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/dependencysubstitution/UnversionedModuleComponentSelector.java
index bb8650aeaf6..336e3c44971 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/dependencysubstitution/UnversionedModuleComponentSelector.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/dependencysubstitution/UnversionedModuleComponentSelector.java
@@ -17,19 +17,19 @@
 package org.gradle.api.internal.artifacts.ivyservice.dependencysubstitution;
 
 import com.google.common.base.Objects;
+import com.google.common.collect.ImmutableSet;
 import org.gradle.api.artifacts.ModuleIdentifier;
 import org.gradle.api.artifacts.capability.CapabilitySelector;
 import org.gradle.api.artifacts.component.ComponentIdentifier;
-import org.gradle.api.artifacts.component.ComponentSelector;
-import org.gradle.api.attributes.AttributeContainer;
 import org.gradle.api.capabilities.Capability;
+import org.gradle.api.internal.artifacts.component.ComponentSelectorInternal;
 import org.gradle.api.internal.attributes.ImmutableAttributes;
 
 import java.util.Collections;
 import java.util.List;
-import java.util.Set;
 
-class UnversionedModuleComponentSelector implements ComponentSelector {
+class UnversionedModuleComponentSelector implements ComponentSelectorInternal {
+
     private final ModuleIdentifier moduleIdentifier;
 
     UnversionedModuleComponentSelector(ModuleIdentifier id) {
@@ -51,7 +51,7 @@ public boolean matchesStrictly(ComponentIdentifier identifier) {
     }
 
     @Override
-    public AttributeContainer getAttributes() {
+    public ImmutableAttributes getAttributes() {
         return ImmutableAttributes.EMPTY;
     }
 
@@ -61,8 +61,8 @@ public List<Capability> getRequestedCapabilities() {
     }
 
     @Override
-    public Set<CapabilitySelector> getCapabilitySelectors() {
-        return Collections.emptySet();
+    public ImmutableSet<CapabilitySelector> getCapabilitySelectors() {
+        return ImmutableSet.of();
     }
 
     @Override
@@ -81,4 +81,5 @@ public boolean equals(Object o) {
     public int hashCode() {
         return Objects.hashCode(moduleIdentifier);
     }
+
 }
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/DynamicVersionResolver.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/DynamicVersionResolver.java
index f508eb63db9..72110c2547a 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/DynamicVersionResolver.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/DynamicVersionResolver.java
@@ -20,7 +20,6 @@
 import org.gradle.api.artifacts.ComponentMetadataSupplierDetails;
 import org.gradle.api.artifacts.component.ModuleComponentIdentifier;
 import org.gradle.api.artifacts.component.ModuleComponentSelector;
-import org.gradle.api.attributes.AttributeContainer;
 import org.gradle.api.internal.artifacts.ComponentMetadataProcessorFactory;
 import org.gradle.api.internal.artifacts.DefaultModuleVersionIdentifier;
 import org.gradle.api.internal.artifacts.ivyservice.CacheExpirationControl;
@@ -99,7 +98,14 @@ public void add(ModuleComponentRepository<ExternalModuleComponentGraphResolveSta
         repositoryNames.add(repository.getName());
     }
 
-    public void resolve(ModuleComponentSelector requested, ComponentOverrideMetadata overrideMetadata, VersionSelector versionSelector, @Nullable VersionSelector rejectedVersionSelector, AttributeContainer consumerAttributes, BuildableComponentIdResolveResult result) {
+    public void resolve(
+        ModuleComponentSelector requested,
+        ComponentOverrideMetadata overrideMetadata,
+        VersionSelector versionSelector,
+        @Nullable VersionSelector rejectedVersionSelector,
+        ImmutableAttributes consumerAttributes,
+        BuildableComponentIdResolveResult result
+    ) {
         LOGGER.debug("Attempting to resolve version for {} using repositories {}", requested, repositoryNames);
         List<Throwable> errors = new ArrayList<>();
 
@@ -258,7 +264,20 @@ private static class RepositoryResolveState implements ComponentSelectionContext
         private final CacheExpirationControl cacheExpirationControl;
         private ModuleComponentIdentifier firstRejected = null;
 
-        public RepositoryResolveState(VersionedComponentChooser versionedComponentChooser, ModuleComponentSelector selector, ComponentOverrideMetadata overrideMetadata, ModuleComponentRepository<ExternalModuleComponentGraphResolveState> repository, VersionSelector versionSelector, VersionSelector rejectedVersionSelector, VersionParser versionParser, AttributeContainer consumerAttributes, AttributesFactory attributesFactory, ComponentMetadataProcessorFactory componentMetadataProcessorFactory, ComponentMetadataSupplierRuleExecutor metadataSupplierRuleExecutor, CacheExpirationControl cacheExpirationControl) {
+        public RepositoryResolveState(
+            VersionedComponentChooser versionedComponentChooser,
+            ModuleComponentSelector selector,
+            ComponentOverrideMetadata overrideMetadata,
+            ModuleComponentRepository<ExternalModuleComponentGraphResolveState> repository,
+            VersionSelector versionSelector,
+            VersionSelector rejectedVersionSelector,
+            VersionParser versionParser,
+            ImmutableAttributes consumerAttributes,
+            AttributesFactory attributesFactory,
+            ComponentMetadataProcessorFactory componentMetadataProcessorFactory,
+            ComponentMetadataSupplierRuleExecutor metadataSupplierRuleExecutor,
+            CacheExpirationControl cacheExpirationControl
+        ) {
             this.versionedComponentChooser = versionedComponentChooser;
             this.overrideMetadata = overrideMetadata;
             this.selector = selector;
@@ -275,15 +294,9 @@ public RepositoryResolveState(VersionedComponentChooser versionedComponentChoose
             this.versionListingResult = new VersionListResult(selector, overrideMetadata, repository);
         }
 
-        private ImmutableAttributes buildAttributes(AttributeContainer consumerAttributes, AttributesFactory attributesFactory) {
-            // TODO: There is a bug here were we do not consider attributes coming from dependency constraints
-            // when determining the effective attributes for dynamic version selection. This means attributes directly declared
-            // on the configuration or on the dependency being resolved are considered, but not attributes coming from
-            // a constraint targeting the dependency being resolved. This is unusual, as we do consider constraint attributes
-            // when selecting variants.
-            ImmutableAttributes immutableConsumerAttributes = ((AttributeContainerInternal) consumerAttributes).asImmutable();
+        private ImmutableAttributes buildAttributes(ImmutableAttributes consumerAttributes, AttributesFactory attributesFactory) {
             ImmutableAttributes dependencyAttributes = ((AttributeContainerInternal) selector.getAttributes()).asImmutable();
-            return attributesFactory.concat(immutableConsumerAttributes, dependencyAttributes);
+            return attributesFactory.concat(consumerAttributes, dependencyAttributes);
         }
 
         public boolean canMakeFurtherAttempts() {
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/ExternalModuleComponentResolverFactory.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/ExternalModuleComponentResolverFactory.java
index 058586463f7..5e22a00bede 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/ExternalModuleComponentResolverFactory.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/ExternalModuleComponentResolverFactory.java
@@ -19,7 +19,6 @@
 import org.gradle.api.artifacts.component.ComponentIdentifier;
 import org.gradle.api.artifacts.component.ComponentSelector;
 import org.gradle.api.artifacts.result.ArtifactResult;
-import org.gradle.api.attributes.AttributeContainer;
 import org.gradle.api.internal.artifacts.ComponentMetadataProcessor;
 import org.gradle.api.internal.artifacts.ComponentMetadataProcessorFactory;
 import org.gradle.api.internal.artifacts.ComponentSelectionRulesInternal;
@@ -38,6 +37,7 @@
 import org.gradle.api.internal.artifacts.result.DefaultResolvedArtifactResult;
 import org.gradle.api.internal.attributes.AttributeSchemaServices;
 import org.gradle.api.internal.attributes.AttributesFactory;
+import org.gradle.api.internal.attributes.ImmutableAttributes;
 import org.gradle.api.internal.attributes.immutable.ImmutableAttributesSchema;
 import org.gradle.api.internal.component.ArtifactType;
 import org.gradle.api.logging.Logger;
@@ -134,15 +134,14 @@ public ComponentResolvers createResolvers(
         ComponentSelectionRulesInternal componentSelectionRules,
         boolean dependencyVerificationEnabled,
         CacheExpirationControl cacheExpirationControl,
-        AttributeContainer consumerAttributes,
         ImmutableAttributesSchema consumerSchema
     ) {
         if (repositories.isEmpty()) {
             return new NoRepositoriesResolver();
         }
 
-        UserResolverChain moduleResolver = new UserResolverChain(versionComparator, componentSelectionRules, versionParser, consumerAttributes, consumerSchema, attributesFactory, attributeSchemaServices, metadataProcessor, componentMetadataSupplierRuleExecutor, calculatedValueFactory, cacheExpirationControl);
-        ParentModuleLookupResolver parentModuleResolver = new ParentModuleLookupResolver(versionComparator, moduleIdentifierFactory, versionParser, consumerAttributes, consumerSchema, attributesFactory, attributeSchemaServices, metadataProcessor, componentMetadataSupplierRuleExecutor, calculatedValueFactory, cacheExpirationControl);
+        UserResolverChain moduleResolver = new UserResolverChain(versionComparator, componentSelectionRules, versionParser, consumerSchema, attributesFactory, attributeSchemaServices, metadataProcessor, componentMetadataSupplierRuleExecutor, calculatedValueFactory, cacheExpirationControl);
+        ParentModuleLookupResolver parentModuleResolver = new ParentModuleLookupResolver(versionComparator, moduleIdentifierFactory, versionParser, consumerSchema, attributesFactory, attributeSchemaServices, metadataProcessor, componentMetadataSupplierRuleExecutor, calculatedValueFactory, cacheExpirationControl);
 
         for (ResolutionAwareRepository repository : repositories) {
             ConfiguredModuleComponentRepository baseRepository = repository.createResolver();
@@ -219,7 +218,6 @@ public ParentModuleLookupResolver(
             VersionComparator versionComparator,
             ImmutableModuleIdentifierFactory moduleIdentifierFactory,
             VersionParser versionParser,
-            AttributeContainer consumerAttributes,
             ImmutableAttributesSchema attributesSchema,
             AttributesFactory attributesFactory,
             AttributeSchemaServices attributeSchemaServices,
@@ -228,7 +226,7 @@ public ParentModuleLookupResolver(
             CalculatedValueFactory calculatedValueFactory,
             CacheExpirationControl cacheExpirationControl
         ) {
-            this.delegate = new UserResolverChain(versionComparator, new DefaultComponentSelectionRules(moduleIdentifierFactory), versionParser, consumerAttributes, attributesSchema, attributesFactory, attributeSchemaServices, componentMetadataProcessorFactory, componentMetadataSupplierRuleExecutor, calculatedValueFactory, cacheExpirationControl);
+            this.delegate = new UserResolverChain(versionComparator, new DefaultComponentSelectionRules(moduleIdentifierFactory), versionParser, attributesSchema, attributesFactory, attributeSchemaServices, componentMetadataProcessorFactory, componentMetadataSupplierRuleExecutor, calculatedValueFactory, cacheExpirationControl);
         }
 
         public void add(ModuleComponentRepository<ExternalModuleComponentGraphResolveState> moduleComponentRepository) {
@@ -251,8 +249,8 @@ public ArtifactResolver getArtifactResolver() {
         }
 
         @Override
-        public void resolve(ComponentSelector selector, ComponentOverrideMetadata overrideMetadata, VersionSelector acceptor, @Nullable VersionSelector rejector, BuildableComponentIdResolveResult result) {
-            delegate.getComponentIdResolver().resolve(selector, overrideMetadata, acceptor, rejector, result);
+        public void resolve(ComponentSelector selector, ComponentOverrideMetadata overrideMetadata, VersionSelector acceptor, @Nullable VersionSelector rejector, BuildableComponentIdResolveResult result, ImmutableAttributes consumerAttributes) {
+            delegate.getComponentIdResolver().resolve(selector, overrideMetadata, acceptor, rejector, result, consumerAttributes);
         }
 
         @Override
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/NoRepositoriesResolver.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/NoRepositoriesResolver.java
index 1fd57d7edf2..9b52b97d475 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/NoRepositoriesResolver.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/NoRepositoriesResolver.java
@@ -20,6 +20,7 @@
 import org.gradle.api.artifacts.component.ComponentIdentifier;
 import org.gradle.api.artifacts.component.ComponentSelector;
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.strategy.VersionSelector;
+import org.gradle.api.internal.attributes.ImmutableAttributes;
 import org.gradle.api.internal.component.ArtifactType;
 import org.gradle.internal.component.model.ComponentArtifactMetadata;
 import org.gradle.internal.component.model.ComponentArtifactResolveMetadata;
@@ -54,7 +55,7 @@ public ArtifactResolver getArtifactResolver() {
     }
 
     @Override
-    public void resolve(ComponentSelector selector, ComponentOverrideMetadata overrideMetadata, VersionSelector acceptor, @Nullable VersionSelector rejector, BuildableComponentIdResolveResult result) {
+    public void resolve(ComponentSelector selector, ComponentOverrideMetadata overrideMetadata, VersionSelector acceptor, @Nullable VersionSelector rejector, BuildableComponentIdResolveResult result, ImmutableAttributes consumerAttributes) {
         result.failed(new ModuleVersionNotFoundException(selector, () -> String.format("Cannot resolve external dependency %s because no repositories are defined.", selector), ImmutableList.of()));
     }
 
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/RepositoryChainDependencyToComponentIdResolver.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/RepositoryChainDependencyToComponentIdResolver.java
index 41d7b5f9a39..6ad97ea4f18 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/RepositoryChainDependencyToComponentIdResolver.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/RepositoryChainDependencyToComponentIdResolver.java
@@ -21,13 +21,13 @@
 import org.gradle.api.artifacts.component.ComponentSelector;
 import org.gradle.api.artifacts.component.ModuleComponentIdentifier;
 import org.gradle.api.artifacts.component.ModuleComponentSelector;
-import org.gradle.api.attributes.AttributeContainer;
 import org.gradle.api.internal.artifacts.ComponentMetadataProcessorFactory;
 import org.gradle.api.internal.artifacts.DefaultModuleVersionIdentifier;
 import org.gradle.api.internal.artifacts.ivyservice.CacheExpirationControl;
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.strategy.VersionParser;
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.strategy.VersionSelector;
 import org.gradle.api.internal.attributes.AttributesFactory;
+import org.gradle.api.internal.attributes.ImmutableAttributes;
 import org.gradle.internal.component.external.model.DefaultModuleComponentIdentifier;
 import org.gradle.internal.component.external.model.ExternalModuleComponentGraphResolveState;
 import org.gradle.internal.component.model.ComponentOverrideMetadata;
@@ -38,11 +38,23 @@
 
 public class RepositoryChainDependencyToComponentIdResolver implements DependencyToComponentIdResolver {
     private final DynamicVersionResolver dynamicRevisionResolver;
-    private final AttributeContainer consumerAttributes;
 
-    public RepositoryChainDependencyToComponentIdResolver(VersionedComponentChooser componentChooser, VersionParser versionParser, AttributeContainer consumerAttributes, AttributesFactory attributesFactory, ComponentMetadataProcessorFactory componentMetadataProcessorFactory, ComponentMetadataSupplierRuleExecutor componentMetadataSupplierRuleExecutor, CacheExpirationControl cacheExpirationControl) {
-        this.dynamicRevisionResolver = new DynamicVersionResolver(componentChooser, versionParser, attributesFactory, componentMetadataProcessorFactory, componentMetadataSupplierRuleExecutor, cacheExpirationControl);
-        this.consumerAttributes = consumerAttributes;
+    public RepositoryChainDependencyToComponentIdResolver(
+        VersionedComponentChooser componentChooser,
+        VersionParser versionParser,
+        AttributesFactory attributesFactory,
+        ComponentMetadataProcessorFactory componentMetadataProcessorFactory,
+        ComponentMetadataSupplierRuleExecutor componentMetadataSupplierRuleExecutor,
+        CacheExpirationControl cacheExpirationControl
+    ) {
+        this.dynamicRevisionResolver = new DynamicVersionResolver(
+            componentChooser,
+            versionParser,
+            attributesFactory,
+            componentMetadataProcessorFactory,
+            componentMetadataSupplierRuleExecutor,
+            cacheExpirationControl
+        );
     }
 
     public void add(ModuleComponentRepository<ExternalModuleComponentGraphResolveState> repository) {
@@ -50,7 +62,14 @@ public void add(ModuleComponentRepository<ExternalModuleComponentGraphResolveSta
     }
 
     @Override
-    public void resolve(ComponentSelector selector, ComponentOverrideMetadata overrideMetadata, VersionSelector acceptor, @Nullable VersionSelector rejector, BuildableComponentIdResolveResult result) {
+    public void resolve(
+        ComponentSelector selector,
+        ComponentOverrideMetadata overrideMetadata,
+        VersionSelector acceptor,
+        @Nullable VersionSelector rejector,
+        BuildableComponentIdResolveResult result,
+        ImmutableAttributes consumerAttributes
+    ) {
         if (selector instanceof ModuleComponentSelector) {
             ModuleComponentSelector module = (ModuleComponentSelector) selector;
             if (acceptor.isDynamic()) {
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/UserResolverChain.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/UserResolverChain.java
index 1557952bee7..42dd2814bbd 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/UserResolverChain.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/UserResolverChain.java
@@ -16,7 +16,6 @@
 
 package org.gradle.api.internal.artifacts.ivyservice.ivyresolve;
 
-import org.gradle.api.attributes.AttributeContainer;
 import org.gradle.api.internal.artifacts.ComponentMetadataProcessorFactory;
 import org.gradle.api.internal.artifacts.ComponentSelectionRulesInternal;
 import org.gradle.api.internal.artifacts.ivyservice.CacheExpirationControl;
@@ -42,7 +41,6 @@ public UserResolverChain(
         VersionComparator versionComparator,
         ComponentSelectionRulesInternal componentSelectionRules,
         VersionParser versionParser,
-        AttributeContainer consumerAttributes,
         ImmutableAttributesSchema consumerSchema,
         AttributesFactory attributesFactory,
         AttributeSchemaServices attributeSchemaServices,
@@ -53,7 +51,7 @@ public UserResolverChain(
     ) {
         this.componentSelectionRules = componentSelectionRules;
         VersionedComponentChooser componentChooser = new DefaultVersionedComponentChooser(versionComparator, versionParser, attributeSchemaServices, componentSelectionRules, consumerSchema);
-        componentIdResolver = new RepositoryChainDependencyToComponentIdResolver(componentChooser, versionParser, consumerAttributes, attributesFactory, componentMetadataProcessor, componentMetadataSupplierRuleExecutor, cacheExpirationControl);
+        componentIdResolver = new RepositoryChainDependencyToComponentIdResolver(componentChooser, versionParser, attributesFactory, componentMetadataProcessor, componentMetadataSupplierRuleExecutor, cacheExpirationControl);
         componentResolver = new RepositoryChainComponentMetaDataResolver(componentChooser, calculatedValueFactory);
         artifactResolver = new RepositoryChainArtifactResolver(calculatedValueFactory);
     }
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/projectmodule/ProjectDependencyResolver.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/projectmodule/ProjectDependencyResolver.java
index a8ac0c182db..681b9143265 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/projectmodule/ProjectDependencyResolver.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/projectmodule/ProjectDependencyResolver.java
@@ -20,6 +20,7 @@
 import org.gradle.api.artifacts.component.ProjectComponentIdentifier;
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.ComponentResolvers;
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.strategy.VersionSelector;
+import org.gradle.api.internal.attributes.ImmutableAttributes;
 import org.gradle.api.internal.component.ArtifactType;
 import org.gradle.internal.component.local.model.DefaultProjectComponentSelector;
 import org.gradle.internal.component.local.model.LocalComponentGraphResolveState;
@@ -64,7 +65,7 @@ public ComponentMetaDataResolver getComponentResolver() {
     }
 
     @Override
-    public void resolve(ComponentSelector selector, ComponentOverrideMetadata overrideMetadata, VersionSelector acceptor, @Nullable VersionSelector rejector, BuildableComponentIdResolveResult result) {
+    public void resolve(ComponentSelector selector, ComponentOverrideMetadata overrideMetadata, VersionSelector acceptor, @Nullable VersionSelector rejector, BuildableComponentIdResolveResult result, ImmutableAttributes consumerAttributes) {
         if (selector instanceof DefaultProjectComponentSelector) {
             DefaultProjectComponentSelector projectSelector = (DefaultProjectComponentSelector) selector;
             ProjectComponentIdentifier projectId = projectSelector.toIdentifier();
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/ComponentResolversChain.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/ComponentResolversChain.java
index 5a90fda9c73..d86bbd31892 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/ComponentResolversChain.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/ComponentResolversChain.java
@@ -20,6 +20,7 @@
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.ComponentResolvers;
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.ErrorHandlingArtifactResolver;
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.strategy.VersionSelector;
+import org.gradle.api.internal.attributes.ImmutableAttributes;
 import org.gradle.api.internal.component.ArtifactType;
 import org.gradle.internal.component.model.ComponentArtifactMetadata;
 import org.gradle.internal.component.model.ComponentArtifactResolveMetadata;
@@ -140,12 +141,12 @@ public DependencyToComponentIdResolverChain(List<DependencyToComponentIdResolver
         }
 
         @Override
-        public void resolve(ComponentSelector selector, ComponentOverrideMetadata overrideMetadata, VersionSelector acceptor, @Nullable VersionSelector rejector, BuildableComponentIdResolveResult result) {
+        public void resolve(ComponentSelector selector, ComponentOverrideMetadata overrideMetadata, VersionSelector acceptor, @Nullable VersionSelector rejector, BuildableComponentIdResolveResult result, ImmutableAttributes consumerAttributes) {
             for (DependencyToComponentIdResolver resolver : resolvers) {
                 if (result.hasResult()) {
                     return;
                 }
-                resolver.resolve(selector, overrideMetadata, acceptor, rejector, result);
+                resolver.resolve(selector, overrideMetadata, acceptor, rejector, result, consumerAttributes);
             }
         }
     }
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/DependencyGraphEdge.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/DependencyGraphEdge.java
index 6e5eef9569d..b0050996b3e 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/DependencyGraphEdge.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/DependencyGraphEdge.java
@@ -37,6 +37,10 @@ public interface DependencyGraphEdge extends ResolvedGraphDependency {
 
     DependencyMetadata getDependencyMetadata();
 
+    /**
+     * Get the attributes that are specific to this edge -- the attributes from any constraint
+     * on the module that this edge points to, and any attributes attached directly to this edge.
+     */
     ImmutableAttributes getAttributes();
 
     boolean isTargetVirtualPlatform();
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/EdgeState.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/EdgeState.java
index a2da8da47fb..4ca01114983 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/EdgeState.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/EdgeState.java
@@ -20,6 +20,7 @@
 import org.gradle.api.artifacts.component.ComponentSelector;
 import org.gradle.api.artifacts.result.ComponentSelectionReason;
 import org.gradle.api.attributes.Attribute;
+import org.gradle.api.internal.artifacts.component.ComponentSelectorInternal;
 import org.gradle.api.internal.artifacts.ivyservice.resolveengine.excludes.ModuleExclusions;
 import org.gradle.api.internal.artifacts.ivyservice.resolveengine.excludes.specs.ExcludeSpec;
 import org.gradle.api.internal.artifacts.ivyservice.resolveengine.graph.DependencyGraphEdge;
@@ -54,12 +55,14 @@ class EdgeState implements DependencyGraphEdge {
     private final List<NodeState> targetNodes = new LinkedList<>();
     private final boolean isTransitive;
     private final boolean isConstraint;
-    private final int hashCode;
 
     private SelectorState selector;
     private ModuleVersionResolveException targetNodeSelectionFailure;
-    private ImmutableAttributes cachedAttributes;
-    private ExcludeSpec transitiveExclusions;
+
+    /**
+     * The accumulated exclusions that apply to this edge based on the paths from the root
+     */
+    private @Nullable ExcludeSpec transitiveExclusions;
     private ExcludeSpec cachedEdgeExclusions;
     private ExcludeSpec cachedExclusions;
 
@@ -67,25 +70,13 @@ class EdgeState implements DependencyGraphEdge {
     private boolean unattached;
     private boolean used;
 
-    EdgeState(NodeState from, DependencyState dependencyState, ExcludeSpec transitiveExclusions, ResolveState resolveState) {
+    EdgeState(NodeState from, DependencyState dependencyState, ResolveState resolveState) {
         this.from = from;
         this.dependencyState = dependencyState;
         this.dependencyMetadata = dependencyState.getDependency();
-        // The accumulated exclusions that apply to this edge based on the path from the root
-        this.transitiveExclusions = transitiveExclusions;
         this.resolveState = resolveState;
         this.isTransitive = from.isTransitive() && dependencyMetadata.isTransitive();
         this.isConstraint = dependencyMetadata.isConstraint();
-        this.hashCode = computeHashCode();
-    }
-
-    private int computeHashCode() {
-        int hashCode = from.hashCode();
-        hashCode = 31 * hashCode + dependencyState.hashCode();
-        if (transitiveExclusions != null) {
-            hashCode = 31 * hashCode + transitiveExclusions.hashCode();
-        }
-        return hashCode;
     }
 
     void computeSelector() {
@@ -201,14 +192,9 @@ public void retarget() {
 
     @Override
     public ImmutableAttributes getAttributes() {
-        assert cachedAttributes != null;
-        return cachedAttributes;
-    }
-
-    private ImmutableAttributes safeGetAttributes() throws AttributeMergingException {
         ModuleResolveState module = selector.getTargetModule();
-        cachedAttributes = module.mergedConstraintsAttributes(dependencyState.getDependency().getSelector().getAttributes());
-        return cachedAttributes;
+        ComponentSelectorInternal componentSelector = (ComponentSelectorInternal) dependencyState.getDependency().getSelector();
+        return resolveState.getAttributesFactory().safeConcat(module.getMergedConstraintAttributes(), componentSelector.getAttributes());
     }
 
     private void calculateTargetNodes(ComponentState targetComponent) {
@@ -279,10 +265,8 @@ private void calculateTargetNodes(ComponentState targetComponent) {
      * Determine which variants of a given target component that this edge should point to.
      */
     private GraphVariantSelectionResult selectTargetVariants(ComponentGraphResolveState targetComponentState) {
-        ImmutableAttributes requestAttributes = resolveState.getRoot().getMetadata().getAttributes();
-        ImmutableAttributes attributes = resolveState.getAttributesFactory().concat(requestAttributes, safeGetAttributes());
-
         GraphVariantSelector variantSelector = resolveState.getVariantSelector();
+        ImmutableAttributes attributes = resolveState.getAttributesFactory().concat(resolveState.getConsumerAttributes(), getAttributes());
         ImmutableAttributesSchema consumerSchema = resolveState.getConsumerSchema();
 
         // First allow the dependency to override variant selection, if it has a special
@@ -493,17 +477,6 @@ private ComponentState getSelectedComponent() {
         return selector.getTargetModule().getSelected();
     }
 
-    @Override
-    public boolean equals(Object o) {
-        return this == o;
-        // Edge states are deduplicated, this is a performance optimization
-    }
-
-    @Override
-    public int hashCode() {
-        return hashCode;
-    }
-
     DependencyState getDependencyState() {
         return dependencyState;
     }
@@ -515,8 +488,12 @@ public void updateTransitiveExcludes(ExcludeSpec newResolutionFilter) {
         }
         transitiveExclusions = newResolutionFilter;
         cachedExclusions = null;
+    }
+
+    public void updateTransitiveExcludesAndRequeueTargetNodes(ExcludeSpec newResolutionFilter) {
+        updateTransitiveExcludes(newResolutionFilter);
         for (NodeState targetNode : targetNodes) {
-            targetNode.updateTransitiveExcludes();
+            targetNode.clearTransitiveExclusionsAndEnqueue();
         }
     }
 
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/ModuleResolveState.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/ModuleResolveState.java
index cfb2479ba84..b93b259868b 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/ModuleResolveState.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/ModuleResolveState.java
@@ -23,7 +23,6 @@
 import org.gradle.api.artifacts.component.ComponentSelector;
 import org.gradle.api.artifacts.component.ModuleComponentIdentifier;
 import org.gradle.api.artifacts.component.ProjectComponentIdentifier;
-import org.gradle.api.attributes.AttributeContainer;
 import org.gradle.api.internal.artifacts.configurations.ConflictResolution;
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.strategy.Version;
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.strategy.VersionParser;
@@ -77,7 +76,7 @@ public class ModuleResolveState implements CandidateModule {
     private ComponentState selected;
     private ImmutableAttributes mergedConstraintAttributes = ImmutableAttributes.EMPTY;
 
-    private AttributeMergingException attributeMergingError;
+    private @Nullable AttributeMergingException attributeMergingError;
     private VirtualPlatformState platformState;
     private boolean overriddenSelection;
     private Set<VirtualPlatformState> platformOwners;
@@ -346,15 +345,11 @@ List<EdgeState> getUnattachedEdges() {
         return unattachedEdges;
     }
 
-    ImmutableAttributes mergedConstraintsAttributes(AttributeContainer append) throws AttributeMergingException {
+    ImmutableAttributes getMergedConstraintAttributes() {
         if (attributeMergingError != null) {
             throw new IllegalStateException(IncompatibleDependencyAttributesMessageBuilder.buildMergeErrorMessage(this, attributeMergingError));
         }
-        ImmutableAttributes attributes = ((AttributeContainerInternal) append).asImmutable();
-        if (mergedConstraintAttributes.isEmpty()) {
-            return attributes;
-        }
-        return attributesFactory.safeConcat(mergedConstraintAttributes.asImmutable(), attributes);
+        return mergedConstraintAttributes;
     }
 
     private ImmutableAttributes appendAttributes(ImmutableAttributes dependencyAttributes, SelectorState selectorState) {
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/NodeState.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/NodeState.java
index 599ed80c4cd..e13c48e0bc0 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/NodeState.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/NodeState.java
@@ -92,35 +92,35 @@ public class NodeState implements DependencyGraphNode {
     ExcludeSpec previousTraversalExclusions;
 
     // In opposite to outgoing edges, virtual edges are for now pretty rare, so they are created lazily
-    private List<EdgeState> virtualEdges;
+    private @Nullable List<EdgeState> virtualEdges;
     private boolean queued;
     private boolean evicted;
     private int transitiveEdgeCount;
-    private Set<ModuleIdentifier> upcomingNoLongerPendingConstraints;
+    private @Nullable Set<ModuleIdentifier> upcomingNoLongerPendingConstraints;
     private boolean virtualPlatformNeedsRefresh;
-    private Set<EdgeState> edgesToRecompute;
-    private Multimap<ModuleIdentifier, DependencyState> potentiallyActivatedConstraints;
+    private @Nullable Set<EdgeState> edgesToRecompute;
+    private @Nullable Multimap<ModuleIdentifier, DependencyState> potentiallyActivatedConstraints;
 
     // caches
     private final Map<DependencyMetadata, DependencyState> dependencyStateCache = new HashMap<>();
     private final Map<DependencyState, EdgeState> edgesCache = new HashMap<>();
 
     // Caches the list of dependency states for dependencies
-    private List<DependencyState> cachedDependencyStates;
+    private @Nullable List<DependencyState> cachedDependencyStates;
 
     // Caches the list of dependency states which are NOT excluded
-    private List<DependencyState> cachedFilteredDependencyStates;
+    private @Nullable List<DependencyState> cachedFilteredDependencyStates;
 
     // exclusions optimizations
-    private ExcludeSpec cachedNodeExclusions;
+    private @Nullable ExcludeSpec cachedNodeExclusions;
     private int previousIncomingEdgeCount;
     private long previousIncomingHash;
     private long incomingHash;
-    private ExcludeSpec cachedModuleResolutionFilter;
+    private @Nullable ExcludeSpec cachedModuleResolutionFilter;
 
-    private StrictVersionConstraints ancestorsStrictVersionConstraints;
-    private StrictVersionConstraints ownStrictVersionConstraints;
-    private List<EdgeState> endorsesStrictVersionsFrom;
+    private @Nullable StrictVersionConstraints ancestorsStrictVersionConstraints;
+    private @Nullable StrictVersionConstraints ownStrictVersionConstraints;
+    private @Nullable List<EdgeState> endorsesStrictVersionsFrom;
     private boolean removingOutgoingEdges;
     private boolean findingExternalVariants;
 
@@ -267,11 +267,13 @@ public void visitOutgoingDependencies(Collection<EdgeState> discoveredEdges) {
             potentiallyActivatedConstraints = null;
             ownStrictVersionConstraints = null;
         }
+
         // We are processing dependencies, anything in the previous state will be handled
         upcomingNoLongerPendingConstraints = null;
-
         visitDependencies(resolutionFilter, discoveredEdges);
         visitOwners(discoveredEdges);
+
+        previousTraversalExclusions = resolutionFilter;
     }
 
     private boolean canIgnoreExternalVariant() {
@@ -324,37 +326,43 @@ void cleanupConstraints() {
     }
 
     private boolean excludesSameDependenciesAsPreviousTraversal(ExcludeSpec newResolutionFilter) {
-        List<DependencyState> oldStates = cachedFilteredDependencyStates;
-        if (previousTraversalExclusions == null || oldStates == null) {
+        if (previousTraversalExclusions == null) {
+            // There was no previous traversal. This traversal can't be the same.
             return false;
         }
         if (previousTraversalExclusions.equals(newResolutionFilter)) {
+            // The excludes did not change. The dependencies are the same.
             return true;
         }
+        if (cachedFilteredDependencyStates == null) {
+            // We don't know which dependencies were excluded in the previous traversal.
+            // We are not sure if this traversal is the same.
+            return false;
+        }
         if (doesNotHaveDependencies && !dependenciesMayChange) {
-            // whatever the exclude filter, there are no dependencies
+            // We have no dependencies, so the resolution filter does not matter.
             return true;
         }
-        cachedFilteredDependencyStates = null;
+
         // here, we need to check that applying the new resolution filter
         // we would actually exclude exactly the same dependencies as in
         // the previous visit. It is important that this is NOT a heuristic
         // (it used to be) because if the filters are _equivalent_, we would
         // revisit all dependencies and possibly change the classpath order!
-        boolean sameDependencies = dependencies(newResolutionFilter).equals(oldStates);
+        List<DependencyState> oldDependencies = cachedFilteredDependencyStates;
+        this.cachedFilteredDependencyStates = null; // Invalidate the cache so `dependencies` recomputes the value.
+        boolean sameDependencies = dependencies(newResolutionFilter).equals(oldDependencies);
+
         if (sameDependencies) {
-            // While there will be no change to this node, there might be changes to the nodes it brings as the exclude change could concern them
+            // If this method returns true, we are going to skip normal dependency traversal
+            // and instead short-circuit by only updating a subset of edges. Therefore, since
+            // the excludes changed, we need to update the resolution filter on our outgoing edges, as we
+            // are going to skip the normal dependency traversal logic that usually takes care of this.
             for (EdgeState outgoingEdge : outgoingEdges) {
-                outgoingEdge.updateTransitiveExcludes(newResolutionFilter);
-            }
-        }
-        if (LOGGER.isDebugEnabled()) {
-            if (sameDependencies) {
-                LOGGER.debug("Filter {} excludes same dependencies as previous {}. Dependencies left = {}", newResolutionFilter, previousTraversalExclusions, oldStates);
-            } else {
-                LOGGER.debug("Filter {} doesn't exclude same dependencies as previous {}. Previous dependencies left = {} - New dependencies left = {}", newResolutionFilter, previousTraversalExclusions, oldStates, cachedFilteredDependencyStates);
+                outgoingEdge.updateTransitiveExcludesAndRequeueTargetNodes(newResolutionFilter);
             }
         }
+
         return sameDependencies;
     }
 
@@ -434,7 +442,6 @@ private void visitDependencies(ExcludeSpec resolutionFilter, Collection<EdgeStat
                     strictVersionsSet = maybeCollectStrictVersions(strictVersionsSet, dependencyState);
                 }
             }
-            previousTraversalExclusions = resolutionFilter;
         } finally {
             // If there are 'pending' dependencies that share a target with any of these outgoing edges,
             // then reset the state of the node that owns those dependencies.
@@ -527,7 +534,8 @@ private DependencyState cachedDependencyStateFor(DependencyMetadata md) {
      * Creates an edge and add it to this node as an outgoing edge.
      */
     private void createAndLinkEdgeState(DependencyState dependencyState, Collection<EdgeState> discoveredEdges, ExcludeSpec resolutionFilter, boolean deferSelection) {
-        EdgeState dependencyEdge = edgesCache.computeIfAbsent(dependencyState, ds -> new EdgeState(this, ds, resolutionFilter, resolveState));
+        EdgeState dependencyEdge = edgesCache.computeIfAbsent(dependencyState, ds -> new EdgeState(this, ds, resolveState));
+        dependencyEdge.updateTransitiveExcludes(resolutionFilter);
         dependencyEdge.computeSelector(); // the selector changes, if the 'versionProvidedByAncestors' state changes
         outgoingEdges.add(dependencyEdge);
         dependencyEdge.markUsed();
@@ -654,13 +662,19 @@ void addIncomingEdge(EdgeState dependencyEdge) {
         if (!incomingEdges.contains(dependencyEdge)) {
             incomingEdges.add(dependencyEdge);
             incomingHash += dependencyEdge.hashCode();
-            resolveState.onMoreSelected(this);
+            clearTransitiveExclusionsAndEnqueue();
             if (dependencyEdge.isTransitive()) {
                 transitiveEdgeCount++;
             }
         }
     }
 
+    void clearTransitiveExclusionsAndEnqueue() {
+        cachedModuleResolutionFilter = null;
+        // TODO: We can eagerly compute the exclusions and enqueue only on change
+        resolveState.onMoreSelected(this);
+    }
+
     void removeIncomingEdge(EdgeState dependencyEdge) {
         if (incomingEdges.remove(dependencyEdge)) {
             incomingHash -= dependencyEdge.hashCode();
@@ -1298,13 +1312,6 @@ private NodeState getFromNode(NodeState from) {
         return incomingEdges.get(0).getFrom();
     }
 
-    public void updateTransitiveExcludes() {
-        cachedModuleResolutionFilter = null;
-        if (isSelected()) {
-            resolveState.onMoreSelected(this);
-        }
-    }
-
     public Set<NodeState> getReachableNodes() {
         Set<NodeState> visited = new HashSet<>();
         dependsTransitivelyOn(visited);
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/PotentialEdge.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/PotentialEdge.java
index d829ffd24a3..2d7413d01b0 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/PotentialEdge.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/PotentialEdge.java
@@ -57,7 +57,8 @@ static PotentialEdge of(ResolveState resolveState, NodeState from, ModuleCompone
         if (exclusions == null) {
             exclusions = resolveState.getModuleExclusions().nothing();
         }
-        EdgeState edge = new EdgeState(from, dependencyState, exclusions, resolveState);
+        EdgeState edge = new EdgeState(from, dependencyState, resolveState);
+        edge.updateTransitiveExcludes(exclusions);
         edge.computeSelector();
         ModuleVersionIdentifier toModuleVersionId = DefaultModuleVersionIdentifier.newId(toSelector.getModuleIdentifier(), toSelector.getVersion());
         ComponentState version = resolveState.getModule(toSelector.getModuleIdentifier()).getVersion(toModuleVersionId, toComponent);
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/ResolveState.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/ResolveState.java
index 668726ad4b0..0852b351724 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/ResolveState.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/ResolveState.java
@@ -41,6 +41,7 @@
 import org.gradle.api.internal.attributes.AttributeDesugaring;
 import org.gradle.api.internal.attributes.AttributeSchemaServices;
 import org.gradle.api.internal.attributes.AttributesFactory;
+import org.gradle.api.internal.attributes.ImmutableAttributes;
 import org.gradle.api.internal.attributes.immutable.ImmutableAttributesSchema;
 import org.gradle.api.specs.Spec;
 import org.gradle.internal.component.local.model.LocalComponentGraphResolveState;
@@ -79,6 +80,7 @@ public class ResolveState implements ComponentStateFactory<ComponentState> {
     private final ComponentMetaDataResolver metaDataResolver;
     private final Deque<NodeState> queue;
     private final ConflictResolution conflictResolution;
+    private final ImmutableAttributes consumerAttributes;
     private final ImmutableAttributesSchema consumerSchema;
     private final ModuleExclusions moduleExclusions;
     private final DeselectVersionAction deselectVersionAction = new DeselectVersionAction(this);
@@ -142,6 +144,7 @@ public ResolveState(
 
         ModuleVersionIdentifier rootModuleVersionId = rootComponentState.getModuleVersionId();
         ComponentIdentifier rootComponentId = rootComponentState.getId();
+        this.consumerAttributes = rootVariant.getAttributes();
         this.consumerSchema = rootComponentState.getMetadata().getAttributesSchema();
 
         int graphSize = estimateGraphSize(rootVariant);
@@ -270,6 +273,10 @@ public void onFewerSelected(NodeState node) {
         }
     }
 
+    public ImmutableAttributes getConsumerAttributes() {
+        return consumerAttributes;
+    }
+
     public ImmutableAttributesSchema getConsumerSchema() {
         return consumerSchema;
     }
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/SelectorState.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/SelectorState.java
index 2487e634579..bcbbae71a7b 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/SelectorState.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/builder/SelectorState.java
@@ -31,6 +31,7 @@
 import org.gradle.api.internal.artifacts.ivyservice.resolveengine.result.ComponentSelectionReasonInternal;
 import org.gradle.api.internal.artifacts.ivyservice.resolveengine.result.ComponentSelectionReasons;
 import org.gradle.api.internal.attributes.AttributeDesugaring;
+import org.gradle.api.internal.attributes.ImmutableAttributes;
 import org.gradle.internal.component.model.ComponentOverrideMetadata;
 import org.gradle.internal.component.model.DefaultComponentOverrideMetadata;
 import org.gradle.internal.component.model.DependencyMetadata;
@@ -66,6 +67,7 @@ class SelectorState implements DependencyGraphSelector, ResolvableSelectorState
 
     private final DependencyState dependencyState;
     private final DependencyToComponentIdResolver resolver;
+    private final ResolveState resolveState;
     private final ResolvedVersionConstraint versionConstraint;
     private final List<ComponentSelectionDescriptorInternal> dependencyReasons = new ArrayList<>(4);
     private final boolean isProjectSelector;
@@ -93,6 +95,7 @@ class SelectorState implements DependencyGraphSelector, ResolvableSelectorState
 
     SelectorState(DependencyState dependencyState, DependencyToComponentIdResolver resolver, ResolveState resolveState, ModuleIdentifier targetModuleId, boolean versionByAncestor) {
         this.resolver = resolver;
+        this.resolveState = resolveState;
         this.targetModule = resolveState.getModule(targetModuleId);
         if (versionByAncestor) {
             dependencyReasons.add(ComponentSelectionReasons.BY_ANCESTOR);
@@ -185,7 +188,8 @@ private ComponentIdResolveResult resolve(@Nullable VersionSelector selector, Ver
             } else {
                 IvyArtifactName firstArtifact = getFirstDependencyArtifact();
                 ComponentOverrideMetadata overrideMetadata = DefaultComponentOverrideMetadata.forDependency(changing, firstArtifact);
-                resolver.resolve(dependencyState.getDependency().getSelector(), overrideMetadata, selector, rejector, idResolveResult);
+                ImmutableAttributes requestAttributes = resolveState.getAttributesFactory().concat(resolveState.getConsumerAttributes(), targetModule.getMergedConstraintAttributes());
+                resolver.resolve(dependencyState.getDependency().getSelector(), overrideMetadata, selector, rejector, idResolveResult, requestAttributes);
             }
 
             if (idResolveResult.getFailure() != null) {
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/query/DefaultArtifactResolutionQuery.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/query/DefaultArtifactResolutionQuery.java
index c8cdfa072a1..fbe73c4db90 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/query/DefaultArtifactResolutionQuery.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/query/DefaultArtifactResolutionQuery.java
@@ -40,6 +40,7 @@
 import org.gradle.api.internal.artifacts.result.DefaultUnresolvedArtifactResult;
 import org.gradle.api.internal.artifacts.result.DefaultUnresolvedComponentResult;
 import org.gradle.api.internal.attributes.ImmutableAttributes;
+import org.gradle.api.internal.attributes.immutable.ImmutableAttributesSchema;
 import org.gradle.api.internal.component.ArtifactType;
 import org.gradle.api.internal.component.ComponentTypeRegistry;
 import org.gradle.internal.Describables;
@@ -155,8 +156,7 @@ public ArtifactResolutionResult execute() {
             resolutionStrategy.getComponentSelection(),
             resolutionStrategy.isDependencyVerificationEnabled(),
             resolutionStrategy.getCachePolicy().asImmutable(),
-            ImmutableAttributes.EMPTY,
-            null
+            ImmutableAttributesSchema.EMPTY
         );
 
         ComponentMetaDataResolver componentMetaDataResolver = componentResolvers.getComponentResolver();
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/repositories/resolver/ExternalResourceResolverDescriptorParseContext.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/repositories/resolver/ExternalResourceResolverDescriptorParseContext.java
index 6d5fe09ed47..24734388498 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/repositories/resolver/ExternalResourceResolverDescriptorParseContext.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/repositories/resolver/ExternalResourceResolverDescriptorParseContext.java
@@ -22,6 +22,7 @@
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.parser.DescriptorParseContext;
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.strategy.VersionSelector;
 import org.gradle.api.internal.artifacts.repositories.metadata.DefaultMetadataFileSource;
+import org.gradle.api.internal.attributes.ImmutableAttributes;
 import org.gradle.api.internal.component.ArtifactType;
 import org.gradle.internal.component.external.model.ModuleComponentArtifactIdentifier;
 import org.gradle.internal.component.model.ComponentArtifactMetadata;
@@ -69,7 +70,7 @@ public LocallyAvailableExternalResource getMetaDataArtifact(ModuleComponentIdent
     @Override
     public LocallyAvailableExternalResource getMetaDataArtifact(ModuleComponentSelector selector, VersionSelector acceptor, ArtifactType artifactType) {
         BuildableComponentIdResolveResult idResolveResult = new DefaultBuildableComponentIdResolveResult();
-        mainResolvers.getComponentIdResolver().resolve(selector, DefaultComponentOverrideMetadata.EMPTY, acceptor, null, idResolveResult);
+        mainResolvers.getComponentIdResolver().resolve(selector, DefaultComponentOverrideMetadata.EMPTY, acceptor, null, idResolveResult, ImmutableAttributes.EMPTY);
         return getMetaDataArtifact((ModuleComponentIdentifier) idResolveResult.getId(), artifactType);
     }
 
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/internal/component/external/model/DefaultModuleComponentSelector.java b/platforms/software/dependency-management/src/main/java/org/gradle/internal/component/external/model/DefaultModuleComponentSelector.java
index ee138d3e1b1..addbd594584 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/internal/component/external/model/DefaultModuleComponentSelector.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/internal/component/external/model/DefaultModuleComponentSelector.java
@@ -31,6 +31,7 @@
 import org.gradle.api.capabilities.Capability;
 import org.gradle.api.internal.artifacts.ImmutableVersionConstraint;
 import org.gradle.api.internal.artifacts.capability.DefaultSpecificCapabilitySelector;
+import org.gradle.api.internal.artifacts.component.ComponentSelectorInternal;
 import org.gradle.api.internal.artifacts.dependencies.DefaultImmutableVersionConstraint;
 import org.gradle.api.internal.attributes.AttributeContainerInternal;
 import org.gradle.api.internal.attributes.ImmutableAttributes;
@@ -38,7 +39,8 @@
 import java.util.List;
 import java.util.Set;
 
-public class DefaultModuleComponentSelector implements ModuleComponentSelector {
+public class DefaultModuleComponentSelector implements ModuleComponentSelector, ComponentSelectorInternal {
+
     private final ModuleIdentifier moduleIdentifier;
     private final ImmutableVersionConstraint versionConstraint;
     private final ImmutableAttributes attributes;
@@ -130,7 +132,7 @@ public ImmutableSet<CapabilitySelector> getCapabilitySelectors() {
     }
 
     @Override
-    public AttributeContainer getAttributes() {
+    public ImmutableAttributes getAttributes() {
         return attributes;
     }
 
@@ -218,4 +220,5 @@ public static ComponentSelector withCapabilities(ModuleComponentSelector selecto
             ImmutableSet.copyOf(capabilitySelectors)
         );
     }
+
 }
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/internal/component/local/model/DefaultLibraryComponentSelector.java b/platforms/software/dependency-management/src/main/java/org/gradle/internal/component/local/model/DefaultLibraryComponentSelector.java
index 68b15cd4518..c2ebe3baac2 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/internal/component/local/model/DefaultLibraryComponentSelector.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/internal/component/local/model/DefaultLibraryComponentSelector.java
@@ -18,20 +18,21 @@
 
 import com.google.common.base.Objects;
 import com.google.common.base.Strings;
+import com.google.common.collect.ImmutableSet;
 import org.gradle.api.artifacts.capability.CapabilitySelector;
 import org.gradle.api.artifacts.component.ComponentIdentifier;
 import org.gradle.api.artifacts.component.LibraryBinaryIdentifier;
 import org.gradle.api.artifacts.component.LibraryComponentSelector;
-import org.gradle.api.attributes.AttributeContainer;
 import org.gradle.api.capabilities.Capability;
+import org.gradle.api.internal.artifacts.component.ComponentSelectorInternal;
 import org.gradle.api.internal.attributes.ImmutableAttributes;
 import org.jspecify.annotations.Nullable;
 
 import java.util.Collections;
 import java.util.List;
-import java.util.Set;
 
-public class DefaultLibraryComponentSelector implements LibraryComponentSelector {
+public class DefaultLibraryComponentSelector implements LibraryComponentSelector, ComponentSelectorInternal {
+
     private final String projectPath;
     private final String libraryName;
     private final String variant;
@@ -91,7 +92,7 @@ public boolean matchesStrictly(ComponentIdentifier identifier) {
     }
 
     @Override
-    public AttributeContainer getAttributes() {
+    public ImmutableAttributes getAttributes() {
         return ImmutableAttributes.EMPTY;
     }
 
@@ -101,8 +102,8 @@ public List<Capability> getRequestedCapabilities() {
     }
 
     @Override
-    public Set<CapabilitySelector> getCapabilitySelectors() {
-        return Collections.emptySet();
+    public ImmutableSet<CapabilitySelector> getCapabilitySelectors() {
+        return ImmutableSet.of();
     }
 
     @Override
@@ -128,4 +129,5 @@ public int hashCode() {
     public String toString() {
         return getDisplayName();
     }
+
 }
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/internal/component/local/model/DefaultProjectComponentSelector.java b/platforms/software/dependency-management/src/main/java/org/gradle/internal/component/local/model/DefaultProjectComponentSelector.java
index a9048410905..73db580e5da 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/internal/component/local/model/DefaultProjectComponentSelector.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/internal/component/local/model/DefaultProjectComponentSelector.java
@@ -175,4 +175,5 @@ public static ProjectComponentSelector withAttributesAndCapabilities(ProjectComp
     public ProjectComponentIdentifier toIdentifier() {
         return new DefaultProjectComponentIdentifier(projectIdentity);
     }
+
 }
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/internal/component/local/model/ProjectComponentSelectorInternal.java b/platforms/software/dependency-management/src/main/java/org/gradle/internal/component/local/model/ProjectComponentSelectorInternal.java
index 30a1acb9f62..ac555fa62a7 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/internal/component/local/model/ProjectComponentSelectorInternal.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/internal/component/local/model/ProjectComponentSelectorInternal.java
@@ -16,23 +16,15 @@
 
 package org.gradle.internal.component.local.model;
 
-import com.google.common.collect.ImmutableSet;
-import org.gradle.api.artifacts.capability.CapabilitySelector;
 import org.gradle.api.artifacts.component.ProjectComponentSelector;
-import org.gradle.api.internal.attributes.ImmutableAttributes;
+import org.gradle.api.internal.artifacts.component.ComponentSelectorInternal;
 import org.gradle.api.internal.project.ProjectIdentity;
 import org.gradle.util.Path;
 
 /**
  * Internal counterpart to {@link ProjectComponentSelector}
  */
-public interface ProjectComponentSelectorInternal extends ProjectComponentSelector {
-
-    @Override
-    ImmutableAttributes getAttributes();
-
-    @Override
-    ImmutableSet<CapabilitySelector> getCapabilitySelectors();
+public interface ProjectComponentSelectorInternal extends ProjectComponentSelector, ComponentSelectorInternal {
 
     /**
      * Returns a unique path for the target project within the current build tree.
@@ -43,4 +35,5 @@ public interface ProjectComponentSelectorInternal extends ProjectComponentSelect
      * Returns the identity of the target project.
      */
     ProjectIdentity getProjectIdentity();
+
 }
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/internal/resolve/resolver/DependencyToComponentIdResolver.java b/platforms/software/dependency-management/src/main/java/org/gradle/internal/resolve/resolver/DependencyToComponentIdResolver.java
index 7f8fa53d794..a80a7147c1c 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/internal/resolve/resolver/DependencyToComponentIdResolver.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/internal/resolve/resolver/DependencyToComponentIdResolver.java
@@ -18,6 +18,7 @@
 
 import org.gradle.api.artifacts.component.ComponentSelector;
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.strategy.VersionSelector;
+import org.gradle.api.internal.attributes.ImmutableAttributes;
 import org.gradle.internal.component.model.ComponentOverrideMetadata;
 import org.gradle.internal.resolve.result.BuildableComponentIdResolveResult;
 import org.jspecify.annotations.Nullable;
@@ -34,5 +35,12 @@ public interface DependencyToComponentIdResolver {
      *
      * <p>At some point in the future, this should resolve to a set of candidates rather than a single instance.
      */
-    void resolve(ComponentSelector selector, ComponentOverrideMetadata overrideMetadata, VersionSelector acceptor, @Nullable VersionSelector rejector, BuildableComponentIdResolveResult result);
+    void resolve(
+        ComponentSelector selector,
+        ComponentOverrideMetadata overrideMetadata,
+        VersionSelector acceptor,
+        @Nullable VersionSelector rejector,
+        BuildableComponentIdResolveResult result,
+        ImmutableAttributes consumerAttributes
+    );
 }
diff --git a/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/configurations/DefaultConfigurationSpec.groovy b/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/configurations/DefaultConfigurationSpec.groovy
index ef077426152..c72e22a25bf 100644
--- a/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/configurations/DefaultConfigurationSpec.groovy
+++ b/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/configurations/DefaultConfigurationSpec.groovy
@@ -649,7 +649,7 @@ class DefaultConfigurationSpec extends Specification {
             ConfigurationRoles.ALL,
             ConfigurationRoles.RESOLVABLE,
             ConfigurationRoles.RESOLVABLE_DEPENDENCY_SCOPE
-        ] + ConfigurationRolesForMigration.ALL
+        ] + ConfigurationRolesForMigration.ALL - ConfigurationRolesForMigration.CONSUMABLE_TO_RETIRED
     }
 
     void "fails to copy non-resolvable configuration (#role)"() {
diff --git a/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/ExternalModuleComponentResolverFactoryTest.groovy b/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/ExternalModuleComponentResolverFactoryTest.groovy
index ffa7edb0123..b973d7f9b7f 100644
--- a/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/ExternalModuleComponentResolverFactoryTest.groovy
+++ b/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/ivyresolve/ExternalModuleComponentResolverFactoryTest.groovy
@@ -40,7 +40,6 @@ import org.gradle.api.internal.artifacts.repositories.metadata.ImmutableMetadata
 import org.gradle.api.internal.artifacts.repositories.metadata.MetadataArtifactProvider
 import org.gradle.api.internal.artifacts.repositories.resolver.ExternalResourceResolver
 import org.gradle.api.internal.artifacts.verification.signatures.SignatureVerificationServiceFactory
-import org.gradle.api.internal.attributes.ImmutableAttributes
 import org.gradle.api.internal.attributes.immutable.ImmutableAttributesSchema
 import org.gradle.api.internal.properties.GradleProperties
 import org.gradle.internal.action.InstantiatingAction
@@ -109,7 +108,7 @@ class ExternalModuleComponentResolverFactoryTest extends Specification {
 
     def "returns an empty resolver when no repositories are configured"() {
         when:
-        def resolver = newFactory().createResolvers(Collections.emptyList(), Stub(ComponentMetadataProcessorFactory), Stub(ComponentSelectionRulesInternal), false, Mock(CacheExpirationControl), ImmutableAttributes.EMPTY, ImmutableAttributesSchema.EMPTY)
+        def resolver = newFactory().createResolvers(Collections.emptyList(), Stub(ComponentMetadataProcessorFactory), Stub(ComponentSelectionRulesInternal), false, Mock(CacheExpirationControl), ImmutableAttributesSchema.EMPTY)
 
         then:
         resolver instanceof NoRepositoriesResolver
@@ -125,7 +124,7 @@ class ExternalModuleComponentResolverFactoryTest extends Specification {
         def componentSelectionRules = Stub(ComponentSelectionRulesInternal)
 
         when:
-        def resolver = newFactory().createResolvers(repositories, Stub(ComponentMetadataProcessorFactory), componentSelectionRules, false, Mock(CacheExpirationControl), ImmutableAttributes.EMPTY, ImmutableAttributesSchema.EMPTY)
+        def resolver = newFactory().createResolvers(repositories, Stub(ComponentMetadataProcessorFactory), componentSelectionRules, false, Mock(CacheExpirationControl), ImmutableAttributesSchema.EMPTY)
 
         then:
         assert resolver instanceof UserResolverChain
diff --git a/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/projectmodule/ProjectDependencyResolverTest.groovy b/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/projectmodule/ProjectDependencyResolverTest.groovy
index d24c7fdbe41..41c86cd8680 100644
--- a/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/projectmodule/ProjectDependencyResolverTest.groovy
+++ b/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/projectmodule/ProjectDependencyResolverTest.groovy
@@ -17,6 +17,7 @@ package org.gradle.api.internal.artifacts.ivyservice.projectmodule
 
 import org.gradle.api.artifacts.component.ComponentIdentifier
 import org.gradle.api.artifacts.component.ComponentSelector
+import org.gradle.api.internal.attributes.ImmutableAttributes
 import org.gradle.api.internal.project.ProjectInternal
 import org.gradle.api.internal.project.ProjectState
 import org.gradle.api.internal.project.ProjectStateRegistry
@@ -52,7 +53,7 @@ class ProjectDependencyResolverTest extends Specification {
         def id = newProjectId(":project")
 
         when:
-        resolver.resolve(selector, DefaultComponentOverrideMetadata.EMPTY, null, null, result)
+        resolver.resolve(selector, DefaultComponentOverrideMetadata.EMPTY, null, null, result, ImmutableAttributes.EMPTY)
 
         then:
         1 * registry.getComponent(id) >> componentState
@@ -80,7 +81,7 @@ class ProjectDependencyResolverTest extends Specification {
         def selector = Stub(ComponentSelector)
 
         when:
-        resolver.resolve(selector, DefaultComponentOverrideMetadata.EMPTY, null, null, result)
+        resolver.resolve(selector, DefaultComponentOverrideMetadata.EMPTY, null, null, result, ImmutableAttributes.EMPTY)
 
         then:
         0 * registry.getComponent(_)
diff --git a/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/resolveengine/DependencyGraphBuilderTest.groovy b/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/resolveengine/DependencyGraphBuilderTest.groovy
index f114e4f57c5..1c3e810a8de 100644
--- a/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/resolveengine/DependencyGraphBuilderTest.groovy
+++ b/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/resolveengine/DependencyGraphBuilderTest.groovy
@@ -1144,7 +1144,7 @@ class DependencyGraphBuilderTest extends Specification {
 
     def doesNotResolve(Map<String, ?> args = [:], TestComponent from, TestComponent to) {
         def selector = dependsOn(args, from, to)
-        0 * idResolver.resolve(selector, _, _, _, _)
+        0 * idResolver.resolve(selector, _, _, _, _, _)
         0 * metaDataResolver.resolve(to.component.id, _, _)
     }
 
@@ -1167,7 +1167,7 @@ class DependencyGraphBuilderTest extends Specification {
 
     def brokenSelector(Map<String, ?> args = [:], TestComponent from, String to) {
         def selector = dependsOn(args, from, newId("group", to, "1.0"))
-        1 * idResolver.resolve(selector, _, _, _, _) >> { ModuleComponentSelector sel, ComponentOverrideMetadata om, VersionSelector acceptor, VersionSelector rejector, BuildableComponentIdResolveResult result ->
+        1 * idResolver.resolve(selector, _, _, _, _, _) >> { ModuleComponentSelector sel, ComponentOverrideMetadata om, VersionSelector acceptor, VersionSelector rejector, BuildableComponentIdResolveResult result, ImmutableAttributes consumerAttributes ->
             org.gradle.internal.Factory<String> broken = { "broken" }
             result.failed(new ModuleVersionResolveException(newSelector(DefaultModuleIdentifier.newId("a", "b"), new DefaultMutableVersionConstraint("c")), broken))
         }
@@ -1204,7 +1204,7 @@ class DependencyGraphBuilderTest extends Specification {
     }
 
     def selectorResolvesTo(ComponentSelector selector, ComponentIdentifier id, ModuleVersionIdentifier mvId) {
-        1 * idResolver.resolve(selector, _, _, _, _) >> { ComponentSelector sel, ComponentOverrideMetadata om, VersionSelector acceptor, VersionSelector rejector, BuildableComponentIdResolveResult result ->
+        1 * idResolver.resolve(selector, _, _, _, _, _) >> { ComponentSelector sel, ComponentOverrideMetadata om, VersionSelector acceptor, VersionSelector rejector, BuildableComponentIdResolveResult result, ImmutableAttributes consumerAttributes ->
             result.resolved(id, mvId)
         }
     }
diff --git a/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/selectors/SelectorStateResolverTest.groovy b/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/selectors/SelectorStateResolverTest.groovy
index 7694c2865e1..099a70f7929 100644
--- a/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/selectors/SelectorStateResolverTest.groovy
+++ b/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/selectors/SelectorStateResolverTest.groovy
@@ -317,7 +317,7 @@ class SelectorStateResolverTest extends Specification {
      */
     class TestDependencyToComponentIdResolver implements DependencyToComponentIdResolver {
         @Override
-        void resolve(ComponentSelector selector, ComponentOverrideMetadata overrideMetadata, VersionSelector acceptor, VersionSelector rejector, BuildableComponentIdResolveResult result) {
+        void resolve(ComponentSelector selector, ComponentOverrideMetadata overrideMetadata, VersionSelector acceptor, VersionSelector rejector, BuildableComponentIdResolveResult result, ImmutableAttributes consumerAttributes) {
             if (!acceptor.isDynamic()) {
                 def id = DefaultModuleComponentIdentifier.newId(DefaultModuleIdentifier.newId(moduleId.group, moduleId.name), acceptor.selector)
                 resolvedOrRejected(id, rejector, result)
diff --git a/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/selectors/TestModuleSelectorState.java b/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/selectors/TestModuleSelectorState.java
index 994773c9534..6b24c24db51 100644
--- a/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/selectors/TestModuleSelectorState.java
+++ b/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/ivyservice/resolveengine/graph/selectors/TestModuleSelectorState.java
@@ -24,6 +24,7 @@
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.strategy.VersionParser;
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.strategy.VersionSelector;
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.strategy.VersionSelectorScheme;
+import org.gradle.api.internal.attributes.ImmutableAttributes;
 import org.gradle.internal.component.model.DefaultComponentOverrideMetadata;
 import org.gradle.internal.component.model.IvyArtifactName;
 import org.gradle.internal.resolve.resolver.DependencyToComponentIdResolver;
@@ -86,7 +87,7 @@ private ComponentIdResolveResult doResolve(VersionSelector acceptor, VersionSele
         }
 
         BuildableComponentIdResolveResult result = new DefaultBuildableComponentIdResolveResult();
-        resolver.resolve(null, DefaultComponentOverrideMetadata.EMPTY, acceptor, rejector, result);
+        resolver.resolve(null, DefaultComponentOverrideMetadata.EMPTY, acceptor, rejector, result, ImmutableAttributes.EMPTY);
         return result;
     }
 
diff --git a/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/query/DefaultArtifactResolutionQueryTest.groovy b/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/query/DefaultArtifactResolutionQueryTest.groovy
index 8d95cc7e3ae..9ffaf372ead 100644
--- a/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/query/DefaultArtifactResolutionQueryTest.groovy
+++ b/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/query/DefaultArtifactResolutionQueryTest.groovy
@@ -126,7 +126,7 @@ class DefaultArtifactResolutionQueryTest extends Specification {
     }
 
     private def withArtifactResolutionInteractions(int numberOfComponentsToResolve = 1) {
-        1 * externalResolverFactory.createResolvers(_, _, _, _, _, _, _) >> repositoryChain
+        1 * externalResolverFactory.createResolvers(_, _, _, _, _, _) >> repositoryChain
         1 * repositoryChain.artifactResolver >> artifactResolver
         1 * repositoryChain.componentResolver >> componentMetaDataResolver
         def state = Mock(ComponentGraphResolveState)
diff --git a/platforms/software/ivy/build.gradle.kts b/platforms/software/ivy/build.gradle.kts
index acdc8a68dbd..b9d3b654cc4 100644
--- a/platforms/software/ivy/build.gradle.kts
+++ b/platforms/software/ivy/build.gradle.kts
@@ -68,7 +68,6 @@ dependencies {
     }
 }
 
-integTest.usesJavadocCodeSnippets = true
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/software/ivy/src/integTest/groovy/org/gradle/api/publish/ivy/IvyPublishJavaIntegTest.groovy b/platforms/software/ivy/src/integTest/groovy/org/gradle/api/publish/ivy/IvyPublishJavaIntegTest.groovy
index 8259ffa97b9..006cb4bbfdb 100644
--- a/platforms/software/ivy/src/integTest/groovy/org/gradle/api/publish/ivy/IvyPublishJavaIntegTest.groovy
+++ b/platforms/software/ivy/src/integTest/groovy/org/gradle/api/publish/ivy/IvyPublishJavaIntegTest.groovy
@@ -146,7 +146,6 @@ class IvyPublishJavaIntegTest extends AbstractIvyPublishIntegTest {
 
             artifacts {
                 implementation extraJar
-                archives extraJar
                 it."default" extraJar
             }
 
diff --git a/platforms/software/ivy/src/main/java/org/gradle/api/publish/ivy/plugins/IvyPublishPlugin.java b/platforms/software/ivy/src/main/java/org/gradle/api/publish/ivy/plugins/IvyPublishPlugin.java
index 8249ae0b801..9ac4191857c 100644
--- a/platforms/software/ivy/src/main/java/org/gradle/api/publish/ivy/plugins/IvyPublishPlugin.java
+++ b/platforms/software/ivy/src/main/java/org/gradle/api/publish/ivy/plugins/IvyPublishPlugin.java
@@ -21,7 +21,6 @@
 import org.gradle.api.NamedDomainObjectSet;
 import org.gradle.api.Plugin;
 import org.gradle.api.Project;
-import org.gradle.api.Task;
 import org.gradle.api.artifacts.repositories.ArtifactRepository;
 import org.gradle.api.artifacts.repositories.IvyArtifactRepository;
 import org.gradle.api.file.DirectoryProperty;
@@ -57,7 +56,6 @@
 import org.gradle.internal.artifacts.repositories.AuthenticationSupportedInternal;
 import org.gradle.internal.reflect.Instantiator;
 import org.gradle.internal.typeconversion.NotationParser;
-import org.gradle.api.internal.ConfigurationCacheDegradationController;
 import org.gradle.model.Path;
 
 import javax.inject.Inject;
@@ -65,6 +63,7 @@
 import java.util.concurrent.atomic.AtomicBoolean;
 
 import static org.apache.commons.lang3.StringUtils.capitalize;
+import static org.gradle.api.internal.ConfigurationCacheDegradation.requireDegradation;
 
 /**
  * Adds the ability to publish in the Ivy format to Ivy repositories.
@@ -90,10 +89,6 @@ public IvyPublishPlugin(Instantiator instantiator, ObjectFactory objectFactory,
         this.providerFactory = providerFactory;
     }
 
-    private ConfigurationCacheDegradationController getDegradationController(Task task) {
-        return ((ProjectInternal) task.getProject()).getServices().get(ConfigurationCacheDegradationController.class);
-    }
-
     @Override
     public void apply(final Project project) {
         project.getPluginManager().apply(PublishingPlugin.class);
@@ -148,7 +143,7 @@ private void createPublishToRepositoryTask(TaskContainer tasks, final IvyPublica
             publishTask.setGroup(PublishingPlugin.PUBLISH_TASK_GROUP);
             publishTask.setDescription("Publishes Ivy publication '" + publicationName + "' to Ivy repository '" + repositoryName + "'.");
         });
-        tasks.withType(PublishToIvyRepository.class).configureEach(t -> getDegradationController(t).requireConfigurationCacheDegradation(t, usingExplicitCredentials(t)));
+        tasks.withType(PublishToIvyRepository.class).configureEach(task -> requireDegradation(task, usingExplicitCredentials(task)));
 
         tasks.named(PublishingPlugin.PUBLISH_LIFECYCLE_TASK_NAME, task -> task.dependsOn(publishTaskName));
         tasks.named(publishAllToSingleRepoTaskName(repository), publish -> publish.dependsOn(publishTaskName));
diff --git a/platforms/software/maven/build.gradle.kts b/platforms/software/maven/build.gradle.kts
index fd97c05b164..1bf8c1fedf6 100644
--- a/platforms/software/maven/build.gradle.kts
+++ b/platforms/software/maven/build.gradle.kts
@@ -82,7 +82,6 @@ packageCycles {
     excludePatterns.add("org/gradle/api/artifacts/maven/**")
 }
 
-integTest.usesJavadocCodeSnippets = true
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/software/maven/src/main/java/org/gradle/api/publish/maven/plugins/MavenPublishPlugin.java b/platforms/software/maven/src/main/java/org/gradle/api/publish/maven/plugins/MavenPublishPlugin.java
index 9ae9aa2d4a1..13193e301f1 100644
--- a/platforms/software/maven/src/main/java/org/gradle/api/publish/maven/plugins/MavenPublishPlugin.java
+++ b/platforms/software/maven/src/main/java/org/gradle/api/publish/maven/plugins/MavenPublishPlugin.java
@@ -24,10 +24,9 @@
 import org.gradle.api.Task;
 import org.gradle.api.artifacts.repositories.MavenArtifactRepository;
 import org.gradle.api.file.DirectoryProperty;
-import org.gradle.api.internal.ConfigurationCacheDegradationController;
 import org.gradle.api.internal.artifacts.configurations.DependencyMetaDataProvider;
 import org.gradle.api.internal.file.FileResolver;
-import org.gradle.api.internal.project.ProjectInternal;
+import org.gradle.api.internal.provider.DefaultProvider;
 import org.gradle.api.internal.tasks.TaskDependencyFactory;
 import org.gradle.api.model.ObjectFactory;
 import org.gradle.api.provider.Provider;
@@ -55,6 +54,7 @@
 import java.util.Set;
 
 import static org.apache.commons.lang3.StringUtils.capitalize;
+import static org.gradle.api.internal.ConfigurationCacheDegradation.requireDegradation;
 
 /**
  * Adds the ability to publish in the Maven format to Maven repositories.
@@ -83,10 +83,6 @@ public MavenPublishPlugin(InstantiatorFactory instantiatorFactory, ObjectFactory
         this.taskDependencyFactory = taskDependencyFactory;
     }
 
-    private ConfigurationCacheDegradationController getDegradationController(Task task) {
-        return ((ProjectInternal) task.getProject()).getServices().get(ConfigurationCacheDegradationController.class);
-    }
-
     @Override
     public void apply(final Project project) {
         project.getPluginManager().apply(PublishingPlugin.class);
@@ -143,8 +139,8 @@ private void createPublishTasksForEachMavenRepo(final TaskContainer tasks, final
                 publishTask.setGroup(PublishingPlugin.PUBLISH_TASK_GROUP);
                 publishTask.setDescription("Publishes Maven publication '" + publicationName + "' to Maven repository '" + repositoryName + "'.");
             });
-            tasks.withType(PublishToMavenRepository.class).configureEach(t ->
-                getDegradationController(t).requireConfigurationCacheDegradation(t, usingExplicitCredentials(t))
+            tasks.withType(PublishToMavenRepository.class).configureEach(
+                task -> requireDegradation(task, usingExplicitCredentials(task))
             );
 
             publishLifecycleTask.configure(task -> task.dependsOn(publishTaskName));
@@ -153,7 +149,7 @@ private void createPublishTasksForEachMavenRepo(final TaskContainer tasks, final
     }
 
     private Provider<String> usingExplicitCredentials(PublishToMavenRepository task) {
-        return task.getProject().provider(() -> (AuthenticationSupportedInternal) task.getRepository())
+        return new DefaultProvider<>(() -> (AuthenticationSupportedInternal) task.getRepository())
                 .flatMap(AuthenticationSupportedInternal::isUsingCredentialsProvider)
                 .map(isUsingCredentialsProvider -> isUsingCredentialsProvider ? null : "Explicit credentials are unsupported with the Configuration Cache");
     }
diff --git a/platforms/software/platform-base/build.gradle.kts b/platforms/software/platform-base/build.gradle.kts
index b6f1cf8eaa0..1de67d077ef 100644
--- a/platforms/software/platform-base/build.gradle.kts
+++ b/platforms/software/platform-base/build.gradle.kts
@@ -44,8 +44,6 @@ packageCycles {
     excludePatterns.add("org/gradle/**")
 }
 
-integTest.usesJavadocCodeSnippets = true
-
 description = """Provides general purpose base types and interfaces for modeling projects, and provides runtime and language support."""
 tasks.isolatedProjectsIntegTest {
     enabled = false
diff --git a/platforms/software/platform-base/src/integTest/groovy/org/gradle/api/plugins/ArchivesConfigurationDeprecationIntegrationTest.groovy b/platforms/software/platform-base/src/integTest/groovy/org/gradle/api/plugins/ArchivesConfigurationDeprecationIntegrationTest.groovy
new file mode 100644
index 00000000000..a309b1ef1ec
--- /dev/null
+++ b/platforms/software/platform-base/src/integTest/groovy/org/gradle/api/plugins/ArchivesConfigurationDeprecationIntegrationTest.groovy
@@ -0,0 +1,133 @@
+/*
+ * Copyright 2025 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.gradle.api.plugins
+
+import org.gradle.integtests.fixtures.AbstractIntegrationSpec
+
+class ArchivesConfigurationDeprecationIntegrationTest extends AbstractIntegrationSpec {
+    def setup() {
+        buildFile """
+            plugins {
+                id("base")
+            }
+        """
+    }
+
+    def "deprecation when adding artifacts to the archives configuration"() {
+        buildFile """
+            task jar(type: Jar) {}
+
+            configurations {
+                archives {
+                    outgoing.artifact(tasks.jar)
+                }
+            }
+        """
+
+        expect:
+        executer.expectDocumentedDeprecationWarning(
+            "The archives configuration has been deprecated for artifact declaration. " +
+                "This will fail with an error in Gradle 10. " +
+                "Add artifacts as direct task dependencies of the 'assemble' task instead of declaring them in the archives configuration. " +
+                "Consult the upgrading guide for further information: https://docs.gradle.org/current/userguide/upgrading_version_9.html#sec:archives-configuration"
+        )
+        succeeds("assemble")
+    }
+
+    def "deprecation when consuming artifacts from the archives configuration"() {
+        settingsFile """
+            rootProject.name = "root"
+            include(":sub")
+        """
+        buildFile """
+            task jar(type: Jar) {}
+
+            configurations {
+                resolvable("resolvableArchives") {
+                    extendsFrom archives
+                }
+                archives {
+                    outgoing.artifact(tasks.jar)
+                }
+            }
+        """
+        buildFile("sub/build.gradle", """
+            configurations {
+                dependencyScope("consumeArchives")
+                resolvable("resolvableArchives") {
+                    extendsFrom consumeArchives
+                }
+            }
+
+            dependencies {
+                consumeArchives project(path: ":", configuration: "archives")
+            }
+
+            task("resolve") {
+                def resolvableArchives = configurations.resolvableArchives
+                inputs.files resolvableArchives
+                doLast {
+                    resolvableArchives.files.each { println it }
+                }
+            }
+        """)
+
+        expect:
+        executer.expectDocumentedDeprecationWarning(
+            "The archives configuration has been deprecated for artifact declaration. " +
+                "This will fail with an error in Gradle 10. " +
+                "Add artifacts as direct task dependencies of the 'assemble' task instead of declaring them in the archives configuration. " +
+                "Consult the upgrading guide for further information: https://docs.gradle.org/current/userguide/upgrading_version_9.html#sec:archives-configuration"
+        )
+        executer.expectDocumentedDeprecationWarning("The archives configuration has been deprecated for consumption. " +
+            "This will fail with an error in Gradle 10. " +
+            "For more information, please refer to https://docs.gradle.org/current/userguide/declaring_dependencies.html#sec:deprecated-configurations in the Gradle documentation."
+        )
+        succeeds(":sub:resolve")
+    }
+
+    def "error when adding dependencies to the archives configuration"() {
+        settingsFile """
+            include(":sub")
+        """
+        buildFile """
+            dependencies {
+                archives project(":sub")
+            }
+        """
+        file("sub").createDir()
+
+        expect:
+        fails("assemble")
+        failure.assertHasCause("Dependencies can not be declared against the `archives` configuration.")
+    }
+
+    def "error when resolving the archives configuration"() {
+        buildFile """
+            task("resolve") {
+                def archives = configurations.archives
+                doLast {
+                    archives.files.each { println it }
+                }
+            }
+        """
+
+        expect:
+        fails("resolve")
+        failure.assertHasCause("Resolving dependency configuration 'archives' is not allowed")
+    }
+}
diff --git a/platforms/software/platform-base/src/integTest/groovy/org/gradle/api/plugins/BasePluginIntegrationTest.groovy b/platforms/software/platform-base/src/integTest/groovy/org/gradle/api/plugins/BasePluginIntegrationTest.groovy
index 648e2a18448..f9d04efd749 100644
--- a/platforms/software/platform-base/src/integTest/groovy/org/gradle/api/plugins/BasePluginIntegrationTest.groovy
+++ b/platforms/software/platform-base/src/integTest/groovy/org/gradle/api/plugins/BasePluginIntegrationTest.groovy
@@ -127,6 +127,12 @@ class BasePluginIntegrationTest extends AbstractIntegrationSpec {
         """
 
         expect:
+        executer.expectDocumentedDeprecationWarning(
+            "The archives configuration has been deprecated for artifact declaration. " +
+                "This will fail with an error in Gradle 10. " +
+                "Add artifacts as direct task dependencies of the 'assemble' task instead of declaring them in the archives configuration. " +
+                "Consult the upgrading guide for further information: https://docs.gradle.org/current/userguide/upgrading_version_9.html#sec:archives-configuration"
+        )
         succeeds("assemble")
 
         executedAndNotSkipped(":jar2")
diff --git a/platforms/software/platform-base/src/integTest/groovy/org/gradle/language/base/AutoTestedSamplePlatformBaseIntegrationTest.groovy b/platforms/software/platform-base/src/integTest/groovy/org/gradle/language/base/AutoTestedSamplePlatformBaseIntegrationTest.groovy
deleted file mode 100644
index 0f2abefc0cc..00000000000
--- a/platforms/software/platform-base/src/integTest/groovy/org/gradle/language/base/AutoTestedSamplePlatformBaseIntegrationTest.groovy
+++ /dev/null
@@ -1,29 +0,0 @@
-/*
- * Copyright 2014 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.language.base
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.gradle.integtests.fixtures.UnsupportedWithConfigurationCache
-import org.junit.Test
-
-@UnsupportedWithConfigurationCache(because = "software model")
-class AutoTestedSamplePlatformBaseIntegrationTest extends AbstractAutoTestedSamplesTest {
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/platforms/software/platform-base/src/main/java/org/gradle/api/plugins/BasePlugin.java b/platforms/software/platform-base/src/main/java/org/gradle/api/plugins/BasePlugin.java
index fed6e159b55..a0a8bd0ba2e 100644
--- a/platforms/software/platform-base/src/main/java/org/gradle/api/plugins/BasePlugin.java
+++ b/platforms/software/platform-base/src/main/java/org/gradle/api/plugins/BasePlugin.java
@@ -20,13 +20,20 @@
 import org.gradle.api.Project;
 import org.gradle.api.artifacts.Configuration;
 import org.gradle.api.artifacts.Dependency;
+import org.gradle.api.artifacts.PublishArtifact;
+import org.gradle.api.internal.DomainObjectCollectionInternal;
 import org.gradle.api.internal.artifacts.configurations.RoleBasedConfigurationContainerInternal;
 import org.gradle.api.internal.plugins.BuildConfigurationRule;
 import org.gradle.api.internal.project.ProjectInternal;
 import org.gradle.api.plugins.internal.DefaultBasePluginExtension;
 import org.gradle.api.tasks.bundling.AbstractArchiveTask;
+import org.gradle.internal.Cast;
+import org.gradle.internal.deprecation.DeprecationLogger;
 import org.gradle.language.base.plugins.LifecycleBasePlugin;
 
+import static org.gradle.api.artifacts.Dependency.ARCHIVES_CONFIGURATION;
+import static org.gradle.api.internal.artifacts.configurations.ConfigurationRolesForMigration.CONSUMABLE_TO_RETIRED;
+
 /**
  * <p>A {@link org.gradle.api.Plugin} which defines a basic project lifecycle and some common convention properties.</p>
  *
@@ -72,8 +79,17 @@ private void configureConfigurations(final Project project) {
         RoleBasedConfigurationContainerInternal configurations = (RoleBasedConfigurationContainerInternal) project.getConfigurations();
         ((ProjectInternal) project).getInternalStatus().convention("integration");
 
-        final Configuration archivesConfiguration = configurations.consumableLocked(Dependency.ARCHIVES_CONFIGURATION, conf -> {
+        final Configuration archivesConfiguration = configurations.migratingLocked(ARCHIVES_CONFIGURATION, CONSUMABLE_TO_RETIRED, conf -> {
             conf.setDescription("Configuration for archive artifacts.");
+            DomainObjectCollectionInternal<PublishArtifact> artifacts = Cast.uncheckedCast(conf.getArtifacts());
+            artifacts.beforeCollectionChanges(artifact -> {
+                DeprecationLogger.deprecateConfiguration(ARCHIVES_CONFIGURATION)
+                    .forArtifactDeclaration()
+                    .withAdvice("Add artifacts as direct task dependencies of the 'assemble' task instead of declaring them in the " + ARCHIVES_CONFIGURATION + " configuration.")
+                    .willBecomeAnErrorInNextMajorGradleVersion()
+                    .withUpgradeGuideSection(9, "sec:archives-configuration")
+                    .nagUser();
+            });
         });
 
         configurations.consumableLocked(Dependency.DEFAULT_CONFIGURATION, conf -> {
diff --git a/platforms/software/plugins-distribution/build.gradle.kts b/platforms/software/plugins-distribution/build.gradle.kts
index 2842c0f03c7..8e1a28c3745 100644
--- a/platforms/software/plugins-distribution/build.gradle.kts
+++ b/platforms/software/plugins-distribution/build.gradle.kts
@@ -31,6 +31,7 @@ dependencies {
 
     implementation(projects.dependencyManagement)
     implementation(projects.fileCollections)
+    implementation(projects.logging)
     implementation(projects.modelCore)
     implementation(projects.platformBase)
 
@@ -45,7 +46,6 @@ dependencies {
     }
 }
 
-integTest.usesJavadocCodeSnippets = true
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/software/plugins-distribution/src/integTest/groovy/org/gradle/integtests/samples/AutoTestedSamplesPluginsDistributionIntegrationTest.groovy b/platforms/software/plugins-distribution/src/integTest/groovy/org/gradle/integtests/samples/AutoTestedSamplesPluginsDistributionIntegrationTest.groovy
deleted file mode 100644
index efac3f4e49b..00000000000
--- a/platforms/software/plugins-distribution/src/integTest/groovy/org/gradle/integtests/samples/AutoTestedSamplesPluginsDistributionIntegrationTest.groovy
+++ /dev/null
@@ -1,32 +0,0 @@
-/*
- * Copyright 2023 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.integtests.samples
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-/**
- * Runs samples contained in class-level javadoc comments in the `plugins-distribution` project.
- */
-class AutoTestedSamplesPluginsDistributionIntegrationTest extends AbstractAutoTestedSamplesTest {
-    @Test
-    void runSamples() {
-        // for debugging purposes you can restrict the tests samples to only a single class
-//        includeOnly '**/Test.java'
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/platforms/software/plugins-distribution/src/main/java/org/gradle/api/distribution/Distribution.java b/platforms/software/plugins-distribution/src/main/java/org/gradle/api/distribution/Distribution.java
index d410635f081..d74841ac935 100644
--- a/platforms/software/plugins-distribution/src/main/java/org/gradle/api/distribution/Distribution.java
+++ b/platforms/software/plugins-distribution/src/main/java/org/gradle/api/distribution/Distribution.java
@@ -75,7 +75,7 @@ public interface Distribution extends Named {
      *     }
      * }
      * </pre>
-     * The DSL inside the {@code contents\{} } block is the same DSL used for Copy tasks.
+     * The DSL inside the {@code contents{} } block is the same DSL used for Copy tasks.
      */
     CopySpec contents(Action<? super CopySpec> action);
 }
diff --git a/platforms/software/plugins-distribution/src/main/java/org/gradle/api/distribution/plugins/DistributionBasePlugin.java b/platforms/software/plugins-distribution/src/main/java/org/gradle/api/distribution/plugins/DistributionBasePlugin.java
index 95420e04e37..8c2b38daf64 100644
--- a/platforms/software/plugins-distribution/src/main/java/org/gradle/api/distribution/plugins/DistributionBasePlugin.java
+++ b/platforms/software/plugins-distribution/src/main/java/org/gradle/api/distribution/plugins/DistributionBasePlugin.java
@@ -38,6 +38,7 @@
 import org.gradle.api.tasks.bundling.AbstractArchiveTask;
 import org.gradle.api.tasks.bundling.Tar;
 import org.gradle.api.tasks.bundling.Zip;
+import org.gradle.internal.deprecation.DeprecationLogger;
 import org.gradle.internal.reflect.Instantiator;
 import org.gradle.util.internal.TextUtil;
 
@@ -125,8 +126,10 @@ private static void configureDistribution(
 
         // Build zips and tars by default when running the build-wide assemble task.
         PublishArtifactSet archivesArtifacts = project.getConfigurations().getByName(Dependency.ARCHIVES_CONFIGURATION).getArtifacts();
-        archivesArtifacts.add(new LazyPublishArtifact(zipTask, project.getFileResolver(), project.getTaskDependencyFactory()));
-        archivesArtifacts.add(new LazyPublishArtifact(tarTask, project.getFileResolver(), project.getTaskDependencyFactory()));
+        DeprecationLogger.whileDisabled(() -> {
+            archivesArtifacts.add(new LazyPublishArtifact(zipTask, project.getFileResolver(), project.getTaskDependencyFactory()));
+            archivesArtifacts.add(new LazyPublishArtifact(tarTask, project.getFileResolver(), project.getTaskDependencyFactory()));
+        });
     }
 
     /**
diff --git a/platforms/software/publish/build.gradle.kts b/platforms/software/publish/build.gradle.kts
index ce6e7267338..f238a55bdd2 100644
--- a/platforms/software/publish/build.gradle.kts
+++ b/platforms/software/publish/build.gradle.kts
@@ -39,7 +39,6 @@ dependencies {
     integTestDistributionRuntimeOnly(projects.distributionsCore)
 }
 
-integTest.usesJavadocCodeSnippets = true
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/software/publish/src/integTest/groovy/org/gradle/api/publish/AutoTestedSamplesPublishIntegrationTest.groovy b/platforms/software/publish/src/integTest/groovy/org/gradle/api/publish/AutoTestedSamplesPublishIntegrationTest.groovy
deleted file mode 100644
index a57c5e227ac..00000000000
--- a/platforms/software/publish/src/integTest/groovy/org/gradle/api/publish/AutoTestedSamplesPublishIntegrationTest.groovy
+++ /dev/null
@@ -1,29 +0,0 @@
-/*
- * Copyright 2012 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.api.publish
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesPublishIntegrationTest extends AbstractAutoTestedSamplesTest {
-
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-
-}
diff --git a/platforms/software/signing/build.gradle.kts b/platforms/software/signing/build.gradle.kts
index fda96aaf5e0..c7777e8c43b 100644
--- a/platforms/software/signing/build.gradle.kts
+++ b/platforms/software/signing/build.gradle.kts
@@ -56,11 +56,6 @@ packageCycles {
     excludePatterns.add("org/gradle/plugins/signing/**")
 }
 
-tasks {
-    integTest {
-        usesJavadocCodeSnippets = true
-    }
-}
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/software/signing/src/integTest/groovy/org/gradle/plugins/signing/AutoTestedSamplesSigningIntegrationTest.groovy b/platforms/software/signing/src/integTest/groovy/org/gradle/plugins/signing/AutoTestedSamplesSigningIntegrationTest.groovy
deleted file mode 100644
index b8850192784..00000000000
--- a/platforms/software/signing/src/integTest/groovy/org/gradle/plugins/signing/AutoTestedSamplesSigningIntegrationTest.groovy
+++ /dev/null
@@ -1,27 +0,0 @@
-/*
- * Copyright 2019 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.plugins.signing
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesSigningIntegrationTest extends AbstractAutoTestedSamplesTest {
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/platforms/software/signing/src/integTest/groovy/org/gradle/plugins/signing/SigningConfigurationsIntegrationSpec.groovy b/platforms/software/signing/src/integTest/groovy/org/gradle/plugins/signing/SigningConfigurationsIntegrationSpec.groovy
index e5ab8a9896a..361fe58104f 100644
--- a/platforms/software/signing/src/integTest/groovy/org/gradle/plugins/signing/SigningConfigurationsIntegrationSpec.groovy
+++ b/platforms/software/signing/src/integTest/groovy/org/gradle/plugins/signing/SigningConfigurationsIntegrationSpec.groovy
@@ -114,24 +114,26 @@ class SigningConfigurationsIntegrationSpec extends SigningIntegrationSpec {
     def "duplicated inputs are handled"() {
         given:
         buildFile << """
+            configurations {
+                consumable("jars") {
+                    // Add the jar file as an artifact using both the task as well as a mapped file provider
+                    outgoing.artifact(tasks.named("jar"))
+                    outgoing.artifact(tasks.named("jar").map { it.archiveFile })
+                }
+            }
             signing {
                 ${signingConfiguration()}
-                sign configurations.archives
+                sign configurations.jars
             }
 
             ${keyInfo.addAsPropertiesScript()}
-
-            artifacts {
-                // depend directly on 'jar' task in addition to dependency through 'archives'
-                archives jar
-            }
         """
 
         when:
         run "buildSignatures"
 
         then:
-        executedAndNotSkipped ":signArchives"
+        executedAndNotSkipped ":signJars"
 
         and:
         file("build", "libs", "sign-1.0.jar.asc").text
diff --git a/platforms/software/signing/src/integTest/groovy/org/gradle/plugins/signing/SigningDistributionsIntegrationSpec.groovy b/platforms/software/signing/src/integTest/groovy/org/gradle/plugins/signing/SigningDistributionsIntegrationSpec.groovy
index 9a1ddbfedd1..d5d8f2c6c29 100644
--- a/platforms/software/signing/src/integTest/groovy/org/gradle/plugins/signing/SigningDistributionsIntegrationSpec.groovy
+++ b/platforms/software/signing/src/integTest/groovy/org/gradle/plugins/signing/SigningDistributionsIntegrationSpec.groovy
@@ -25,13 +25,26 @@ class SigningDistributionsIntegrationSpec extends SigningIntegrationSpec {
     def "can sign a distribution zip when distribution plugin is applied after signing is configured"() {
         given:
         buildFile << """
+            configurations {
+                consumable("distributions") {
+                    outgoing.artifact(tasks.named("jar"))
+                }
+            }
+
             signing {
                 ${signingConfiguration()}
-                sign configurations.archives
+                sign configurations.distributions
             }
 
             apply plugin: "distribution"
 
+            configurations {
+                distributions {
+                    outgoing.artifact(tasks.named("distZip"))
+                    outgoing.artifact(tasks.named("distTar"))
+                }
+            }
+
             distributions {
                 main {
                     distributionBaseName = 'main'
@@ -40,14 +53,14 @@ class SigningDistributionsIntegrationSpec extends SigningIntegrationSpec {
             }
 
             ${keyInfo.addAsPropertiesScript()}
-            ${getJavadocAndSourceJarsScript("archives")}
+            ${getJavadocAndSourceJarsScript("distributions")}
         """
 
         when:
         run "buildSignatures"
 
         then:
-        executedAndNotSkipped ":signArchives"
+        executedAndNotSkipped ":signDistributions"
 
         and:
         file("build", "libs", "sign-1.0.jar.asc").text
diff --git a/platforms/software/signing/src/integTest/groovy/org/gradle/plugins/signing/SigningIntegrationSpec.groovy b/platforms/software/signing/src/integTest/groovy/org/gradle/plugins/signing/SigningIntegrationSpec.groovy
index ac8198015a0..b555eb500e0 100644
--- a/platforms/software/signing/src/integTest/groovy/org/gradle/plugins/signing/SigningIntegrationSpec.groovy
+++ b/platforms/software/signing/src/integTest/groovy/org/gradle/plugins/signing/SigningIntegrationSpec.groovy
@@ -131,11 +131,10 @@ abstract class SigningIntegrationSpec extends AbstractIntegrationSpec {
         } else {
             javaPluginConfig + """
                 configurations {
-                    $configurationName
-                }
-
-                artifacts {
-                    $configurationName sourcesJar, javadocJar
+                    $configurationName {
+                        outgoing.artifact(tasks.named("sourcesJar"))
+                        outgoing.artifact(tasks.named("javadocJar"))
+                    }
                 }
             """
         }
diff --git a/platforms/software/software-diagnostics/build.gradle.kts b/platforms/software/software-diagnostics/build.gradle.kts
index e6290c80c4e..ad059635c2d 100644
--- a/platforms/software/software-diagnostics/build.gradle.kts
+++ b/platforms/software/software-diagnostics/build.gradle.kts
@@ -37,7 +37,6 @@ dependencies {
 
     implementation(projects.functional)
     implementation(projects.loggingApi)
-    implementation(projects.serviceLookup)
 
     implementation(libs.commonsLang)
     implementation(libs.guava)
diff --git a/platforms/software/software-diagnostics/src/main/java/org/gradle/api/reporting/components/ComponentReport.java b/platforms/software/software-diagnostics/src/main/java/org/gradle/api/reporting/components/ComponentReport.java
index 26e49f207bc..1d3d3423970 100644
--- a/platforms/software/software-diagnostics/src/main/java/org/gradle/api/reporting/components/ComponentReport.java
+++ b/platforms/software/software-diagnostics/src/main/java/org/gradle/api/reporting/components/ComponentReport.java
@@ -17,10 +17,8 @@
 package org.gradle.api.reporting.components;
 
 import org.gradle.api.DefaultTask;
-import org.gradle.api.internal.ConfigurationCacheDegradationController;
 import org.gradle.api.internal.file.FileResolver;
 import org.gradle.api.internal.project.ProjectInternal;
-import org.gradle.api.internal.provider.Providers;
 import org.gradle.api.reporting.components.internal.ComponentReportRenderer;
 import org.gradle.api.reporting.components.internal.TypeAwareBinaryRenderer;
 import org.gradle.api.tasks.TaskAction;
@@ -41,6 +39,7 @@
 import java.util.ArrayList;
 import java.util.Collection;
 
+import static org.gradle.api.internal.ConfigurationCacheDegradation.requireDegradation;
 import static org.gradle.model.internal.type.ModelTypes.modelMap;
 
 /**
@@ -63,7 +62,7 @@ public abstract class ComponentReport extends DefaultTask {
 
     @Inject
     public ComponentReport() {
-        getServices().get(ConfigurationCacheDegradationController.class).requireConfigurationCacheDegradation(this, Providers.of("Task is not compatible with the Configuration Cache"));
+        requireDegradation(this, "Task is not compatible with the Configuration Cache");
     }
 
     @TaskAction
diff --git a/platforms/software/software-diagnostics/src/main/java/org/gradle/api/reporting/dependents/DependentComponentsReport.java b/platforms/software/software-diagnostics/src/main/java/org/gradle/api/reporting/dependents/DependentComponentsReport.java
index 21efd74b5c2..fe52e62497a 100644
--- a/platforms/software/software-diagnostics/src/main/java/org/gradle/api/reporting/dependents/DependentComponentsReport.java
+++ b/platforms/software/software-diagnostics/src/main/java/org/gradle/api/reporting/dependents/DependentComponentsReport.java
@@ -20,9 +20,7 @@
 import com.google.common.collect.Lists;
 import org.gradle.api.DefaultTask;
 import org.gradle.api.InvalidUserDataException;
-import org.gradle.api.internal.ConfigurationCacheDegradationController;
 import org.gradle.api.internal.project.ProjectInternal;
-import org.gradle.api.internal.provider.Providers;
 import org.gradle.api.reporting.dependents.internal.TextDependentComponentsReportRenderer;
 import org.gradle.api.tasks.Console;
 import org.gradle.api.tasks.TaskAction;
@@ -42,6 +40,7 @@
 import java.util.List;
 import java.util.Set;
 
+import static org.gradle.api.internal.ConfigurationCacheDegradation.requireDegradation;
 import static org.gradle.api.reporting.dependents.internal.DependentComponentsUtils.getAllComponents;
 import static org.gradle.api.reporting.dependents.internal.DependentComponentsUtils.getAllTestSuites;
 
@@ -58,7 +57,7 @@ public abstract class DependentComponentsReport extends DefaultTask {
 
     @Inject
     public DependentComponentsReport() {
-        getServices().get(ConfigurationCacheDegradationController.class).requireConfigurationCacheDegradation(this, Providers.of("Task is not compatible with the Configuration Cache"));
+        requireDegradation(this, "Task is not compatible with the Configuration Cache");
     }
 
     /**
diff --git a/platforms/software/testing-base-infrastructure/build.gradle.kts b/platforms/software/testing-base-infrastructure/build.gradle.kts
index af650f19351..bf69ffa4f21 100644
--- a/platforms/software/testing-base-infrastructure/build.gradle.kts
+++ b/platforms/software/testing-base-infrastructure/build.gradle.kts
@@ -42,7 +42,6 @@ packageCycles {
     excludePatterns.add("org/gradle/api/internal/tasks/testing/**")
 }
 
-integTest.usesJavadocCodeSnippets = true
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/DefaultTestFailure.java b/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/DefaultTestFailure.java
index af7c5d10159..73347fe1fb0 100644
--- a/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/DefaultTestFailure.java
+++ b/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/DefaultTestFailure.java
@@ -19,8 +19,8 @@
 import org.gradle.api.tasks.testing.TestFailure;
 import org.gradle.api.tasks.testing.TestFailureDetails;
 import org.gradle.internal.serialize.PlaceholderExceptionSupport;
-
 import org.jspecify.annotations.Nullable;
+
 import java.io.PrintWriter;
 import java.io.StringWriter;
 import java.util.Collections;
@@ -84,7 +84,7 @@ public static TestFailure fromTestFrameworkFailure(Throwable failure, @Nullable
     }
 
     public static TestFailure fromTestFrameworkStartupFailure(Throwable failure) {
-        TestFailureDetails details = new TestFrameworkFailureDetails(messageOf(failure), classNameOf(failure), stacktraceOf(failure));
+        TestFailureDetails details = new DefaultTestFailureDetails(messageOf(failure), classNameOf(failure), stacktraceOf(failure));
         return new DefaultTestFailure(failure, details, Collections.emptyList());
     }
 
diff --git a/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/TestFrameworkStartupFailureException.java b/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/TestFrameworkStartupFailureException.java
deleted file mode 100644
index 2e75ac4d51b..00000000000
--- a/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/TestFrameworkStartupFailureException.java
+++ /dev/null
@@ -1,51 +0,0 @@
-/*
- * Copyright 2025 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.api.internal.tasks.testing;
-
-import org.gradle.api.GradleException;
-import org.gradle.api.tasks.testing.TestFailure;
-import org.gradle.internal.exceptions.ResolutionProvider;
-import org.jspecify.annotations.NullMarked;
-
-import java.util.ArrayList;
-import java.util.Collections;
-import java.util.List;
-
-/**
- * {@link GradleException} thrown when a test framework completely fails to start.
- * <p>
- * This exception is used to provide additional information about the failure, including possible resolutions.
- */
-@NullMarked
-public final class TestFrameworkStartupFailureException extends GradleException implements ResolutionProvider {
-    private final List<String> resolutions;
-
-    public TestFrameworkStartupFailureException(TestFailure testFailure) {
-        super(testFailure.getDetails().getMessage() != null ? testFailure.getDetails().getMessage() : "", testFailure.getRawFailure());
-
-        if (testFailure.getRawFailure() instanceof ResolutionProvider && !((ResolutionProvider) testFailure.getRawFailure()).getResolutions().isEmpty()) {
-            this.resolutions = new ArrayList<>(((ResolutionProvider) testFailure.getRawFailure()).getResolutions());
-        } else {
-            this.resolutions = Collections.singletonList("Inspect your task configuration for errors.");
-        }
-    }
-
-    @Override
-    public List<String> getResolutions() {
-        return resolutions;
-    }
-}
diff --git a/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/TestFrameworkFailureDetails.java b/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/TestWorkerFailureException.java
similarity index 52%
rename from platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/TestFrameworkFailureDetails.java
rename to platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/TestWorkerFailureException.java
index 7b173cbf424..0e70f7ad7b4 100644
--- a/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/TestFrameworkFailureDetails.java
+++ b/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/TestWorkerFailureException.java
@@ -16,25 +16,27 @@
 
 package org.gradle.api.internal.tasks.testing;
 
-import org.gradle.api.tasks.testing.TestFailureDetails;
+import org.gradle.internal.exceptions.DefaultMultiCauseException;
 import org.jspecify.annotations.NullMarked;
 
+import java.util.List;
+
 /**
- * A {@link TestFailureDetails} that indicates a failure in the test framework itself, like
- * a missing test framework, that shouldn't be reported a <em>failure of a test or tests</em>, but rather as a
- * <em>Gradle test task failure</em>.
+ * Thrown when a test worker completely fails to start.
  * <p>
- * This need to be treated differently, so that the errors are more visible instead of being buried in the
- * test report.
+ * This exception is used to provide additional information about the failure, including possible resolutions.
  */
 @NullMarked
-public final class TestFrameworkFailureDetails extends DefaultTestFailureDetails {
-    public TestFrameworkFailureDetails(String message, String className, String stacktrace) {
-        super(message, className, stacktrace);
+public final class TestWorkerFailureException extends DefaultMultiCauseException {
+    private final List<String> resolutions;
+
+    public TestWorkerFailureException(String message, List<Throwable> causes, List<String> resolutions) {
+        super(message, causes);
+        this.resolutions = resolutions;
     }
 
     @Override
-    public boolean isStartupFailure() {
-        return true;
+    public List<String> getResolutions() {
+        return resolutions;
     }
 }
diff --git a/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/worker/TestEventSerializer.java b/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/worker/TestEventSerializer.java
index e3fa5541302..009de69e465 100644
--- a/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/worker/TestEventSerializer.java
+++ b/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/internal/tasks/testing/worker/TestEventSerializer.java
@@ -31,7 +31,6 @@
 import org.gradle.api.internal.tasks.testing.FileComparisonFailureDetails;
 import org.gradle.api.internal.tasks.testing.TestCompleteEvent;
 import org.gradle.api.internal.tasks.testing.TestFailureSerializationException;
-import org.gradle.api.internal.tasks.testing.TestFrameworkFailureDetails;
 import org.gradle.api.internal.tasks.testing.TestStartEvent;
 import org.gradle.api.tasks.testing.TestFailure;
 import org.gradle.api.tasks.testing.TestFailureDetails;
@@ -201,7 +200,6 @@ public TestFailure read(Decoder decoder) throws Exception {
 
             // assumption failure
             boolean isAssumptionFailure = decoder.readBoolean();
-            boolean isFrameworkFailure = decoder.readBoolean();
 
             // assertion failure
             boolean isAssertionFailure = decoder.readBoolean();
@@ -237,8 +235,6 @@ public TestFailure read(Decoder decoder) throws Exception {
                 details = new AssertionFailureDetails(message, className, stacktrace, expected, actual);
             } else if (isAssumptionFailure) {
                 details = new AssumptionFailureDetails(message, className, stacktrace);
-            } else if (isFrameworkFailure) {
-                details = new TestFrameworkFailureDetails(message, className, stacktrace);
             } else {
                 details = new DefaultTestFailureDetails(message, className, stacktrace);
             }
@@ -283,9 +279,6 @@ public void write(Encoder encoder, TestFailure value) throws Exception {
             // assumption failure
             encoder.writeBoolean(details.isAssumptionFailure());
 
-            // startup failure
-            encoder.writeBoolean(details.isStartupFailure());
-
             // assertion failure
             encoder.writeBoolean(details.isAssertionFailure());
             encoder.writeNullableString(details.getExpected());
diff --git a/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/tasks/testing/TestFailureDetails.java b/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/tasks/testing/TestFailureDetails.java
index ce30d75776a..9f3b5a39c5a 100644
--- a/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/tasks/testing/TestFailureDetails.java
+++ b/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/tasks/testing/TestFailureDetails.java
@@ -115,13 +115,4 @@ public interface TestFailureDetails {
      */
     boolean isAssumptionFailure();
 
-    /**
-     * Is this a failure that prevented any tests from running, like a testing framework availability failure?
-     *
-     * @return {@code true} if this is such a failure; {@code false} otherwise
-     * @since 9.0.0
-     */
-    default boolean isStartupFailure() {
-        return false;
-    }
 }
diff --git a/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/tasks/testing/TestResult.java b/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/tasks/testing/TestResult.java
index 7ca0599ecb2..018ee18d149 100644
--- a/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/tasks/testing/TestResult.java
+++ b/platforms/software/testing-base-infrastructure/src/main/java/org/gradle/api/tasks/testing/TestResult.java
@@ -74,6 +74,7 @@ enum ResultType {
      * @since 8.14
      */
     @Incubating
+    @Nullable
     TestFailure getAssumptionFailure();
 
     /**
diff --git a/platforms/software/testing-base/build.gradle.kts b/platforms/software/testing-base/build.gradle.kts
index cb466d2d0b8..2ff513e0a2c 100644
--- a/platforms/software/testing-base/build.gradle.kts
+++ b/platforms/software/testing-base/build.gradle.kts
@@ -16,7 +16,6 @@ dependencies {
     api(projects.coreApi)
     api(projects.enterpriseLogging)
     api(projects.stdlibJavaExtensions)
-    api(projects.logging)
     api(projects.loggingApi)
     api(projects.messaging)
     api(projects.native)
@@ -33,6 +32,7 @@ dependencies {
     api(libs.jspecify)
     api(libs.inject)
 
+    implementation(projects.logging)
     implementation(projects.baseServicesGroovy)
     implementation(projects.concurrent)
     implementation(projects.files)
@@ -77,7 +77,6 @@ packageCycles {
     excludePatterns.add("org/gradle/api/internal/tasks/testing/**")
 }
 
-integTest.usesJavadocCodeSnippets = true
 tasks.isolatedProjectsIntegTest {
     enabled = false
 }
diff --git a/platforms/software/testing-base/src/integTest/groovy/org/gradle/testing/AutoTestedSamplesTestingBaseIntegrationTest.groovy b/platforms/software/testing-base/src/integTest/groovy/org/gradle/testing/AutoTestedSamplesTestingBaseIntegrationTest.groovy
deleted file mode 100644
index 1b48d86eaf6..00000000000
--- a/platforms/software/testing-base/src/integTest/groovy/org/gradle/testing/AutoTestedSamplesTestingBaseIntegrationTest.groovy
+++ /dev/null
@@ -1,27 +0,0 @@
-/*
- * Copyright 2019 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.testing
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesTestingBaseIntegrationTest extends AbstractAutoTestedSamplesTest {
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/logging/TestCountLogger.java b/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/logging/TestCountLogger.java
index c1661e7b82f..c4d2fb8c5c4 100644
--- a/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/logging/TestCountLogger.java
+++ b/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/logging/TestCountLogger.java
@@ -16,7 +16,10 @@
 
 package org.gradle.api.internal.tasks.testing.logging;
 
+import org.gradle.api.internal.DocumentationRegistry;
+import org.gradle.api.internal.tasks.testing.TestWorkerFailureException;
 import org.gradle.api.tasks.testing.TestDescriptor;
+import org.gradle.api.tasks.testing.TestFailure;
 import org.gradle.api.tasks.testing.TestListener;
 import org.gradle.api.tasks.testing.TestResult;
 import org.gradle.internal.logging.progress.ProgressLogger;
@@ -25,6 +28,11 @@
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
+import java.util.ArrayList;
+import java.util.Collections;
+import java.util.List;
+import java.util.stream.Collectors;
+
 /**
  * Reports a live-updating total of tests run, failed and skipped.
  * <p>
@@ -32,6 +40,8 @@
  * <pre>
  * > :project-name:testTaskName > 6659 tests completed, 1 failed, 2 skipped
  * </pre>
+ *
+ * This logger also keeps track of whether there were any worker failures that make the overall test result incomplete.
  */
 public class TestCountLogger implements TestListener {
     private final ProgressLoggerFactory factory;
@@ -43,6 +53,7 @@ public class TestCountLogger implements TestListener {
     private long failedTests;
     private long skippedTests;
     private boolean hadFailures;
+    private List<TestFailure> workerFailures;
 
     public TestCountLogger(ProgressLoggerFactory factory) {
         this(factory, LoggerFactory.getLogger(TestCountLogger.class));
@@ -51,6 +62,7 @@ public TestCountLogger(ProgressLoggerFactory factory) {
     TestCountLogger(ProgressLoggerFactory factory, Logger logger) {
         this.factory = factory;
         this.logger = logger;
+        this.workerFailures = new ArrayList<>();
     }
 
     @Override
@@ -112,8 +124,19 @@ public void afterSuite(TestDescriptor suite, TestResult result) {
 
             if (result.getResultType() == TestResult.ResultType.FAILURE) {
                 hadFailures = true;
+                // TODO: Instead of assuming all failures at the root suite are worker failures, we should
+                // identify worker failures in the TestFailureDetails
+                workerFailures.addAll(result.getFailures());
             }
         } else {
+            // Looks like a test worker suite
+            // TODO: Instead of assuming all failures at this level are worker failures, we should
+            // identify worker failures in the TestFailureDetails
+            if (suite.getParent().getParent() == null) {
+                if (result.getResultType() == TestResult.ResultType.FAILURE) {
+                    workerFailures.addAll(result.getFailures());
+                }
+            }
             // Only count suites that can be attributed to a discovered class such as test class suites, explicit test suites,
             // parameterized tests, test templates, dynamic tests, etc, and ignore the "test worker" and root suites.
             if (suite.getClassName() != null) {
@@ -137,4 +160,25 @@ public long getTotalTests() {
     public long getTotalDiscoveredItems() {
         return totalDiscoveredItems;
     }
+
+    /**
+     * Checks if any test failures were reported during test worker startup and throws an exception if so.
+     */
+    public boolean hasWorkerFailures() {
+        return !workerFailures.isEmpty();
+    }
+
+    public void handleWorkerFailures() {
+        // TODO: We should expand this into different kinds of failures based on the situation we've detected.
+        // e.g., test workers can fail to start due to command-line misconfiguration
+        // or test workers can start, but fail to run any tests due to a bad classpath
+        // or test workers can start, run some tests and then fail due to OOM or System.exit(...)
+        //
+        // We currently treat all of these as the same kind of failure.
+        //
+        // It would be better to emit these as problems instead of packing everything into the exception.
+        throw new TestWorkerFailureException("Test process encountered an unexpected problem.",
+            workerFailures.stream().map(TestFailure::getRawFailure).collect(Collectors.toList()),
+            Collections.singletonList("Check common problems " + new DocumentationRegistry().getDocumentationFor("java_testing", "sec:java_testing_troubleshooting") + "."));
+    }
 }
diff --git a/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/processors/TestMainAction.java b/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/processors/TestMainAction.java
index df022a5692d..032d6e22ef9 100644
--- a/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/processors/TestMainAction.java
+++ b/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/processors/TestMainAction.java
@@ -65,9 +65,8 @@ public void run() {
                     }
                 });
             }
-        } catch (Throwable t) {
-            resultProcessor.failure(suite.getId(), DefaultTestFailure.fromTestFrameworkStartupFailure(t));
-            throw t;
+        } catch (Throwable ex) {
+            resultProcessor.failure(suite.getId(), DefaultTestFailure.fromTestFrameworkStartupFailure(ex));
         } finally {
             resultProcessor.completed(suite.getId(), new TestCompleteEvent(clock.getCurrentTime()));
         }
diff --git a/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/report/ClassPageRenderer.java b/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/report/ClassPageRenderer.java
index c1a7b11c0b3..12f6a8fe26f 100644
--- a/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/report/ClassPageRenderer.java
+++ b/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/report/ClassPageRenderer.java
@@ -29,6 +29,8 @@
 import java.util.Arrays;
 import java.util.List;
 
+import static org.gradle.reporting.HtmlWriterTools.addClipboardCopyButton;
+
 class ClassPageRenderer extends PageRenderer<ClassTestResults> {
     private final CodePanelRenderer codePanelRenderer = new CodePanelRenderer();
     private final TestResultsProvider resultsProvider;
@@ -97,8 +99,9 @@ private boolean methodNameColumnExists() {
     @Override
     protected void renderFailures(SimpleHtmlWriter htmlWriter) throws IOException {
         for (TestResult test : getResults().getFailures()) {
+            String testId = test.getId().toString();
             htmlWriter.startElement("div").attribute("class", "test")
-                .startElement("a").attribute("name", test.getId().toString()).characters("").endElement() //browsers dont understand <a name="..."/>
+                .startElement("a").attribute("name", testId).characters("").endElement() //browsers dont understand <a name="..."/>
                 .startElement("h3").attribute("class", test.getStatusClass()).characters(test.getDisplayName()).endElement();
             for (SerializableFailure failure : test.getFailures()) {
                 String message;
@@ -107,7 +110,7 @@ protected void renderFailures(SimpleHtmlWriter htmlWriter) throws IOException {
                 } else {
                     message = failure.getStackTrace();
                 }
-                codePanelRenderer.render(message, htmlWriter);
+                codePanelRenderer.render(new CodePanelRenderer.Data(message, "test-message-" + testId), htmlWriter);
             }
             htmlWriter.endElement();
         }
@@ -116,14 +119,15 @@ protected void renderFailures(SimpleHtmlWriter htmlWriter) throws IOException {
     @Override
     protected void renderIgnoredTests(SimpleHtmlWriter htmlWriter) throws IOException {
         for (TestResult test : getResults().getIgnored()) {
+            String testId = test.getId().toString();
             htmlWriter.startElement("div").attribute("class", "test")
-                .startElement("a").attribute("name", test.getId().toString()).characters("").endElement() //browsers dont understand <a name="..."/>
+                .startElement("a").attribute("name", testId).characters("").endElement() //browsers dont understand <a name="..."/>
                 .startElement("h3").attribute("class", test.getStatusClass()).characters(test.getDisplayName()).endElement();
 
             String whitespace = SystemProperties.getInstance().getLineSeparator() + SystemProperties.getInstance().getLineSeparator();
             for (SerializableFailure failure : test.getFailures()) {
                 String message = failure.getMessage() + whitespace + failure.getStackTrace();
-                codePanelRenderer.render(message, htmlWriter);
+                codePanelRenderer.render(new CodePanelRenderer.Data(message, "test-message-" + testId), htmlWriter);
             }
             htmlWriter.endElement();
         }
@@ -144,12 +148,15 @@ public void doExecute(SimpleHtmlWriter writer) throws IOException {
             addTab("Standard output", new ErroringAction<SimpleHtmlWriter>() {
                 @Override
                 protected void doExecute(SimpleHtmlWriter htmlWriter) throws IOException {
+                    String codeId = "class-stdout";
                     htmlWriter.startElement("span").attribute("class", "code")
                         .startElement("pre")
+                        .attribute("id", codeId)
                         .characters("");
                     resultsProvider.writeAllOutput(classId, TestOutputEvent.Destination.StdOut, htmlWriter);
-                        htmlWriter.endElement()
-                    .endElement();
+                        htmlWriter.endElement();
+                    addClipboardCopyButton(htmlWriter, codeId);
+                    htmlWriter.endElement();
                 }
             });
         }
@@ -157,12 +164,15 @@ protected void doExecute(SimpleHtmlWriter htmlWriter) throws IOException {
             addTab("Standard error", new ErroringAction<SimpleHtmlWriter>() {
                 @Override
                 protected void doExecute(SimpleHtmlWriter element) throws Exception {
+                    String codeId = "class-stderr";
                     element.startElement("span").attribute("class", "code")
-                    .startElement("pre")
+                        .startElement("pre")
+                        .attribute("id", codeId)
                         .characters("");
                     resultsProvider.writeAllOutput(classId, TestOutputEvent.Destination.StdErr, element);
-                    element.endElement()
-                    .endElement();
+                    element.endElement();
+                    addClipboardCopyButton(element, codeId);
+                    element.endElement();
                 }
             });
         }
diff --git a/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/report/generic/PerRootTabRenderer.java b/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/report/generic/PerRootTabRenderer.java
index c84fda7d5c7..3ff4afa7ad2 100644
--- a/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/report/generic/PerRootTabRenderer.java
+++ b/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/report/generic/PerRootTabRenderer.java
@@ -37,6 +37,9 @@
 import java.time.ZoneId;
 import java.time.format.DateTimeFormatter;
 import java.util.List;
+import java.util.Locale;
+
+import static org.gradle.reporting.HtmlWriterTools.addClipboardCopyButton;
 
 public abstract class PerRootTabRenderer extends ReportRenderer<TestTreeModel, SimpleHtmlWriter> {
     protected final int rootIndex;
@@ -144,7 +147,7 @@ private static String getFormattedDuration(SerializableTestResult testResult) {
             return TimeFormatting.formatDurationVeryTerse(testResult.getDuration());
         }
 
-        private static void renderLeafDetails(TestTreeModel.PerRootInfo info, SimpleHtmlWriter htmlWriter) throws IOException {
+        private void renderLeafDetails(TestTreeModel.PerRootInfo info, SimpleHtmlWriter htmlWriter) throws IOException {
             if (info.getResult().getResultType() != TestResult.ResultType.SUCCESS && !info.getResult().getFailures().isEmpty()) {
                 htmlWriter.startElement("div").attribute("class", "result-details");
 
@@ -152,15 +155,16 @@ private static void renderLeafDetails(TestTreeModel.PerRootInfo info, SimpleHtml
                     info.getResult().getResultType() == TestResult.ResultType.FAILURE ? "Failure details" : "Skip details"
                 ).endElement();
 
+                String failureOutputId = "root-" + rootIndex + "-test-failure-" + info.getResult().getName();
                 htmlWriter.startElement("span").attribute("class", "code")
                     .startElement("pre")
+                    .attribute("id", failureOutputId)
                     .characters("");
                 for (SerializableFailure failure : info.getResult().getFailures()) {
                     htmlWriter.characters(failure.getStackTrace() + "\n");
                 }
-                htmlWriter.endElement()
-                    .endElement();
-
+                htmlWriter.endElement();
+                addClipboardCopyButton(htmlWriter, failureOutputId);
                 htmlWriter.endElement();
             }
         }
@@ -251,14 +255,17 @@ public ForOutput(int rootIndex, SerializableTestResultStore.OutputReader outputR
 
         @Override
         protected void render(TestTreeModel.PerRootInfo info, SimpleHtmlWriter htmlWriter) throws IOException {
+            String outputId = "root-" + rootIndex + "-test-" + destination.name().toLowerCase(Locale.ROOT) + "-" + info.getResult().getName();
             htmlWriter.startElement("span").attribute("class", "code")
                 .startElement("pre")
+                .attribute("id", outputId)
                 .characters("");
             try (Reader reader = outputReader.getOutput(info.getOutputId(), destination)) {
                 CharStreams.copy(reader, htmlWriter);
             }
-            htmlWriter.endElement()
-                .endElement();
+            htmlWriter.endElement();
+            addClipboardCopyButton(htmlWriter, outputId);
+            htmlWriter.endElement();
         }
     }
 
diff --git a/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/results/DefaultTestResult.java b/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/results/DefaultTestResult.java
index b59eb800d02..ac0a187e2dd 100644
--- a/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/results/DefaultTestResult.java
+++ b/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/results/DefaultTestResult.java
@@ -20,12 +20,14 @@
 import org.gradle.api.tasks.testing.TestResult;
 import org.gradle.internal.InternalTransformer;
 import org.gradle.util.internal.CollectionUtils;
+import org.jspecify.annotations.Nullable;
 
 import java.io.Serializable;
 import java.util.List;
 
 public class DefaultTestResult implements TestResult, Serializable {
     private final List<TestFailure> failures;
+    @Nullable
     private final TestFailure assumptionFailure;
     private final ResultType resultType;
     private final long startTime;
@@ -38,7 +40,7 @@ public DefaultTestResult(TestState state) {
         this(state.resultType, state.getStartTime(), state.getEndTime(), state.testCount, state.successfulCount, state.failedCount, state.failures, state.assumptionFailure);
     }
 
-    public DefaultTestResult(ResultType resultType, long startTime, long endTime, long testCount, long successfulCount, long failedCount, List<TestFailure> failures, TestFailure assumptionFailure) {
+    public DefaultTestResult(ResultType resultType, long startTime, long endTime, long testCount, long successfulCount, long failedCount, List<TestFailure> failures, @Nullable TestFailure assumptionFailure) {
         this.resultType = resultType;
         this.startTime = startTime;
         this.endTime = endTime;
@@ -60,6 +62,7 @@ public Throwable getException() {
     }
 
     @Override
+    @Nullable
     public TestFailure getAssumptionFailure() {
         return assumptionFailure;
     }
diff --git a/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/results/StateTrackingTestResultProcessor.java b/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/results/StateTrackingTestResultProcessor.java
index 2c0c0d01d5a..628b56cd968 100644
--- a/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/results/StateTrackingTestResultProcessor.java
+++ b/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/results/StateTrackingTestResultProcessor.java
@@ -19,7 +19,6 @@
 import org.gradle.api.internal.tasks.testing.DecoratingTestDescriptor;
 import org.gradle.api.internal.tasks.testing.TestCompleteEvent;
 import org.gradle.api.internal.tasks.testing.TestDescriptorInternal;
-import org.gradle.api.internal.tasks.testing.TestFrameworkStartupFailureException;
 import org.gradle.api.internal.tasks.testing.TestResultProcessor;
 import org.gradle.api.internal.tasks.testing.TestStartEvent;
 import org.gradle.api.tasks.testing.TestFailure;
@@ -106,16 +105,7 @@ public final void failure(Object testId, TestFailure testFailure) {
                     "Received a failure event for test with unknown id '%s'. Registered test ids: '%s'",
                     testId, executing.keySet()));
         }
-        if (testFailure.getDetails().isStartupFailure()) {
-            testState.failures.add(testFailure);
-            /*
-             * This is a special case of test failure where the testing framework has completely failed to start up.
-             * We want to treat this not as a test failure, but as a TASK failure, as it indicates a task misconfiguration.
-             * We need to throw an exception here and abort normal failure processing so that this information
-             * isn't buried in the typical test results report.
-             */
-            throw new TestFrameworkStartupFailureException(testFailure);
-        } else if (testFailure.getDetails().isAssumptionFailure()) {
+        if (testFailure.getDetails().isAssumptionFailure()) {
             testState.assumptionFailure = testFailure;
         } else {
             testState.failures.add(testFailure);
diff --git a/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/results/TestState.java b/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/results/TestState.java
index 97933145d8d..f818ea693ee 100644
--- a/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/results/TestState.java
+++ b/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/results/TestState.java
@@ -21,6 +21,7 @@
 import org.gradle.api.internal.tasks.testing.TestStartEvent;
 import org.gradle.api.tasks.testing.TestFailure;
 import org.gradle.api.tasks.testing.TestResult;
+import org.jspecify.annotations.Nullable;
 
 import java.util.ArrayList;
 import java.util.List;
@@ -32,6 +33,7 @@ public class TestState {
     private final Map<Object, TestState> executing;
     public boolean failedChild;
     public List<TestFailure> failures = new ArrayList<TestFailure>();
+    @Nullable
     public TestFailure assumptionFailure = null;
     public long testCount;
     public long successfulCount;
diff --git a/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/worker/ForkingTestClassProcessor.java b/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/worker/ForkingTestClassProcessor.java
index 94f6dede22e..577adb2978b 100644
--- a/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/worker/ForkingTestClassProcessor.java
+++ b/platforms/software/testing-base/src/main/java/org/gradle/api/internal/tasks/testing/worker/ForkingTestClassProcessor.java
@@ -17,7 +17,6 @@
 package org.gradle.api.internal.tasks.testing.worker;
 
 import org.gradle.api.Action;
-import org.gradle.api.internal.DocumentationRegistry;
 import org.gradle.api.internal.tasks.testing.TestClassProcessor;
 import org.gradle.api.internal.tasks.testing.TestClassRunInfo;
 import org.gradle.api.internal.tasks.testing.TestResultProcessor;
@@ -27,8 +26,8 @@
 import org.gradle.internal.remote.ObjectConnection;
 import org.gradle.internal.work.WorkerLeaseRegistry;
 import org.gradle.internal.work.WorkerThreadRegistry;
-import org.gradle.process.ProcessExecutionException;
 import org.gradle.process.JavaForkOptions;
+import org.gradle.process.ProcessExecutionException;
 import org.gradle.process.internal.worker.WorkerProcess;
 import org.gradle.process.internal.worker.WorkerProcessBuilder;
 import org.gradle.process.internal.worker.WorkerProcessFactory;
@@ -50,7 +49,6 @@ public class ForkingTestClassProcessor implements TestClassProcessor {
     private WorkerProcess workerProcess;
     private TestResultProcessor resultProcessor;
     private WorkerLeaseRegistry.WorkerLeaseCompletion completion;
-    private final DocumentationRegistry documentationRegistry;
     private boolean stoppedNow;
     private final Set<Throwable> unrecoverableExceptions = new HashSet<>();
 
@@ -61,8 +59,7 @@ public ForkingTestClassProcessor(
         WorkerTestClassProcessorFactory processorFactory,
         JavaForkOptions options,
         ForkedTestClasspath classpath,
-        Action<WorkerProcessBuilder> buildConfigAction,
-        DocumentationRegistry documentationRegistry
+        Action<WorkerProcessBuilder> buildConfigAction
     ) {
         this.workerThreadRegistry = workerThreadRegistry;
         this.workerFactory = workerFactory;
@@ -70,7 +67,6 @@ public ForkingTestClassProcessor(
         this.options = options;
         this.classpath = classpath;
         this.buildConfigAction = buildConfigAction;
-        this.documentationRegistry = documentationRegistry;
     }
 
     @Override
@@ -157,9 +153,7 @@ public void stop() {
             }
         } catch (ProcessExecutionException e) {
             if (!stoppedNow) {
-                throw new ProcessExecutionException(e.getMessage()
-                    + "\nThis problem might be caused by incorrect test process configuration."
-                    + "\n" + documentationRegistry.getDocumentationRecommendationFor("on test execution", "java_testing", "sec:test_execution"), e.getCause());
+                throw e;
             }
         } finally {
             if (completion != null) {
diff --git a/platforms/software/testing-base/src/main/java/org/gradle/api/tasks/testing/AbstractTestTask.java b/platforms/software/testing-base/src/main/java/org/gradle/api/tasks/testing/AbstractTestTask.java
index 1c98267204a..1ee979479d0 100644
--- a/platforms/software/testing-base/src/main/java/org/gradle/api/tasks/testing/AbstractTestTask.java
+++ b/platforms/software/testing-base/src/main/java/org/gradle/api/tasks/testing/AbstractTestTask.java
@@ -529,7 +529,11 @@ public void executeTests() {
 
     private void handleCollectedResults(TestCountLogger testCountLogger) {
         if (testCountLogger.hadFailures()) {
-            handleTestFailures();
+            if (testCountLogger.hasWorkerFailures()) {
+                testCountLogger.handleWorkerFailures();
+            } else {
+                handleTestFailures();
+            }
         } else if (testCountLogger.getTotalTests() == 0) {
             // No tests were executed, the following rules apply:
             // - If there are no filters, and no tests or test suites were discovered, fail
diff --git a/platforms/software/testing-base/src/main/resources/org/gradle/api/internal/tasks/testing/report/generic/style.css b/platforms/software/testing-base/src/main/resources/org/gradle/api/internal/tasks/testing/report/generic/style.css
index dc1c0d7046e..16ce84b684a 100644
--- a/platforms/software/testing-base/src/main/resources/org/gradle/api/internal/tasks/testing/report/generic/style.css
+++ b/platforms/software/testing-base/src/main/resources/org/gradle/api/internal/tasks/testing/report/generic/style.css
@@ -104,3 +104,16 @@ .metadata a {
 .metadata .unrenderable {
     color: darkred;
 }
+
+.code {
+    position: relative;
+}
+
+.clipboard-copy-btn {
+    position: absolute;
+    top: 8px;
+    right: 8px;
+    padding: 4px 8px;
+    font-size: 0.9em;
+    cursor: pointer;
+}
diff --git a/platforms/software/testing-base/src/main/resources/org/gradle/api/internal/tasks/testing/report/style.css b/platforms/software/testing-base/src/main/resources/org/gradle/api/internal/tasks/testing/report/style.css
index 3dc4913e7a0..ccb271c0d28 100644
--- a/platforms/software/testing-base/src/main/resources/org/gradle/api/internal/tasks/testing/report/style.css
+++ b/platforms/software/testing-base/src/main/resources/org/gradle/api/internal/tasks/testing/report/style.css
@@ -82,3 +82,16 @@ ul.linkList li {
     list-style: none;
     margin-bottom: 5px;
 }
+
+.code {
+    position: relative;
+}
+
+.clipboard-copy-btn {
+    position: absolute;
+    top: 8px;
+    right: 8px;
+    padding: 4px 8px;
+    font-size: 0.9em;
+    cursor: pointer;
+}
diff --git a/platforms/software/testing-base/src/test/groovy/org/gradle/api/internal/tasks/testing/logging/TestCountLoggerTest.groovy b/platforms/software/testing-base/src/test/groovy/org/gradle/api/internal/tasks/testing/logging/TestCountLoggerTest.groovy
index 0b6b3dca4b2..165a8849afa 100644
--- a/platforms/software/testing-base/src/test/groovy/org/gradle/api/internal/tasks/testing/logging/TestCountLoggerTest.groovy
+++ b/platforms/software/testing-base/src/test/groovy/org/gradle/api/internal/tasks/testing/logging/TestCountLoggerTest.groovy
@@ -16,19 +16,24 @@
 
 package org.gradle.api.internal.tasks.testing.logging
 
-import org.gradle.internal.logging.progress.ProgressLoggerFactory
-import org.gradle.internal.logging.progress.ProgressLogger
+import org.gradle.api.internal.tasks.testing.TestWorkerFailureException
+import org.gradle.api.internal.tasks.testing.results.DefaultTestResult
 import org.gradle.api.tasks.testing.TestDescriptor
+import org.gradle.api.tasks.testing.TestFailure
 import org.gradle.api.tasks.testing.TestResult
+import org.gradle.internal.logging.progress.ProgressLogger
+import org.gradle.internal.logging.progress.ProgressLoggerFactory
+import org.gradle.util.internal.TextUtil
 import org.slf4j.Logger
-
 import spock.lang.Specification
-import org.gradle.util.internal.TextUtil
 
 class TestCountLoggerTest extends Specification {
     private final ProgressLoggerFactory factory = Mock()
     private final ProgressLogger progressLogger = Mock()
-    private final TestDescriptor rootSuite = suite(true)
+    private final TestDescriptor rootSuite = Stub() {
+        getParent() >> null
+        getClassName() >> null
+    }
     private final Logger errorLogger = Mock()
     private final TestCountLogger logger = new TestCountLogger(factory, errorLogger)
     private final String sep = TextUtil.platformLineSeparator
@@ -97,7 +102,10 @@ class TestCountLoggerTest extends Specification {
     }
 
     def ignoresSuitesOtherThanTheRootSuite() {
-        TestDescriptor suite = suite()
+        TestDescriptor suite = Stub() {
+            getParent() >> rootSuite
+            getClassName() >> 'not-root'
+        }
 
         logger.beforeSuite(rootSuite)
 
@@ -137,16 +145,31 @@ class TestCountLoggerTest extends Specification {
         logger.totalTests == 2
     }
 
-    private test() {
-        [:] as TestDescriptor
+    def "discover worker failures"() {
+        when:
+        logger.beforeSuite(rootSuite)
+        logger.afterSuite(rootSuite, result(true, 5))
+
+        then:
+        logger.hadFailures()
+        logger.hasWorkerFailures()
+
+        when:
+        logger.handleWorkerFailures()
+        then:
+        def e = thrown(TestWorkerFailureException)
+        e.getCauses().size() == 5
     }
 
-    private suite(boolean root = false) {
-        [getParent: {root ? null : [:] as TestDescriptor}, getClassName: {root ? null : ''}] as TestDescriptor
+    private test() {
+        [:] as TestDescriptor
     }
 
-    private result(boolean failed = false) {
-        [getTestCount: { 1L }, getFailedTestCount: { failed ? 1L : 0L }, getSkippedTestCount: { 0L },
-                getResultType: { failed ? TestResult.ResultType.FAILURE : TestResult.ResultType.SUCCESS }] as TestResult
+    private result(boolean failed = false, int failureCount = 1) {
+        if (failed) {
+            List<TestFailure> failures = (1..failureCount).collect {Mock(TestFailure) }
+            return new DefaultTestResult(TestResult.ResultType.FAILURE, 0, 0, 1, 0, 1, failures, null)
+        }
+        return new DefaultTestResult(TestResult.ResultType.SUCCESS, 0, 0, 1, 1, 0, [], null)
     }
 }
diff --git a/platforms/software/testing-base/src/test/groovy/org/gradle/api/internal/tasks/testing/processors/TestMainActionTest.groovy b/platforms/software/testing-base/src/test/groovy/org/gradle/api/internal/tasks/testing/processors/TestMainActionTest.groovy
index 7b939c42e77..86259249005 100644
--- a/platforms/software/testing-base/src/test/groovy/org/gradle/api/internal/tasks/testing/processors/TestMainActionTest.groovy
+++ b/platforms/software/testing-base/src/test/groovy/org/gradle/api/internal/tasks/testing/processors/TestMainActionTest.groovy
@@ -17,6 +17,7 @@ package org.gradle.api.internal.tasks.testing.processors
 
 import org.gradle.api.internal.tasks.testing.TestClassProcessor
 import org.gradle.api.internal.tasks.testing.TestResultProcessor
+import org.gradle.api.tasks.testing.TestFailure
 import org.gradle.internal.time.MockClock
 import org.gradle.internal.work.WorkerLeaseRegistry
 import org.gradle.internal.work.WorkerLeaseService
@@ -71,15 +72,12 @@ class TestMainActionTest extends Specification {
         1 * workerLeaseService.blocking(_) >> { Runnable runnable -> runnable.run() }
         1 * processor.stop()
         then:
-        1 * resultProcessor.failure(!null, !null)
+        1 * resultProcessor.failure(!null, { TestFailure f -> f.rawFailure == failure })
         1 * resultProcessor.completed(!null, !null)
 
         0 * resultProcessor._
         0 * detector._
         0 * processor._
-
-        def exception = thrown(RuntimeException)
-        exception == failure
     }
 
 
@@ -95,15 +93,12 @@ class TestMainActionTest extends Specification {
         then:
         1 * processor.startProcessing(!null) >> { throw failure }
         then:
-        1 * resultProcessor.failure(!null, !null)
+        1 * resultProcessor.failure(!null, { TestFailure f -> f.rawFailure == failure })
         1 * resultProcessor.completed(!null, !null)
 
         0 * resultProcessor._
         0 * detector._
         0 * processor._
-
-        def exception = thrown(RuntimeException)
-        exception == failure
     }
 
     def 'fires end events when end processing fails'() {
@@ -123,14 +118,11 @@ class TestMainActionTest extends Specification {
         1 * workerLeaseService.blocking(_) >> { Runnable runnable -> runnable.run() }
         1 * processor.stop() >> { throw failure }
         then:
-        1 * resultProcessor.failure(!null, !null)
+        1 * resultProcessor.failure(!null, { TestFailure f -> f.rawFailure == failure })
         1 * resultProcessor.completed(!null, !null)
 
         0 * resultProcessor._
         0 * detector._
         0 * processor._
-
-        def exception = thrown(RuntimeException)
-        exception == failure
     }
 }
diff --git a/platforms/software/testing-base/src/test/groovy/org/gradle/api/internal/tasks/testing/worker/ForkingTestClassProcessorTest.groovy b/platforms/software/testing-base/src/test/groovy/org/gradle/api/internal/tasks/testing/worker/ForkingTestClassProcessorTest.groovy
index 1a068157589..8c36cbcab10 100644
--- a/platforms/software/testing-base/src/test/groovy/org/gradle/api/internal/tasks/testing/worker/ForkingTestClassProcessorTest.groovy
+++ b/platforms/software/testing-base/src/test/groovy/org/gradle/api/internal/tasks/testing/worker/ForkingTestClassProcessorTest.groovy
@@ -18,7 +18,6 @@ package org.gradle.api.internal.tasks.testing.worker
 
 import com.google.common.collect.ImmutableList
 import org.gradle.api.Action
-import org.gradle.api.internal.DocumentationRegistry
 import org.gradle.api.internal.tasks.testing.TestClassRunInfo
 import org.gradle.api.internal.tasks.testing.WorkerTestClassProcessorFactory
 import org.gradle.internal.exceptions.DefaultMultiCauseException
@@ -177,7 +176,7 @@ class ForkingTestClassProcessorTest extends Specification {
     ) {
         return new ForkingTestClassProcessor(
             workerLeaseRegistry, workerProcessFactory, Mock(WorkerTestClassProcessorFactory),
-            Stub(JavaForkOptions), classpath, Mock(Action), Mock(DocumentationRegistry)
+            Stub(JavaForkOptions), classpath, Mock(Action)
         )
     }
 }
diff --git a/platforms/software/version-control/src/main/java/org/gradle/vcs/internal/resolver/VcsDependencyResolver.java b/platforms/software/version-control/src/main/java/org/gradle/vcs/internal/resolver/VcsDependencyResolver.java
index 488f1ecfda1..d14b5a68767 100644
--- a/platforms/software/version-control/src/main/java/org/gradle/vcs/internal/resolver/VcsDependencyResolver.java
+++ b/platforms/software/version-control/src/main/java/org/gradle/vcs/internal/resolver/VcsDependencyResolver.java
@@ -25,6 +25,7 @@
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.ComponentResolvers;
 import org.gradle.api.internal.artifacts.ivyservice.ivyresolve.strategy.VersionSelector;
 import org.gradle.api.internal.artifacts.ivyservice.projectmodule.LocalComponentRegistry;
+import org.gradle.api.internal.attributes.ImmutableAttributes;
 import org.gradle.api.internal.component.ArtifactType;
 import org.gradle.initialization.definition.DefaultInjectedPluginDependency;
 import org.gradle.internal.Actions;
@@ -85,7 +86,7 @@ public VcsDependencyResolver(LocalComponentRegistry localComponentRegistry, VcsR
     }
 
     @Override
-    public void resolve(ComponentSelector selector, ComponentOverrideMetadata overrideMetadata, VersionSelector acceptor, VersionSelector rejector, BuildableComponentIdResolveResult result) {
+    public void resolve(ComponentSelector selector, ComponentOverrideMetadata overrideMetadata, VersionSelector acceptor, VersionSelector rejector, BuildableComponentIdResolveResult result, ImmutableAttributes consumerAttributes) {
         if (selector instanceof ModuleComponentSelector) {
             final ModuleComponentSelector depSelector = (ModuleComponentSelector) selector;
             VersionControlSpec spec = vcsResolver.locateVcsFor(depSelector);
diff --git a/released-versions.json b/released-versions.json
index 16b1db6026b..d4dea599ab1 100644
--- a/released-versions.json
+++ b/released-versions.json
@@ -1,7 +1,7 @@
 {
   "latestReleaseSnapshot": {
-    "version": "9.0.0-20250618012308+0000",
-    "buildTime": "20250618012308+0000"
+    "version": "9.0.0-20250703012944+0000",
+    "buildTime": "20250703012944+0000"
   },
   "latestRc": {
     "version": "9.0.0-rc-1",
diff --git a/subprojects/core-api/build.gradle.kts b/subprojects/core-api/build.gradle.kts
index 4a7ca8aa1cd..f2494fc45a2 100644
--- a/subprojects/core-api/build.gradle.kts
+++ b/subprojects/core-api/build.gradle.kts
@@ -59,7 +59,8 @@ strictCompile {
     ignoreRawTypes() // raw types used in public API
 }
 
-integTest.usesJavadocCodeSnippets = true
+// AutoTestedSamplesCoreApiIntegrationTest includes customized test logic, so automatic auto testing samples generation is not needed (and would fail) in this project
+integTest.generateDefaultAutoTestedSamplesTest = false
 testFilesCleanup.reportOnly = true
 tasks.isolatedProjectsIntegTest {
     enabled = false
diff --git a/subprojects/core-api/src/main/java/org/gradle/api/Project.java b/subprojects/core-api/src/main/java/org/gradle/api/Project.java
index 3e8df294ba9..cd0ee6af5ef 100644
--- a/subprojects/core-api/src/main/java/org/gradle/api/Project.java
+++ b/subprojects/core-api/src/main/java/org/gradle/api/Project.java
@@ -1556,7 +1556,6 @@ void afterEvaluate(@DelegatesTo(Project.class)
      * @return the dependency factory. Never returns null.
      * @since 7.6
      */
-    @Incubating
     DependencyFactory getDependencyFactory();
 
     /**
diff --git a/subprojects/core-api/src/main/java/org/gradle/api/initialization/ProjectDescriptor.java b/subprojects/core-api/src/main/java/org/gradle/api/initialization/ProjectDescriptor.java
index 3443572b30b..13e73fd12a8 100644
--- a/subprojects/core-api/src/main/java/org/gradle/api/initialization/ProjectDescriptor.java
+++ b/subprojects/core-api/src/main/java/org/gradle/api/initialization/ProjectDescriptor.java
@@ -56,8 +56,11 @@ public interface ProjectDescriptor {
 
     /**
      * Sets the project directory of this project.
+     * <p>
+     * Gradle expects project directories to exist and be writable.
+     * </p>
      *
-     * @param dir The new project directory. Should not be null.
+     * @param dir The new project directory. Should not be null, and it is expected to exist and be writable.
      */
     void setProjectDir(File dir);
 
diff --git a/subprojects/core/build.gradle.kts b/subprojects/core/build.gradle.kts
index 545bb585434..dc013092f8d 100644
--- a/subprojects/core/build.gradle.kts
+++ b/subprojects/core/build.gradle.kts
@@ -31,6 +31,12 @@ dependencyAnalysis {
         ignoreSourceSet(testInterceptors.name)
     }
 }
+jvmCompile {
+    addCompilationFrom(testInterceptors) {
+        // By default, test interceptors compile to the same JVM version as the production code.
+        targetJvmVersion = compilations.named("main").flatMap { it.targetJvmVersion }
+    }
+}
 
 val testInterceptorsImplementation: Configuration by configurations.getting {
     extendsFrom(configurations.implementation.get())
@@ -308,5 +314,4 @@ tasks.compileTestGroovy {
     }
 }
 
-integTest.usesJavadocCodeSnippets = true
 testFilesCleanup.reportOnly = true
diff --git a/subprojects/core/src/integTest/groovy/org/gradle/api/ConfigurationOnDemandIntegrationTest.groovy b/subprojects/core/src/integTest/groovy/org/gradle/api/ConfigurationOnDemandIntegrationTest.groovy
index cc341fc6a68..30653393aae 100644
--- a/subprojects/core/src/integTest/groovy/org/gradle/api/ConfigurationOnDemandIntegrationTest.groovy
+++ b/subprojects/core/src/integTest/groovy/org/gradle/api/ConfigurationOnDemandIntegrationTest.groovy
@@ -158,7 +158,7 @@ class ConfigurationOnDemandIntegrationTest extends AbstractIntegrationSpec {
         buildFile << """
 allprojects { apply plugin: 'java-library' }
 project(':impl') {
-    dependencies { implementation project(path: ':api', configuration: 'archives') }
+    dependencies { implementation project(':api') }
 }
 project(':api') {
     dependencies { runtimeOnly project(':impl') }
diff --git a/subprojects/core/src/integTest/groovy/org/gradle/api/PluginServiceInjectionIntegrationTest.groovy b/subprojects/core/src/integTest/groovy/org/gradle/api/PluginServiceInjectionIntegrationTest.groovy
index 7846b02fb99..948a6829b42 100644
--- a/subprojects/core/src/integTest/groovy/org/gradle/api/PluginServiceInjectionIntegrationTest.groovy
+++ b/subprojects/core/src/integTest/groovy/org/gradle/api/PluginServiceInjectionIntegrationTest.groovy
@@ -17,14 +17,19 @@
 package org.gradle.api
 
 import org.gradle.api.artifacts.ConfigurationContainer
+import org.gradle.api.file.ArchiveOperations
+import org.gradle.api.file.BuildLayout
 import org.gradle.api.file.FileSystemOperations
 import org.gradle.api.file.ProjectLayout
 import org.gradle.api.internal.artifacts.configurations.RoleBasedConfigurationContainerInternal
 import org.gradle.api.model.ObjectFactory
 import org.gradle.api.provider.ProviderFactory
+import org.gradle.api.tasks.testing.TestEventReporterFactory
 import org.gradle.integtests.fixtures.AbstractIntegrationSpec
 import org.gradle.internal.execution.ExecutionEngine
 import org.gradle.process.ExecOperations
+import org.gradle.tooling.provider.model.ToolingModelBuilderRegistry
+import org.gradle.workers.WorkerExecutor
 
 import javax.inject.Inject
 
@@ -170,12 +175,21 @@ class PluginServiceInjectionIntegrationTest extends AbstractIntegrationSpec {
 
         where:
         serviceType << [
+            // available everywhere
             ObjectFactory,
-            ProjectLayout,
             ProviderFactory,
-            ExecutionEngine,
             FileSystemOperations,
             ExecOperations,
+            ArchiveOperations,
+
+            // specific for Projects
+            ProjectLayout,
+            WorkerExecutor,
+            ToolingModelBuilderRegistry,
+            TestEventReporterFactory,
+
+            // internal services
+            ExecutionEngine,
             ConfigurationContainer, // this is a supertype of the RoleBasedConfigurationContainerInternal, we want to ensure it can still be injected without asking for the subtype
             RoleBasedConfigurationContainerInternal
         ].collect { it.name }
@@ -207,10 +221,16 @@ class PluginServiceInjectionIntegrationTest extends AbstractIntegrationSpec {
 
         where:
         serviceType << [
+            // available everywhere
             ObjectFactory,
             ProviderFactory,
             FileSystemOperations,
             ExecOperations,
+            ArchiveOperations,
+
+            // specific for Settings
+            BuildLayout,
+            ToolingModelBuilderRegistry,
         ].collect { it.name }
     }
 
@@ -240,10 +260,14 @@ class PluginServiceInjectionIntegrationTest extends AbstractIntegrationSpec {
 
         where:
         serviceType << [
+            // available everywhere
             ObjectFactory,
             ProviderFactory,
             FileSystemOperations,
             ExecOperations,
+            ArchiveOperations,
+
+            // specific for Gradle
         ].collect { it.name }
     }
 }
diff --git a/subprojects/core/src/integTest/groovy/org/gradle/api/file/TaskFilePropertiesIntegrationTest.groovy b/subprojects/core/src/integTest/groovy/org/gradle/api/file/TaskFilePropertiesIntegrationTest.groovy
index 858b06848d5..e30b70143cf 100644
--- a/subprojects/core/src/integTest/groovy/org/gradle/api/file/TaskFilePropertiesIntegrationTest.groovy
+++ b/subprojects/core/src/integTest/groovy/org/gradle/api/file/TaskFilePropertiesIntegrationTest.groovy
@@ -153,7 +153,7 @@ class TaskFilePropertiesIntegrationTest extends AbstractIntegrationSpec {
 
         buildFile('a/build.gradle', '''
             configurations.create("compile")
-            dependencies { compile project(path: ':b', configuration: 'archives') }
+            dependencies { compile project(path: ':b', configuration: 'producer') }
 
             task doStuff(type: InputTask) {
                 src = configurations.compile + fileTree('src/java')
@@ -179,12 +179,12 @@ class TaskFilePropertiesIntegrationTest extends AbstractIntegrationSpec {
 
             configurations {
                 create("deps")
-                archives {
+                consumable("producer") {
                     extendsFrom deps
+                    outgoing.artifact(otherJar)
                 }
             }
             dependencies { deps files('b.jar') { builtBy jar } }
-            artifacts { archives otherJar }
         ''')
 
         when:
diff --git a/subprojects/core/src/integTest/groovy/org/gradle/initialization/GradleHelpIntegrationTest.groovy b/subprojects/core/src/integTest/groovy/org/gradle/initialization/GradleHelpIntegrationTest.groovy
index c9e4a002eb7..7f0cdb56391 100644
--- a/subprojects/core/src/integTest/groovy/org/gradle/initialization/GradleHelpIntegrationTest.groovy
+++ b/subprojects/core/src/integTest/groovy/org/gradle/initialization/GradleHelpIntegrationTest.groovy
@@ -44,7 +44,7 @@ USAGE: gradle [option...] [task...]
 --configuration-cache-problems     Configures how the configuration cache handles problems (fail or warn). Defaults to fail.
 --configure-on-demand              Configure necessary projects only. Gradle will attempt to reduce configuration time for large multi-project builds. [incubating]
 --no-configure-on-demand           Disables the use of configuration on demand. [incubating]
---console                          Specifies which type of console output to generate. Values are 'plain', 'auto' (default), 'rich' or 'verbose'.
+--console                          Specifies which type of console output to generate. Values are 'plain', 'colored', 'auto' (default), 'rich' or 'verbose'.
 --continue                         Continue task execution after a task failure.
 --no-continue                      Stop task execution after a task failure.
 -D, --system-prop                  Set system property of the JVM (e.g. -Dmyprop=myvalue).
diff --git a/subprojects/core/src/integTest/groovy/org/gradle/samples/AutoTestedSamplesCoreIntegrationTest.groovy b/subprojects/core/src/integTest/groovy/org/gradle/samples/AutoTestedSamplesCoreIntegrationTest.groovy
deleted file mode 100644
index f1590079641..00000000000
--- a/subprojects/core/src/integTest/groovy/org/gradle/samples/AutoTestedSamplesCoreIntegrationTest.groovy
+++ /dev/null
@@ -1,28 +0,0 @@
-/*
- * Copyright 2010 the original author or authors.
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package org.gradle.samples
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesCoreIntegrationTest extends AbstractAutoTestedSamplesTest {
-
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-}
diff --git a/subprojects/core/src/main/java/org/gradle/api/internal/ConfigurationCacheDegradation.java b/subprojects/core/src/main/java/org/gradle/api/internal/ConfigurationCacheDegradation.java
new file mode 100644
index 00000000000..0ba5c82c184
--- /dev/null
+++ b/subprojects/core/src/main/java/org/gradle/api/internal/ConfigurationCacheDegradation.java
@@ -0,0 +1,48 @@
+/*
+ * Copyright 2025 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.gradle.api.internal;
+
+import org.gradle.api.internal.provider.Providers;
+import org.gradle.api.provider.Provider;
+
+/**
+ * A helper class for tasks and plugins that may require configuration cache graceful degradation.
+ */
+@SuppressWarnings("deprecation")
+public class ConfigurationCacheDegradation {
+    /**
+     * Contributes a conditional degradation request.
+     *
+     * @param task the task that needs degrading
+     * @param reason a provider that produces a reason string if degradation is indeed required, or has no value otherwise
+     */
+    public static <T extends AbstractTask> void requireDegradation(T task, Provider<String> reason) {
+        task.getServices().get(ConfigurationCacheDegradationController.class)
+            .requireConfigurationCacheDegradation(task, reason);
+    }
+
+    /**
+     * Contributes an unconditional degradation request.
+     *
+     * @param task the task that needs degrading
+     * @param reason the (fixed) reason
+     */
+    public static <T extends AbstractTask> void requireDegradation(T task, String reason) {
+        requireDegradation(task, Providers.of(reason));
+    }
+
+}
diff --git a/subprojects/core/src/main/java/org/gradle/api/internal/artifacts/configurations/ConfigurationRolesForMigration.java b/subprojects/core/src/main/java/org/gradle/api/internal/artifacts/configurations/ConfigurationRolesForMigration.java
index df4b78ca1d0..cc6b16c30a9 100644
--- a/subprojects/core/src/main/java/org/gradle/api/internal/artifacts/configurations/ConfigurationRolesForMigration.java
+++ b/subprojects/core/src/main/java/org/gradle/api/internal/artifacts/configurations/ConfigurationRolesForMigration.java
@@ -40,6 +40,11 @@
 public final class ConfigurationRolesForMigration {
     private ConfigurationRolesForMigration() { /* Private to prevent instantiation. */ }
 
+    /**
+     * A configuration that is retired and not meant to be used for any purpose.  This is primarily useful in creating a migrating configuration role in {@link ConfigurationRolesForMigration}.
+     */
+    public static final ConfigurationRole NONE = new DefaultConfigurationRole("Deprecated", false, false, false, false, false, false);
+
     /**
      * A resolvable dependency scope that will become a resolvable configuration in the next major version.
      */
@@ -61,13 +66,19 @@ private ConfigurationRolesForMigration() { /* Private to prevent instantiation.
     @Deprecated
     public static final ConfigurationRole LEGACY_TO_RESOLVABLE_DEPENDENCY_SCOPE = difference(ConfigurationRoles.ALL, ConfigurationRoles.RESOLVABLE_DEPENDENCY_SCOPE);
 
+    /**
+     * A consumable configuration that has been deprecated and will be removed in the next major version.
+     */
+    public static final ConfigurationRole CONSUMABLE_TO_RETIRED = difference(ConfigurationRoles.CONSUMABLE, NONE);
+
     /**
      * All known migration roles.
      */
     public static final Set<ConfigurationRole> ALL = ImmutableSet.of(
         RESOLVABLE_DEPENDENCY_SCOPE_TO_RESOLVABLE,
         RESOLVABLE_DEPENDENCY_SCOPE_TO_DEPENDENCY_SCOPE,
-        LEGACY_TO_RESOLVABLE_DEPENDENCY_SCOPE
+        LEGACY_TO_RESOLVABLE_DEPENDENCY_SCOPE,
+        CONSUMABLE_TO_RETIRED
     );
 
     /**
@@ -86,7 +97,7 @@ private static ConfigurationRole difference(ConfigurationRole initialRole, Confi
 
         /*
          * Since we're assuming strictly narrowing usage from a non-deprecated initial role, for each usage we want this migration
-         * role to deprecate a usage iff that usage will change from allowed -> disallowed when migrating from the initial role to the
+         * role to deprecate a usage if that usage will change from allowed -> disallowed when migrating from the initial role to the
          * eventual role.
          */
         boolean consumptionDeprecated = initialRole.isConsumable() && !eventualRole.isConsumable();
diff --git a/subprojects/core/src/main/java/org/gradle/api/internal/attributes/AttributeMergingException.java b/subprojects/core/src/main/java/org/gradle/api/internal/attributes/AttributeMergingException.java
index b8bad742734..d7dd7d48e52 100644
--- a/subprojects/core/src/main/java/org/gradle/api/internal/attributes/AttributeMergingException.java
+++ b/subprojects/core/src/main/java/org/gradle/api/internal/attributes/AttributeMergingException.java
@@ -22,10 +22,6 @@ public class AttributeMergingException extends RuntimeException {
     private final Object leftValue;
     private final Object rightValue;
 
-    public AttributeMergingException(Attribute<?> attribute, Object leftValue, Object rightValue) {
-        this(attribute, leftValue, rightValue, "An attribute named '" + attribute.getName() + "' of type '" + attribute.getType().getName() + "' already exists in this container");
-    }
-
     public AttributeMergingException(Attribute<?> attribute, Object leftValue, Object rightValue, String message) {
         super(message);
         this.attribute = attribute;
diff --git a/subprojects/core/src/main/java/org/gradle/api/internal/attributes/AttributeValue.java b/subprojects/core/src/main/java/org/gradle/api/internal/attributes/AttributeValue.java
index d850952a87a..a37d39edd7f 100644
--- a/subprojects/core/src/main/java/org/gradle/api/internal/attributes/AttributeValue.java
+++ b/subprojects/core/src/main/java/org/gradle/api/internal/attributes/AttributeValue.java
@@ -45,6 +45,11 @@ public <S> S coerce(Attribute<S> type) {
         public Object get() {
             throw new UnsupportedOperationException("get() should not be called on a missing attribute value");
         }
+
+        @Override
+        public Attribute<?> getAttribute() {
+            throw new UnsupportedOperationException("getAttribute() should not be called on a missing attribute value");
+        }
     };
 
     /**
@@ -73,4 +78,9 @@ public Object get() {
      * @throws IllegalArgumentException if this attribute is not compatible with the other one
      */
     <S> S coerce(Attribute<S> otherAttribute);
+
+    /**
+     * Get the key corresponding to this attribute value.
+     */
+    Attribute<?> getAttribute();
 }
diff --git a/subprojects/core/src/main/java/org/gradle/api/internal/attributes/DefaultAttributesFactory.java b/subprojects/core/src/main/java/org/gradle/api/internal/attributes/DefaultAttributesFactory.java
index 8e5bf0c98fc..84e2f99a8a6 100644
--- a/subprojects/core/src/main/java/org/gradle/api/internal/attributes/DefaultAttributesFactory.java
+++ b/subprojects/core/src/main/java/org/gradle/api/internal/attributes/DefaultAttributesFactory.java
@@ -190,7 +190,8 @@ public ImmutableAttributes safeConcat(ImmutableAttributes attributes1, Immutable
                 Object currentAttribute = entry.get();
                 Object existingAttribute = attributes1.getAttribute(attribute);
                 if (!currentAttribute.equals(existingAttribute)) {
-                    throw new AttributeMergingException(attribute, existingAttribute, currentAttribute, buildSameNameDifferentTypeErrorMsg(attribute, attributes2.findAttribute(attribute.getName())));
+                    String message = "An attribute named '" + attribute.getName() + "' of type '" + attribute.getType().getName() + "' already exists in this container";
+                    throw new AttributeMergingException(attribute, existingAttribute, currentAttribute, message);
                 }
             }
             if (attributes1 instanceof DefaultImmutableAttributesContainer) {
diff --git a/subprojects/core/src/main/java/org/gradle/api/internal/attributes/DefaultImmutableAttributesContainer.java b/subprojects/core/src/main/java/org/gradle/api/internal/attributes/DefaultImmutableAttributesContainer.java
index c4ab76bedb8..d1e14dd12f8 100644
--- a/subprojects/core/src/main/java/org/gradle/api/internal/attributes/DefaultImmutableAttributesContainer.java
+++ b/subprojects/core/src/main/java/org/gradle/api/internal/attributes/DefaultImmutableAttributesContainer.java
@@ -222,13 +222,6 @@ public AttributeValue<?> findEntry(String name) {
         return attributes == null ? MISSING : attributes;
     }
 
-    @Override
-    @Nullable
-    public Attribute<?> findAttribute(String name) {
-        DefaultImmutableAttributesContainer attributes = hierarchyByName.get(name);
-        return attributes == null ? null : attributes.attribute;
-    }
-
     @SuppressWarnings("DataFlowIssue")
     @Override
     public Object get() {
@@ -308,6 +301,11 @@ public boolean isEmpty() {
         return attribute == null;
     }
 
+    @Override
+    public Attribute<?> getAttribute() {
+        return attribute;
+    }
+
     @Override
     public boolean contains(Attribute<?> key) {
         return hierarchy.containsKey(key);
diff --git a/subprojects/core/src/main/java/org/gradle/api/internal/attributes/ImmutableAttributes.java b/subprojects/core/src/main/java/org/gradle/api/internal/attributes/ImmutableAttributes.java
index 53dce63cbac..3942af8e1d5 100644
--- a/subprojects/core/src/main/java/org/gradle/api/internal/attributes/ImmutableAttributes.java
+++ b/subprojects/core/src/main/java/org/gradle/api/internal/attributes/ImmutableAttributes.java
@@ -18,7 +18,6 @@
 
 import com.google.common.collect.ImmutableSet;
 import org.gradle.api.attributes.Attribute;
-import org.jspecify.annotations.Nullable;
 
 public interface ImmutableAttributes extends AttributeContainerInternal {
     ImmutableAttributes EMPTY = new DefaultImmutableAttributesContainer();
@@ -49,15 +48,6 @@ public interface ImmutableAttributes extends AttributeContainerInternal {
      */
     AttributeValue<?> findEntry(String name);
 
-    /**
-     * Locates the {@link Attribute} with given name.
-     *
-     * @param name the name of an attribute to locate in this container
-     * @return the attribute with this name in this container; or {@code null} if not present
-     */
-    @Nullable
-    Attribute<?> findAttribute(String name);
-
     @Override
     ImmutableSet<Attribute<?>> keySet();
 }
diff --git a/subprojects/core/src/main/java/org/gradle/api/tasks/ant/AntTarget.java b/subprojects/core/src/main/java/org/gradle/api/tasks/ant/AntTarget.java
index 6b8a766c8cf..5f1424491f5 100644
--- a/subprojects/core/src/main/java/org/gradle/api/tasks/ant/AntTarget.java
+++ b/subprojects/core/src/main/java/org/gradle/api/tasks/ant/AntTarget.java
@@ -16,9 +16,7 @@
 package org.gradle.api.tasks.ant;
 
 import org.apache.tools.ant.Target;
-import org.gradle.api.internal.ConfigurationCacheDegradationController;
 import org.gradle.api.internal.ConventionTask;
-import org.gradle.api.internal.project.ProjectInternal;
 import org.gradle.api.tasks.Internal;
 import org.gradle.api.tasks.TaskAction;
 import org.gradle.internal.instrumentation.api.annotations.ToBeReplacedByLazyProperty;
@@ -26,6 +24,8 @@
 
 import java.io.File;
 
+import static org.gradle.api.internal.ConfigurationCacheDegradation.requireDegradation;
+
 /**
  * A task which executes an Ant target.
  */
@@ -36,13 +36,7 @@ public abstract class AntTarget extends ConventionTask {
     private File baseDir;
 
     public AntTarget() {
-        getDegradationController().requireConfigurationCacheDegradation(this,
-            getProject().getProviders().provider(() -> "Task is not compatible with the Configuration Cache")
-        );
-    }
-
-    private ConfigurationCacheDegradationController getDegradationController() {
-        return ((ProjectInternal) getProject()).getServices().get(ConfigurationCacheDegradationController.class);
+        requireDegradation(this, "Task is not compatible with the Configuration Cache");
     }
 
     @TaskAction
diff --git a/subprojects/core/src/main/java/org/gradle/execution/taskgraph/DefaultTaskExecutionGraph.java b/subprojects/core/src/main/java/org/gradle/execution/taskgraph/DefaultTaskExecutionGraph.java
index 77842cef344..f427ee68388 100644
--- a/subprojects/core/src/main/java/org/gradle/execution/taskgraph/DefaultTaskExecutionGraph.java
+++ b/subprojects/core/src/main/java/org/gradle/execution/taskgraph/DefaultTaskExecutionGraph.java
@@ -16,6 +16,7 @@
 
 package org.gradle.execution.taskgraph;
 
+import com.google.common.base.Preconditions;
 import com.google.common.collect.ImmutableList;
 import com.google.common.collect.ImmutableSet;
 import groovy.lang.Closure;
@@ -34,9 +35,11 @@
 import org.gradle.execution.plan.Node;
 import org.gradle.execution.plan.NodeExecutor;
 import org.gradle.execution.plan.PlanExecutor;
+import org.gradle.execution.plan.ScheduledWork;
 import org.gradle.execution.plan.TaskNode;
 import org.gradle.internal.Cast;
 import org.gradle.internal.InternalListener;
+import org.gradle.internal.MutableReference;
 import org.gradle.internal.build.ExecutionResult;
 import org.gradle.internal.event.ListenerBroadcast;
 import org.gradle.internal.operations.BuildOperationContext;
@@ -56,7 +59,6 @@
 import java.util.Collections;
 import java.util.List;
 import java.util.Set;
-import java.util.function.BiConsumer;
 
 @SuppressWarnings("deprecation")
 @NullMarked
@@ -272,8 +274,14 @@ public List<Task> getAllTasks() {
     }
 
     @Override
-    public void visitScheduledNodes(BiConsumer<List<Node>, Set<Node>> visitor) {
-        executionPlan.getContents().getScheduledNodes().visitNodes(visitor);
+    public ScheduledWork collectScheduledWork() {
+        MutableReference<ScheduledWork> result = MutableReference.of(null);
+        executionPlan.getContents().getScheduledNodes().visitNodes((nodes, entryNodes) -> {
+            result.set(new ScheduledWork(nodes, entryNodes));
+        });
+        ScheduledWork scheduledWork = result.get();
+        Preconditions.checkState(scheduledWork != null, "No scheduled work found");
+        return scheduledWork;
     }
 
     @Override
diff --git a/subprojects/core/src/main/java/org/gradle/execution/taskgraph/TaskExecutionGraphInternal.java b/subprojects/core/src/main/java/org/gradle/execution/taskgraph/TaskExecutionGraphInternal.java
index ceb042568ce..c025e8f62b3 100644
--- a/subprojects/core/src/main/java/org/gradle/execution/taskgraph/TaskExecutionGraphInternal.java
+++ b/subprojects/core/src/main/java/org/gradle/execution/taskgraph/TaskExecutionGraphInternal.java
@@ -18,25 +18,25 @@
 import org.gradle.api.Task;
 import org.gradle.api.execution.TaskExecutionGraph;
 import org.gradle.execution.plan.FinalizedExecutionPlan;
-import org.gradle.execution.plan.Node;
+import org.gradle.execution.plan.ScheduledWork;
 import org.gradle.internal.build.ExecutionResult;
-import org.jspecify.annotations.Nullable;
 import org.gradle.internal.service.scopes.Scope;
 import org.gradle.internal.service.scopes.ServiceScope;
+import org.jspecify.annotations.Nullable;
 
-import java.util.List;
 import java.util.Set;
-import java.util.function.BiConsumer;
 
 @ServiceScope(Scope.Gradle.class)
 public interface TaskExecutionGraphInternal extends TaskExecutionGraph {
 
     /**
      * Find a task with the given path in the task graph.
+     *
      * @param path the path of the task to find in the task graph
      * @return the task with the given path if it is present in the task graph, null otherwise
      */
-    @Nullable Task findTask(String path);
+    @Nullable
+    Task findTask(String path);
 
     /**
      * Attaches the work that this graph will run. Fires events and no further tasks should be added.
@@ -59,11 +59,14 @@ public interface TaskExecutionGraphInternal extends TaskExecutionGraph {
      */
     int size();
 
+    default boolean hasScheduledWork() {
+        return size() > 0;
+    }
+
     /**
-     * Returns all the work items in this graph scheduled for execution plus all
-     * dependencies from other builds.
+     * Returns a snapshot of currently scheduled nodes.
      */
-    void visitScheduledNodes(BiConsumer<List<Node>, Set<Node>> visitor);
+    ScheduledWork collectScheduledWork();
 
     /**
      * Resets the lifecycle for this graph.
diff --git a/platforms/software/maven/src/integTest/groovy/org/gradle/api/AutoTestedSamplesMavenIntegrationTest.groovy b/subprojects/core/src/main/java/org/gradle/execution/taskgraph/package-info.java
similarity index 63%
rename from platforms/software/maven/src/integTest/groovy/org/gradle/api/AutoTestedSamplesMavenIntegrationTest.groovy
rename to subprojects/core/src/main/java/org/gradle/execution/taskgraph/package-info.java
index 6b019a5c684..3a134667f2e 100644
--- a/platforms/software/maven/src/integTest/groovy/org/gradle/api/AutoTestedSamplesMavenIntegrationTest.groovy
+++ b/subprojects/core/src/main/java/org/gradle/execution/taskgraph/package-info.java
@@ -1,5 +1,5 @@
 /*
- * Copyright 2012 the original author or authors.
+ * Copyright 2025 the original author or authors.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -13,17 +13,7 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
+@NullMarked
+package org.gradle.execution.taskgraph;
 
-package org.gradle.api
-
-import org.gradle.integtests.fixtures.AbstractAutoTestedSamplesTest
-import org.junit.Test
-
-class AutoTestedSamplesMavenIntegrationTest extends AbstractAutoTestedSamplesTest {
-
-    @Test
-    void runSamples() {
-        runSamplesFrom("src/main")
-    }
-
-}
+import org.jspecify.annotations.NullMarked;
diff --git a/subprojects/core/src/main/java/org/gradle/internal/html/SimpleHtmlWriter.java b/subprojects/core/src/main/java/org/gradle/internal/html/SimpleHtmlWriter.java
index a9ab05d9194..067b3687bdf 100644
--- a/subprojects/core/src/main/java/org/gradle/internal/html/SimpleHtmlWriter.java
+++ b/subprojects/core/src/main/java/org/gradle/internal/html/SimpleHtmlWriter.java
@@ -64,7 +64,8 @@ public SimpleMarkupWriter startElement(String name) throws IOException {
         "ul", "li",
         "a", "p",
         "pre", "div", "span",
-        "label", "input"
+        "label", "input",
+        "button"
     )));
 
     private static boolean isValidHtmlTag(String name) {
diff --git a/subprojects/core/src/main/resources/org/gradle/reporting/report.js b/subprojects/core/src/main/resources/org/gradle/reporting/report.js
index e246ebad9f9..e6582171292 100644
--- a/subprojects/core/src/main/resources/org/gradle/reporting/report.js
+++ b/subprojects/core/src/main/resources/org/gradle/reporting/report.js
@@ -65,6 +65,29 @@
         }
     }
 
+    function initClipboardCopyButton() {
+        document.querySelectorAll(".clipboard-copy-btn").forEach((button) => {
+            const copyElementId = button.getAttribute("data-copy-element-id");
+            const elementWithCodeToSelect = document.getElementById(copyElementId);
+
+            button.addEventListener("click", () => {
+                const text = elementWithCodeToSelect.innerText.trim();
+                navigator.clipboard
+                    .writeText(text)
+                    .then(() => {
+                        button.textContent = "Copied!";
+                        setTimeout(() => {
+                            button.textContent = "Copy";
+                        }, 1500);
+                    })
+                    .catch((err) => {
+                        alert("Failed to copy to the clipboard: '" + err.message + "'. Check JavaScript console for more details.")
+                        console.warn("Failed to copy to the clipboard", err);
+                    });
+            });
+        });
+    }
+
     function initControls() {
         if (findCodeBlocks().length > 0) {
             const checkBox = getCheckBox();
@@ -75,6 +98,8 @@
 
             removeClass(label, "hidden");
          }
+
+         initClipboardCopyButton()
     }
 
     class TabManager {
diff --git a/subprojects/core/src/test/groovy/org/gradle/api/internal/attributes/DefaultAttributesFactoryTest.groovy b/subprojects/core/src/test/groovy/org/gradle/api/internal/attributes/DefaultAttributesFactoryTest.groovy
index fd6e73350dc..4204c817fd3 100644
--- a/subprojects/core/src/test/groovy/org/gradle/api/internal/attributes/DefaultAttributesFactoryTest.groovy
+++ b/subprojects/core/src/test/groovy/org/gradle/api/internal/attributes/DefaultAttributesFactoryTest.groovy
@@ -16,14 +16,14 @@
 
 package org.gradle.api.internal.attributes
 
-
 import org.gradle.util.AttributeTestUtil
 import spock.lang.Specification
 
 import static org.gradle.api.internal.attributes.immutable.TestAttributes.BAR
 import static org.gradle.api.internal.attributes.immutable.TestAttributes.BAZ
+import static org.gradle.api.internal.attributes.immutable.TestAttributes.BOOLEAN_BAR
 import static org.gradle.api.internal.attributes.immutable.TestAttributes.FOO
-import static org.gradle.api.internal.attributes.immutable.TestAttributes.OTHER_BAR
+import static org.gradle.api.internal.attributes.immutable.TestAttributes.OBJECT_BAR
 
 /**
  * Unit tests for {@link DefaultAttributesFactory}.
@@ -160,7 +160,7 @@ class DefaultAttributesFactoryTest extends Specification {
 
     def "can replace attribute with same name and different type"() {
         given:
-        def set1 = factory.concat(factory.of(FOO, "foo1"), factory.of(OTHER_BAR, "bar1")) // Object-typed bar
+        def set1 = factory.concat(factory.of(FOO, "foo1"), factory.of(BOOLEAN_BAR, true)) // Boolean-typed bar
         def set2 = factory.of(BAR, "bar2") // String-typed bar
 
         when:
@@ -187,9 +187,25 @@ class DefaultAttributesFactoryTest extends Specification {
         e.rightValue == "bar2"
     }
 
-    def "can detect incompatible attributes with different types when merging"() {
+    def "safeConcat does not permit overwriting existing attribute value"() {
         given:
-        def set1 = factory.concat(factory.of(FOO, "foo1"), factory.of(OTHER_BAR, "bar1")) // Object-typed bar
+        def set1 = factory.concat(factory.of(FOO, "foo1"), factory.of(BAR, "bar1"))
+        def set2 = factory.concat(factory.of(FOO, "foo1"), factory.of(BAR, "bar2"))
+
+        when:
+        factory.safeConcat(set1, set2)
+
+        then:
+        AttributeMergingException e = thrown()
+        e.attribute == BAR
+        e.leftValue == "bar1"
+        e.rightValue == "bar2"
+        e.message == "An attribute named 'bar' of type 'java.lang.String' already exists in this container"
+    }
+
+    def "safeConcat can detect incompatible attributes with different types when merging"() {
+        given:
+        def set1 = factory.concat(factory.of(FOO, "foo1"), factory.of(BOOLEAN_BAR, true)) // Boolean-typed bar
         def set2 = factory.concat(factory.of(FOO, "foo1"), factory.of(BAR, "bar2")) // String-typed bar
 
         when:
@@ -197,15 +213,31 @@ class DefaultAttributesFactoryTest extends Specification {
 
         then:
         AttributeMergingException e = thrown()
-        e.attribute == OTHER_BAR
+        e.attribute == BOOLEAN_BAR
+        e.leftValue == true
+        e.rightValue == "bar2"
+        e.message == "An attribute named 'bar' of type 'java.lang.Boolean' already exists in this container"
+    }
+
+    def "safeConcat can detect incompatible attributes with different types when merging; different value and different compatible types"() {
+        given:
+        def set1 = factory.concat(factory.of(FOO, "foo1"), factory.of(OBJECT_BAR, "bar1")) // Object-typed bar
+        def set2 = factory.concat(factory.of(FOO, "foo1"), factory.of(BAR, "bar2")) // String-typed bar
+
+        when:
+        factory.safeConcat(set1, set2)
+
+        then:
+        AttributeMergingException e = thrown()
+        e.attribute == OBJECT_BAR
         e.leftValue == "bar1"
         e.rightValue == "bar2"
-        e.message == "Cannot have two attributes with the same name but different types. This container already has an attribute named 'bar' of type 'java.lang.String' and you are trying to store another one of type 'java.lang.Object'"
+        e.message == "An attribute named 'bar' of type 'java.lang.Object' already exists in this container"
     }
 
-    def "can detect incompatible attributes with different types when merging; same value but different types"() {
+    def "safeConcat can detect incompatible attributes with different types when merging; same value and different compatible types"() {
         given:
-        def set1 = factory.concat(factory.of(FOO, "foo1"), factory.of(OTHER_BAR, "bar1")) // Object-typed bar
+        def set1 = factory.concat(factory.of(FOO, "foo1"), factory.of(OBJECT_BAR, "bar1")) // Object-typed bar
         def set2 = factory.concat(factory.of(FOO, "foo1"), factory.of(BAR, "bar1")) // String-typed bar
 
         when:
diff --git a/subprojects/core/src/test/groovy/org/gradle/internal/classpath/DefaultCachedClasspathTransformerTest.groovy b/subprojects/core/src/test/groovy/org/gradle/internal/classpath/DefaultCachedClasspathTransformerTest.groovy
index d77cb0c68df..9b412678bc6 100644
--- a/subprojects/core/src/test/groovy/org/gradle/internal/classpath/DefaultCachedClasspathTransformerTest.groovy
+++ b/subprojects/core/src/test/groovy/org/gradle/internal/classpath/DefaultCachedClasspathTransformerTest.groovy
@@ -47,10 +47,10 @@ import spock.lang.Subject
 import java.util.zip.ZipEntry
 
 class DefaultCachedClasspathTransformerTest extends ConcurrentSpec {
-    private static final String HASH_JAR = "2237539028494c023ca6ba0154b1b63b"
-    private static final String HASH_JAR_WITH_STORED_RESOURCE = "e592d5efeff1967dd9ef2120b20d9b0f"
-    private static final String HASH_DIR = "dbc7c1d348c743c06d46137f2fdd25e2"
-    private static final String HASH_COPYING_TRANSFORM_ON_JAR = "o_e161f24809571a55f09d3f820c8e5942"
+    private static final String HASH_JAR = "91ec681b708f5791b57ef1225ccbde75"
+    private static final String HASH_JAR_WITH_STORED_RESOURCE = "67661fe89bbac9fbbd0863814999dd24"
+    private static final String HASH_DIR = "26d84a27e45ab67d330b1199328b4ee7"
+    private static final String HASH_COPYING_TRANSFORM_ON_JAR = "o_1f5b1eae547bef94b883b9b49cacc47c"
 
     @Rule
     TestNameTestDirectoryProvider testDirectoryProvider = new TestNameTestDirectoryProvider(getClass())
@@ -406,7 +406,7 @@ class DefaultCachedClasspathTransformerTest extends ConcurrentSpec {
         def file = testDir.file("thing.jar")
         jar(file)
         def classpath = DefaultClassPath.of(file)
-        def cachedFile = testDir.file("cached/447b2b801d9cc27cc9539f0cd2c94692/thing.jar")
+        def cachedFile = testDir.file("cached/b4df09c8c528b9489440109655e5b9e2/thing.jar")
 
         when:
         def cachedClasspath = transformer.transform(classpath, transform)
diff --git a/subprojects/core/src/testFixtures/groovy/org/gradle/api/internal/attributes/immutable/TestAttributes.groovy b/subprojects/core/src/testFixtures/groovy/org/gradle/api/internal/attributes/immutable/TestAttributes.groovy
index 4ce82aedc4f..d0e2442b778 100644
--- a/subprojects/core/src/testFixtures/groovy/org/gradle/api/internal/attributes/immutable/TestAttributes.groovy
+++ b/subprojects/core/src/testFixtures/groovy/org/gradle/api/internal/attributes/immutable/TestAttributes.groovy
@@ -25,6 +25,7 @@ import org.gradle.api.internal.attributes.ImmutableAttributes
 final class TestAttributes {
     static final Attribute<String> FOO = Attribute.of("foo", String)
     static final Attribute<String> BAR = Attribute.of("bar", String)
-    static final Attribute<Object> OTHER_BAR = Attribute.of("bar", Object.class)
+    static final Attribute<Boolean> BOOLEAN_BAR = Attribute.of("bar", Boolean.class)
+    static final Attribute<Object> OBJECT_BAR = Attribute.of("bar", Object.class)
     static final Attribute<String> BAZ = Attribute.of("baz", String)
 }
diff --git a/testing/architecture-test/src/changes/accepted-changes/accepted-public-api-changes.json b/testing/architecture-test/src/changes/accepted-changes/accepted-public-api-changes.json
index 4017e100292..339a786d4cd 100644
--- a/testing/architecture-test/src/changes/accepted-changes/accepted-public-api-changes.json
+++ b/testing/architecture-test/src/changes/accepted-changes/accepted-public-api-changes.json
@@ -1,3 +1,12 @@
 {
-    "acceptedApiChanges": []
-}
\ No newline at end of file
+    "acceptedApiChanges": [
+        {
+            "type": "org.gradle.api.tasks.testing.TestResult",
+            "member": "Method org.gradle.api.tasks.testing.TestResult.getAssumptionFailure()",
+            "acceptation": "Was always nullable, this is correctly reflecting the state of the code",
+            "changes": [
+                "From non-null returning to null returning breaking change"
+            ]
+        }
+    ]
+}
diff --git a/testing/architecture-test/src/changes/archunit-store/internal-api-nullability.txt b/testing/architecture-test/src/changes/archunit-store/internal-api-nullability.txt
index 2577aa7fce1..5d1800f5ef9 100644
--- a/testing/architecture-test/src/changes/archunit-store/internal-api-nullability.txt
+++ b/testing/architecture-test/src/changes/archunit-store/internal-api-nullability.txt
@@ -1259,18 +1259,6 @@ Class <org.gradle.execution.selection.BuildTaskSelector> is not annotated (direc
 Class <org.gradle.execution.selection.DefaultBuildTaskSelector$LazyFilter> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (DefaultBuildTaskSelector.java:0)
 Class <org.gradle.execution.selection.DefaultBuildTaskSelector$ProjectResolutionResult> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (DefaultBuildTaskSelector.java:0)
 Class <org.gradle.execution.selection.DefaultBuildTaskSelector> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (DefaultBuildTaskSelector.java:0)
-Class <org.gradle.execution.taskgraph.DefaultTaskExecutionGraph$1> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (DefaultTaskExecutionGraph.java:0)
-Class <org.gradle.execution.taskgraph.DefaultTaskExecutionGraph$2> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (DefaultTaskExecutionGraph.java:0)
-Class <org.gradle.execution.taskgraph.DefaultTaskExecutionGraph$BuildOperationAwareExecutionAction> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (DefaultTaskExecutionGraph.java:0)
-Class <org.gradle.execution.taskgraph.DefaultTaskExecutionGraph$InvokeNodeExecutorsAction> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (DefaultTaskExecutionGraph.java:0)
-Class <org.gradle.execution.taskgraph.DefaultTaskExecutionGraph$NotifyTaskGraphWhenReady> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (DefaultTaskExecutionGraph.java:0)
-Class <org.gradle.execution.taskgraph.DefaultTaskExecutionGraph$NotifyTaskGraphWhenReadyDetails> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (DefaultTaskExecutionGraph.java:0)
-Class <org.gradle.execution.taskgraph.NotifyTaskGraphWhenReadyBuildOperationType$1> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (NotifyTaskGraphWhenReadyBuildOperationType.java:0)
-Class <org.gradle.execution.taskgraph.NotifyTaskGraphWhenReadyBuildOperationType$Details> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (NotifyTaskGraphWhenReadyBuildOperationType.java:0)
-Class <org.gradle.execution.taskgraph.NotifyTaskGraphWhenReadyBuildOperationType$Result> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (NotifyTaskGraphWhenReadyBuildOperationType.java:0)
-Class <org.gradle.execution.taskgraph.NotifyTaskGraphWhenReadyBuildOperationType> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (NotifyTaskGraphWhenReadyBuildOperationType.java:0)
-Class <org.gradle.execution.taskgraph.TaskExecutionGraphInternal> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (TaskExecutionGraphInternal.java:0)
-Class <org.gradle.execution.taskgraph.TaskListenerInternal> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (TaskListenerInternal.java:0)
 Class <org.gradle.execution.taskpath.ResolvedTaskPath> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (ResolvedTaskPath.java:0)
 Class <org.gradle.external.javadoc.internal.AbstractJavadocOptionFileOption> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (AbstractJavadocOptionFileOption.java:0)
 Class <org.gradle.external.javadoc.internal.AbstractListJavadocOptionFileOption> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (AbstractListJavadocOptionFileOption.java:0)
diff --git a/testing/architecture-test/src/changes/archunit-store/platform-coupling.txt b/testing/architecture-test/src/changes/archunit-store/platform-coupling.txt
index b71627016a3..5ac724d83a0 100644
--- a/testing/architecture-test/src/changes/archunit-store/platform-coupling.txt
+++ b/testing/architecture-test/src/changes/archunit-store/platform-coupling.txt
@@ -12,7 +12,6 @@ Class 'org.gradle.api.internal.resources.DefaultTextResourceFactory' from platfo
 Class 'org.gradle.api.internal.resources.FileCollectionBackedTextResource' from platform 'core' imports class 'org.gradle.api.resources.ResourceException' from a forbidden platform 'software'
 Class 'org.gradle.api.internal.resources.FileCollectionBackedTextResource' from platform 'core' imports class 'org.gradle.internal.resource.ResourceExceptions' from a forbidden platform 'software'
 Class 'org.gradle.api.internal.resources.StringBackedTextResource' from platform 'core' imports class 'org.gradle.api.resources.ResourceException' from a forbidden platform 'software'
-Class 'org.gradle.api.plugins.antlr.AntlrPlugin$1$1' from platform 'software' imports class 'org.gradle.api.tasks.SourceSet' from a forbidden platform 'jvm'
 Class 'org.gradle.api.plugins.antlr.AntlrPlugin$1' from platform 'software' imports class 'org.gradle.api.internal.tasks.DefaultSourceSet' from a forbidden platform 'jvm'
 Class 'org.gradle.api.plugins.antlr.AntlrPlugin$1' from platform 'software' imports class 'org.gradle.api.tasks.SourceSet' from a forbidden platform 'jvm'
 Class 'org.gradle.api.plugins.antlr.AntlrPlugin' from platform 'software' imports class 'org.gradle.api.plugins.JavaPluginExtension' from a forbidden platform 'jvm'
diff --git a/testing/architecture-test/src/changes/archunit-store/public-api-nullability.txt b/testing/architecture-test/src/changes/archunit-store/public-api-nullability.txt
index 7d7b5cb74b1..1262c347e36 100644
--- a/testing/architecture-test/src/changes/archunit-store/public-api-nullability.txt
+++ b/testing/architecture-test/src/changes/archunit-store/public-api-nullability.txt
@@ -29,8 +29,6 @@ Class <org.gradle.api.logging.configuration.ConsoleOutput> is not annotated (dir
 Class <org.gradle.api.logging.configuration.LoggingConfiguration> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (LoggingConfiguration.java:0)
 Class <org.gradle.api.logging.configuration.ShowStacktrace> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (ShowStacktrace.java:0)
 Class <org.gradle.api.logging.configuration.WarningMode> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (WarningMode.java:0)
-Class <org.gradle.api.plugins.antlr.AntlrPlugin$1$1> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (AntlrPlugin.java:0)
-Class <org.gradle.api.plugins.antlr.AntlrPlugin$1$2> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (AntlrPlugin.java:0)
 Class <org.gradle.api.plugins.antlr.AntlrPlugin$1> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (AntlrPlugin.java:0)
 Class <org.gradle.api.plugins.antlr.AntlrPlugin> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (AntlrPlugin.java:0)
 Class <org.gradle.api.plugins.antlr.AntlrSourceDirectorySet> is not annotated (directly or via its package) with @org.jspecify.annotations.NullMarked in (AntlrSourceDirectorySet.java:0)
diff --git a/testing/internal-integ-testing/build.gradle.kts b/testing/internal-integ-testing/build.gradle.kts
index 936475deb3c..da776a2373a 100644
--- a/testing/internal-integ-testing/build.gradle.kts
+++ b/testing/internal-integ-testing/build.gradle.kts
@@ -7,6 +7,15 @@ plugins {
 
 description = "Collection of test fixtures for integration tests, internal use only"
 
+jvmCompile {
+    compilations {
+        named("main") {
+            // These test fixtures are used by the tooling API tests, which still run on JVM 8
+            targetJvmVersion = 8
+        }
+    }
+}
+
 sourceSets {
     main {
         // Incremental Groovy joint-compilation doesn't work with the Error Prone annotation processor
diff --git a/testing/internal-integ-testing/src/integTest/groovy/org/gradle/integtests/fixtures/executer/InProcessGradleExecuterIntegrationTest.groovy b/testing/internal-integ-testing/src/integTest/groovy/org/gradle/integtests/fixtures/executer/InProcessGradleExecuterIntegrationTest.groovy
index 21b05a755b5..548a4d00d99 100644
--- a/testing/internal-integ-testing/src/integTest/groovy/org/gradle/integtests/fixtures/executer/InProcessGradleExecuterIntegrationTest.groovy
+++ b/testing/internal-integ-testing/src/integTest/groovy/org/gradle/integtests/fixtures/executer/InProcessGradleExecuterIntegrationTest.groovy
@@ -87,7 +87,7 @@ class InProcessGradleExecuterIntegrationTest extends Specification {
         outputs.stdErr.contains("AFTER ERR")
 
         where:
-        console << [ConsoleOutput.Plain, ConsoleOutput.Rich, ConsoleOutput.Verbose]
+        console << [ConsoleOutput.Plain, ConsoleOutput.Colored, ConsoleOutput.Rich, ConsoleOutput.Verbose]
     }
 
     @ToBeFixedForConfigurationCache
@@ -143,7 +143,7 @@ class InProcessGradleExecuterIntegrationTest extends Specification {
         outputs.stdErr.contains("AFTER ERR")
 
         where:
-        console << [ConsoleOutput.Plain, ConsoleOutput.Rich, ConsoleOutput.Verbose]
+        console << [ConsoleOutput.Plain, ConsoleOutput.Colored, ConsoleOutput.Rich, ConsoleOutput.Verbose]
     }
 
     def stripped(String output) {
diff --git a/testing/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/AbstractAutoTestedSamplesTest.groovy b/testing/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/AbstractAutoTestedSamplesTest.groovy
index fa93bd0c245..99eb51735fd 100644
--- a/testing/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/AbstractAutoTestedSamplesTest.groovy
+++ b/testing/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/AbstractAutoTestedSamplesTest.groovy
@@ -19,12 +19,9 @@ package org.gradle.integtests.fixtures
 import org.gradle.integtests.fixtures.executer.GradleContextualExecuter
 
 class AbstractAutoTestedSamplesTest extends AbstractIntegrationTest {
-
-    def util = new AutoTestedSamplesUtil()
-
-    void runSamplesFrom(String dir) {
-        // make sure all project directories exist
-        def settingsEvaluatedHook = file("settingsEvaluatedHook.gradle") << """
+    // make sure all project directories exist
+    File createSettingsEvaluatedHook() {
+        file("settingsEvaluatedHook.gradle") << """
             def collectChildren(def obj) {
                 [obj] + obj.getChildren().collectMany { collectChildren(it) }
             }
@@ -34,25 +31,41 @@ class AbstractAutoTestedSamplesTest extends AbstractIntegrationTest {
                 }
             }
         """
-        util.findSamples(dir) { file, sample, tagSuffix ->
-            println "Found sample: ${sample.split("\n")[0]} (...) in $file"
-            if (tagSuffix.contains('WithoutCC') && GradleContextualExecuter.configCache) {
-                println 'Skipping sample tagged WithoutCC'
-                return
-            }
-            def buildFile = testFile('build.gradle')
-            def settingsFile = testFile('settings.gradle')
-            def fileToTest = tagSuffix.contains('Settings') ? settingsFile : buildFile
-            if (tagSuffix.contains('WithDeprecations')) {
-                executer.noDeprecationChecks()
-            }
-            fileToTest.text = sample
-            executer
-                .withTasks('help')
-                .withArguments("--stacktrace", "--init-script", settingsEvaluatedHook.absolutePath)
-            beforeSample(file, tagSuffix)
-            executer.run()
-            fileToTest.delete()
+    }
+
+    void runSample(File file, String sample, String tagSuffix, File settingsEvaluatedHook) {
+        println "Found sample: ${sample.split("\n")[0]} (...) in $file"
+        if (tagSuffix.contains('WithoutCC') && GradleContextualExecuter.configCache) {
+            println 'Skipping sample tagged WithoutCC'
+            return
+        }
+        def buildFile = testFile('build.gradle')
+        def settingsFile = testFile('settings.gradle')
+        def fileToTest = tagSuffix.contains('Settings') ? settingsFile : buildFile
+        if (tagSuffix.contains('WithDeprecations')) {
+            executer.noDeprecationChecks()
+        }
+        fileToTest.text = sample
+        executer
+            .withTasks('help')
+            .withArguments("--stacktrace", "--init-script", settingsEvaluatedHook.absolutePath)
+        beforeSample(file, tagSuffix)
+        executer.run()
+        fileToTest.delete()
+    }
+
+    void runSamplesFromFile(File f, String fileContent) {
+        def settingsEvaluatedHook = createSettingsEvaluatedHook()
+        AutoTestedSamplesUtil.runSamplesFromFile(f, fileContent) { file, sample, tagSuffix ->
+            runSample(file, sample, tagSuffix, settingsEvaluatedHook)
+        }
+    }
+
+    void runSamplesFrom(String dir) {
+        def settingsEvaluatedHook = createSettingsEvaluatedHook()
+
+        AutoTestedSamplesUtil.findSamples(dir) { file, sample, tagSuffix ->
+            runSample(file, sample, tagSuffix, settingsEvaluatedHook)
         }
     }
 
diff --git a/testing/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/AutoTestedSamplesUtil.groovy b/testing/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/AutoTestedSamplesUtil.groovy
index 781275dd694..240ff364b9b 100644
--- a/testing/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/AutoTestedSamplesUtil.groovy
+++ b/testing/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/AutoTestedSamplesUtil.groovy
@@ -28,7 +28,7 @@ class AutoTestedSamplesUtil {
     private static final Pattern LEADING_ASTERISK_PATTERN = Pattern.compile(/(?m)^\s*?\*/)
     private static final Pattern LITERAL_PATTERN = Pattern.compile(/\{@literal ([^}]+)}/)
 
-    void findSamples(String dir, Closure runner) {
+    static void findSamples(String dir, Closure runner) {
         def sources = findDir(dir)
 
         Files.walk(Paths.get(sources))
@@ -37,33 +37,25 @@ class AutoTestedSamplesUtil {
                 String name = p.toString()
                 return name.endsWith(".java") || name.endsWith(".groovy")
             })
-        .forEach { runSamplesFromFile(it.toFile(), runner) }
+        .forEach { runSamplesFromFile(it.toFile(), it.toFile().text, runner) }
     }
 
     static String findDir(String dir) {
         def workDir = SystemProperties.instance.currentDir
         def samplesDir = new File("$workDir/$dir")
         if (samplesDir.exists()) {
-            assertDeclaredAsInput(samplesDir.absolutePath)
             return samplesDir
         }
         throw new RuntimeException("$samplesDir does not exist")
     }
 
-    static void assertDeclaredAsInput(String dir) {
-        String inputs = System.getProperty("declaredSampleInputs")
-        assert inputs: "Must declare source directory as input: 'integTest.usesJavadocCodeSnippets.set(true)'"
-        assert inputs == dir
-    }
-
-    static void runSamplesFromFile(File file, Closure runner) {
-        String text = file.text
-        def samples = SAMPLE_START.matcher(text)
+    static void runSamplesFromFile(File file, String fileContent, Closure runner) {
+        def samples = SAMPLE_START.matcher(fileContent)
         while (samples.find()) {
             def tagSuffix = samples.group(1)
             def start = samples.end()
-            def end = text.indexOf("</pre>", start)
-            def sample = text.substring(start, end)
+            def end = fileContent.indexOf("</pre>", start)
+            def sample = fileContent.substring(start, end)
             sample = LEADING_ASTERISK_PATTERN.matcher(sample).replaceAll('')
             sample = sample.replace('&lt;', '<')
             sample = sample.replace('&gt;', '>')
diff --git a/testing/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/console/AbstractConsoleGroupedTaskFunctionalTest.groovy b/testing/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/console/AbstractConsoleGroupedTaskFunctionalTest.groovy
index eefb2266723..7a0a50aad35 100644
--- a/testing/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/console/AbstractConsoleGroupedTaskFunctionalTest.groovy
+++ b/testing/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/console/AbstractConsoleGroupedTaskFunctionalTest.groovy
@@ -50,7 +50,7 @@ abstract class AbstractConsoleGroupedTaskFunctionalTest extends AbstractIntegrat
 
     boolean shouldCheckDeprecations() {
         // Deprecation checks are disabled when using styled text
-        return consoleType == ConsoleOutput.Plain || (consoleType == ConsoleOutput.Auto && consoleAttachment == ConsoleAttachment.NOT_ATTACHED)
+        return consoleType == ConsoleOutput.Plain || consoleType == ConsoleOutput.Colored || (consoleType == ConsoleOutput.Auto && consoleAttachment == ConsoleAttachment.NOT_ATTACHED)
     }
 
     abstract ConsoleOutput getConsoleType()
diff --git a/testing/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/executer/AbstractGradleExecuter.java b/testing/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/executer/AbstractGradleExecuter.java
index bb9850b4a18..2a938679572 100644
--- a/testing/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/executer/AbstractGradleExecuter.java
+++ b/testing/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/executer/AbstractGradleExecuter.java
@@ -1111,8 +1111,7 @@ protected List<String> getAllArgs() {
         }
 
         if (consoleType != null) {
-            String s = consoleType.toString();
-            allArgs.add("--console=" + s.toLowerCase(Locale.ROOT));
+            allArgs.add("--console=" + consoleType.toString().toLowerCase(Locale.ROOT));
         }
 
         // Rich console output is difficult to check, so we disable warnings
diff --git a/testing/internal-testing/build.gradle.kts b/testing/internal-testing/build.gradle.kts
index 5ca3a4ecaa3..bb84f50c189 100644
--- a/testing/internal-testing/build.gradle.kts
+++ b/testing/internal-testing/build.gradle.kts
@@ -4,6 +4,15 @@ plugins {
 
 description = "Collection of test fixtures for both unit tests and integration tests, internal use only"
 
+jvmCompile {
+    compilations {
+        named("main") {
+            // These test fixtures are used by the tooling API tests, which still run on JVM 8
+            targetJvmVersion = 8
+        }
+    }
+}
+
 sourceSets {
     main {
         // Incremental Groovy joint-compilation doesn't work with the Error Prone annotation processor
diff --git a/testing/smoke-ide-test/build.gradle.kts b/testing/smoke-ide-test/build.gradle.kts
index 7b30b6fe97a..db6e99acc72 100644
--- a/testing/smoke-ide-test/build.gradle.kts
+++ b/testing/smoke-ide-test/build.gradle.kts
@@ -12,6 +12,10 @@ val smokeIdeTestSourceSet = sourceSets.create("smokeIdeTest") {
     runtimeClasspath += sourceSets.main.get().output
 }
 
+jvmCompile {
+    addCompilationFrom(smokeIdeTestSourceSet)
+}
+
 dependencyAnalysis {
     issues {
         ignoreSourceSet(smokeIdeTestSourceSet.name)
diff --git a/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/AbstractIdeSyncTest.groovy b/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/AbstractIdeSyncTest.groovy
index 570495efaae..2b3b1ec28aa 100644
--- a/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/AbstractIdeSyncTest.groovy
+++ b/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/AbstractIdeSyncTest.groovy
@@ -41,9 +41,9 @@ import java.nio.file.Paths
 abstract class AbstractIdeSyncTest extends Specification {
 
     // https://youtrack.jetbrains.com/articles/IDEA-A-21/IDEA-Latest-Builds-And-Release-Notes
-    final static String IDEA_COMMUNITY_VERSION = "2024.3-rc"
+    final static String IDEA_COMMUNITY_VERSION = "2025.1.3"
     // https://developer.android.com/studio/archive
-    final static String ANDROID_STUDIO_VERSION = "2024.3.1.6"
+    final static String ANDROID_STUDIO_VERSION = "2025.1.1.1"
 
     @Rule
     final TestNameTestDirectoryProvider temporaryFolder = new TestNameTestDirectoryProvider(getClass())
diff --git a/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/IsolatedProjectsAndroidProjectSyncTest.groovy b/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/IsolatedProjectsAndroidProjectSyncTest.groovy
index 253780e7d99..586f37595a7 100644
--- a/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/IsolatedProjectsAndroidProjectSyncTest.groovy
+++ b/testing/smoke-ide-test/src/smokeIdeTest/groovy/org/gradle/ide/sync/IsolatedProjectsAndroidProjectSyncTest.groovy
@@ -18,8 +18,6 @@ package org.gradle.ide.sync
 
 import org.gradle.ide.sync.fixtures.IsolatedProjectsIdeSyncFixture
 import org.gradle.integtests.fixtures.versions.AndroidGradlePluginVersions
-import org.gradle.test.precondition.Requires
-import org.gradle.test.preconditions.UnitTestPreconditions
 
 class IsolatedProjectsAndroidProjectSyncTest extends AbstractIdeSyncTest {
 
@@ -28,10 +26,6 @@ class IsolatedProjectsAndroidProjectSyncTest extends AbstractIdeSyncTest {
 
     private IsolatedProjectsIdeSyncFixture fixture = new IsolatedProjectsIdeSyncFixture(testDirectory)
 
-    @Requires(
-        value = UnitTestPreconditions.MacOs,
-        reason = "intellij-ide-starter can't download AndroidStudio distribution for Linux yet."
-    )
     def "can sync simple Android build without problems"() {
         given:
         simpleAndroidProject(AGP_VERSION)
diff --git a/testing/smoke-test/build.gradle.kts b/testing/smoke-test/build.gradle.kts
index 1663c4d089d..a28183b8847 100644
--- a/testing/smoke-test/build.gradle.kts
+++ b/testing/smoke-test/build.gradle.kts
@@ -13,6 +13,10 @@ val smokeTestSourceSet = sourceSets.create("smokeTest") {
     runtimeClasspath += sourceSets.main.get().output
 }
 
+jvmCompile {
+    addCompilationFrom(smokeTestSourceSet)
+}
+
 dependencyAnalysis {
     issues {
         ignoreSourceSet(smokeTestSourceSet.name)
diff --git a/testing/smoke-test/src/smokeTest/groovy/org/gradle/smoketests/AbstractSmokeTest.groovy b/testing/smoke-test/src/smokeTest/groovy/org/gradle/smoketests/AbstractSmokeTest.groovy
index b632c81b623..f1e9105522e 100644
--- a/testing/smoke-test/src/smokeTest/groovy/org/gradle/smoketests/AbstractSmokeTest.groovy
+++ b/testing/smoke-test/src/smokeTest/groovy/org/gradle/smoketests/AbstractSmokeTest.groovy
@@ -73,7 +73,7 @@ abstract class AbstractSmokeTest extends Specification {
         static nebulaResolutionRules = "11.5.0"
 
         // https://plugins.gradle.org/plugin/com.gradleup.shadow
-        static shadow = "8.3.6"
+        static shadow = "8.3.7"
 
         // https://github.com/asciidoctor/asciidoctor-gradle-plugin/tags
         static asciidoctor = "4.0.4"
diff --git a/testing/smoke-test/src/smokeTest/groovy/org/gradle/smoketests/KotlinMultiplatformPluginSmokeTest.groovy b/testing/smoke-test/src/smokeTest/groovy/org/gradle/smoketests/KotlinMultiplatformPluginSmokeTest.groovy
index a3025fd3cf5..daf9fc6eb8e 100644
--- a/testing/smoke-test/src/smokeTest/groovy/org/gradle/smoketests/KotlinMultiplatformPluginSmokeTest.groovy
+++ b/testing/smoke-test/src/smokeTest/groovy/org/gradle/smoketests/KotlinMultiplatformPluginSmokeTest.groovy
@@ -44,6 +44,11 @@ class KotlinMultiplatformPluginSmokeTest extends AbstractKotlinPluginSmokeTest {
                 kotlinVersionNumber.baseVersion < KotlinGradlePluginVersions.KOTLIN_2_1_21,
                 "Declaring an 'is-' property with a Boolean type has been deprecated. Starting with Gradle 9.0, this property will be ignored by Gradle. The combination of method name and return type is not consistent with Java Bean property rules and will become unsupported in future versions of Groovy. Add a method named 'getMpp' with the same behavior and mark the old one with @Deprecated, or change the type of 'org.jetbrains.kotlin.gradle.targets.js.ir.KotlinJsIrTarget.isMpp' (and the setter) to 'boolean'. Consult the upgrading guide for further information: https://docs.gradle.org/${GradleVersion.current().version}/userguide/upgrading_version_8.html#groovy_boolean_properties",
             )
+            .expectDeprecationWarningIf(
+                kotlinVersionNumber.baseVersion > KotlinGradlePluginVersions.KOTLIN_2_1_20,
+                "The archives configuration has been deprecated for artifact declaration. This will fail with an error in Gradle 10. Add artifacts as direct task dependencies of the 'assemble' task instead of declaring them in the archives configuration. Consult the upgrading guide for further information: https://docs.gradle.org/${GradleVersion.current().version}/userguide/upgrading_version_9.html#sec:archives-configuration",
+                "https://youtrack.jetbrains.com/issue/KT-78620"
+            )
             .build()
 
         then:
@@ -78,6 +83,11 @@ class KotlinMultiplatformPluginSmokeTest extends AbstractKotlinPluginSmokeTest {
                 GradleContextualExecuter.notConfigCache && kotlinVersionNumber.baseVersion < KotlinGradlePluginVersions.KOTLIN_2_1_20,
                 "Invocation of Task.project at execution time has been deprecated. This will fail with an error in Gradle 10. This API is incompatible with the configuration cache, which will become the only mode supported by Gradle in a future release. Consult the upgrading guide for further information: https://docs.gradle.org/${GradleVersion.current().version}/userguide/upgrading_version_7.html#task_project"
             )
+            .expectDeprecationWarningIf(
+                kotlinVersionNumber.baseVersion > KotlinGradlePluginVersions.KOTLIN_2_1_20,
+                "The archives configuration has been deprecated for artifact declaration. This will fail with an error in Gradle 10. Add artifacts as direct task dependencies of the 'assemble' task instead of declaring them in the archives configuration. Consult the upgrading guide for further information: https://docs.gradle.org/${GradleVersion.current().version}/userguide/upgrading_version_9.html#sec:archives-configuration",
+                "https://youtrack.jetbrains.com/issue/KT-78620"
+            )
             .build()
 
         then:
@@ -114,7 +124,13 @@ class KotlinMultiplatformPluginSmokeTest extends AbstractKotlinPluginSmokeTest {
         def kotlinVersionNumber = VersionNumber.parse(kotlinVersion)
 
         when:
-        def result = kgpRunner(false, kotlinVersionNumber, ':tasks').build()
+        def result = kgpRunner(false, kotlinVersionNumber, ':tasks')
+            .expectDeprecationWarningIf(
+                kotlinVersionNumber.baseVersion > KotlinGradlePluginVersions.KOTLIN_2_1_20,
+                "The archives configuration has been deprecated for artifact declaration. This will fail with an error in Gradle 10. Add artifacts as direct task dependencies of the 'assemble' task instead of declaring them in the archives configuration. Consult the upgrading guide for further information: https://docs.gradle.org/${GradleVersion.current().version}/userguide/upgrading_version_9.html#sec:archives-configuration",
+                "https://youtrack.jetbrains.com/issue/KT-78620"
+            )
+            .build()
 
         then:
         result.task(':tasks').outcome == SUCCESS
@@ -166,6 +182,11 @@ class KotlinMultiplatformPluginSmokeTest extends AbstractKotlinPluginSmokeTest {
 
         when:
         def testRunner = kgpRunner(false, kotlinVersionNumber, ':resolve', '--stacktrace')
+            .expectDeprecationWarningIf(
+                kotlinVersionNumber.baseVersion > KotlinGradlePluginVersions.KOTLIN_2_1_20,
+                "The archives configuration has been deprecated for artifact declaration. This will fail with an error in Gradle 10. Add artifacts as direct task dependencies of the 'assemble' task instead of declaring them in the archives configuration. Consult the upgrading guide for further information: https://docs.gradle.org/${GradleVersion.current().version}/userguide/upgrading_version_9.html#sec:archives-configuration",
+                "https://youtrack.jetbrains.com/issue/KT-78620"
+            )
         def result = testRunner.build()
 
         then:
diff --git a/testing/smoke-test/src/smokeTest/groovy/org/gradle/smoketests/ShadowPluginSmokeTest.groovy b/testing/smoke-test/src/smokeTest/groovy/org/gradle/smoketests/ShadowPluginSmokeTest.groovy
index 551f2526332..098ae70eb2b 100644
--- a/testing/smoke-test/src/smokeTest/groovy/org/gradle/smoketests/ShadowPluginSmokeTest.groovy
+++ b/testing/smoke-test/src/smokeTest/groovy/org/gradle/smoketests/ShadowPluginSmokeTest.groovy
@@ -16,15 +16,11 @@
 
 package org.gradle.smoketests
 
-
 import org.gradle.integtests.fixtures.executer.GradleContextualExecuter
-import org.gradle.test.precondition.Requires
-import org.gradle.test.preconditions.UnitTestPreconditions
 import spock.lang.Issue
 
 import static org.gradle.testkit.runner.TaskOutcome.SUCCESS
 
-@Requires(UnitTestPreconditions.Jdk11OrLater)
 class ShadowPluginSmokeTest extends AbstractPluginValidatingSmokeTest {
 
     @Issue('https://plugins.gradle.org/plugin/com.gradleup.shadow')
@@ -46,6 +42,7 @@ class ShadowPluginSmokeTest extends AbstractPluginValidatingSmokeTest {
 
             shadowJar {
                 transform(ServiceFileTransformer)
+                relocate("org.apache.commons.collections", "shadow.org.apache.commons.collections")
 
                 manifest {
                     attributes 'Test-Entry': 'PASSED'
@@ -53,6 +50,41 @@ class ShadowPluginSmokeTest extends AbstractPluginValidatingSmokeTest {
             }
             """.stripIndent()
 
+        file("src/main/java/org/example/ExampleAnnotation.java").java """
+            package org.example;
+            public @interface ExampleAnnotation {
+                String value() default "default";
+                int otherValue() default 42;
+            }
+        """
+        file("src/main/java/org/example/BidiMapExample.java").java """
+            package org.example;
+
+            import org.apache.commons.collections.BidiMap;
+            import org.apache.commons.collections.MapIterator;
+            import org.apache.commons.collections.bidimap.DualHashBidiMap;
+
+            public class BidiMapExample {
+                public static void main(String[] args) {
+                    BidiMap bidi = new DualHashBidiMap();
+                    bidi.put("key1", 1);
+                    bidi.put("key2", 2);
+
+                    // Get value by key
+                    System.out.println("Value for key2: " + bidi.get("key2")); // Output: 2
+
+                    // Get key by value
+                    System.out.println("Key for value 1: " + bidi.getKey(1)); // Output: key1
+
+                    // Iterate through the map
+                    MapIterator it = bidi.mapIterator();
+                    while (it.hasNext()) {
+                        it.next();
+                        System.out.println("Key: " + it.getKey() + ", Value: " + it.getValue());
+                    }
+                }
+            }
+            """
 
         when:
 
