diff --git a/core-processor/src/main/java/io/micronaut/inject/annotation/AnnotationMetadataWriter.java b/core-processor/src/main/java/io/micronaut/inject/annotation/AnnotationMetadataWriter.java
index 1b985c2363..5db7acb98e 100644
--- a/core-processor/src/main/java/io/micronaut/inject/annotation/AnnotationMetadataWriter.java
+++ b/core-processor/src/main/java/io/micronaut/inject/annotation/AnnotationMetadataWriter.java
@@ -591,15 +591,11 @@ public class AnnotationMetadataWriter extends AbstractClassFileWriter {
                 invokeLoadClassValueMethod(declaringType, declaringClassWriter, methodVisitor, loadTypeMethods, acv);
             }
         } else if (value instanceof Enum<?> enumObject) {
-            methodVisitor.push(enumObject.name()); // Always store enum values as string
+            Class<?> declaringClass = enumObject.getDeclaringClass();
+            Type t = Type.getType(declaringClass);
+            methodVisitor.getStatic(t, enumObject.name(), t);
         } else if (value.getClass().isArray()) {
-            Class<?> jt;
-            Class<?> arrayComponentType = value.getClass().getComponentType();
-            if (arrayComponentType.isEnum() || arrayComponentType.equals(java.lang.Enum.class)) {
-                jt = String.class; // Always store enum values as string
-            } else {
-                jt = ReflectionUtils.getPrimitiveType(arrayComponentType);
-            }
+            Class<?> jt = ReflectionUtils.getPrimitiveType(value.getClass().getComponentType());
             final Type componentType = Type.getType(jt);
             int len = Array.getLength(value);
             if (Object.class == jt && len == 0) {
diff --git a/core-processor/src/main/java/io/micronaut/inject/beans/visitor/IntrospectedTypeElementVisitor.java b/core-processor/src/main/java/io/micronaut/inject/beans/visitor/IntrospectedTypeElementVisitor.java
index 2e5f2d77b9..44407f9be0 100644
--- a/core-processor/src/main/java/io/micronaut/inject/beans/visitor/IntrospectedTypeElementVisitor.java
+++ b/core-processor/src/main/java/io/micronaut/inject/beans/visitor/IntrospectedTypeElementVisitor.java
@@ -33,6 +33,7 @@ import io.micronaut.inject.ast.ElementQuery;
 import io.micronaut.inject.ast.MethodElement;
 import io.micronaut.inject.ast.PropertyElement;
 import io.micronaut.inject.ast.PropertyElementQuery;
+import io.micronaut.inject.visitor.ElementPostponedToNextRoundException;
 import io.micronaut.inject.visitor.TypeElementVisitor;
 import io.micronaut.inject.visitor.VisitorContext;
 import io.micronaut.inject.writer.ClassGenerationException;
@@ -256,13 +257,16 @@ public class IntrospectedTypeElementVisitor implements TypeElementVisitor<Object
     public void finish(VisitorContext visitorContext) {
         try {
             if (!writers.isEmpty()) {
-                for (BeanIntrospectionWriter writer : writers.values()) {
+                writers.forEach((className, writer) -> {
                     try {
                         writer.accept(visitorContext);
+                    } catch (ElementPostponedToNextRoundException ignore) {
+                        // Ignore, next round will redo
                     } catch (IOException e) {
                         throw new ClassGenerationException("I/O error occurred during class generation: " + e.getMessage(), e);
                     }
-                }
+                });
+
             }
         } finally {
             writers.clear();
diff --git a/core-processor/src/main/java/io/micronaut/inject/visitor/ElementPostponedToNextRoundException.java b/core-processor/src/main/java/io/micronaut/inject/visitor/ElementPostponedToNextRoundException.java
new file mode 100644
index 0000000000..74daed3dde
--- /dev/null
+++ b/core-processor/src/main/java/io/micronaut/inject/visitor/ElementPostponedToNextRoundException.java
@@ -0,0 +1,46 @@
+/*
+ * Copyright 2017-2020 original authors
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * https://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package io.micronaut.inject.visitor;
+
+import io.micronaut.core.annotation.Internal;
+import io.micronaut.core.annotation.NonNull;
+import io.micronaut.inject.ast.Element;
+
+/**
+ * Exception is thrown when the visitor is attempted to create a new file but the originated element is postponed to the next round.
+ *
+ * @author Denis Stepanov
+ * @since 4.7
+ */
+@Internal
+public final class ElementPostponedToNextRoundException extends RuntimeException {
+
+    private final Element originatingElement;
+
+    /**
+     * @param originatingElement The originating element
+     */
+    public ElementPostponedToNextRoundException(@NonNull Element originatingElement) {
+        super("Original element: " + originatingElement.getName() + " is postponed to the next round!");
+        this.originatingElement = originatingElement;
+    }
+
+    @NonNull
+    public Element getOriginatingElement() {
+        return originatingElement;
+    }
+
+}
diff --git a/core/src/main/java/io/micronaut/core/io/buffer/ByteArrayByteBuffer.java b/core/src/main/java/io/micronaut/core/io/buffer/ByteArrayByteBuffer.java
index 0303dad496..c2350c3a84 100644
--- a/core/src/main/java/io/micronaut/core/io/buffer/ByteArrayByteBuffer.java
+++ b/core/src/main/java/io/micronaut/core/io/buffer/ByteArrayByteBuffer.java
@@ -31,7 +31,7 @@ import java.util.Arrays;
  */
 @Internal
 @Experimental
-public class ByteArrayByteBuffer implements ByteBuffer<byte[]> {
+public final class ByteArrayByteBuffer implements ByteBuffer<byte[]> {
 
     private final byte[] underlyingBytes;
     private int readerIndex;
diff --git a/core/src/test/groovy/io/micronaut/core/io/buffer/ByteArrayByteBufferSpec.groovy b/core/src/test/groovy/io/micronaut/core/io/buffer/ByteArrayByteBufferSpec.groovy
new file mode 100644
index 0000000000..37eb288aa2
--- /dev/null
+++ b/core/src/test/groovy/io/micronaut/core/io/buffer/ByteArrayByteBufferSpec.groovy
@@ -0,0 +1,126 @@
+package io.micronaut.core.io.buffer
+
+import spock.lang.Specification
+
+import java.nio.charset.StandardCharsets
+
+class ByteArrayByteBufferSpec extends Specification {
+
+    void 'test creating a buffer'() {
+        given:
+        def bytes = 'abcdefghij'.bytes
+        def buffer = new ByteArrayByteBuffer(bytes)
+
+        expect:
+        buffer.toByteArray() == bytes
+        buffer.maxCapacity() == 10
+
+        buffer.readableBytes() == 10
+        buffer.readerIndex() == 0
+
+        buffer.writableBytes() == 10
+        buffer.writerIndex() == 0
+    }
+
+    void 'test copying a buffer'() {
+        given:
+        def bytes = 'abcdefghij'.bytes
+        def buffer = new ByteArrayByteBuffer(bytes)
+
+        when:
+        def sliced = buffer.slice(1, 5)
+
+        then:
+        sliced.toByteArray() == 'bcdef'.bytes
+
+        when:
+        def expanded = new ByteArrayByteBuffer(buffer.toByteArray(), 20)
+
+        then:
+        expanded.readerIndex() == 0
+        expanded.readableBytes() == 20
+        expanded.toByteArray() == 'abcdefghij\0\0\0\0\0\0\0\0\0\0'.bytes
+
+        when:
+        def shrunk = new ByteArrayByteBuffer(buffer.toByteArray(), 5)
+
+        then:
+        shrunk.readerIndex() == 0
+        shrunk.readableBytes() == 5
+        shrunk.toByteArray() == 'abcde'.bytes
+    }
+
+    void 'test inputstream creation'() {
+        given:
+        def bytes = 'abcdefghij'.bytes
+        def buffer = new ByteArrayByteBuffer(bytes)
+
+        when:
+        def stream = buffer.toInputStream()
+
+        then:
+        stream.readAllBytes() == bytes
+    }
+
+    void 'test writing'() {
+        given:
+        def bytes = 'abcdefghij'.bytes
+        def buffer = new ByteArrayByteBuffer(bytes)
+
+        when:
+        buffer.write('12345'.bytes)
+
+        then:
+        buffer.toByteArray() == '12345fghij'.bytes
+        buffer.readerIndex() == 0
+        buffer.readableBytes() == 10
+
+        buffer.writerIndex() == 5
+        buffer.writableBytes() == 5
+
+        when:
+        buffer = new ByteArrayByteBuffer('abcdefghij'.bytes)
+        buffer.writerIndex(5)
+        buffer.write('T', StandardCharsets.UTF_8)
+
+        then:
+        buffer.toByteArray() == 'abcdeTghij'.bytes
+        buffer.readerIndex() == 0
+        buffer.readableBytes() == 10
+        buffer.writerIndex() == 6
+        buffer.writableBytes() == 4
+    }
+
+    void 'test reading'() {
+        given:
+        def bytes = 'abcdefghij'.bytes
+        def buffer = new ByteArrayByteBuffer(bytes)
+        def target = new byte[5]
+
+        when:
+        buffer.read(target)
+
+        then:
+        target == 'abcde'.bytes
+        buffer.readerIndex() == 5
+        buffer.readableBytes() == 5
+
+        buffer.writerIndex() == 0
+        buffer.writableBytes() == 10
+
+        when:
+        target = new byte[5]
+        buffer = new ByteArrayByteBuffer('abcdefghij'.bytes)
+        buffer.readerIndex(5)
+        buffer.read(target, 3, 5)
+
+        then:
+        target == '\0\0\0fg'.bytes
+        buffer.writerIndex() == 0
+        buffer.writableBytes() == 10
+
+        and: 'we only read 2 elements'
+        buffer.readerIndex() == 7
+        buffer.readableBytes() == 3
+    }
+}
diff --git a/inject-java/src/main/java/io/micronaut/annotation/processing/AbstractInjectAnnotationProcessor.java b/inject-java/src/main/java/io/micronaut/annotation/processing/AbstractInjectAnnotationProcessor.java
index 4af276bb43..fa937b43f0 100644
--- a/inject-java/src/main/java/io/micronaut/annotation/processing/AbstractInjectAnnotationProcessor.java
+++ b/inject-java/src/main/java/io/micronaut/annotation/processing/AbstractInjectAnnotationProcessor.java
@@ -36,6 +36,7 @@ import java.util.Arrays;
 import java.util.Collections;
 import java.util.HashMap;
 import java.util.HashSet;
+import java.util.LinkedHashSet;
 import java.util.Map;
 import java.util.Set;
 
@@ -77,6 +78,7 @@ abstract class AbstractInjectAnnotationProcessor extends AbstractProcessor {
     private final Set<String> supportedAnnotationTypes = new HashSet<>(5);
     private final Map<String, Boolean> isProcessedCache = new HashMap<>(30);
     private Set<String> processedTypes;
+    protected Set<String> postponedTypes = new LinkedHashSet<>();
 
     @Override
     public SourceVersion getSupportedSourceVersion() {
@@ -216,7 +218,8 @@ abstract class AbstractInjectAnnotationProcessor extends AbstractProcessor {
             modelUtils,
             filer,
             visitorAttributes,
-            getVisitorKind()
+            getVisitorKind(),
+            postponedTypes
         );
     }
 
diff --git a/inject-java/src/main/java/io/micronaut/annotation/processing/AnnotationUtils.java b/inject-java/src/main/java/io/micronaut/annotation/processing/AnnotationUtils.java
index 067c42e35b..81685124ce 100644
--- a/inject-java/src/main/java/io/micronaut/annotation/processing/AnnotationUtils.java
+++ b/inject-java/src/main/java/io/micronaut/annotation/processing/AnnotationUtils.java
@@ -29,6 +29,7 @@ import javax.annotation.processing.Messager;
 import javax.annotation.processing.ProcessingEnvironment;
 import javax.lang.model.util.Elements;
 import javax.lang.model.util.Types;
+import java.util.Set;
 
 /**
  * Utility methods for annotations.
@@ -143,7 +144,8 @@ public class AnnotationUtils {
             modelUtils,
             filer,
             visitorAttributes,
-            TypeElementVisitor.VisitorKind.ISOLATING
+            TypeElementVisitor.VisitorKind.ISOLATING,
+            Set.of()
         );
     }
 
diff --git a/inject-java/src/main/java/io/micronaut/annotation/processing/TypeElementVisitorProcessor.java b/inject-java/src/main/java/io/micronaut/annotation/processing/TypeElementVisitorProcessor.java
index 9822fdb1b7..3eacf20325 100644
--- a/inject-java/src/main/java/io/micronaut/annotation/processing/TypeElementVisitorProcessor.java
+++ b/inject-java/src/main/java/io/micronaut/annotation/processing/TypeElementVisitorProcessor.java
@@ -107,7 +107,6 @@ public class TypeElementVisitorProcessor extends AbstractInjectAnnotationProcess
 
     private List<LoadedVisitor> loadedVisitors;
     private Collection<? extends TypeElementVisitor<?, ?>> typeElementVisitors;
-    private final Set<String> pendingTypes = new LinkedHashSet<>();
 
     /**
      * The visited annotation names.
@@ -241,8 +240,8 @@ public class TypeElementVisitorProcessor extends AbstractInjectAnnotationProcess
                 roundEnv.getRootElements()
             ).filter(notGroovyObject).forEach(elements::add);
 
-            pendingTypes.stream().map(elementUtils::getTypeElement).filter(Objects::nonNull).forEach(elements::add);
-            pendingTypes.clear();
+            postponedTypes.stream().map(elementUtils::getTypeElement).filter(Objects::nonNull).forEach(elements::add);
+            postponedTypes.clear();
 
             if (!elements.isEmpty()) {
 
@@ -272,7 +271,7 @@ public class TypeElementVisitorProcessor extends AbstractInjectAnnotationProcess
                             }
                             error(originatingElement.element(), e.getMessage());
                         } catch (PostponeToNextRoundException e) {
-                            pendingTypes.add(javaClassElement.getName());
+                            postponedTypes.add(javaClassElement.getName());
                         }
                     }
                 }
diff --git a/inject-java/src/main/java/io/micronaut/annotation/processing/visitor/JavaClassElement.java b/inject-java/src/main/java/io/micronaut/annotation/processing/visitor/JavaClassElement.java
index 4dbefa908f..d9059e1f78 100644
--- a/inject-java/src/main/java/io/micronaut/annotation/processing/visitor/JavaClassElement.java
+++ b/inject-java/src/main/java/io/micronaut/annotation/processing/visitor/JavaClassElement.java
@@ -52,6 +52,7 @@ import javax.lang.model.element.TypeElement;
 import javax.lang.model.element.TypeParameterElement;
 import javax.lang.model.element.VariableElement;
 import javax.lang.model.type.DeclaredType;
+import javax.lang.model.type.TypeKind;
 import javax.lang.model.type.TypeMirror;
 import javax.lang.model.util.Types;
 import java.lang.annotation.Annotation;
@@ -265,11 +266,15 @@ public class JavaClassElement extends AbstractJavaElement implements ArrayableCl
     @Override
     public Collection<ClassElement> getInterfaces() {
         if (resolvedInterfaces == null) {
-            resolvedInterfaces = classElement.getInterfaces().stream().map(mirror -> newClassElement(mirror, getTypeArguments())).toList();
+            resolvedInterfaces = classElement.getInterfaces().stream().filter(this::onlyAvailable).map(mirror -> newClassElement(mirror, getTypeArguments())).toList();
         }
         return resolvedInterfaces;
     }
 
+    private boolean onlyAvailable(TypeMirror mirror) {
+        return !(mirror instanceof DeclaredType declaredType) || declaredType.getKind() != TypeKind.ERROR;
+    }
+
     @Override
     public Optional<ClassElement> getSuperType() {
         if (resolvedSuperType == null) {
diff --git a/inject-java/src/main/java/io/micronaut/annotation/processing/visitor/JavaVisitorContext.java b/inject-java/src/main/java/io/micronaut/annotation/processing/visitor/JavaVisitorContext.java
index b9966d8988..be7a7e5662 100644
--- a/inject-java/src/main/java/io/micronaut/annotation/processing/visitor/JavaVisitorContext.java
+++ b/inject-java/src/main/java/io/micronaut/annotation/processing/visitor/JavaVisitorContext.java
@@ -17,6 +17,7 @@ package io.micronaut.annotation.processing.visitor;
 
 import io.micronaut.annotation.processing.AnnotationProcessingOutputVisitor;
 import io.micronaut.annotation.processing.AnnotationUtils;
+import io.micronaut.inject.visitor.ElementPostponedToNextRoundException;
 import io.micronaut.annotation.processing.GenericUtils;
 import io.micronaut.annotation.processing.JavaAnnotationMetadataBuilder;
 import io.micronaut.annotation.processing.JavaElementAnnotationMetadataFactory;
@@ -66,6 +67,7 @@ import java.util.Arrays;
 import java.util.Collection;
 import java.util.Collections;
 import java.util.Enumeration;
+import java.util.HashSet;
 import java.util.List;
 import java.util.Map;
 import java.util.Optional;
@@ -100,6 +102,7 @@ public final class JavaVisitorContext implements VisitorContext, BeanElementVisi
     private final JavaElementAnnotationMetadataFactory elementAnnotationMetadataFactory;
     private final JavaNativeElementsHelper nativeElementsHelper;
     private final Filer filer;
+    private final Set<String> postponedTypes;
 
     /**
      * The default constructor.
@@ -128,7 +131,7 @@ public final class JavaVisitorContext implements VisitorContext, BeanElementVisi
         Filer filer,
         MutableConvertibleValues<Object> visitorAttributes,
         TypeElementVisitor.VisitorKind visitorKind) {
-        this(processingEnv, messager, elements, types, modelUtils, filer, visitorAttributes, visitorKind);
+        this(processingEnv, messager, elements, types, modelUtils, filer, visitorAttributes, visitorKind, new HashSet<>());
     }
 
     /**
@@ -142,7 +145,9 @@ public final class JavaVisitorContext implements VisitorContext, BeanElementVisi
      * @param filer The filer
      * @param visitorAttributes The attributes
      * @param visitorKind The visitor kind
+     * @deprecated No longer needed
      */
+    @Deprecated(forRemoval = true, since = "4.7.0")
     public JavaVisitorContext(
         ProcessingEnvironment processingEnv,
         Messager messager,
@@ -152,6 +157,32 @@ public final class JavaVisitorContext implements VisitorContext, BeanElementVisi
         Filer filer,
         MutableConvertibleValues<Object> visitorAttributes,
         TypeElementVisitor.VisitorKind visitorKind) {
+        this(processingEnv, messager, elements, types, modelUtils, filer, visitorAttributes, visitorKind, Set.of());
+    }
+
+    /**
+     * The default constructor.
+     *
+     * @param processingEnv The processing environment
+     * @param messager The messager
+     * @param elements The elements
+     * @param types Type types
+     * @param modelUtils The model utils
+     * @param filer The filer
+     * @param visitorAttributes The attributes
+     * @param visitorKind The visitor kind
+     * @param postponedTypes The postponed types
+     */
+    public JavaVisitorContext(
+        ProcessingEnvironment processingEnv,
+        Messager messager,
+        Elements elements,
+        Types types,
+        ModelUtils modelUtils,
+        Filer filer,
+        MutableConvertibleValues<Object> visitorAttributes,
+        TypeElementVisitor.VisitorKind visitorKind,
+        Set<String> postponedTypes) {
         this.messager = messager;
         this.elements = elements;
         this.types = types;
@@ -166,6 +197,7 @@ public final class JavaVisitorContext implements VisitorContext, BeanElementVisi
         this.elementAnnotationMetadataFactory = new JavaElementAnnotationMetadataFactory(false, this.annotationMetadataBuilder);
         this.expressionCompilationContextFactory = new DefaultExpressionCompilationContextFactory(this);
         this.filer = filer;
+        this.postponedTypes = postponedTypes;
     }
 
     @Override
@@ -321,13 +353,29 @@ public final class JavaVisitorContext implements VisitorContext, BeanElementVisi
         }
     }
 
+    private void checkForPostponedOriginalElement(io.micronaut.inject.ast.Element originatingElement) {
+        if (originatingElement != null && postponedTypes.contains(originatingElement.getName())) {
+            throw new ElementPostponedToNextRoundException(originatingElement);
+        }
+    }
+
+    private void checkForPostponedOriginalElements(io.micronaut.inject.ast.Element[] originatingElements) {
+        if (originatingElements != null) {
+            for (io.micronaut.inject.ast.Element originatingElement : originatingElements) {
+                checkForPostponedOriginalElement(originatingElement);
+            }
+        }
+    }
+
     @Override
     public OutputStream visitClass(String classname, @Nullable io.micronaut.inject.ast.Element originatingElement) throws IOException {
+        checkForPostponedOriginalElement(originatingElement);
         return outputVisitor.visitClass(classname, new io.micronaut.inject.ast.Element[] {originatingElement});
     }
 
     @Override
     public OutputStream visitClass(String classname, io.micronaut.inject.ast.Element... originatingElements) throws IOException {
+        checkForPostponedOriginalElements(originatingElements);
         return outputVisitor.visitClass(classname, originatingElements);
     }
 
@@ -338,11 +386,13 @@ public final class JavaVisitorContext implements VisitorContext, BeanElementVisi
 
     @Override
     public void visitServiceDescriptor(String type, String classname, io.micronaut.inject.ast.Element originatingElement) {
+        checkForPostponedOriginalElement(originatingElement);
         outputVisitor.visitServiceDescriptor(type, classname, originatingElement);
     }
 
     @Override
     public Optional<GeneratedFile> visitMetaInfFile(String path, io.micronaut.inject.ast.Element... originatingElements) {
+        checkForPostponedOriginalElements(originatingElements);
         return outputVisitor.visitMetaInfFile(path, originatingElements);
     }
 
@@ -353,11 +403,13 @@ public final class JavaVisitorContext implements VisitorContext, BeanElementVisi
 
     @Override
     public Optional<GeneratedFile> visitGeneratedFile(String path, io.micronaut.inject.ast.Element... originatingElements) {
+        checkForPostponedOriginalElements(originatingElements);
         return outputVisitor.visitGeneratedFile(path, originatingElements);
     }
 
     @Override
     public Optional<GeneratedFile> visitGeneratedSourceFile(String packageName, String fileNameWithoutExtension, io.micronaut.inject.ast.Element... originatingElements) {
+        checkForPostponedOriginalElements(originatingElements);
         return outputVisitor.visitGeneratedSourceFile(packageName, fileNameWithoutExtension, originatingElements);
     }
 
diff --git a/inject-java/src/test/groovy/io/micronaut/visitors/PostponedVisitorsSpec.groovy b/inject-java/src/test/groovy/io/micronaut/visitors/PostponedVisitorsSpec.groovy
new file mode 100644
index 0000000000..e2a6d86f44
--- /dev/null
+++ b/inject-java/src/test/groovy/io/micronaut/visitors/PostponedVisitorsSpec.groovy
@@ -0,0 +1,31 @@
+package io.micronaut.visitors
+
+
+import io.micronaut.annotation.processing.test.AbstractTypeElementSpec
+
+class PostponedVisitorsSpec extends AbstractTypeElementSpec {
+
+    void 'test'() {
+        when:
+            def definition = buildBeanIntrospection('test.Walrus', '''
+package test;
+
+import io.micronaut.core.annotation.Introspected;
+import io.micronaut.core.annotation.NonNull;
+import io.micronaut.visitors.Wither;
+
+@Introspected
+@Wither
+public record Walrus (
+    @NonNull
+    String name,
+    int age,
+    byte[] chipInfo
+) implements WalrusWither  {
+}
+
+''')
+        then:
+            definition
+    }
+}
diff --git a/inject-java/src/test/groovy/io/micronaut/visitors/Wither.java b/inject-java/src/test/groovy/io/micronaut/visitors/Wither.java
new file mode 100644
index 0000000000..c07c477900
--- /dev/null
+++ b/inject-java/src/test/groovy/io/micronaut/visitors/Wither.java
@@ -0,0 +1,8 @@
+package io.micronaut.visitors;
+
+import java.lang.annotation.Retention;
+import java.lang.annotation.RetentionPolicy;
+
+@Retention(RetentionPolicy.RUNTIME)
+public @interface Wither {
+}
diff --git a/inject-java/src/test/groovy/io/micronaut/visitors/WitherVisitor.java b/inject-java/src/test/groovy/io/micronaut/visitors/WitherVisitor.java
new file mode 100644
index 0000000000..682385d143
--- /dev/null
+++ b/inject-java/src/test/groovy/io/micronaut/visitors/WitherVisitor.java
@@ -0,0 +1,47 @@
+package io.micronaut.visitors;
+
+import io.micronaut.inject.ast.ClassElement;
+import io.micronaut.inject.processing.ProcessingException;
+import io.micronaut.inject.visitor.TypeElementVisitor;
+import io.micronaut.inject.visitor.VisitorContext;
+
+public class WitherVisitor implements TypeElementVisitor<Wither, Object> {
+
+    @Override
+    public void visitClass(ClassElement element, VisitorContext context) {
+            context.visitGeneratedSourceFile(
+                "test",
+                "WalrusWither",
+                element
+            ).ifPresent(sourceFile -> {
+                try {
+                    sourceFile.write(writer -> writer.write("""
+                        package test;
+
+                        public interface WalrusWither {
+                            String name();
+
+                            int age();
+
+                            byte[] chipInfo();
+
+                            default Walrus withName(String name) {
+                                return new Walrus(name, this.age(), this.chipInfo());
+                            }
+
+                            default Walrus withAge(int age) {
+                                return new Walrus(this.name(), age, this.chipInfo());
+                            }
+
+                            default Walrus withChipInfo(byte[] chipInfo) {
+                                return new Walrus(this.name(), this.age(), chipInfo);
+                            }
+                        }
+                        """));
+                } catch (Exception e) {
+                    throw new ProcessingException(element, "Failed to generate a Wither: " + e.getMessage(), e);
+                }
+            });
+    }
+
+}
diff --git a/inject-java/src/test/resources/META-INF/services/io.micronaut.inject.visitor.TypeElementVisitor b/inject-java/src/test/resources/META-INF/services/io.micronaut.inject.visitor.TypeElementVisitor
index 71ade81eba..e8e846e183 100644
--- a/inject-java/src/test/resources/META-INF/services/io.micronaut.inject.visitor.TypeElementVisitor
+++ b/inject-java/src/test/resources/META-INF/services/io.micronaut.inject.visitor.TypeElementVisitor
@@ -19,3 +19,4 @@ io.micronaut.annotation.AnnotatePropertySpec$AnnotatePropertyVisitor
 io.micronaut.annotation.AnnotateClassSpec$AnnotateClassVisitor
 io.micronaut.annotation.AnnotateTypeArgSpec$AnnotateTypeArgVisitor
 io.micronaut.aop.introduction.beans.MyRepoVisitor2
+io.micronaut.visitors.WitherVisitor
diff --git a/settings.gradle b/settings.gradle
index de7de3415e..572b01cdb8 100644
--- a/settings.gradle
+++ b/settings.gradle
@@ -84,8 +84,6 @@ include "test-suite-logback-graalvm"
 include "test-suite-netty-ssl-graalvm"
 include "test-suite-kotlin-graalvm"
 include "test-utils"
-include "test-suite-annotation-remapper"
-include "test-suite-annotation-remapper-visitor"
 
 // benchmarks
 include "benchmarks"
diff --git a/test-suite-annotation-remapper-visitor/build.gradle b/test-suite-annotation-remapper-visitor/build.gradle
deleted file mode 100644
index b5758ffb82..0000000000
--- a/test-suite-annotation-remapper-visitor/build.gradle
+++ /dev/null
@@ -1,11 +0,0 @@
-plugins {
-    id "java"
-}
-
-description = "A simple remapping visitor"
-
-dependencies {
-    implementation(projects.injectJava)
-    // Use an enum that shouldn't be present and the runtime to simulate added enum value that doesn't exist
-    implementation libs.blaze.persistence.core
-}
diff --git a/test-suite-annotation-remapper-visitor/src/main/java/example/micronaut/AddAnnotationWithEnumVisitor.java b/test-suite-annotation-remapper-visitor/src/main/java/example/micronaut/AddAnnotationWithEnumVisitor.java
deleted file mode 100644
index 2c5355d76c..0000000000
--- a/test-suite-annotation-remapper-visitor/src/main/java/example/micronaut/AddAnnotationWithEnumVisitor.java
+++ /dev/null
@@ -1,21 +0,0 @@
-package example.micronaut;
-
-import com.blazebit.persistence.spi.JpqlFunctionKind;
-import io.micronaut.inject.ast.ClassElement;
-import io.micronaut.inject.visitor.TypeElementVisitor;
-import io.micronaut.inject.visitor.VisitorContext;
-
-public class AddAnnotationWithEnumVisitor implements TypeElementVisitor<Object, Object> {
-
-    @Override
-    public VisitorKind getVisitorKind() {
-        return VisitorKind.ISOLATING;
-    }
-
-    @Override
-    public void visitClass(ClassElement element, VisitorContext context) {
-            // Simulate annotating with enum value
-            // Micronaut should store the string value and not the enum value in the metadata
-        element.annotate("Something", builder -> builder.value(JpqlFunctionKind.DETERMINISTIC));
-    }
-}
diff --git a/test-suite-annotation-remapper-visitor/src/main/resources/META-INF/services/io.micronaut.inject.visitor.TypeElementVisitor b/test-suite-annotation-remapper-visitor/src/main/resources/META-INF/services/io.micronaut.inject.visitor.TypeElementVisitor
deleted file mode 100644
index d630212781..0000000000
--- a/test-suite-annotation-remapper-visitor/src/main/resources/META-INF/services/io.micronaut.inject.visitor.TypeElementVisitor
+++ /dev/null
@@ -1 +0,0 @@
-example.micronaut.AddAnnotationWithEnumVisitor
diff --git a/test-suite-annotation-remapper/build.gradle b/test-suite-annotation-remapper/build.gradle
deleted file mode 100644
index cf05507e95..0000000000
--- a/test-suite-annotation-remapper/build.gradle
+++ /dev/null
@@ -1,34 +0,0 @@
-plugins {
-    id "java"
-    id "org.graalvm.buildtools.native"
-}
-
-description = "Test suite for definitions with added enum values"
-
-tasks.withType(Test).configureEach {
-    useJUnitPlatform()
-}
-
-dependencies {
-    testAnnotationProcessor(projects.testSuiteAnnotationRemapperVisitor)
-    testAnnotationProcessor(projects.injectJava)
-    testImplementation(projects.httpServerNetty)
-    implementation(projects.jacksonDatabind)
-    testImplementation(projects.httpClient)
-    testImplementation(libs.logback.classic)
-    testImplementation(libs.micronaut.test.junit5) {
-        exclude group: 'io.micronaut'
-    }
-}
-
-graalvmNative {
-    toolchainDetection = false
-    metadataRepository {
-        enabled = true
-    }
-    binaries {
-        configureEach {
-            resources.autodetect()
-        }
-    }
-}
diff --git a/test-suite-annotation-remapper/src/test/java/example/micronaut/HelloController.java b/test-suite-annotation-remapper/src/test/java/example/micronaut/HelloController.java
deleted file mode 100644
index eccfd9d5de..0000000000
--- a/test-suite-annotation-remapper/src/test/java/example/micronaut/HelloController.java
+++ /dev/null
@@ -1,13 +0,0 @@
-package example.micronaut;
-
-import io.micronaut.http.annotation.Controller;
-import io.micronaut.http.annotation.Get;
-
-@Controller("/hello")
-public class HelloController {
-
-    @Get
-    public MyRecord index() {
-        return new MyRecord("Denis", 123);
-    }
-}
diff --git a/test-suite-annotation-remapper/src/test/java/example/micronaut/HelloControllerTest.java b/test-suite-annotation-remapper/src/test/java/example/micronaut/HelloControllerTest.java
deleted file mode 100644
index 60b3a99046..0000000000
--- a/test-suite-annotation-remapper/src/test/java/example/micronaut/HelloControllerTest.java
+++ /dev/null
@@ -1,39 +0,0 @@
-package example.micronaut;
-
-import io.micronaut.context.BeanContext;
-import io.micronaut.http.HttpRequest;
-import io.micronaut.http.client.HttpClient;
-import io.micronaut.http.client.annotation.Client;
-import io.micronaut.inject.BeanDefinition;
-import io.micronaut.test.extensions.junit5.annotation.MicronautTest;
-import jakarta.inject.Inject;
-import org.junit.jupiter.api.Test;
-
-import static org.junit.jupiter.api.Assertions.assertEquals;
-import static org.junit.jupiter.api.Assertions.assertTrue;
-
-@MicronautTest
-public class HelloControllerTest {
-
-    @Inject
-    @Client("/")
-    HttpClient client;
-
-    @Inject
-    BeanContext beanContext;
-
-    @Test
-    void testHelloWorldResponse() {
-        String response = client.toBlocking()
-            .retrieve(HttpRequest.GET("/hello"));
-        assertEquals("""
-            {"name":"Denis","age":123}""", response);
-    }
-
-    @Test
-    void testNewAnnotationIsAdded() {
-        BeanDefinition<HelloController> beanDefinition = beanContext.getBeanDefinition(HelloController.class);
-        assertTrue(beanDefinition.hasAnnotation("Something"));
-    }
-
-}
diff --git a/test-suite-annotation-remapper/src/test/java/example/micronaut/MyRecord.java b/test-suite-annotation-remapper/src/test/java/example/micronaut/MyRecord.java
deleted file mode 100644
index 20f7cccd9f..0000000000
--- a/test-suite-annotation-remapper/src/test/java/example/micronaut/MyRecord.java
+++ /dev/null
@@ -1,7 +0,0 @@
-package example.micronaut;
-
-import io.micronaut.core.annotation.Introspected;
-
-@Introspected
-public record MyRecord(String name, int age) {
-}
diff --git a/test-suite-annotation-remapper/src/test/resources/logback.xml b/test-suite-annotation-remapper/src/test/resources/logback.xml
deleted file mode 100644
index 18fd1cc91f..0000000000
--- a/test-suite-annotation-remapper/src/test/resources/logback.xml
+++ /dev/null
@@ -1,16 +0,0 @@
-<configuration>
-
-    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
-        <!-- encoders are assigned the type
-             ch.qos.logback.classic.encoder.PatternLayoutEncoder by default -->
-        <encoder>
-            <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
-        </encoder>
-    </appender>
-
-    <root level="info">
-        <appender-ref ref="STDOUT" />
-    </root>
-
-</configuration>
-
