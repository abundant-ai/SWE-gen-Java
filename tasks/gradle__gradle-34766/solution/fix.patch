diff --git a/.teamcity/src/main/kotlin/common/CommonExtensions.kt b/.teamcity/src/main/kotlin/common/CommonExtensions.kt
index e8456ffcb83..c039c465f74 100644
--- a/.teamcity/src/main/kotlin/common/CommonExtensions.kt
+++ b/.teamcity/src/main/kotlin/common/CommonExtensions.kt
@@ -332,10 +332,11 @@ fun functionalTestParameters(
 ): List<String> =
     listOf(
         "-PteamCityBuildId=%teamcity.build.id%",
-        os.javaInstallationLocations(arch),
+        "-Dorg.gradle.java.installations.auto-download=false",
         "-Porg.gradle.java.installations.auto-download=false",
+        "-Dorg.gradle.java.installations.auto-detect=false",
         "-Porg.gradle.java.installations.auto-detect=false",
-    )
+    ) + os.javaInstallationLocations(arch)
 
 fun promotionBuildParameters(
     dependencyBuildId: RelativeId,
diff --git a/.teamcity/src/main/kotlin/common/Os.kt b/.teamcity/src/main/kotlin/common/Os.kt
index f47544cc527..a0ae2bb884d 100644
--- a/.teamcity/src/main/kotlin/common/Os.kt
+++ b/.teamcity/src/main/kotlin/common/Os.kt
@@ -69,7 +69,7 @@ enum class Os(
 
     fun asName() = name.lowercase().toCapitalized()
 
-    fun javaInstallationLocations(arch: Arch = Arch.AMD64): String {
+    fun javaInstallationLocations(arch: Arch = Arch.AMD64): List<String> {
         val paths =
             when {
                 this == LINUX ->
@@ -99,6 +99,9 @@ enum class Os(
                         DefaultJvm(JvmVersion.JAVA_25, JvmVendor.OPENJDK),
                     )
             }.joinToString(",") { javaHome(it, this, arch) }
-        return """"-Porg.gradle.java.installations.paths=$paths""""
+        return listOf(
+            """"-Dorg.gradle.java.installations.paths=$paths"""",
+            """"-Porg.gradle.java.installations.paths=$paths"""",
+        )
     }
 }
diff --git a/.teamcity/src/main/kotlin/common/PerformanceTestExtensions.kt b/.teamcity/src/main/kotlin/common/PerformanceTestExtensions.kt
index b875d6b3b63..cf1426619d0 100644
--- a/.teamcity/src/main/kotlin/common/PerformanceTestExtensions.kt
+++ b/.teamcity/src/main/kotlin/common/PerformanceTestExtensions.kt
@@ -59,9 +59,9 @@ fun performanceTestCommandLine(
     "-PtestJavaVendor=$testJavaVendor",
     "-PautoDownloadAndroidStudio=true",
     "-PrunAndroidStudioInHeadlessMode=true",
+    "-Dorg.gradle.java.installations.auto-download=false",
     "-Porg.gradle.java.installations.auto-download=false",
-    os.javaInstallationLocations(arch),
-) +
+) + os.javaInstallationLocations(arch) +
     listOf(
         "-Porg.gradle.performance.branchName" to "%teamcity.build.branch%",
         "-Porg.gradle.performance.db.url" to "%performance.db.url%",
diff --git a/.teamcity/src/main/kotlin/configurations/BuildDistributions.kt b/.teamcity/src/main/kotlin/configurations/BuildDistributions.kt
index d0d9669200a..8c2e4b09c0e 100644
--- a/.teamcity/src/main/kotlin/configurations/BuildDistributions.kt
+++ b/.teamcity/src/main/kotlin/configurations/BuildDistributions.kt
@@ -23,6 +23,7 @@ class BuildDistributions(
                     stage.getBuildScanCustomValueParam(),
                     buildScanTagParam("BuildDistributions"),
                     "-PtestJavaVersion=${LINUX.buildJavaVersion.major}",
+                    "-Dorg.gradle.java.installations.auto-download=false",
                     "-Porg.gradle.java.installations.auto-download=false",
                 ).joinToString(" "),
         )
diff --git a/.teamcity/src/main/kotlin/configurations/CheckLinks.kt b/.teamcity/src/main/kotlin/configurations/CheckLinks.kt
index f1caa244b9c..03d58e4a3b0 100644
--- a/.teamcity/src/main/kotlin/configurations/CheckLinks.kt
+++ b/.teamcity/src/main/kotlin/configurations/CheckLinks.kt
@@ -20,6 +20,7 @@ class CheckLinks(
             extraParameters =
                 listOf(
                     buildScanTagParam("CheckLinks"),
+                    "-Dorg.gradle.java.installations.auto-download=false",
                     "-Porg.gradle.java.installations.auto-download=false",
                 ).joinToString(""),
         )
diff --git a/.teamcity/src/main/kotlin/configurations/CompileAll.kt b/.teamcity/src/main/kotlin/configurations/CompileAll.kt
index 7e9f021f9d8..1882c530f38 100644
--- a/.teamcity/src/main/kotlin/configurations/CompileAll.kt
+++ b/.teamcity/src/main/kotlin/configurations/CompileAll.kt
@@ -26,6 +26,7 @@ class CompileAll(
                 listOf(
                     stage.getBuildScanCustomValueParam(),
                     buildScanTagParam("CompileAll"),
+                    "-Dorg.gradle.java.installations.auto-download=false",
                     "-Porg.gradle.java.installations.auto-download=false",
                 ).joinToString(" "),
         )
diff --git a/.teamcity/src/main/kotlin/configurations/SanityCheck.kt b/.teamcity/src/main/kotlin/configurations/SanityCheck.kt
index 6c7144cc367..b7a3dd4d195 100644
--- a/.teamcity/src/main/kotlin/configurations/SanityCheck.kt
+++ b/.teamcity/src/main/kotlin/configurations/SanityCheck.kt
@@ -26,6 +26,7 @@ class SanityCheck(
                 listOf(
                     stage.getBuildScanCustomValueParam(),
                     buildScanTagParam("SanityCheck"),
+                    "-Dorg.gradle.java.installations.auto-download=false",
                     "-Porg.gradle.java.installations.auto-download=false",
                 ).joinToString(" "),
         )
