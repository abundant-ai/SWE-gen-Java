diff --git a/okhttp-tls/src/main/kotlin/okhttp3/tls/internal/der/Adapters.kt b/okhttp-tls/src/main/kotlin/okhttp3/tls/internal/der/Adapters.kt
index 25389735f..b55ed7735 100644
--- a/okhttp-tls/src/main/kotlin/okhttp3/tls/internal/der/Adapters.kt
+++ b/okhttp-tls/src/main/kotlin/okhttp3/tls/internal/der/Adapters.kt
@@ -15,8 +15,8 @@
  */
 package okhttp3.tls.internal.der
 
+import java.io.IOException
 import java.math.BigInteger
-import java.net.ProtocolException
 import java.text.SimpleDateFormat
 import java.util.Date
 import java.util.TimeZone
@@ -202,31 +202,6 @@ internal object Adapters {
       }
   )
 
-  /** Decodes any value without interpretation as [AnyValue]. */
-  val ANY_VALUE = object : DerAdapter<AnyValue> {
-    override fun matches(header: DerHeader) = true
-
-    override fun fromDer(reader: DerReader): AnyValue {
-      reader.read("ANY") { header ->
-        val bytes = reader.readUnknown()
-        return AnyValue(
-            tagClass = header.tagClass,
-            tag = header.tag,
-            constructed = header.constructed,
-            length = header.length,
-            bytes = bytes
-        )
-      }
-    }
-
-    override fun toDer(writer: DerWriter, value: AnyValue) {
-      writer.write("ANY", value.tagClass, value.tag) {
-        writer.writeOctetString(value.bytes)
-        writer.constructed = value.constructed
-      }
-    }
-  }
-
   internal fun parseGeneralizedTime(string: String): Long {
     val utc = TimeZone.getTimeZone("GMT")
     val dateFormat = SimpleDateFormat("yyyyMMddHHmmssXX").apply {
@@ -273,7 +248,7 @@ internal object Adapters {
           }
 
           if (reader.hasNext()) {
-            throw ProtocolException("unexpected ${reader.peekHeader()} at $reader")
+            throw IOException("unexpected ${reader.peekHeader()} at $reader")
           }
 
           return@withTypeHint construct(list)
@@ -306,11 +281,10 @@ internal object Adapters {
 
       override fun fromDer(reader: DerReader): Pair<DerAdapter<*>, Any?> {
         val peekedHeader = reader.peekHeader()
-            ?: throw ProtocolException("expected a value at $reader")
+            ?: throw IOException("expected a value at $reader")
 
         val choice = choices.firstOrNull { it.matches(peekedHeader) }
-            ?: throw ProtocolException(
-                "expected a matching choice but was $peekedHeader at $reader")
+            ?: throw IOException("expected a matching choice but was $peekedHeader at $reader")
 
         return choice to choice.fromDer(reader)
       }
@@ -375,8 +349,7 @@ internal object Adapters {
       String::class to PRINTABLE_STRING,
       Nothing::class to IA5_STRING,
       Nothing::class to UTC_TIME,
-      Long::class to GENERALIZED_TIME,
-      AnyValue::class to ANY_VALUE
+      Long::class to GENERALIZED_TIME
   )
 
   fun any(
@@ -393,6 +366,12 @@ internal object Adapters {
             // Write nothing.
           }
 
+          value is AnyValue -> {
+            writer.write("ANY", value.tagClass, value.tag) {
+              writer.writeOctetString(value.bytes)
+            }
+          }
+
           else -> {
             for ((type, adapter) in choices) {
               if (type.isInstance(value) || (value == null && type == Unit::class)) {
@@ -407,15 +386,22 @@ internal object Adapters {
       override fun fromDer(reader: DerReader): Any? {
         if (isOptional && !reader.hasNext()) return optionalValue
 
-        val peekedHeader = reader.peekHeader()
-            ?: throw ProtocolException("expected a value at $reader")
         for ((_, adapter) in choices) {
-          if (adapter.matches(peekedHeader)) {
+          if (adapter.matches(reader.peekHeader()!!)) {
             return adapter.fromDer(reader)
           }
         }
 
-        throw ProtocolException("expected any but was $peekedHeader at $reader")
+        reader.read("ANY") { header ->
+          val bytes = reader.readUnknown()
+          return AnyValue(
+              tagClass = header.tagClass,
+              tag = header.tag,
+              constructed = header.constructed,
+              length = header.length,
+              bytes = bytes
+          )
+        }
       }
     }
   }
diff --git a/okhttp-tls/src/main/kotlin/okhttp3/tls/internal/der/BasicDerAdapter.kt b/okhttp-tls/src/main/kotlin/okhttp3/tls/internal/der/BasicDerAdapter.kt
index 109cdb6ba..8a526133d 100644
--- a/okhttp-tls/src/main/kotlin/okhttp3/tls/internal/der/BasicDerAdapter.kt
+++ b/okhttp-tls/src/main/kotlin/okhttp3/tls/internal/der/BasicDerAdapter.kt
@@ -15,7 +15,7 @@
  */
 package okhttp3.tls.internal.der
 
-import java.net.ProtocolException
+import okio.IOException
 
 /**
  * Handles basic types that always use the same tag. This supports optional types and may set a type
@@ -56,7 +56,7 @@ internal data class BasicDerAdapter<T>(
     val peekedHeader = reader.peekHeader()
     if (peekedHeader == null || peekedHeader.tagClass != tagClass || peekedHeader.tag != tag) {
       if (isOptional) return defaultValue as T
-      throw ProtocolException("expected $this but was $peekedHeader at $reader")
+      throw IOException("expected $this but was $peekedHeader at $reader")
     }
 
     val result = reader.read(name) {
diff --git a/okhttp-tls/src/main/kotlin/okhttp3/tls/internal/der/CertificateAdapters.kt b/okhttp-tls/src/main/kotlin/okhttp3/tls/internal/der/CertificateAdapters.kt
index 86c08b948..7805f919a 100644
--- a/okhttp-tls/src/main/kotlin/okhttp3/tls/internal/der/CertificateAdapters.kt
+++ b/okhttp-tls/src/main/kotlin/okhttp3/tls/internal/der/CertificateAdapters.kt
@@ -16,8 +16,8 @@
 package okhttp3.tls.internal.der
 
 import java.math.BigInteger
-import java.net.ProtocolException
 import okio.ByteString
+import okio.IOException
 
 /**
  * ASN.1 adapters adapted from the specifications in [RFC 5280][rfc_5280].
@@ -47,7 +47,7 @@ internal object CertificateAdapters {
 
     override fun fromDer(reader: DerReader): Long {
       val peekHeader = reader.peekHeader()
-          ?: throw ProtocolException("expected time but was exhausted at $reader")
+          ?: throw IOException("expected time but was exhausted at $reader")
 
       return when {
         peekHeader.tagClass == Adapters.UTC_TIME.tagClass &&
@@ -58,7 +58,7 @@ internal object CertificateAdapters {
             peekHeader.tag == Adapters.GENERALIZED_TIME.tag -> {
           Adapters.GENERALIZED_TIME.fromDer(reader)
         }
-        else -> throw ProtocolException("expected time but was $peekHeader at $reader")
+        else -> throw IOException("expected time but was $peekHeader at $reader")
       }
     }
 
@@ -185,8 +185,7 @@ internal object CertificateAdapters {
   internal val generalNameIpAddress = Adapters.OCTET_STRING.withTag(tag = 7L)
   internal val generalName: DerAdapter<Pair<DerAdapter<*>, Any?>> = Adapters.choice(
       generalNameDnsName,
-      generalNameIpAddress,
-      Adapters.ANY_VALUE
+      generalNameIpAddress
   )
 
   /**
@@ -263,11 +262,7 @@ internal object CertificateAdapters {
   private val attributeTypeAndValue: BasicDerAdapter<AttributeTypeAndValue> = Adapters.sequence(
       "AttributeTypeAndValue",
       Adapters.OBJECT_IDENTIFIER,
-      Adapters.any(
-          String::class to Adapters.UTF8_STRING,
-          Nothing::class to Adapters.PRINTABLE_STRING,
-          AnyValue::class to Adapters.ANY_VALUE
-      ),
+      Adapters.any(),
       decompose = {
         listOf(
             it.type,
diff --git a/okhttp-tls/src/main/kotlin/okhttp3/tls/internal/der/DerReader.kt b/okhttp-tls/src/main/kotlin/okhttp3/tls/internal/der/DerReader.kt
index 29a702341..2e14ba189 100644
--- a/okhttp-tls/src/main/kotlin/okhttp3/tls/internal/der/DerReader.kt
+++ b/okhttp-tls/src/main/kotlin/okhttp3/tls/internal/der/DerReader.kt
@@ -21,6 +21,7 @@ import okio.Buffer
 import okio.BufferedSource
 import okio.ByteString
 import okio.ForwardingSource
+import okio.IOException
 import okio.Source
 import okio.buffer
 
@@ -160,7 +161,7 @@ internal class DerReader(source: Source) {
    * header. It is an error to not consume a full value in [block].
    */
   internal inline fun <T> read(name: String?, block: (DerHeader) -> T): T {
-    if (!hasNext()) throw ProtocolException("expected a value")
+    if (!hasNext()) throw IOException("expected a value")
 
     val header = peekedHeader!!
     peekedHeader = null
diff --git a/okhttp-tls/src/test/java/okhttp3/tls/HeldCertificateTest.java b/okhttp-tls/src/test/java/okhttp3/tls/HeldCertificateTest.java
index f5f37466d..230b6ca9c 100644
--- a/okhttp-tls/src/test/java/okhttp3/tls/HeldCertificateTest.java
+++ b/okhttp-tls/src/test/java/okhttp3/tls/HeldCertificateTest.java
@@ -148,18 +148,18 @@ public final class HeldCertificateTest {
         .rsa2048()
         .build();
 
-    assertThat(""
+    assertThat((""
         + "-----BEGIN CERTIFICATE-----\n"
-        + "MIIBmjCCAQOgAwIBAgIBATANBgkqhkiG9w0BAQsFADATMREwDwYDVQQDDAhjYXNo\n"
-        + "LmFwcDAeFw03MDAxMDEwMDAwMDBaFw03MDAxMDEwMDAwMDFaMBMxETAPBgNVBAMM\n"
+        + "MIIBmjCCAQOgAwIBAgIBATANBgkqhkiG9w0BAQsFADATMREwDwYDVQQDEwhjYXNo\n"
+        + "LmFwcDAeFw03MDAxMDEwMDAwMDBaFw03MDAxMDEwMDAwMDFaMBMxETAPBgNVBAMT\n"
         + "CGNhc2guYXBwMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCApFHhtrLan28q\n"
         + "+oMolZuaTfWBA0V5aMIvq32BsloQu6LlvX1wJ4YEoUCjDlPOtpht7XLbUmBnbIzN\n"
         + "89XK4UJVM6Sqp3K88Km8z7gMrdrfTom/274wL25fICR+yDEQ5fUVYBmJAKXZF1ao\n"
-        + "I0mIoEx0xFsQhIJ637v2MxJDupd61wIDAQABMA0GCSqGSIb3DQEBCwUAA4GBADHT\n"
-        + "vcjwl9Z4I5Cb2R1y7aaa860HkY2k3ThaDK5OJt6GYqJTA9P3LtX7VwQtL1TWqXGc\n"
-        + "+OEfl3zhm0PUqcbckMzhJtqIa7NkDSjNm71BKd843pIhGcEri69DcL/cR8T+eMex\n"
-        + "hadh7aGM9OjeL8gznLeq27Ly6Dj7Vkp5OmOrSKfn\n"
-        + "-----END CERTIFICATE-----\n").isEqualTo(heldCertificate.certificatePem());
+        + "I0mIoEx0xFsQhIJ637v2MxJDupd61wIDAQABMA0GCSqGSIb3DQEBCwUAA4GBADam\n"
+        + "UVwKh5Ry7es3OxtY3IgQunPUoLc0Gw71gl9Z+7t2FJ5VkcI5gWfutmdxZ2bDXCI8\n"
+        + "8V0vxo1pHXnbBrnxhS/Z3TBerw8RyQqcaWOdp+pBXyIWmR+jHk9cHZCqQveTIBsY\n"
+        + "jaA9VEhgdaVhxBsT2qzUNDsXlOzGsliznDfoqETb\n"
+        + "-----END CERTIFICATE-----\n")).isEqualTo(heldCertificate.certificatePem());
 
     assertThat((""
         + "-----BEGIN RSA PRIVATE KEY-----\n"
diff --git a/okhttp-tls/src/test/java/okhttp3/tls/internal/der/DerCertificatesTest.kt b/okhttp-tls/src/test/java/okhttp3/tls/internal/der/DerCertificatesTest.kt
index 6146f325c..69192dffa 100644
--- a/okhttp-tls/src/test/java/okhttp3/tls/internal/der/DerCertificatesTest.kt
+++ b/okhttp-tls/src/test/java/okhttp3/tls/internal/der/DerCertificatesTest.kt
@@ -34,7 +34,6 @@ import okio.Buffer
 import okio.ByteString
 import okio.ByteString.Companion.decodeBase64
 import okio.ByteString.Companion.decodeHex
-import okio.ByteString.Companion.encodeUtf8
 import okio.ByteString.Companion.toByteString
 import org.assertj.core.api.Assertions.assertThat
 import org.junit.Test
@@ -731,9 +730,9 @@ internal class DerCertificatesTest {
 
   @Test
   fun `reencode golden EC certificate`() {
-    val certificateByteString = ("MIIBkjCCATmgAwIBAgIBETAKBggqhkjOPQQDAjAwMRYwFAYDVQQLDA1HZW5lIFJ" +
-        "lc2VhcmNoMRYwFAYDVQQDDA1KdXJhc3NpYyBQYXJrMB4XDTY5MTIzMTIzNTk1OVoXDTcwMDEwMTAwMDAwMlowMDE" +
-        "WMBQGA1UECwwNR2VuZSBSZXNlYXJjaDEWMBQGA1UEAwwNSnVyYXNzaWMgUGFyazBZMBMGByqGSM49AgEGCCqGSM4" +
+    val certificateByteString = ("MIIBkjCCATmgAwIBAgIBETAKBggqhkjOPQQDAjAwMRYwFAYDVQQLEw1HZW5lIFJ" +
+        "lc2VhcmNoMRYwFAYDVQQDEw1KdXJhc3NpYyBQYXJrMB4XDTY5MTIzMTIzNTk1OVoXDTcwMDEwMTAwMDAwMlowMDE" +
+        "WMBQGA1UECxMNR2VuZSBSZXNlYXJjaDEWMBQGA1UEAxMNSnVyYXNzaWMgUGFyazBZMBMGByqGSM49AgEGCCqGSM4" +
         "9AwEHA0IABKzhiMzpN+BkUSPLIKItu6O2iao2Pd7dxrvPdIs4xv9/2tPCVgUxevZ27qRcqZOnSd31ZP6B04vkXag" +
         "/awy2/iujRDBCMBIGA1UdEwEB/wQIMAYBAf8CAQMwLAYDVR0RAQH/BCIwIIINKi5leGFtcGxlLmNvbYIPd3d3LmV" +
         "4YW1wbGUub3JnMAoGCCqGSM49BAMCA0cAMEQCIHzutN/uzViLBXZ0slMqO5oz7ghgBgDbgo2ZyroVeQ/KAiB6Vqo" +
@@ -747,9 +746,9 @@ internal class DerCertificatesTest {
 
   @Test
   fun `reencode golden RSA certificate`() {
-    val certificateByteString = ("MIIDHzCCAgegAwIBAgIBETANBgkqhkiG9w0BAQsFADAwMRYwFAYDVQQLDA1HZW5" +
-        "lIFJlc2VhcmNoMRYwFAYDVQQDDA1KdXJhc3NpYyBQYXJrMB4XDTY5MTIzMTIzNTk1OVoXDTcwMDEwMTAwMDAwMlo" +
-        "wMDEWMBQGA1UECwwNR2VuZSBSZXNlYXJjaDEWMBQGA1UEAwwNSnVyYXNzaWMgUGFyazCCASIwDQYJKoZIhvcNAQE" +
+    val certificateByteString = ("MIIDHzCCAgegAwIBAgIBETANBgkqhkiG9w0BAQsFADAwMRYwFAYDVQQLEw1HZW5" +
+        "lIFJlc2VhcmNoMRYwFAYDVQQDEw1KdXJhc3NpYyBQYXJrMB4XDTY5MTIzMTIzNTk1OVoXDTcwMDEwMTAwMDAwMlo" +
+        "wMDEWMBQGA1UECxMNR2VuZSBSZXNlYXJjaDEWMBQGA1UEAxMNSnVyYXNzaWMgUGFyazCCASIwDQYJKoZIhvcNAQE" +
         "BBQADggEPADCCAQoCggEBAMfROxfCzmxIX5bDSZt6hstXALVeiywFFzTLW5UI0eKSDCliojmiKBcGR5ln7gVe6/t" +
         "me35J9n+Xe5LLmRogMo1CxCoyJxuDX4RrTpPGSepJCrvsBaMA7bQXc/9SbckPF4DYGbE5j3L6IyFU++8RKep/xjc" +
         "FAK4yhEgriDh7Gb+sbG6Mv2qTO4p6TR9WhMKXhMgHdk1JYyaSsJ+tSruKiPVmMAcQLBWgNez6MUIC1WVDyvCvfXI" +
@@ -852,50 +851,6 @@ internal class DerCertificatesTest {
     assertThat(okHttpCertificate.checkSignature(certificate.keyPair.public)).isFalse()
   }
 
-  /**
-   * We don't have API support for rfc822Name values (email addresses) in the subject alternative
-   * name, but we don't crash either.
-   */
-  @Test
-  fun `unsupported general name tag`() {
-    val certificateByteString = ("MIIFEDCCA/igAwIBAgIRAJK4dE9xztDibHKj2NXZJbIwDQYJKoZIhvcNAQELBQA" +
-        "wSDELMAkGA1UEBhMCVVMxIDAeBgNVBAoTF1NlY3VyZVRydXN0IENvcnBvcmF0aW9uMRcwFQYDVQQDEw5TZWN1cmV" +
-        "UcnVzdCBDQTAeFw0xNjA5MDExNDM1MzVaFw0yNDA5MjkxNDM1MzVaMIG1MQswCQYDVQQGEwJVUzERMA8GA1UECBM" +
-        "ISWxsaW5vaXMxEDAOBgNVBAcTB0NoaWNhZ28xITAfBgNVBAoTGFRydXN0d2F2ZSBIb2xkaW5ncywgSW5jLjE9MDs" +
-        "GA1UEAxM0VHJ1c3R3YXZlIE9yZ2FuaXphdGlvbiBWYWxpZGF0aW9uIFNIQTI1NiBDQSwgTGV2ZWwgMTEfMB0GCSq" +
-        "GSIb3DQEJARYQY2FAdHJ1c3R3YXZlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAOPTqIZSRwS" +
-        "f47okE5omzktvKR7wgqdWzznOnpUOtgwmBPwNeCV1LSPMmlHPZxY4enTc0eyoxTxKv6g6ZUJe39U74eYnwTTT9sE" +
-        "OnvNtE1pTzuB4Uf+YOPt4hZidTe5Ba8Q6dfz/Ht/vZXCbF3JFwrXxZEPbJaICap2grIqYHax+IEIYnBQC+WKh8Ng" +
-        "Cn3LWS0j6cYSN8SEjFf5SEMGT1iNtttb/QC3JKJIeaVunUyvMfMjVFMntc7eZrFs6rp3wY1WFVI+fy17uOoUvfTH" +
-        "8bvNAESUch7FyLh2zM8FVxqilT2XygHRwZeXtxJQozcDcvh4ItPb0uz6AFIYwn/8Gzp0CAwEAAaOCAYUwggGBMBI" +
-        "GA1UdEwEB/wQIMAYBAf8CAQAwHQYDVR0OBBYEFMrOHRgDdx4c83xYsppwqAiAFvSuMA4GA1UdDwEB/wQEAwIBhjA" +
-        "yBgNVHR8EKzApMCegJaAjhiFodHRwOi8vY3JsLnRydXN0d2F2ZS5jb20vU1RDQS5jcmwwPQYDVR0gBDYwNDAyBgR" +
-        "VHSAAMCowKAYIKwYBBQUHAgEWHGh0dHBzOi8vc3NsLnRydXN0d2F2ZS5jb20vQ0EwbAYIKwYBBQUHAQEEYDBeMCU" +
-        "GCCsGAQUFBzABhhlodHRwOi8vb2NzcC50cnVzdHdhdmUuY29tMDUGCCsGAQUFBzAChilodHRwOi8vc3NsLnRydXN" +
-        "0d2F2ZS5jb20vaXNzdWVycy9TVENBLmNydDAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwHwYDVR0jBBg" +
-        "wFoAUQjK2FvoE/f5dS3rD/fdMQB1aQ68wGwYDVR0RBBQwEoEQY2FAdHJ1c3R3YXZlLmNvbTANBgkqhkiG9w0BAQs" +
-        "FAAOCAQEAC0OvN7/UJBcRDXchA4b2qJo7mBD05+XR96N7vucMaanz26CnUxs1o8DcBckpqyEXCxdOanIr+/UJNbB" +
-        "LXLJCzNLJEJcgV9TjbVu33eQR23yMuXD+cZsqLMF+L5IIM47W8dlwKJvMy0xs7Jb1S3NOIhcoVu+XPzRsgKv8Yi2" +
-        "B6l278RfzegiCx4vYJv0pBjFzizEiFH9bWTYIOlIJJSM57hoICgjCTS8BoEgndwWIyc/nEmlYaUwmCo9QynY+UmW" +
-        "1WPWmVITEJPMdMK6AZqvvaWmuHJ6/vURaz+Hoc5D3z0yJDDCkv52bXV04ZoF6cbcWry7JvNA+djvay/4BRR4SZQ==")
-        .decodeBase64()!!
-
-    val decoded = CertificateAdapters.certificate.fromDer(certificateByteString)
-    assertThat(decoded.subjectAlternativeNames).isEqualTo(Extension(
-        id = subjectAlternativeName,
-        critical = false,
-        value = listOf(
-            Adapters.ANY_VALUE to AnyValue(
-                tagClass = DerHeader.TAG_CLASS_CONTEXT_SPECIFIC,
-                tag = 1L,
-                constructed = false,
-                length = 16,
-                bytes = "ca@trustwave.com".encodeUtf8()
-            )
-        )
-    ))
-  }
-
   /** Converts public key bytes to SubjectPublicKeyInfo bytes. */
   private fun encodeKey(algorithm: String, publicKeyBytes: ByteString): ByteString {
     val subjectPublicKeyInfo = SubjectPublicKeyInfo(
