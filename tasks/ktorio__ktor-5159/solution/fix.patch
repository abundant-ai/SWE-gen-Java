diff --git a/ktor-client/ktor-client-core/common/src/io/ktor/client/plugins/HttpRequestRetry.kt b/ktor-client/ktor-client-core/common/src/io/ktor/client/plugins/HttpRequestRetry.kt
index 25f097182..6554a9ea2 100644
--- a/ktor-client/ktor-client-core/common/src/io/ktor/client/plugins/HttpRequestRetry.kt
+++ b/ktor-client/ktor-client-core/common/src/io/ktor/client/plugins/HttpRequestRetry.kt
@@ -325,6 +325,11 @@ public val HttpRequestRetry: ClientPlugin<HttpRequestRetryConfig> = createClient
         return subRequest
     }
 
+    onRequest { request, _ ->
+        val maxRetriesValue = request.attributes.getOrNull(MaxRetriesPerRequestAttributeKey) ?: maxRetries
+        request.attributes.put(MaxRetriesPerRequestAttributeKey, maxRetriesValue)
+    }
+
     on(Send) { request ->
         var retryCount = 0
         val shouldRetry = request.attributes.getOrNull(ShouldRetryPerRequestAttributeKey) ?: shouldRetry
@@ -376,8 +381,8 @@ public val HttpRequestRetry: ClientPlugin<HttpRequestRetryConfig> = createClient
 }
 
 /**
- * A context for [HttpRequestRetry.Configuration.shouldRetry]
- * and [HttpRequestRetry.Configuration.shouldRetryOnException]
+ * A context for [HttpRequestRetryConfig.shouldRetry]
+ * and [HttpRequestRetryConfig.shouldRetryOnException]
  *
  * [Report a problem](https://ktor.io/feedback/?fqname=io.ktor.client.plugins.HttpRetryShouldRetryContext)
  */
@@ -389,7 +394,7 @@ public class HttpRetryShouldRetryContext(
 )
 
 /**
- * A context for [HttpRequestRetry.Configuration.delayMillis].
+ * A context for [HttpRequestRetryConfig.delayMillis].
  * Contains a non-null [response] or [cause] but not both.
  *
  * [Report a problem](https://ktor.io/feedback/?fqname=io.ktor.client.plugins.HttpRetryDelayContext)
@@ -401,7 +406,7 @@ public class HttpRetryDelayContext internal constructor(
 )
 
 /**
- * A context for [HttpRequestRetry.Configuration.modifyRequest].
+ * A context for [HttpRequestRetryConfig.modifyRequest].
  * Contains a non-null [response] or [cause] but not both.
  *
  * [Report a problem](https://ktor.io/feedback/?fqname=io.ktor.client.plugins.HttpRetryModifyRequestContext)
@@ -445,8 +450,7 @@ public fun HttpRequestBuilder.retry(block: HttpRequestRetryConfig.() -> Unit) {
     attributes.put(ModifyRequestPerRequestAttributeKey, configuration.modifyRequest)
 }
 
-private val MaxRetriesPerRequestAttributeKey =
-    AttributeKey<Int>("MaxRetriesPerRequestAttributeKey")
+internal val MaxRetriesPerRequestAttributeKey = AttributeKey<Int>("MaxRetriesPerRequestAttributeKey")
 
 private val ShouldRetryPerRequestAttributeKey =
     AttributeKey<HttpRetryShouldRetryContext.(HttpRequest, HttpResponse) -> Boolean>(
diff --git a/ktor-client/ktor-client-core/common/src/io/ktor/client/plugins/HttpSend.kt b/ktor-client/ktor-client-core/common/src/io/ktor/client/plugins/HttpSend.kt
index 163940eb0..ed90b3383 100644
--- a/ktor-client/ktor-client-core/common/src/io/ktor/client/plugins/HttpSend.kt
+++ b/ktor-client/ktor-client-core/common/src/io/ktor/client/plugins/HttpSend.kt
@@ -11,7 +11,7 @@ import io.ktor.http.*
 import io.ktor.http.content.*
 import io.ktor.util.*
 import io.ktor.utils.io.*
-import kotlinx.coroutines.*
+import kotlinx.coroutines.cancel
 
 /**
  * HttpSend pipeline interceptor function
@@ -89,8 +89,13 @@ public class HttpSend private constructor(
                         .trimMargin()
                 }
                 context.setBody(content)
-
-                val realSender: Sender = DefaultSender(plugin.maxSendCount, scope)
+                val maxRetriesFromRetryPlugin = context.attributes.getOrNull(MaxRetriesPerRequestAttributeKey)
+                val maxRetries = if (maxRetriesFromRetryPlugin != null) {
+                    maxRetriesFromRetryPlugin + 1 // +1 for the initial request
+                } else {
+                    plugin.maxSendCount
+                }
+                val realSender: Sender = DefaultSender(maxRetries, scope)
                 var interceptedSender = realSender
                 for (interceptor in plugin.interceptors.reversed()) {
                     interceptedSender = InterceptedSender(interceptor, interceptedSender)
diff --git a/ktor-server/ktor-server-core/common/src/io/ktor/server/routing/RoutingNode.kt b/ktor-server/ktor-server-core/common/src/io/ktor/server/routing/RoutingNode.kt
index 64e586892..4449276c1 100644
--- a/ktor-server/ktor-server-core/common/src/io/ktor/server/routing/RoutingNode.kt
+++ b/ktor-server/ktor-server-core/common/src/io/ktor/server/routing/RoutingNode.kt
@@ -357,7 +357,7 @@ private fun RoutingNode.getAllRoutes(endpoints: MutableList<RoutingNode>) {
 public val RoutingNode.path: String
     get() = path()
 
-internal fun RoutingNode.path(): String {
+private fun RoutingNode.path(): String {
     val parentPath = parent?.path()
     val selectorElement = selector.toPathElement()
     return when {
@@ -368,9 +368,16 @@ internal fun RoutingNode.path(): String {
     }
 }
 
-private fun RouteSelector.toPathElement(): String = when {
-    isPathElement() -> toString()
-    this is TrailingSlashRouteSelector -> "/"
+private fun RouteSelector.toPathElement(): String = when (this) {
+    is PathSegmentConstantRouteSelector,
+    is PathSegmentParameterRouteSelector,
+    is PathSegmentOptionalParameterRouteSelector,
+    is PathSegmentTailcardRouteSelector,
+    is PathSegmentWildcardRouteSelector,
+    is PathSegmentRegexRouteSelector -> toString()
+
+    is TrailingSlashRouteSelector -> "/"
+
     else -> ""
 }
 
diff --git a/ktor-server/ktor-server-core/common/src/io/ktor/server/routing/RoutingResolveResult.kt b/ktor-server/ktor-server-core/common/src/io/ktor/server/routing/RoutingResolveResult.kt
index 3bc163312..35ba31b55 100644
--- a/ktor-server/ktor-server-core/common/src/io/ktor/server/routing/RoutingResolveResult.kt
+++ b/ktor-server/ktor-server-core/common/src/io/ktor/server/routing/RoutingResolveResult.kt
@@ -39,8 +39,7 @@ public sealed class RoutingResolveResult(public val route: RoutingNode) {
         )
         public constructor(route: RoutingNode, parameters: Parameters) : this(route, parameters, 0.0)
 
-        override fun toString(): String =
-            "SUCCESS${if (parameters.isEmpty()) "" else "; $parameters"} @ ${route.render()}"
+        override fun toString(): String = "SUCCESS${if (parameters.isEmpty()) "" else "; $parameters"} @ $route"
     }
 
     /**
@@ -65,6 +64,6 @@ public sealed class RoutingResolveResult(public val route: RoutingNode) {
         override val parameters: Nothing
             get() = throw UnsupportedOperationException("Parameters are available only when routing resolve succeeds")
 
-        override fun toString(): String = "FAILURE \"$reason\" @ ${route.render()}"
+        override fun toString(): String = "FAILURE \"$reason\" @ $route"
     }
 }
diff --git a/ktor-server/ktor-server-core/common/src/io/ktor/server/routing/RoutingResolveTrace.kt b/ktor-server/ktor-server-core/common/src/io/ktor/server/routing/RoutingResolveTrace.kt
index 04fdb97ac..b1784dc01 100644
--- a/ktor-server/ktor-server-core/common/src/io/ktor/server/routing/RoutingResolveTrace.kt
+++ b/ktor-server/ktor-server-core/common/src/io/ktor/server/routing/RoutingResolveTrace.kt
@@ -45,7 +45,7 @@ public open class RoutingResolveTraceEntry(
         children?.forEach { it.buildText(builder, indent + 1) }
     }
 
-    override fun toString(): String = "${route.render()}, segment:$segmentIndex -> $result"
+    override fun toString(): String = "$route, segment:$segmentIndex -> $result"
 }
 
 /**
@@ -168,34 +168,3 @@ private class Stack<E> {
         return tower.last()
     }
 }
-
-internal fun RoutingNode.render(): String {
-    val path = path.ifEmpty { "/" }
-    val constraints = buildConstraints()
-    return if (constraints.isEmpty()) path else "$path [$constraints]"
-}
-
-private fun RoutingNode.buildConstraints(): String {
-    val parentConstraints = parent?.buildConstraints()
-    if (selector.isPathElement()) {
-        return parentConstraints ?: ""
-    }
-
-    val selectorElement = selector.toString()
-    return when {
-        parentConstraints == null || parentConstraints.isEmpty() -> selectorElement
-        selectorElement.isEmpty() -> parentConstraints
-        else -> "$parentConstraints, $selectorElement"
-    }
-}
-
-internal fun RouteSelector.isPathElement(): Boolean = when (this) {
-    is PathSegmentConstantRouteSelector,
-    is PathSegmentParameterRouteSelector,
-    is PathSegmentOptionalParameterRouteSelector,
-    is PathSegmentTailcardRouteSelector,
-    is PathSegmentWildcardRouteSelector,
-    is PathSegmentRegexRouteSelector -> true
-
-    else -> false
-}
