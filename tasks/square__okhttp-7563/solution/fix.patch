diff --git a/mockwebserver/api/mockwebserver3.api b/mockwebserver/api/mockwebserver3.api
index 6c0b263ac..2e32e3c41 100644
--- a/mockwebserver/api/mockwebserver3.api
+++ b/mockwebserver/api/mockwebserver3.api
@@ -86,6 +86,7 @@ public final class mockwebserver3/MockWebServer : java/io/Closeable {
 	public final fun getBodyLimit ()J
 	public final fun getDispatcher ()Lmockwebserver3/Dispatcher;
 	public final fun getHostName ()Ljava/lang/String;
+	public final fun getInetSocketAddress ()Ljava/net/InetSocketAddress;
 	public final fun getPort ()I
 	public final fun getProtocolNegotiationEnabled ()Z
 	public final fun getRequestCount ()I
diff --git a/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt b/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt
index 4f5a65ad6..4c2732385 100644
--- a/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt
+++ b/mockwebserver/src/main/kotlin/mockwebserver3/MockWebServer.kt
@@ -152,10 +152,16 @@ class MockWebServer : Closeable {
   val hostName: String
     get() {
       before()
-      return inetSocketAddress!!.address.canonicalHostName
+      return _inetSocketAddress!!.address.canonicalHostName
     }
 
-  private var inetSocketAddress: InetSocketAddress? = null
+  private var _inetSocketAddress: InetSocketAddress? = null
+
+  val inetSocketAddress: InetSocketAddress
+    get() {
+      before()
+      return InetSocketAddress(hostName, portField)
+    }
 
   /**
    * True if ALPN is used on incoming HTTPS connections to negotiate a protocol like HTTP/1.1 or
@@ -206,7 +212,7 @@ class MockWebServer : Closeable {
 
   fun toProxyAddress(): Proxy {
     before()
-    val address = InetSocketAddress(inetSocketAddress!!.address.canonicalHostName, port)
+    val address = InetSocketAddress(_inetSocketAddress!!.address.canonicalHostName, port)
     return Proxy(Proxy.Type.HTTP, address)
   }
 
@@ -383,7 +389,7 @@ class MockWebServer : Closeable {
     if (started) return
     started = true
 
-    this.inetSocketAddress = inetSocketAddress
+    this._inetSocketAddress = inetSocketAddress
 
     serverSocket = serverSocketFactory!!.createServerSocket()
 
diff --git a/okhttp-testing-support/src/main/kotlin/okhttp3/SpecificHostSocketFactory.kt b/okhttp-testing-support/src/main/kotlin/okhttp3/SpecificHostSocketFactory.kt
new file mode 100644
index 000000000..d58d08ee5
--- /dev/null
+++ b/okhttp-testing-support/src/main/kotlin/okhttp3/SpecificHostSocketFactory.kt
@@ -0,0 +1,48 @@
+/*
+ * Copyright (C) 2022 Square, Inc.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package okhttp3
+
+import java.net.InetAddress
+import java.net.InetSocketAddress
+import java.net.Socket
+import java.net.SocketAddress
+
+/**
+ * A [SocketFactory] that redirects connections to [defaultAddress] or specific overridden address via [set].
+ */
+class SpecificHostSocketFactory(
+  val defaultAddress: InetSocketAddress?
+) : DelegatingSocketFactory(getDefault()) {
+  private val hostMapping = mutableMapOf<InetAddress, InetSocketAddress>()
+
+  /** Sets the [real] address for [requested].  */
+  operator fun set(
+    requested: InetAddress,
+    real: InetSocketAddress
+  ) {
+    hostMapping[requested] = real
+  }
+
+  override fun createSocket(): Socket {
+    return object : Socket() {
+      override fun connect(endpoint: SocketAddress?, timeout: Int) {
+        val requested = (endpoint as InetSocketAddress)
+        val inetSocketAddress = hostMapping[requested.address] ?: defaultAddress ?: requested
+        super.connect(inetSocketAddress, timeout)
+      }
+    }
+  }
+}
diff --git a/okhttp/src/jvmMain/kotlin/okhttp3/internal/connection/RouteDatabase.kt b/okhttp/src/jvmMain/kotlin/okhttp3/internal/connection/RouteDatabase.kt
index c7c7422fc..4685de667 100644
--- a/okhttp/src/jvmMain/kotlin/okhttp3/internal/connection/RouteDatabase.kt
+++ b/okhttp/src/jvmMain/kotlin/okhttp3/internal/connection/RouteDatabase.kt
@@ -24,18 +24,22 @@ import okhttp3.Route
  * preferred.
  */
 class RouteDatabase {
-  private val failedRoutes = mutableSetOf<Route>()
+  private val _failedRoutes = mutableSetOf<Route>()
+
+  val failedRoutes: Set<Route>
+    @Synchronized get() = _failedRoutes.toSet()
+
 
   /** Records a failure connecting to [failedRoute]. */
   @Synchronized fun failed(failedRoute: Route) {
-    failedRoutes.add(failedRoute)
+    _failedRoutes.add(failedRoute)
   }
 
   /** Records success connecting to [route]. */
   @Synchronized fun connected(route: Route) {
-    failedRoutes.remove(route)
+    _failedRoutes.remove(route)
   }
 
   /** Returns true if [route] has failed recently and should be avoided. */
-  @Synchronized fun shouldPostpone(route: Route): Boolean = route in failedRoutes
+  @Synchronized fun shouldPostpone(route: Route): Boolean = route in _failedRoutes
 }
