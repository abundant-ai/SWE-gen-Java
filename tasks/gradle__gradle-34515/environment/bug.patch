diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCacheIO.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCacheIO.kt
index 1ca5495504b..d696696cc6e 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCacheIO.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/DefaultConfigurationCacheIO.kt
@@ -707,7 +707,6 @@ class DefaultConfigurationCacheIO internal constructor(
             parallelLoad = startParameter.isParallelLoad,
             problems = service(),
             attributeDesugaring = service(),
-            taskDependencyFactory = service(),
         )
 
     private
diff --git a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/serialize/Codecs.kt b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/serialize/Codecs.kt
index c096ff665e1..39a6dfe685d 100644
--- a/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/serialize/Codecs.kt
+++ b/platforms/core-configuration/configuration-cache/src/main/kotlin/org/gradle/internal/cc/impl/serialize/Codecs.kt
@@ -37,7 +37,6 @@ import org.gradle.api.internal.file.FileResolver
 import org.gradle.api.internal.file.collections.DirectoryFileTreeFactory
 import org.gradle.api.internal.provider.PropertyFactory
 import org.gradle.api.internal.provider.ValueSourceProviderFactory
-import org.gradle.api.internal.tasks.TaskDependencyFactory
 import org.gradle.api.problems.internal.InternalProblems
 import org.gradle.api.tasks.util.internal.PatternSetFactory
 import org.gradle.composite.internal.BuildTreeWorkGraphController
@@ -175,7 +174,6 @@ class Codecs(
     includedTaskGraph: BuildTreeWorkGraphController,
     buildStateRegistry: BuildStateRegistry,
     documentationRegistry: DocumentationRegistry,
-    taskDependencyFactory: TaskDependencyFactory,
     val javaSerializationEncodingLookup: JavaSerializationEncodingLookup,
     flowProviders: FlowProviders,
     transformStepNodeFactory: TransformStepNodeFactory,
@@ -204,7 +202,7 @@ class Codecs(
             bind(DefaultContextAwareTaskLoggerCodec)
             bind(LoggerCodec)
 
-            fileCollectionTypes(directoryFileTreeFactory, fileCollectionFactory, artifactSetConverter, fileOperations, fileFactory, patternSetFactory, fileLookup, taskDependencyFactory)
+            fileCollectionTypes(directoryFileTreeFactory, fileCollectionFactory, artifactSetConverter, fileOperations, fileFactory, patternSetFactory, fileLookup)
 
             bind(org.gradle.internal.serialize.codecs.core.ApiTextResourceAdapterCodec)
 
@@ -212,7 +210,7 @@ class Codecs(
             bind(SerializedLambdaParametersCheckingCodec)
 
             // Dependency management types
-            bind(ArtifactCollectionCodec(calculatedValueContainerFactory, artifactSetConverter, attributeDesugaring, taskDependencyFactory))
+            bind(ArtifactCollectionCodec(calculatedValueContainerFactory, artifactSetConverter, attributeDesugaring))
             bind(ImmutableAttributesCodec(attributesFactory, managedFactoryRegistry))
             bind(AttributeContainerCodec(attributesFactory, managedFactoryRegistry))
             bind(ComponentVariantIdentifierCodec)
@@ -312,7 +310,7 @@ class Codecs(
         baseTypes()
 
         providerTypes(propertyFactory, filePropertyFactory, nestedProviderCodec(valueSourceProviderFactory, buildStateRegistry, flowProviders))
-        fileCollectionTypes(directoryFileTreeFactory, fileCollectionFactory, artifactSetConverter, fileOperations, fileFactory, patternSetFactory, fileLookup, taskDependencyFactory)
+        fileCollectionTypes(directoryFileTreeFactory, fileCollectionFactory, artifactSetConverter, fileOperations, fileFactory, patternSetFactory, fileLookup)
 
         bind(TaskInAnotherBuildCodec(includedTaskGraph))
 
@@ -383,15 +381,14 @@ class Codecs(
         fileOperations: FileOperations,
         fileFactory: FileFactory,
         patternSetFactory: PatternSetFactory,
-        fileLookup: FileLookup,
-        taskDependencyFactory: TaskDependencyFactory
+        fileLookup: FileLookup
     ) {
         bind(PathToFileResolverCodec(fileLookup))
         bind(DirectoryCodec(fileFactory))
         bind(RegularFileCodec(fileFactory))
         bind(ConfigurableFileTreeCodec(fileCollectionFactory))
         bind(FileTreeCodec(fileCollectionFactory, directoryFileTreeFactory, fileOperations))
-        val fileCollectionCodec = FileCollectionCodec(fileCollectionFactory, artifactSetConverter, taskDependencyFactory)
+        val fileCollectionCodec = FileCollectionCodec(fileCollectionFactory, artifactSetConverter)
         bind(ConfigurableFileCollectionCodec(fileCollectionCodec, fileCollectionFactory))
         bind(fileCollectionCodec)
         bind(IntersectionPatternSetCodec)
diff --git a/platforms/core-configuration/configuration-cache/src/test/kotlin/org/gradle/internal/cc/impl/serialization/codecs/AbstractUserTypeCodecTest.kt b/platforms/core-configuration/configuration-cache/src/test/kotlin/org/gradle/internal/cc/impl/serialization/codecs/AbstractUserTypeCodecTest.kt
index d30afb88cfe..f44241cad99 100644
--- a/platforms/core-configuration/configuration-cache/src/test/kotlin/org/gradle/internal/cc/impl/serialization/codecs/AbstractUserTypeCodecTest.kt
+++ b/platforms/core-configuration/configuration-cache/src/test/kotlin/org/gradle/internal/cc/impl/serialization/codecs/AbstractUserTypeCodecTest.kt
@@ -210,6 +210,5 @@ abstract class AbstractUserTypeCodecTest {
         transformStepNodeFactory = mock(),
         problems = mock(),
         attributeDesugaring = mock(),
-        taskDependencyFactory = mock()
     )
 }
diff --git a/platforms/core-configuration/core-serialization-codecs/src/main/kotlin/org/gradle/internal/serialize/codecs/core/FileCollectionCodec.kt b/platforms/core-configuration/core-serialization-codecs/src/main/kotlin/org/gradle/internal/serialize/codecs/core/FileCollectionCodec.kt
index 63fa012fe9e..e4e18262f0e 100644
--- a/platforms/core-configuration/core-serialization-codecs/src/main/kotlin/org/gradle/internal/serialize/codecs/core/FileCollectionCodec.kt
+++ b/platforms/core-configuration/core-serialization-codecs/src/main/kotlin/org/gradle/internal/serialize/codecs/core/FileCollectionCodec.kt
@@ -32,7 +32,6 @@ import org.gradle.api.internal.file.collections.FailingFileCollection
 import org.gradle.api.internal.file.collections.FileSystemMirroringFileTree
 import org.gradle.api.internal.file.collections.ProviderBackedFileCollection
 import org.gradle.api.internal.provider.ProviderInternal
-import org.gradle.api.internal.tasks.TaskDependencyFactory
 import org.gradle.api.specs.Spec
 import org.gradle.api.tasks.TaskProvider
 import org.gradle.api.tasks.util.PatternSet
@@ -52,8 +51,7 @@ import kotlin.jvm.optionals.getOrNull
 
 class FileCollectionCodec(
     private val fileCollectionFactory: FileCollectionFactory,
-    private val artifactSetConverter: ArtifactSetToFileCollectionFactory,
-    private val taskDependencyFactory: TaskDependencyFactory
+    private val artifactSetConverter: ArtifactSetToFileCollectionFactory
 ) : Codec<FileCollectionInternal> {
 
     override suspend fun WriteContext.encode(value: FileCollectionInternal) {
@@ -99,12 +97,7 @@ class FileCollectionCodec(
                     is FilteredFileCollectionSpec -> element.collection.filter(element.filter)
                     is ProviderBackedFileCollectionSpec -> fileCollectionFactory.withResolver(element.resolver).resolving(element.provider)
                     is FileTree -> element
-                    is ResolutionBackedFileCollectionSpec -> ResolutionBackedFileCollection(
-                        artifactSetConverter.getSelectedArtifacts(element.elements),
-                        element.lenient,
-                        artifactSetConverter.resolutionHost(element.displayName),
-                        taskDependencyFactory
-                    )
+                    is ResolutionBackedFileCollectionSpec -> artifactSetConverter.asFileCollection(element.displayName, element.lenient, element.elements)
                     is BeanSpec -> element.bean
                     else -> throw IllegalArgumentException("Unexpected item $element in file collection contents")
                 }
diff --git a/platforms/core-configuration/dependency-management-serialization-codecs/src/main/kotlin/org/gradle/internal/serialize/codecs/dm/ArtifactCollectionCodec.kt b/platforms/core-configuration/dependency-management-serialization-codecs/src/main/kotlin/org/gradle/internal/serialize/codecs/dm/ArtifactCollectionCodec.kt
index d42575adad3..121cad07b98 100644
--- a/platforms/core-configuration/dependency-management-serialization-codecs/src/main/kotlin/org/gradle/internal/serialize/codecs/dm/ArtifactCollectionCodec.kt
+++ b/platforms/core-configuration/dependency-management-serialization-codecs/src/main/kotlin/org/gradle/internal/serialize/codecs/dm/ArtifactCollectionCodec.kt
@@ -29,7 +29,6 @@ import org.gradle.api.internal.attributes.AttributeDesugaring
 import org.gradle.api.internal.attributes.ImmutableAttributes
 import org.gradle.api.internal.file.FileCollectionInternal
 import org.gradle.api.internal.file.FileCollectionStructureVisitor
-import org.gradle.api.internal.tasks.TaskDependencyFactory
 import org.gradle.internal.DisplayName
 import org.gradle.internal.component.external.model.ImmutableCapabilities
 import org.gradle.internal.extensions.stdlib.uncheckedCast
@@ -46,7 +45,6 @@ class ArtifactCollectionCodec(
     private val calculatedValueContainerFactory: CalculatedValueContainerFactory,
     private val artifactSetConverter: ArtifactSetToFileCollectionFactory,
     private val attributeDesugaring: AttributeDesugaring,
-    private val taskDependencyFactory: TaskDependencyFactory
 ) : Codec<ArtifactCollectionInternal> {
 
     override suspend fun WriteContext.encode(value: ArtifactCollectionInternal) {
@@ -62,7 +60,7 @@ class ArtifactCollectionCodec(
         val lenient = readBoolean()
         val elements = readList().uncheckedCast<List<Any>>()
 
-        val artifacts = artifactSetConverter.getSelectedArtifacts(
+        val files = artifactSetConverter.asFileCollection(displayName, lenient,
             elements.map { element ->
                 when (element) {
                     is Throwable -> artifactSetConverter.asResolvedArtifactSet(element)
@@ -72,8 +70,7 @@ class ArtifactCollectionCodec(
                 }
             }
         )
-
-        return DefaultArtifactCollection(artifacts, lenient, artifactSetConverter.resolutionHost(displayName), taskDependencyFactory, calculatedValueContainerFactory, attributeDesugaring)
+        return DefaultArtifactCollection(files, lenient, artifactSetConverter.resolutionHost(displayName), calculatedValueContainerFactory, attributeDesugaring)
     }
 }
 
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/configurations/ArtifactCollectionInternal.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/configurations/ArtifactCollectionInternal.java
index e26f9d6c66d..3aadf055e2a 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/configurations/ArtifactCollectionInternal.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/configurations/ArtifactCollectionInternal.java
@@ -18,7 +18,6 @@
 
 import org.gradle.api.artifacts.ArtifactCollection;
 import org.gradle.api.internal.artifacts.ivyservice.resolveengine.artifact.ArtifactVisitor;
-import org.gradle.api.internal.file.FileCollectionInternal;
 
 public interface ArtifactCollectionInternal extends ArtifactCollection {
     ResolutionHost getResolutionHost();
@@ -26,7 +25,4 @@ public interface ArtifactCollectionInternal extends ArtifactCollection {
     boolean isLenient();
 
     void visitArtifacts(ArtifactVisitor visitor);
-
-    @Override
-    FileCollectionInternal getArtifactFiles();
 }
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/configurations/DefaultArtifactCollection.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/configurations/DefaultArtifactCollection.java
index c1fb93b37bd..61f4e6db31b 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/configurations/DefaultArtifactCollection.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/configurations/DefaultArtifactCollection.java
@@ -18,13 +18,12 @@
 
 import org.gradle.api.artifacts.ArtifactCollection;
 import org.gradle.api.artifacts.result.ResolvedArtifactResult;
+import org.gradle.api.file.FileCollection;
 import org.gradle.api.internal.artifacts.ivyservice.ResolvedArtifactCollectingVisitor;
 import org.gradle.api.internal.artifacts.ivyservice.resolveengine.artifact.ArtifactVisitor;
-import org.gradle.api.internal.artifacts.ivyservice.resolveengine.artifact.SelectedArtifactSet;
 import org.gradle.api.internal.attributes.AttributeDesugaring;
 import org.gradle.api.internal.file.FileCollectionInternal;
 import org.gradle.api.internal.provider.BuildableBackedProvider;
-import org.gradle.api.internal.tasks.TaskDependencyFactory;
 import org.gradle.api.provider.Provider;
 import org.gradle.internal.Cast;
 import org.gradle.internal.Factory;
@@ -36,29 +35,16 @@
 import java.util.Set;
 
 public class DefaultArtifactCollection implements ArtifactCollectionInternal {
-
-    private final SelectedArtifactSet artifacts;
+    private final ResolutionBackedFileCollection fileCollection;
     private final boolean lenient;
-    private final ResolutionHost resolutionHost;
     private final CalculatedValue<ArtifactSetResult> result;
-    private final TaskDependencyFactory taskDependencyFactory;
-
-    public DefaultArtifactCollection(
-        SelectedArtifactSet artifacts,
-        boolean lenient,
-        ResolutionHost resolutionHost,
-        TaskDependencyFactory taskDependencyFactory,
-        CalculatedValueFactory calculatedValueFactory,
-        AttributeDesugaring attributeDesugaring
-    ) {
-        this.artifacts = artifacts;
-        this.lenient = lenient;
-        this.resolutionHost = resolutionHost;
-        this.taskDependencyFactory = taskDependencyFactory;
 
+    public DefaultArtifactCollection(ResolutionBackedFileCollection files, boolean lenient, ResolutionHost resolutionHost, CalculatedValueFactory calculatedValueFactory, AttributeDesugaring attributeDesugaring) {
+        this.fileCollection = files;
+        this.lenient = lenient;
         this.result = calculatedValueFactory.create(resolutionHost.displayName("files"), () -> {
             ResolvedArtifactCollectingVisitor visitor = new ResolvedArtifactCollectingVisitor(attributeDesugaring);
-            artifacts.visitArtifacts(visitor, lenient);
+            fileCollection.getArtifacts().visitArtifacts(visitor, lenient);
 
             Set<ResolvedArtifactResult> artifactResults = visitor.getArtifacts();
             Set<Throwable> failures = visitor.getFailures();
@@ -72,7 +58,7 @@ public DefaultArtifactCollection(
 
     @Override
     public ResolutionHost getResolutionHost() {
-        return resolutionHost;
+        return fileCollection.getResolutionHost();
     }
 
     @Override
@@ -81,13 +67,8 @@ public boolean isLenient() {
     }
 
     @Override
-    public FileCollectionInternal getArtifactFiles() {
-        return new ResolutionBackedFileCollection(
-            artifacts,
-            lenient,
-            resolutionHost,
-            taskDependencyFactory
-        );
+    public FileCollection getArtifactFiles() {
+        return fileCollection;
     }
 
     @Override
@@ -98,7 +79,7 @@ public Set<ResolvedArtifactResult> getArtifacts() {
 
     @Override
     public Provider<Set<ResolvedArtifactResult>> getResolvedArtifacts() {
-        return new BuildableBackedProvider<>(getArtifactFiles(), Cast.uncheckedCast(Set.class), new ArtifactCollectionResolvedArtifactsFactory(this));
+        return new BuildableBackedProvider<>((FileCollectionInternal) getArtifactFiles(), Cast.uncheckedCast(Set.class), new ArtifactCollectionResolvedArtifactsFactory(this));
     }
 
     @Override
@@ -116,7 +97,7 @@ public Collection<Throwable> getFailures() {
     @Override
     public void visitArtifacts(ArtifactVisitor visitor) {
         // TODO - if already resolved, use the results
-        artifacts.visitArtifacts(visitor, lenient);
+        fileCollection.getArtifacts().visitArtifacts(visitor, lenient);
     }
 
     private void ensureResolved() {
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/configurations/ResolutionBackedFileCollection.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/configurations/ResolutionBackedFileCollection.java
index 36fa0a6a94c..a61f78c75ce 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/configurations/ResolutionBackedFileCollection.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/configurations/ResolutionBackedFileCollection.java
@@ -92,4 +92,7 @@ protected void appendContents(TreeFormatter formatter) {
         formatter.node("contains: " + getDisplayName());
     }
 
+    SelectedArtifactSet getArtifacts() {
+        return artifacts;
+    }
 }
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/artifact/ArtifactSetToFileCollectionFactory.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/artifact/ArtifactSetToFileCollectionFactory.java
index 13099164aa1..5bcb3ed5869 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/artifact/ArtifactSetToFileCollectionFactory.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/ivyservice/resolveengine/artifact/ArtifactSetToFileCollectionFactory.java
@@ -20,18 +20,20 @@
 import org.gradle.api.Action;
 import org.gradle.api.artifacts.ResolvedArtifact;
 import org.gradle.api.artifacts.component.ComponentArtifactIdentifier;
+import org.gradle.internal.component.model.VariantIdentifier;
+import org.gradle.api.internal.artifacts.configurations.ResolutionBackedFileCollection;
 import org.gradle.api.internal.artifacts.configurations.ResolutionHost;
 import org.gradle.api.internal.artifacts.ivyservice.TypedResolveException;
 import org.gradle.api.internal.attributes.ImmutableAttributes;
 import org.gradle.api.internal.file.FileCollectionInternal;
 import org.gradle.api.internal.file.FileCollectionStructureVisitor;
+import org.gradle.api.internal.tasks.TaskDependencyFactory;
 import org.gradle.api.internal.tasks.TaskDependencyResolveContext;
 import org.gradle.api.problems.internal.InternalProblems;
 import org.gradle.internal.DisplayName;
 import org.gradle.internal.component.external.model.ImmutableCapabilities;
 import org.gradle.internal.component.model.DefaultIvyArtifactName;
 import org.gradle.internal.component.model.IvyArtifactName;
-import org.gradle.internal.component.model.VariantIdentifier;
 import org.gradle.internal.model.CalculatedValue;
 import org.gradle.internal.operations.BuildOperationExecutor;
 import org.gradle.internal.operations.BuildOperationQueue;
@@ -47,11 +49,12 @@
 
 @ServiceScope(Scope.BuildTree.class)
 public class ArtifactSetToFileCollectionFactory {
-
     private final BuildOperationExecutor buildOperationExecutor;
+    private final TaskDependencyFactory taskDependencyFactory;
     private final InternalProblems problemsService;
 
-    public ArtifactSetToFileCollectionFactory(BuildOperationExecutor buildOperationExecutor, InternalProblems problemsService) {
+    public ArtifactSetToFileCollectionFactory(TaskDependencyFactory taskDependencyFactory, BuildOperationExecutor buildOperationExecutor, InternalProblems problemsService) {
+        this.taskDependencyFactory = taskDependencyFactory;
         this.buildOperationExecutor = buildOperationExecutor;
         this.problemsService = problemsService;
     }
@@ -61,13 +64,13 @@ public ResolutionHost resolutionHost(String displayName) {
     }
 
     /**
-     * Presents the contents of the given artifacts as a partial {@link SelectedArtifactSet} implementation.
+     * Presents the contents of the given artifacts as a partial {@link FileCollectionInternal} implementation.
      *
      * <p>This produces only a minimal implementation to use for artifact sets loaded from the configuration cache
      * Over time, this should be merged with the FileCollection implementation in DefaultConfiguration
      */
-    public SelectedArtifactSet getSelectedArtifacts(List<?> elements) {
-        return new PartialSelectedArtifactSet(elements, buildOperationExecutor);
+    public ResolutionBackedFileCollection asFileCollection(String displayName, boolean lenient, List<?> elements) {
+        return new ResolutionBackedFileCollection(new PartialSelectedArtifactSet(elements, buildOperationExecutor), lenient, new NameBackedResolutionHost(problemsService, displayName), taskDependencyFactory);
     }
 
     public ResolvedArtifactSet asResolvedArtifactSet(Throwable failure) {
@@ -280,5 +283,4 @@ public void visitDependencies(TaskDependencyResolveContext context) {
             // No dependencies
         }
     }
-
 }
diff --git a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/resolver/DefaultResolutionOutputs.java b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/resolver/DefaultResolutionOutputs.java
index ea63ca95c1d..3568b3ce645 100644
--- a/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/resolver/DefaultResolutionOutputs.java
+++ b/platforms/software/dependency-management/src/main/java/org/gradle/api/internal/artifacts/resolver/DefaultResolutionOutputs.java
@@ -26,6 +26,7 @@
 import org.gradle.api.internal.artifacts.ResolverResults;
 import org.gradle.api.internal.artifacts.configurations.ArtifactCollectionInternal;
 import org.gradle.api.internal.artifacts.configurations.DefaultArtifactCollection;
+import org.gradle.api.internal.artifacts.configurations.ResolutionBackedFileCollection;
 import org.gradle.api.internal.artifacts.configurations.ResolutionResultProviderBackedSelectedArtifactSet;
 import org.gradle.api.internal.artifacts.ivyservice.resolveengine.artifact.ArtifactSelectionSpec;
 import org.gradle.api.internal.artifacts.ivyservice.resolveengine.artifact.SelectedArtifactSet;
@@ -176,23 +177,25 @@ public DefaultArtifactView(
 
         @Override
         public ArtifactCollectionInternal getArtifacts() {
-            SelectedArtifactSet selectedArtifacts = new ResolutionResultProviderBackedSelectedArtifactSet(
-                resolutionAccess.getResults().map(this::selectArtifacts)
-            );
-
             return new DefaultArtifactCollection(
-                selectedArtifacts,
+                getFiles(),
                 lenient,
                 resolutionAccess.getHost(),
-                taskDependencyFactory,
                 calculatedValueContainerFactory,
                 attributeDesugaring
             );
         }
 
         @Override
-        public FileCollectionInternal getFiles() {
-            return getArtifacts().getArtifactFiles();
+        public ResolutionBackedFileCollection getFiles() {
+            return new ResolutionBackedFileCollection(
+                new ResolutionResultProviderBackedSelectedArtifactSet(
+                    resolutionAccess.getResults().map(this::selectArtifacts)
+                ),
+                lenient,
+                resolutionAccess.getHost(),
+                taskDependencyFactory
+            );
         }
 
         private SelectedArtifactSet selectArtifacts(ResolverResults results) {
diff --git a/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/configurations/DefaultConfigurationSpec.groovy b/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/configurations/DefaultConfigurationSpec.groovy
index 074915fb913..5c164777ae1 100644
--- a/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/configurations/DefaultConfigurationSpec.groovy
+++ b/platforms/software/dependency-management/src/test/groovy/org/gradle/api/internal/artifacts/configurations/DefaultConfigurationSpec.groovy
@@ -45,6 +45,7 @@ import org.gradle.api.internal.artifacts.DefaultResolverResults
 import org.gradle.api.internal.artifacts.DependencyResolutionServices
 import org.gradle.api.internal.artifacts.ResolveExceptionMapper
 import org.gradle.api.internal.artifacts.ResolverResults
+import org.gradle.internal.component.model.VariantIdentifier
 import org.gradle.api.internal.artifacts.dependencies.DefaultExternalModuleDependency
 import org.gradle.api.internal.artifacts.dsl.PublishArtifactNotationParserFactory
 import org.gradle.api.internal.artifacts.ivyservice.TypedResolveException
@@ -70,10 +71,10 @@ import org.gradle.internal.Describables
 import org.gradle.internal.Factories
 import org.gradle.internal.code.UserCodeApplicationContext
 import org.gradle.internal.component.external.model.ImmutableCapabilities
-import org.gradle.internal.component.model.VariantIdentifier
 import org.gradle.internal.dispatch.Dispatch
 import org.gradle.internal.event.AnonymousListenerBroadcast
 import org.gradle.internal.event.ListenerManager
+import org.gradle.internal.model.CalculatedValueContainerFactory
 import org.gradle.internal.operations.TestBuildOperationRunner
 import org.gradle.testfixtures.ProjectBuilder
 import org.gradle.util.AttributeTestUtil
@@ -100,7 +101,7 @@ class DefaultConfigurationSpec extends Specification {
     def projectStateRegistry = Mock(ProjectStateRegistry)
     def domainObjectCollectionCallbackActionDecorator = Mock(CollectionCallbackActionDecorator)
     def userCodeApplicationContext = Mock(UserCodeApplicationContext)
-    def calculatedValueContainerFactory = TestUtil.calculatedValueContainerFactory()
+    def calculatedValueContainerFactory = Mock(CalculatedValueContainerFactory)
 
     def setup() {
         _ * listenerManager.createAnonymousBroadcaster(DependencyResolutionListener) >> { new AnonymousListenerBroadcast<DependencyResolutionListener>(DependencyResolutionListener, Stub(Dispatch)) }
diff --git a/testing/architecture-test/src/changes/archunit-store/platform-coupling.txt b/testing/architecture-test/src/changes/archunit-store/platform-coupling.txt
index e9c7f9c47a1..2a6eade60a4 100644
--- a/testing/architecture-test/src/changes/archunit-store/platform-coupling.txt
+++ b/testing/architecture-test/src/changes/archunit-store/platform-coupling.txt
@@ -107,7 +107,6 @@ Class 'org.gradle.internal.extensions.core.ScriptSourceExtensionsKt' from platfo
 Class 'org.gradle.internal.serialize.codecs.core.BaseTypesKt' from platform 'core' imports class 'org.gradle.api.internal.artifacts.ivyservice.resolveengine.result.BuildIdentifierSerializer' from a forbidden platform 'software'
 Class 'org.gradle.internal.serialize.codecs.core.CollectingVisitor' from platform 'core' imports class 'org.gradle.api.internal.artifacts.configurations.ResolutionBackedFileCollection' from a forbidden platform 'software'
 Class 'org.gradle.internal.serialize.codecs.core.CollectingVisitor' from platform 'core' imports class 'org.gradle.api.internal.artifacts.configurations.ResolutionHost' from a forbidden platform 'software'
-Class 'org.gradle.internal.serialize.codecs.core.FileCollectionCodec' from platform 'core' imports class 'org.gradle.api.internal.artifacts.configurations.ResolutionBackedFileCollection' from a forbidden platform 'software'
 Class 'org.gradle.internal.serialize.codecs.core.FileCollectionCodec' from platform 'core' imports class 'org.gradle.api.internal.artifacts.ivyservice.resolveengine.artifact.ArtifactSetToFileCollectionFactory' from a forbidden platform 'software'
 Class 'org.gradle.internal.serialize.codecs.dm.ArtifactCollectionCodec' from platform 'core' imports class 'org.gradle.api.internal.artifacts.configurations.ArtifactCollectionInternal' from a forbidden platform 'software'
 Class 'org.gradle.internal.serialize.codecs.dm.ArtifactCollectionCodec' from platform 'core' imports class 'org.gradle.api.internal.artifacts.configurations.DefaultArtifactCollection' from a forbidden platform 'software'
