diff --git a/ktor-server/ktor-server-servlet-jakarta/jvm/src/io/ktor/server/servlet/jakarta/ServletWriter.kt b/ktor-server/ktor-server-servlet-jakarta/jvm/src/io/ktor/server/servlet/jakarta/ServletWriter.kt
index 0ae7716ad..8f7064cad 100644
--- a/ktor-server/ktor-server-servlet-jakarta/jvm/src/io/ktor/server/servlet/jakarta/ServletWriter.kt
+++ b/ktor-server/ktor-server-servlet-jakarta/jvm/src/io/ktor/server/servlet/jakarta/ServletWriter.kt
@@ -77,7 +77,7 @@ private class ServletWriter(val output: ServletOutputStream) : WriteListener {
                 }
 
                 awaitReady()
-                output.write(buffer, 0, rc)
+                output.write(buffer, start, rc)
                 awaitReady()
                 rc
             }
diff --git a/ktor-server/ktor-server-servlet/jvm/src/io/ktor/server/servlet/ServletWriter.kt b/ktor-server/ktor-server-servlet/jvm/src/io/ktor/server/servlet/ServletWriter.kt
index 6e3298e40..ae706de56 100644
--- a/ktor-server/ktor-server-servlet/jvm/src/io/ktor/server/servlet/ServletWriter.kt
+++ b/ktor-server/ktor-server-servlet/jvm/src/io/ktor/server/servlet/ServletWriter.kt
@@ -77,7 +77,7 @@ private class ServletWriter(val output: ServletOutputStream) : WriteListener {
                 }
 
                 awaitReady()
-                output.write(buffer, 0, rc)
+                output.write(buffer, start, rc)
                 awaitReady()
                 rc
             }
diff --git a/ktor-server/ktor-server-tests/build.gradle.kts b/ktor-server/ktor-server-tests/build.gradle.kts
index 29c7a5681..2f7e66c29 100644
--- a/ktor-server/ktor-server-tests/build.gradle.kts
+++ b/ktor-server/ktor-server-tests/build.gradle.kts
@@ -15,6 +15,7 @@ kotlin.sourceSets {
     jvmTest {
         dependencies {
             implementation(libs.jansi)
+            implementation(project(":ktor-client:ktor-client-plugins:ktor-client-encoding"))
             api(project(":ktor-server:ktor-server-core", configuration = "testOutput"))
             api(libs.logback.classic)
             api(project(":ktor-server:ktor-server-plugins:ktor-server-sse"))
