diff --git a/ktor-server/ktor-server-plugins/ktor-server-di/api/ktor-server-di.api b/ktor-server/ktor-server-plugins/ktor-server-di/api/ktor-server-di.api
index e41dabeef..e60ac0465 100644
--- a/ktor-server/ktor-server-plugins/ktor-server-di/api/ktor-server-di.api
+++ b/ktor-server/ktor-server-plugins/ktor-server-di/api/ktor-server-di.api
@@ -24,6 +24,7 @@ public abstract interface class io/ktor/server/plugins/di/DependencyConflictPoli
 public final class io/ktor/server/plugins/di/DependencyConflictPolicyKt {
 	public static final fun getDefaultConflictPolicy ()Lio/ktor/server/plugins/di/DependencyConflictPolicy;
 	public static final fun getIgnoreConflicts ()Lio/ktor/server/plugins/di/DependencyConflictPolicy;
+	public static final fun getOverridePrevious ()Lio/ktor/server/plugins/di/DependencyConflictPolicy;
 }
 
 public abstract interface class io/ktor/server/plugins/di/DependencyConflictResult {
diff --git a/ktor-server/ktor-server-plugins/ktor-server-di/api/ktor-server-di.klib.api b/ktor-server/ktor-server-plugins/ktor-server-di/api/ktor-server-di.klib.api
index e130331b3..727425d39 100644
--- a/ktor-server/ktor-server-plugins/ktor-server-di/api/ktor-server-di.klib.api
+++ b/ktor-server/ktor-server-plugins/ktor-server-di/api/ktor-server-di.klib.api
@@ -393,6 +393,8 @@ final val io.ktor.server.plugins.di/Nullables // io.ktor.server.plugins.di/Nulla
     final fun <get-Nullables>(): io.ktor.server.plugins.di/DependencyKeyCovariance // io.ktor.server.plugins.di/Nullables.<get-Nullables>|<get-Nullables>(){}[0]
 final val io.ktor.server.plugins.di/OutTypeArgumentsSupertypes // io.ktor.server.plugins.di/OutTypeArgumentsSupertypes|{}OutTypeArgumentsSupertypes[0]
     final fun <get-OutTypeArgumentsSupertypes>(): io.ktor.server.plugins.di/DependencyKeyCovariance // io.ktor.server.plugins.di/OutTypeArgumentsSupertypes.<get-OutTypeArgumentsSupertypes>|<get-OutTypeArgumentsSupertypes>(){}[0]
+final val io.ktor.server.plugins.di/OverridePrevious // io.ktor.server.plugins.di/OverridePrevious|{}OverridePrevious[0]
+    final fun <get-OverridePrevious>(): io.ktor.server.plugins.di/DependencyConflictPolicy // io.ktor.server.plugins.di/OverridePrevious.<get-OverridePrevious>|<get-OverridePrevious>(){}[0]
 final val io.ktor.server.plugins.di/RawTypes // io.ktor.server.plugins.di/RawTypes|{}RawTypes[0]
     final fun <get-RawTypes>(): io.ktor.server.plugins.di/DependencyKeyCovariance // io.ktor.server.plugins.di/RawTypes.<get-RawTypes>|<get-RawTypes>(){}[0]
 final val io.ktor.server.plugins.di/Supertypes // io.ktor.server.plugins.di/Supertypes|{}Supertypes[0]
diff --git a/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyConflictPolicy.kt b/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyConflictPolicy.kt
index 99e88ee1a..4a8022354 100644
--- a/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyConflictPolicy.kt
+++ b/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyConflictPolicy.kt
@@ -77,14 +77,27 @@ public val DefaultConflictPolicy: DependencyConflictPolicy = DependencyConflictP
 }
 
 /**
- * During testing, we ignore conflicts.
- * This allows for replacing base implementations with mock values.
+ * During testing, we ignore conflicts by providing dependencies BEFORE loading modules.
+ * This allows for mocking out dependencies.
  *
  * [Report a problem](https://ktor.io/feedback/?fqname=io.ktor.server.plugins.di.IgnoreConflicts)
  */
 public val IgnoreConflicts: DependencyConflictPolicy = DependencyConflictPolicy { prev, current ->
     when (val result = DefaultConflictPolicy.resolve(prev, current)) {
-        is Conflict -> KeepPrevious
+        is Conflict, Ambiguous -> KeepPrevious
+        else -> result
+    }
+}
+
+/**
+ * Overrides the previous dependency with the newly provided one.
+ * This can be useful either for testing or in cases where consumers do not have control over the base implementations.
+ *
+ * [Report a problem](https://ktor.io/feedback/?fqname=io.ktor.server.plugins.di.OverridePrevious)
+ */
+public val OverridePrevious: DependencyConflictPolicy = DependencyConflictPolicy { prev, current ->
+    when (val result = DefaultConflictPolicy.resolve(prev, current)) {
+        is Conflict, Ambiguous -> KeepNew
         else -> result
     }
 }
@@ -97,3 +110,10 @@ private fun DependencyInitializer.distance(): Int = when (this) {
     is DependencyInitializer.Missing,
     is DependencyInitializer.Null -> Int.MAX_VALUE
 }
+
+internal fun parseConflictPolicy(name: String): DependencyConflictPolicy = when (name) {
+    "Default" -> DefaultConflictPolicy
+    "IgnoreConflicts" -> IgnoreConflicts
+    "OverridePrevious" -> OverridePrevious
+    else -> error("Unknown conflict policy: $name")
+}
diff --git a/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyInjection.kt b/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyInjection.kt
index ce52f8af4..f8983f5be 100644
--- a/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyInjection.kt
+++ b/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyInjection.kt
@@ -8,6 +8,7 @@ import io.ktor.server.application.*
 import io.ktor.server.plugins.di.utils.*
 import io.ktor.util.*
 import io.ktor.util.reflect.*
+import io.ktor.utils.io.CancellationException
 import kotlinx.coroutines.CoroutineName
 import kotlinx.coroutines.CoroutineScope
 import kotlinx.coroutines.ExperimentalCoroutinesApi
@@ -67,8 +68,12 @@ public val DI: ApplicationPlugin<DependencyInjectionConfig> =
                 ?.map { ClasspathReference(it) }
                 .orEmpty()
 
-        val configMap = ConfigurationDependencyMap(application.environment.config)
-        var extensionMap = pluginConfig.dependenciesMap?.let { it + configMap } ?: configMap
+        val configuration = application.environment.config
+        val configConflictPolicy = configuration.propertyOrNull("ktor.di.conflictPolicy")?.getString()
+        val configKeyMapping = configuration.propertyOrNull("ktor.di.keyMapping")?.getString()
+        val configDependencyMap = ConfigurationDependencyMap(configuration)
+
+        var extensionMap = pluginConfig.dependenciesMap?.let { it + configDependencyMap } ?: configDependencyMap
         for (extension in loadMapExtensions()) {
             extensionMap += extension.get(application)
         }
@@ -79,24 +84,41 @@ public val DI: ApplicationPlugin<DependencyInjectionConfig> =
                 application.coroutineContext +
                     CoroutineName("dependency-injection")
             )
-        val map: DependencyInitializerMap = mutableMapOf()
+        val dependencyMap: DependencyInitializerMap = mutableMapOf()
         val reflection = pluginConfig.reflection
         val useSuspend = startupMode == ApplicationStartupMode.CONCURRENT
-        val resolver = MapDependencyResolver(
-            map,
-            extensionMap,
-            reflection,
-            useSuspend,
-            coroutineScope,
-        )
         val conflictPolicy = pluginConfig.conflictPolicy
-            ?: if (isTestEngine()) IgnoreConflicts else DefaultConflictPolicy
+            ?: if (configConflictPolicy != null) {
+                parseConflictPolicy(configConflictPolicy)
+            } else if (isTestEngine()) {
+                IgnoreConflicts
+            } else {
+                DefaultConflictPolicy
+            }
+        val keyMapping = when (pluginConfig.keyMapping) {
+            DefaultKeyCovariance -> {
+                if (configKeyMapping != null) {
+                    parseKeyMapping(configKeyMapping)
+                } else {
+                    DefaultKeyCovariance
+                }
+            }
+            else -> pluginConfig.keyMapping
+        }
+
         val provider = MapDependencyProvider(
-            map = map,
-            keyMapping = pluginConfig.keyMapping,
+            map = dependencyMap,
+            keyMapping = keyMapping,
             conflictPolicy = conflictPolicy,
             onConflict = pluginConfig.onConflict,
         )
+        val resolver = MapDependencyResolver(
+            map = dependencyMap,
+            extension = extensionMap,
+            reflection = reflection,
+            waitForValues = useSuspend,
+            coroutineScope = coroutineScope,
+        )
         var registry = DependencyRegistry(resolver, provider)
 
         with(application) {
@@ -137,13 +159,15 @@ public val DI: ApplicationPlugin<DependencyInjectionConfig> =
                 }
             }
             monitor.subscribe(ApplicationStopping) {
-                for (key in map.keys.reversed()) {
+                for (key in dependencyMap.keys.reversed()) {
                     try {
                         val instance = registry.getDeferred<Any?>(key).tryGetCompleted() ?: continue
                         registry.shutdownHooks[key]?.invoke(instance)
                         onShutdown(key, instance)
                     } catch (e: Throwable) {
-                        environment.log.warn("Exception during cleanup for $key; continuing", e)
+                        if (e !is CancellationException) {
+                            environment.log.warn("Exception during cleanup for $key; continuing", e)
+                        }
                     }
                 }
                 coroutineScope.cancel("Application stopped")
diff --git a/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyKeyCovariance.kt b/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyKeyCovariance.kt
index 5ce39ee9c..7e4410f6b 100644
--- a/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyKeyCovariance.kt
+++ b/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyKeyCovariance.kt
@@ -160,3 +160,127 @@ public operator fun DependencyKeyCovariance.plus(other: DependencyKeyCovariance)
  */
 public val DefaultKeyCovariance: DependencyKeyCovariance =
     Supertypes * Nullables * OutTypeArgumentsSupertypes * RawTypes
+
+/**
+ * Parses expressions using the OOTB key mapping rules.
+ *
+ * See [DependencyKeyCovarianceParser.mappings] for the list of supported OOTB options.
+ *
+ * When using expressions, operators are supported, including `+`, `*`, and `()`.
+ *
+ * Examples:
+ * - `Supertypes * Nullables` will provide all supertypes and nullable versions of those supertypes.
+ * - `Supertypes + (Nullables + Unnamed)` will provide the same, but also unnamed versions of the supertypes.
+ *    It will not include nullable, unnamed versions of the supertypes, however.
+ */
+internal fun parseKeyMapping(text: String): DependencyKeyCovariance {
+    return DependencyKeyCovarianceParser(text).parse()
+}
+
+private class DependencyKeyCovarianceParser(
+    private val text: String,
+) {
+    companion object {
+        private val mappings = mapOf(
+            "Supertypes" to Supertypes,
+            "SuperTypes" to Supertypes,
+            "Unnamed" to Unnamed,
+            "Nullables" to Nullables,
+            "OutTypeArgumentsSupertypes" to OutTypeArgumentsSupertypes,
+            "RawTypes" to RawTypes,
+            "Default" to DefaultKeyCovariance
+        )
+    }
+    private var position = 0
+
+    fun parse(): DependencyKeyCovariance {
+        skipWhitespace()
+        val result = parseAddition()
+        skipWhitespace()
+        check(position >= text.length) {
+            "Unexpected character at position $position: '${text[position]}'"
+        }
+        return result
+    }
+
+    private fun parseAddition(): DependencyKeyCovariance {
+        var left = parseMultiplication()
+
+        while (true) {
+            skipWhitespace()
+            if (position >= text.length || peek() != '+') break
+
+            consume('+')
+            skipWhitespace()
+            val right = parseMultiplication()
+            left += right
+        }
+
+        return left
+    }
+
+    private fun parseMultiplication(): DependencyKeyCovariance {
+        var left = parsePrimary()
+
+        while (true) {
+            skipWhitespace()
+            if (position >= text.length || peek() != '*') break
+
+            consume('*')
+            skipWhitespace()
+            val right = parsePrimary()
+            left *= right
+        }
+
+        return left
+    }
+
+    private fun parsePrimary(): DependencyKeyCovariance {
+        skipWhitespace()
+
+        return when {
+            position >= text.length -> error("Unexpected end of expression")
+            peek() == '(' -> {
+                consume('(')
+                val result = parseAddition()
+                skipWhitespace()
+                consume(')')
+                result
+            }
+            else -> parseIdentifier()
+        }
+    }
+
+    private fun parseIdentifier(): DependencyKeyCovariance {
+        val start = position
+        while (position < text.length && (text[position].isLetterOrDigit() || text[position] == '_')) {
+            position++
+        }
+
+        check(start < position) {
+            "Expected identifier at position $position"
+        }
+
+        val identifier = text.substring(start, position)
+        return mappings[identifier]
+            ?: error("Unknown mapping: '$identifier'. Available: ${mappings.keys.joinToString(", ")}")
+    }
+
+    private fun skipWhitespace() {
+        while (position < text.length && text[position].isWhitespace()) {
+            position++
+        }
+    }
+
+    private fun peek(): Char = text[position]
+
+    private fun consume(expected: Char) {
+        check(position < text.length) {
+            "Expected '$expected' but reached end of expression"
+        }
+        check(text[position] == expected) {
+            "Expected '$expected' but found '${text[position]}' at position $position"
+        }
+        position++
+    }
+}
diff --git a/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyResolution.kt b/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyResolution.kt
index 3982eb4c3..36247fea6 100644
--- a/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyResolution.kt
+++ b/ktor-server/ktor-server-plugins/ktor-server-di/common/src/io/ktor/server/plugins/di/DependencyResolution.kt
@@ -78,7 +78,7 @@ public interface DependencyMap {
      * @param key The unique key that identifies the dependency to check.
      * @return `true` if the dependency identified by the key is present in the map; otherwise `false`
      */
-    public fun contains(key: DependencyKey): Boolean
+    public operator fun contains(key: DependencyKey): Boolean
 
     public fun getInitializer(key: DependencyKey): DependencyInitializer
 }
